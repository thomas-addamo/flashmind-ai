(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();function tm(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Vh={exports:{}},eo={},Oh={exports:{}},K={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ls=Symbol.for("react.element"),nm=Symbol.for("react.portal"),im=Symbol.for("react.fragment"),sm=Symbol.for("react.strict_mode"),rm=Symbol.for("react.profiler"),om=Symbol.for("react.provider"),am=Symbol.for("react.context"),lm=Symbol.for("react.forward_ref"),um=Symbol.for("react.suspense"),cm=Symbol.for("react.memo"),dm=Symbol.for("react.lazy"),Ou=Symbol.iterator;function hm(n){return n===null||typeof n!="object"?null:(n=Ou&&n[Ou]||n["@@iterator"],typeof n=="function"?n:null)}var Gh={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Bh=Object.assign,zh={};function ki(n,e,t){this.props=n,this.context=e,this.refs=zh,this.updater=t||Gh}ki.prototype.isReactComponent={};ki.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ki.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function qh(){}qh.prototype=ki.prototype;function Sl(n,e,t){this.props=n,this.context=e,this.refs=zh,this.updater=t||Gh}var El=Sl.prototype=new qh;El.constructor=Sl;Bh(El,ki.prototype);El.isPureReactComponent=!0;var Gu=Array.isArray,$h=Object.prototype.hasOwnProperty,wl={current:null},Wh={key:!0,ref:!0,__self:!0,__source:!0};function Yh(n,e,t){var i,s={},r=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)$h.call(e,i)&&!Wh.hasOwnProperty(i)&&(s[i]=e[i]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];s.children=l}if(n&&n.defaultProps)for(i in a=n.defaultProps,a)s[i]===void 0&&(s[i]=a[i]);return{$$typeof:Ls,type:n,key:r,ref:o,props:s,_owner:wl.current}}function fm(n,e){return{$$typeof:Ls,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Cl(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ls}function pm(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Bu=/\/+/g;function ko(n,e){return typeof n=="object"&&n!==null&&n.key!=null?pm(""+n.key):e.toString(36)}function ur(n,e,t,i,s){var r=typeof n;(r==="undefined"||r==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Ls:case nm:o=!0}}if(o)return o=n,s=s(o),n=i===""?"."+ko(o,0):i,Gu(s)?(t="",n!=null&&(t=n.replace(Bu,"$&/")+"/"),ur(s,e,t,"",function(u){return u})):s!=null&&(Cl(s)&&(s=fm(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Bu,"$&/")+"/")+n)),e.push(s)),1;if(o=0,i=i===""?".":i+":",Gu(n))for(var a=0;a<n.length;a++){r=n[a];var l=i+ko(r,a);o+=ur(r,e,t,l,s)}else if(l=hm(n),typeof l=="function")for(n=l.call(n),a=0;!(r=n.next()).done;)r=r.value,l=i+ko(r,a++),o+=ur(r,e,t,l,s);else if(r==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Bs(n,e,t){if(n==null)return n;var i=[],s=0;return ur(n,i,"","",function(r){return e.call(t,r,s++)}),i}function gm(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Je={current:null},cr={transition:null},mm={ReactCurrentDispatcher:Je,ReactCurrentBatchConfig:cr,ReactCurrentOwner:wl};function Kh(){throw Error("act(...) is not supported in production builds of React.")}K.Children={map:Bs,forEach:function(n,e,t){Bs(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Bs(n,function(){e++}),e},toArray:function(n){return Bs(n,function(e){return e})||[]},only:function(n){if(!Cl(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};K.Component=ki;K.Fragment=im;K.Profiler=rm;K.PureComponent=Sl;K.StrictMode=sm;K.Suspense=um;K.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mm;K.act=Kh;K.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=Bh({},n.props),s=n.key,r=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=wl.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)$h.call(e,l)&&!Wh.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];i.children=a}return{$$typeof:Ls,type:n.type,key:s,ref:r,props:i,_owner:o}};K.createContext=function(n){return n={$$typeof:am,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:om,_context:n},n.Consumer=n};K.createElement=Yh;K.createFactory=function(n){var e=Yh.bind(null,n);return e.type=n,e};K.createRef=function(){return{current:null}};K.forwardRef=function(n){return{$$typeof:lm,render:n}};K.isValidElement=Cl;K.lazy=function(n){return{$$typeof:dm,_payload:{_status:-1,_result:n},_init:gm}};K.memo=function(n,e){return{$$typeof:cm,type:n,compare:e===void 0?null:e}};K.startTransition=function(n){var e=cr.transition;cr.transition={};try{n()}finally{cr.transition=e}};K.unstable_act=Kh;K.useCallback=function(n,e){return Je.current.useCallback(n,e)};K.useContext=function(n){return Je.current.useContext(n)};K.useDebugValue=function(){};K.useDeferredValue=function(n){return Je.current.useDeferredValue(n)};K.useEffect=function(n,e){return Je.current.useEffect(n,e)};K.useId=function(){return Je.current.useId()};K.useImperativeHandle=function(n,e,t){return Je.current.useImperativeHandle(n,e,t)};K.useInsertionEffect=function(n,e){return Je.current.useInsertionEffect(n,e)};K.useLayoutEffect=function(n,e){return Je.current.useLayoutEffect(n,e)};K.useMemo=function(n,e){return Je.current.useMemo(n,e)};K.useReducer=function(n,e,t){return Je.current.useReducer(n,e,t)};K.useRef=function(n){return Je.current.useRef(n)};K.useState=function(n){return Je.current.useState(n)};K.useSyncExternalStore=function(n,e,t){return Je.current.useSyncExternalStore(n,e,t)};K.useTransition=function(){return Je.current.useTransition()};K.version="18.3.1";Oh.exports=K;var Ee=Oh.exports;const ym=tm(Ee);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vm=Ee,_m=Symbol.for("react.element"),Am=Symbol.for("react.fragment"),Sm=Object.prototype.hasOwnProperty,Em=vm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wm={key:!0,ref:!0,__self:!0,__source:!0};function Jh(n,e,t){var i,s={},r=null,o=null;t!==void 0&&(r=""+t),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)Sm.call(e,i)&&!wm.hasOwnProperty(i)&&(s[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)s[i]===void 0&&(s[i]=e[i]);return{$$typeof:_m,type:n,key:r,ref:o,props:s,_owner:Em.current}}eo.Fragment=Am;eo.jsx=Jh;eo.jsxs=Jh;Vh.exports=eo;var x=Vh.exports,ca={},Xh={exports:{}},ft={},Qh={exports:{}},Zh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(b,O){var z=b.length;b.push(O);e:for(;0<z;){var Z=z-1>>>1,X=b[Z];if(0<s(X,O))b[Z]=O,b[z]=X,z=Z;else break e}}function t(b){return b.length===0?null:b[0]}function i(b){if(b.length===0)return null;var O=b[0],z=b.pop();if(z!==O){b[0]=z;e:for(var Z=0,X=b.length,ue=X>>>1;Z<ue;){var Qe=2*(Z+1)-1,Bt=b[Qe],ge=Qe+1,ne=b[ge];if(0>s(Bt,z))ge<X&&0>s(ne,Bt)?(b[Z]=ne,b[ge]=z,Z=ge):(b[Z]=Bt,b[Qe]=z,Z=Qe);else if(ge<X&&0>s(ne,z))b[Z]=ne,b[ge]=z,Z=ge;else break e}}return O}function s(b,O){var z=b.sortIndex-O.sortIndex;return z!==0?z:b.id-O.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],d=1,f=null,p=3,g=!1,m=!1,v=!1,S=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(b){for(var O=t(u);O!==null;){if(O.callback===null)i(u);else if(O.startTime<=b)i(u),O.sortIndex=O.expirationTime,e(l,O);else break;O=t(u)}}function E(b){if(v=!1,A(b),!m)if(t(l)!==null)m=!0,k(w);else{var O=t(u);O!==null&&U(E,O.startTime-b)}}function w(b,O){m=!1,v&&(v=!1,y(I),I=-1),g=!0;var z=p;try{for(A(O),f=t(l);f!==null&&(!(f.expirationTime>O)||b&&!L());){var Z=f.callback;if(typeof Z=="function"){f.callback=null,p=f.priorityLevel;var X=Z(f.expirationTime<=O);O=n.unstable_now(),typeof X=="function"?f.callback=X:f===t(l)&&i(l),A(O)}else i(l);f=t(l)}if(f!==null)var ue=!0;else{var Qe=t(u);Qe!==null&&U(E,Qe.startTime-O),ue=!1}return ue}finally{f=null,p=z,g=!1}}var C=!1,T=null,I=-1,P=5,R=-1;function L(){return!(n.unstable_now()-R<P)}function V(){if(T!==null){var b=n.unstable_now();R=b;var O=!0;try{O=T(!0,b)}finally{O?J():(C=!1,T=null)}}else C=!1}var J;if(typeof _=="function")J=function(){_(V)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,Ae=ee.port2;ee.port1.onmessage=V,J=function(){Ae.postMessage(null)}}else J=function(){S(V,0)};function k(b){T=b,C||(C=!0,J())}function U(b,O){I=S(function(){b(n.unstable_now())},O)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(b){b.callback=null},n.unstable_continueExecution=function(){m||g||(m=!0,k(w))},n.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<b?Math.floor(1e3/b):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(b){switch(p){case 1:case 2:case 3:var O=3;break;default:O=p}var z=p;p=O;try{return b()}finally{p=z}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(b,O){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var z=p;p=b;try{return O()}finally{p=z}},n.unstable_scheduleCallback=function(b,O,z){var Z=n.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?Z+z:Z):z=Z,b){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=z+X,b={id:d++,callback:O,priorityLevel:b,startTime:z,expirationTime:X,sortIndex:-1},z>Z?(b.sortIndex=z,e(u,b),t(l)===null&&b===t(u)&&(v?(y(I),I=-1):v=!0,U(E,z-Z))):(b.sortIndex=X,e(l,b),m||g||(m=!0,k(w))),b},n.unstable_shouldYield=L,n.unstable_wrapCallback=function(b){var O=p;return function(){var z=p;p=O;try{return b.apply(this,arguments)}finally{p=z}}}})(Zh);Qh.exports=Zh;var Cm=Qh.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tm=Ee,ht=Cm;function M(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jh=new Set,gs={};function Wn(n,e){wi(n,e),wi(n+"Capture",e)}function wi(n,e){for(gs[n]=e,n=0;n<e.length;n++)jh.add(e[n])}var Xt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),da=Object.prototype.hasOwnProperty,xm=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,zu={},qu={};function Im(n){return da.call(qu,n)?!0:da.call(zu,n)?!1:xm.test(n)?qu[n]=!0:(zu[n]=!0,!1)}function Pm(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Rm(n,e,t,i){if(e===null||typeof e>"u"||Pm(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xe(n,e,t,i,s,r,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var De={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){De[n]=new Xe(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];De[e]=new Xe(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){De[n]=new Xe(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){De[n]=new Xe(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){De[n]=new Xe(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){De[n]=new Xe(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){De[n]=new Xe(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){De[n]=new Xe(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){De[n]=new Xe(n,5,!1,n.toLowerCase(),null,!1,!1)});var Tl=/[\-:]([a-z])/g;function xl(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Tl,xl);De[e]=new Xe(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Tl,xl);De[e]=new Xe(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Tl,xl);De[e]=new Xe(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){De[n]=new Xe(n,1,!1,n.toLowerCase(),null,!1,!1)});De.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){De[n]=new Xe(n,1,!1,n.toLowerCase(),null,!0,!0)});function Il(n,e,t,i){var s=De.hasOwnProperty(e)?De[e]:null;(s!==null?s.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Rm(e,t,s,i)&&(t=null),i||s===null?Im(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,i=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var tn=Tm.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,zs=Symbol.for("react.element"),jn=Symbol.for("react.portal"),ei=Symbol.for("react.fragment"),Pl=Symbol.for("react.strict_mode"),ha=Symbol.for("react.profiler"),ef=Symbol.for("react.provider"),tf=Symbol.for("react.context"),Rl=Symbol.for("react.forward_ref"),fa=Symbol.for("react.suspense"),pa=Symbol.for("react.suspense_list"),Ml=Symbol.for("react.memo"),on=Symbol.for("react.lazy"),nf=Symbol.for("react.offscreen"),$u=Symbol.iterator;function Ui(n){return n===null||typeof n!="object"?null:(n=$u&&n[$u]||n["@@iterator"],typeof n=="function"?n:null)}var pe=Object.assign,bo;function Xi(n){if(bo===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);bo=e&&e[1]||""}return`
`+bo+n}var No=!1;function Lo(n,e){if(!n||No)return"";No=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var i=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){i=u}n.call(e.prototype)}else{try{throw Error()}catch(u){i=u}n()}}catch(u){if(u&&i&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),r=i.stack.split(`
`),o=s.length-1,a=r.length-1;1<=o&&0<=a&&s[o]!==r[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==r[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==r[a]){var l=`
`+s[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{No=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Xi(n):""}function Mm(n){switch(n.tag){case 5:return Xi(n.type);case 16:return Xi("Lazy");case 13:return Xi("Suspense");case 19:return Xi("SuspenseList");case 0:case 2:case 15:return n=Lo(n.type,!1),n;case 11:return n=Lo(n.type.render,!1),n;case 1:return n=Lo(n.type,!0),n;default:return""}}function ga(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case ei:return"Fragment";case jn:return"Portal";case ha:return"Profiler";case Pl:return"StrictMode";case fa:return"Suspense";case pa:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case tf:return(n.displayName||"Context")+".Consumer";case ef:return(n._context.displayName||"Context")+".Provider";case Rl:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Ml:return e=n.displayName||null,e!==null?e:ga(n.type)||"Memo";case on:e=n._payload,n=n._init;try{return ga(n(e))}catch{}}return null}function km(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ga(e);case 8:return e===Pl?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function En(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function sf(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function bm(n){var e=sf(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,r=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){i=""+o,r.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function qs(n){n._valueTracker||(n._valueTracker=bm(n))}function rf(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=sf(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function Cr(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function ma(n,e){var t=e.checked;return pe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Wu(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=En(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function of(n,e){e=e.checked,e!=null&&Il(n,"checked",e,!1)}function ya(n,e){of(n,e);var t=En(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?va(n,e.type,t):e.hasOwnProperty("defaultValue")&&va(n,e.type,En(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Yu(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function va(n,e,t){(e!=="number"||Cr(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Qi=Array.isArray;function fi(n,e,t,i){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&i&&(n[t].defaultSelected=!0)}else{for(t=""+En(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,i&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function _a(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(M(91));return pe({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Ku(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(M(92));if(Qi(t)){if(1<t.length)throw Error(M(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:En(t)}}function af(n,e){var t=En(e.value),i=En(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function Ju(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function lf(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Aa(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?lf(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var $s,uf=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for($s=$s||document.createElement("div"),$s.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=$s.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function ms(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var ns={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Nm=["Webkit","ms","Moz","O"];Object.keys(ns).forEach(function(n){Nm.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),ns[e]=ns[n]})});function cf(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||ns.hasOwnProperty(n)&&ns[n]?(""+e).trim():e+"px"}function df(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,s=cf(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,s):n[t]=s}}var Lm=pe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sa(n,e){if(e){if(Lm[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(M(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(M(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(M(61))}if(e.style!=null&&typeof e.style!="object")throw Error(M(62))}}function Ea(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wa=null;function kl(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Ca=null,pi=null,gi=null;function Xu(n){if(n=Us(n)){if(typeof Ca!="function")throw Error(M(280));var e=n.stateNode;e&&(e=ro(e),Ca(n.stateNode,n.type,e))}}function hf(n){pi?gi?gi.push(n):gi=[n]:pi=n}function ff(){if(pi){var n=pi,e=gi;if(gi=pi=null,Xu(n),e)for(n=0;n<e.length;n++)Xu(e[n])}}function pf(n,e){return n(e)}function gf(){}var Do=!1;function mf(n,e,t){if(Do)return n(e,t);Do=!0;try{return pf(n,e,t)}finally{Do=!1,(pi!==null||gi!==null)&&(gf(),ff())}}function ys(n,e){var t=n.stateNode;if(t===null)return null;var i=ro(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(M(231,e,typeof t));return t}var Ta=!1;if(Xt)try{var Hi={};Object.defineProperty(Hi,"passive",{get:function(){Ta=!0}}),window.addEventListener("test",Hi,Hi),window.removeEventListener("test",Hi,Hi)}catch{Ta=!1}function Dm(n,e,t,i,s,r,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(d){this.onError(d)}}var is=!1,Tr=null,xr=!1,xa=null,Fm={onError:function(n){is=!0,Tr=n}};function Um(n,e,t,i,s,r,o,a,l){is=!1,Tr=null,Dm.apply(Fm,arguments)}function Hm(n,e,t,i,s,r,o,a,l){if(Um.apply(this,arguments),is){if(is){var u=Tr;is=!1,Tr=null}else throw Error(M(198));xr||(xr=!0,xa=u)}}function Yn(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function yf(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Qu(n){if(Yn(n)!==n)throw Error(M(188))}function Vm(n){var e=n.alternate;if(!e){if(e=Yn(n),e===null)throw Error(M(188));return e!==n?null:n}for(var t=n,i=e;;){var s=t.return;if(s===null)break;var r=s.alternate;if(r===null){if(i=s.return,i!==null){t=i;continue}break}if(s.child===r.child){for(r=s.child;r;){if(r===t)return Qu(s),n;if(r===i)return Qu(s),e;r=r.sibling}throw Error(M(188))}if(t.return!==i.return)t=s,i=r;else{for(var o=!1,a=s.child;a;){if(a===t){o=!0,t=s,i=r;break}if(a===i){o=!0,i=s,t=r;break}a=a.sibling}if(!o){for(a=r.child;a;){if(a===t){o=!0,t=r,i=s;break}if(a===i){o=!0,i=r,t=s;break}a=a.sibling}if(!o)throw Error(M(189))}}if(t.alternate!==i)throw Error(M(190))}if(t.tag!==3)throw Error(M(188));return t.stateNode.current===t?n:e}function vf(n){return n=Vm(n),n!==null?_f(n):null}function _f(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=_f(n);if(e!==null)return e;n=n.sibling}return null}var Af=ht.unstable_scheduleCallback,Zu=ht.unstable_cancelCallback,Om=ht.unstable_shouldYield,Gm=ht.unstable_requestPaint,ve=ht.unstable_now,Bm=ht.unstable_getCurrentPriorityLevel,bl=ht.unstable_ImmediatePriority,Sf=ht.unstable_UserBlockingPriority,Ir=ht.unstable_NormalPriority,zm=ht.unstable_LowPriority,Ef=ht.unstable_IdlePriority,to=null,Ot=null;function qm(n){if(Ot&&typeof Ot.onCommitFiberRoot=="function")try{Ot.onCommitFiberRoot(to,n,void 0,(n.current.flags&128)===128)}catch{}}var Rt=Math.clz32?Math.clz32:Ym,$m=Math.log,Wm=Math.LN2;function Ym(n){return n>>>=0,n===0?32:31-($m(n)/Wm|0)|0}var Ws=64,Ys=4194304;function Zi(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Pr(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,s=n.suspendedLanes,r=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~s;a!==0?i=Zi(a):(r&=o,r!==0&&(i=Zi(r)))}else o=t&~s,o!==0?i=Zi(o):r!==0&&(i=Zi(r));if(i===0)return 0;if(e!==0&&e!==i&&!(e&s)&&(s=i&-i,r=e&-e,s>=r||s===16&&(r&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-Rt(e),s=1<<t,i|=n[t],e&=~s;return i}function Km(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jm(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,s=n.expirationTimes,r=n.pendingLanes;0<r;){var o=31-Rt(r),a=1<<o,l=s[o];l===-1?(!(a&t)||a&i)&&(s[o]=Km(a,e)):l<=e&&(n.expiredLanes|=a),r&=~a}}function Ia(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function wf(){var n=Ws;return Ws<<=1,!(Ws&4194240)&&(Ws=64),n}function Fo(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Ds(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Rt(e),n[e]=t}function Xm(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-Rt(t),r=1<<s;e[s]=0,i[s]=-1,n[s]=-1,t&=~r}}function Nl(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-Rt(t),s=1<<i;s&e|n[i]&e&&(n[i]|=e),t&=~s}}var ie=0;function Cf(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Tf,Ll,xf,If,Pf,Pa=!1,Ks=[],fn=null,pn=null,gn=null,vs=new Map,_s=new Map,ln=[],Qm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ju(n,e){switch(n){case"focusin":case"focusout":fn=null;break;case"dragenter":case"dragleave":pn=null;break;case"mouseover":case"mouseout":gn=null;break;case"pointerover":case"pointerout":vs.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":_s.delete(e.pointerId)}}function Vi(n,e,t,i,s,r){return n===null||n.nativeEvent!==r?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:r,targetContainers:[s]},e!==null&&(e=Us(e),e!==null&&Ll(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function Zm(n,e,t,i,s){switch(e){case"focusin":return fn=Vi(fn,n,e,t,i,s),!0;case"dragenter":return pn=Vi(pn,n,e,t,i,s),!0;case"mouseover":return gn=Vi(gn,n,e,t,i,s),!0;case"pointerover":var r=s.pointerId;return vs.set(r,Vi(vs.get(r)||null,n,e,t,i,s)),!0;case"gotpointercapture":return r=s.pointerId,_s.set(r,Vi(_s.get(r)||null,n,e,t,i,s)),!0}return!1}function Rf(n){var e=Nn(n.target);if(e!==null){var t=Yn(e);if(t!==null){if(e=t.tag,e===13){if(e=yf(t),e!==null){n.blockedOn=e,Pf(n.priority,function(){xf(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function dr(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Ra(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);wa=i,t.target.dispatchEvent(i),wa=null}else return e=Us(t),e!==null&&Ll(e),n.blockedOn=t,!1;e.shift()}return!0}function ec(n,e,t){dr(n)&&t.delete(e)}function jm(){Pa=!1,fn!==null&&dr(fn)&&(fn=null),pn!==null&&dr(pn)&&(pn=null),gn!==null&&dr(gn)&&(gn=null),vs.forEach(ec),_s.forEach(ec)}function Oi(n,e){n.blockedOn===e&&(n.blockedOn=null,Pa||(Pa=!0,ht.unstable_scheduleCallback(ht.unstable_NormalPriority,jm)))}function As(n){function e(s){return Oi(s,n)}if(0<Ks.length){Oi(Ks[0],n);for(var t=1;t<Ks.length;t++){var i=Ks[t];i.blockedOn===n&&(i.blockedOn=null)}}for(fn!==null&&Oi(fn,n),pn!==null&&Oi(pn,n),gn!==null&&Oi(gn,n),vs.forEach(e),_s.forEach(e),t=0;t<ln.length;t++)i=ln[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<ln.length&&(t=ln[0],t.blockedOn===null);)Rf(t),t.blockedOn===null&&ln.shift()}var mi=tn.ReactCurrentBatchConfig,Rr=!0;function ey(n,e,t,i){var s=ie,r=mi.transition;mi.transition=null;try{ie=1,Dl(n,e,t,i)}finally{ie=s,mi.transition=r}}function ty(n,e,t,i){var s=ie,r=mi.transition;mi.transition=null;try{ie=4,Dl(n,e,t,i)}finally{ie=s,mi.transition=r}}function Dl(n,e,t,i){if(Rr){var s=Ra(n,e,t,i);if(s===null)Wo(n,e,i,Mr,t),ju(n,i);else if(Zm(s,n,e,t,i))i.stopPropagation();else if(ju(n,i),e&4&&-1<Qm.indexOf(n)){for(;s!==null;){var r=Us(s);if(r!==null&&Tf(r),r=Ra(n,e,t,i),r===null&&Wo(n,e,i,Mr,t),r===s)break;s=r}s!==null&&i.stopPropagation()}else Wo(n,e,i,null,t)}}var Mr=null;function Ra(n,e,t,i){if(Mr=null,n=kl(i),n=Nn(n),n!==null)if(e=Yn(n),e===null)n=null;else if(t=e.tag,t===13){if(n=yf(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Mr=n,null}function Mf(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Bm()){case bl:return 1;case Sf:return 4;case Ir:case zm:return 16;case Ef:return 536870912;default:return 16}default:return 16}}var dn=null,Fl=null,hr=null;function kf(){if(hr)return hr;var n,e=Fl,t=e.length,i,s="value"in dn?dn.value:dn.textContent,r=s.length;for(n=0;n<t&&e[n]===s[n];n++);var o=t-n;for(i=1;i<=o&&e[t-i]===s[r-i];i++);return hr=s.slice(n,1<i?1-i:void 0)}function fr(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Js(){return!0}function tc(){return!1}function pt(n){function e(t,i,s,r,o){this._reactName=t,this._targetInst=s,this.type=i,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(r):r[a]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?Js:tc,this.isPropagationStopped=tc,this}return pe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Js)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Js)},persist:function(){},isPersistent:Js}),e}var bi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ul=pt(bi),Fs=pe({},bi,{view:0,detail:0}),ny=pt(Fs),Uo,Ho,Gi,no=pe({},Fs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hl,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Gi&&(Gi&&n.type==="mousemove"?(Uo=n.screenX-Gi.screenX,Ho=n.screenY-Gi.screenY):Ho=Uo=0,Gi=n),Uo)},movementY:function(n){return"movementY"in n?n.movementY:Ho}}),nc=pt(no),iy=pe({},no,{dataTransfer:0}),sy=pt(iy),ry=pe({},Fs,{relatedTarget:0}),Vo=pt(ry),oy=pe({},bi,{animationName:0,elapsedTime:0,pseudoElement:0}),ay=pt(oy),ly=pe({},bi,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),uy=pt(ly),cy=pe({},bi,{data:0}),ic=pt(cy),dy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function py(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=fy[n])?!!e[n]:!1}function Hl(){return py}var gy=pe({},Fs,{key:function(n){if(n.key){var e=dy[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=fr(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?hy[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hl,charCode:function(n){return n.type==="keypress"?fr(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?fr(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),my=pt(gy),yy=pe({},no,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sc=pt(yy),vy=pe({},Fs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hl}),_y=pt(vy),Ay=pe({},bi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sy=pt(Ay),Ey=pe({},no,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),wy=pt(Ey),Cy=[9,13,27,32],Vl=Xt&&"CompositionEvent"in window,ss=null;Xt&&"documentMode"in document&&(ss=document.documentMode);var Ty=Xt&&"TextEvent"in window&&!ss,bf=Xt&&(!Vl||ss&&8<ss&&11>=ss),rc=" ",oc=!1;function Nf(n,e){switch(n){case"keyup":return Cy.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Lf(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var ti=!1;function xy(n,e){switch(n){case"compositionend":return Lf(e);case"keypress":return e.which!==32?null:(oc=!0,rc);case"textInput":return n=e.data,n===rc&&oc?null:n;default:return null}}function Iy(n,e){if(ti)return n==="compositionend"||!Vl&&Nf(n,e)?(n=kf(),hr=Fl=dn=null,ti=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return bf&&e.locale!=="ko"?null:e.data;default:return null}}var Py={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ac(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!Py[n.type]:e==="textarea"}function Df(n,e,t,i){hf(i),e=kr(e,"onChange"),0<e.length&&(t=new Ul("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var rs=null,Ss=null;function Ry(n){Wf(n,0)}function io(n){var e=si(n);if(rf(e))return n}function My(n,e){if(n==="change")return e}var Ff=!1;if(Xt){var Oo;if(Xt){var Go="oninput"in document;if(!Go){var lc=document.createElement("div");lc.setAttribute("oninput","return;"),Go=typeof lc.oninput=="function"}Oo=Go}else Oo=!1;Ff=Oo&&(!document.documentMode||9<document.documentMode)}function uc(){rs&&(rs.detachEvent("onpropertychange",Uf),Ss=rs=null)}function Uf(n){if(n.propertyName==="value"&&io(Ss)){var e=[];Df(e,Ss,n,kl(n)),mf(Ry,e)}}function ky(n,e,t){n==="focusin"?(uc(),rs=e,Ss=t,rs.attachEvent("onpropertychange",Uf)):n==="focusout"&&uc()}function by(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return io(Ss)}function Ny(n,e){if(n==="click")return io(e)}function Ly(n,e){if(n==="input"||n==="change")return io(e)}function Dy(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var kt=typeof Object.is=="function"?Object.is:Dy;function Es(n,e){if(kt(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var s=t[i];if(!da.call(e,s)||!kt(n[s],e[s]))return!1}return!0}function cc(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function dc(n,e){var t=cc(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=cc(t)}}function Hf(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Hf(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function Vf(){for(var n=window,e=Cr();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Cr(n.document)}return e}function Ol(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Fy(n){var e=Vf(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Hf(t.ownerDocument.documentElement,t)){if(i!==null&&Ol(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,r=Math.min(i.start,s);i=i.end===void 0?r:Math.min(i.end,s),!n.extend&&r>i&&(s=i,i=r,r=s),s=dc(t,r);var o=dc(t,i);s&&o&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),r>i?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Uy=Xt&&"documentMode"in document&&11>=document.documentMode,ni=null,Ma=null,os=null,ka=!1;function hc(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;ka||ni==null||ni!==Cr(i)||(i=ni,"selectionStart"in i&&Ol(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),os&&Es(os,i)||(os=i,i=kr(Ma,"onSelect"),0<i.length&&(e=new Ul("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=ni)))}function Xs(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ii={animationend:Xs("Animation","AnimationEnd"),animationiteration:Xs("Animation","AnimationIteration"),animationstart:Xs("Animation","AnimationStart"),transitionend:Xs("Transition","TransitionEnd")},Bo={},Of={};Xt&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ii.animationend.animation,delete ii.animationiteration.animation,delete ii.animationstart.animation),"TransitionEvent"in window||delete ii.transitionend.transition);function so(n){if(Bo[n])return Bo[n];if(!ii[n])return n;var e=ii[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in Of)return Bo[n]=e[t];return n}var Gf=so("animationend"),Bf=so("animationiteration"),zf=so("animationstart"),qf=so("transitionend"),$f=new Map,fc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xn(n,e){$f.set(n,e),Wn(e,[n])}for(var zo=0;zo<fc.length;zo++){var qo=fc[zo],Hy=qo.toLowerCase(),Vy=qo[0].toUpperCase()+qo.slice(1);xn(Hy,"on"+Vy)}xn(Gf,"onAnimationEnd");xn(Bf,"onAnimationIteration");xn(zf,"onAnimationStart");xn("dblclick","onDoubleClick");xn("focusin","onFocus");xn("focusout","onBlur");xn(qf,"onTransitionEnd");wi("onMouseEnter",["mouseout","mouseover"]);wi("onMouseLeave",["mouseout","mouseover"]);wi("onPointerEnter",["pointerout","pointerover"]);wi("onPointerLeave",["pointerout","pointerover"]);Wn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ji="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oy=new Set("cancel close invalid load scroll toggle".split(" ").concat(ji));function pc(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,Hm(i,e,void 0,n),n.currentTarget=null}function Wf(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],s=i.event;i=i.listeners;e:{var r=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==r&&s.isPropagationStopped())break e;pc(s,a,u),r=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==r&&s.isPropagationStopped())break e;pc(s,a,u),r=l}}}if(xr)throw n=xa,xr=!1,xa=null,n}function oe(n,e){var t=e[Fa];t===void 0&&(t=e[Fa]=new Set);var i=n+"__bubble";t.has(i)||(Yf(e,n,2,!1),t.add(i))}function $o(n,e,t){var i=0;e&&(i|=4),Yf(t,n,i,e)}var Qs="_reactListening"+Math.random().toString(36).slice(2);function ws(n){if(!n[Qs]){n[Qs]=!0,jh.forEach(function(t){t!=="selectionchange"&&(Oy.has(t)||$o(t,!1,n),$o(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Qs]||(e[Qs]=!0,$o("selectionchange",!1,e))}}function Yf(n,e,t,i){switch(Mf(e)){case 1:var s=ey;break;case 4:s=ty;break;default:s=Dl}t=s.bind(null,e,t,n),s=void 0,!Ta||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function Wo(n,e,t,i,s){var r=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=Nn(a),o===null)return;if(l=o.tag,l===5||l===6){i=r=o;continue e}a=a.parentNode}}i=i.return}mf(function(){var u=r,d=kl(t),f=[];e:{var p=$f.get(n);if(p!==void 0){var g=Ul,m=n;switch(n){case"keypress":if(fr(t)===0)break e;case"keydown":case"keyup":g=my;break;case"focusin":m="focus",g=Vo;break;case"focusout":m="blur",g=Vo;break;case"beforeblur":case"afterblur":g=Vo;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=nc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=sy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=_y;break;case Gf:case Bf:case zf:g=ay;break;case qf:g=Sy;break;case"scroll":g=ny;break;case"wheel":g=wy;break;case"copy":case"cut":case"paste":g=uy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=sc}var v=(e&4)!==0,S=!v&&n==="scroll",y=v?p!==null?p+"Capture":null:p;v=[];for(var _=u,A;_!==null;){A=_;var E=A.stateNode;if(A.tag===5&&E!==null&&(A=E,y!==null&&(E=ys(_,y),E!=null&&v.push(Cs(_,E,A)))),S)break;_=_.return}0<v.length&&(p=new g(p,m,null,t,d),f.push({event:p,listeners:v}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",g=n==="mouseout"||n==="pointerout",p&&t!==wa&&(m=t.relatedTarget||t.fromElement)&&(Nn(m)||m[Qt]))break e;if((g||p)&&(p=d.window===d?d:(p=d.ownerDocument)?p.defaultView||p.parentWindow:window,g?(m=t.relatedTarget||t.toElement,g=u,m=m?Nn(m):null,m!==null&&(S=Yn(m),m!==S||m.tag!==5&&m.tag!==6)&&(m=null)):(g=null,m=u),g!==m)){if(v=nc,E="onMouseLeave",y="onMouseEnter",_="mouse",(n==="pointerout"||n==="pointerover")&&(v=sc,E="onPointerLeave",y="onPointerEnter",_="pointer"),S=g==null?p:si(g),A=m==null?p:si(m),p=new v(E,_+"leave",g,t,d),p.target=S,p.relatedTarget=A,E=null,Nn(d)===u&&(v=new v(y,_+"enter",m,t,d),v.target=A,v.relatedTarget=S,E=v),S=E,g&&m)t:{for(v=g,y=m,_=0,A=v;A;A=Qn(A))_++;for(A=0,E=y;E;E=Qn(E))A++;for(;0<_-A;)v=Qn(v),_--;for(;0<A-_;)y=Qn(y),A--;for(;_--;){if(v===y||y!==null&&v===y.alternate)break t;v=Qn(v),y=Qn(y)}v=null}else v=null;g!==null&&gc(f,p,g,v,!1),m!==null&&S!==null&&gc(f,S,m,v,!0)}}e:{if(p=u?si(u):window,g=p.nodeName&&p.nodeName.toLowerCase(),g==="select"||g==="input"&&p.type==="file")var w=My;else if(ac(p))if(Ff)w=Ly;else{w=by;var C=ky}else(g=p.nodeName)&&g.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(w=Ny);if(w&&(w=w(n,u))){Df(f,w,t,d);break e}C&&C(n,p,u),n==="focusout"&&(C=p._wrapperState)&&C.controlled&&p.type==="number"&&va(p,"number",p.value)}switch(C=u?si(u):window,n){case"focusin":(ac(C)||C.contentEditable==="true")&&(ni=C,Ma=u,os=null);break;case"focusout":os=Ma=ni=null;break;case"mousedown":ka=!0;break;case"contextmenu":case"mouseup":case"dragend":ka=!1,hc(f,t,d);break;case"selectionchange":if(Uy)break;case"keydown":case"keyup":hc(f,t,d)}var T;if(Vl)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else ti?Nf(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(bf&&t.locale!=="ko"&&(ti||I!=="onCompositionStart"?I==="onCompositionEnd"&&ti&&(T=kf()):(dn=d,Fl="value"in dn?dn.value:dn.textContent,ti=!0)),C=kr(u,I),0<C.length&&(I=new ic(I,n,null,t,d),f.push({event:I,listeners:C}),T?I.data=T:(T=Lf(t),T!==null&&(I.data=T)))),(T=Ty?xy(n,t):Iy(n,t))&&(u=kr(u,"onBeforeInput"),0<u.length&&(d=new ic("onBeforeInput","beforeinput",null,t,d),f.push({event:d,listeners:u}),d.data=T))}Wf(f,e)})}function Cs(n,e,t){return{instance:n,listener:e,currentTarget:t}}function kr(n,e){for(var t=e+"Capture",i=[];n!==null;){var s=n,r=s.stateNode;s.tag===5&&r!==null&&(s=r,r=ys(n,t),r!=null&&i.unshift(Cs(n,r,s)),r=ys(n,e),r!=null&&i.push(Cs(n,r,s))),n=n.return}return i}function Qn(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function gc(n,e,t,i,s){for(var r=e._reactName,o=[];t!==null&&t!==i;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&u!==null&&(a=u,s?(l=ys(t,r),l!=null&&o.unshift(Cs(t,l,a))):s||(l=ys(t,r),l!=null&&o.push(Cs(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var Gy=/\r\n?/g,By=/\u0000|\uFFFD/g;function mc(n){return(typeof n=="string"?n:""+n).replace(Gy,`
`).replace(By,"")}function Zs(n,e,t){if(e=mc(e),mc(n)!==e&&t)throw Error(M(425))}function br(){}var ba=null,Na=null;function La(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Da=typeof setTimeout=="function"?setTimeout:void 0,zy=typeof clearTimeout=="function"?clearTimeout:void 0,yc=typeof Promise=="function"?Promise:void 0,qy=typeof queueMicrotask=="function"?queueMicrotask:typeof yc<"u"?function(n){return yc.resolve(null).then(n).catch($y)}:Da;function $y(n){setTimeout(function(){throw n})}function Yo(n,e){var t=e,i=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(i===0){n.removeChild(s),As(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=s}while(t);As(e)}function mn(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function vc(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ni=Math.random().toString(36).slice(2),Vt="__reactFiber$"+Ni,Ts="__reactProps$"+Ni,Qt="__reactContainer$"+Ni,Fa="__reactEvents$"+Ni,Wy="__reactListeners$"+Ni,Yy="__reactHandles$"+Ni;function Nn(n){var e=n[Vt];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Qt]||t[Vt]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=vc(n);n!==null;){if(t=n[Vt])return t;n=vc(n)}return e}n=t,t=n.parentNode}return null}function Us(n){return n=n[Vt]||n[Qt],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function si(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(M(33))}function ro(n){return n[Ts]||null}var Ua=[],ri=-1;function In(n){return{current:n}}function le(n){0>ri||(n.current=Ua[ri],Ua[ri]=null,ri--)}function re(n,e){ri++,Ua[ri]=n.current,n.current=e}var wn={},ze=In(wn),it=In(!1),Vn=wn;function Ci(n,e){var t=n.type.contextTypes;if(!t)return wn;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var s={},r;for(r in t)s[r]=e[r];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function st(n){return n=n.childContextTypes,n!=null}function Nr(){le(it),le(ze)}function _c(n,e,t){if(ze.current!==wn)throw Error(M(168));re(ze,e),re(it,t)}function Kf(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var s in i)if(!(s in e))throw Error(M(108,km(n)||"Unknown",s));return pe({},t,i)}function Lr(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||wn,Vn=ze.current,re(ze,n),re(it,it.current),!0}function Ac(n,e,t){var i=n.stateNode;if(!i)throw Error(M(169));t?(n=Kf(n,e,Vn),i.__reactInternalMemoizedMergedChildContext=n,le(it),le(ze),re(ze,n)):le(it),re(it,t)}var Wt=null,oo=!1,Ko=!1;function Jf(n){Wt===null?Wt=[n]:Wt.push(n)}function Ky(n){oo=!0,Jf(n)}function Pn(){if(!Ko&&Wt!==null){Ko=!0;var n=0,e=ie;try{var t=Wt;for(ie=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}Wt=null,oo=!1}catch(s){throw Wt!==null&&(Wt=Wt.slice(n+1)),Af(bl,Pn),s}finally{ie=e,Ko=!1}}return null}var oi=[],ai=0,Dr=null,Fr=0,yt=[],vt=0,On=null,Yt=1,Kt="";function kn(n,e){oi[ai++]=Fr,oi[ai++]=Dr,Dr=n,Fr=e}function Xf(n,e,t){yt[vt++]=Yt,yt[vt++]=Kt,yt[vt++]=On,On=n;var i=Yt;n=Kt;var s=32-Rt(i)-1;i&=~(1<<s),t+=1;var r=32-Rt(e)+s;if(30<r){var o=s-s%5;r=(i&(1<<o)-1).toString(32),i>>=o,s-=o,Yt=1<<32-Rt(e)+s|t<<s|i,Kt=r+n}else Yt=1<<r|t<<s|i,Kt=n}function Gl(n){n.return!==null&&(kn(n,1),Xf(n,1,0))}function Bl(n){for(;n===Dr;)Dr=oi[--ai],oi[ai]=null,Fr=oi[--ai],oi[ai]=null;for(;n===On;)On=yt[--vt],yt[vt]=null,Kt=yt[--vt],yt[vt]=null,Yt=yt[--vt],yt[vt]=null}var dt=null,ct=null,de=!1,Pt=null;function Qf(n,e){var t=_t(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Sc(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,dt=n,ct=mn(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,dt=n,ct=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=On!==null?{id:Yt,overflow:Kt}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=_t(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,dt=n,ct=null,!0):!1;default:return!1}}function Ha(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Va(n){if(de){var e=ct;if(e){var t=e;if(!Sc(n,e)){if(Ha(n))throw Error(M(418));e=mn(t.nextSibling);var i=dt;e&&Sc(n,e)?Qf(i,t):(n.flags=n.flags&-4097|2,de=!1,dt=n)}}else{if(Ha(n))throw Error(M(418));n.flags=n.flags&-4097|2,de=!1,dt=n}}}function Ec(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;dt=n}function js(n){if(n!==dt)return!1;if(!de)return Ec(n),de=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!La(n.type,n.memoizedProps)),e&&(e=ct)){if(Ha(n))throw Zf(),Error(M(418));for(;e;)Qf(n,e),e=mn(e.nextSibling)}if(Ec(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(M(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ct=mn(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ct=null}}else ct=dt?mn(n.stateNode.nextSibling):null;return!0}function Zf(){for(var n=ct;n;)n=mn(n.nextSibling)}function Ti(){ct=dt=null,de=!1}function zl(n){Pt===null?Pt=[n]:Pt.push(n)}var Jy=tn.ReactCurrentBatchConfig;function Bi(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(M(309));var i=t.stateNode}if(!i)throw Error(M(147,n));var s=i,r=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(o){var a=s.refs;o===null?delete a[r]:a[r]=o},e._stringRef=r,e)}if(typeof n!="string")throw Error(M(284));if(!t._owner)throw Error(M(290,n))}return n}function er(n,e){throw n=Object.prototype.toString.call(e),Error(M(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function wc(n){var e=n._init;return e(n._payload)}function jf(n){function e(y,_){if(n){var A=y.deletions;A===null?(y.deletions=[_],y.flags|=16):A.push(_)}}function t(y,_){if(!n)return null;for(;_!==null;)e(y,_),_=_.sibling;return null}function i(y,_){for(y=new Map;_!==null;)_.key!==null?y.set(_.key,_):y.set(_.index,_),_=_.sibling;return y}function s(y,_){return y=An(y,_),y.index=0,y.sibling=null,y}function r(y,_,A){return y.index=A,n?(A=y.alternate,A!==null?(A=A.index,A<_?(y.flags|=2,_):A):(y.flags|=2,_)):(y.flags|=1048576,_)}function o(y){return n&&y.alternate===null&&(y.flags|=2),y}function a(y,_,A,E){return _===null||_.tag!==6?(_=ta(A,y.mode,E),_.return=y,_):(_=s(_,A),_.return=y,_)}function l(y,_,A,E){var w=A.type;return w===ei?d(y,_,A.props.children,E,A.key):_!==null&&(_.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===on&&wc(w)===_.type)?(E=s(_,A.props),E.ref=Bi(y,_,A),E.return=y,E):(E=Ar(A.type,A.key,A.props,null,y.mode,E),E.ref=Bi(y,_,A),E.return=y,E)}function u(y,_,A,E){return _===null||_.tag!==4||_.stateNode.containerInfo!==A.containerInfo||_.stateNode.implementation!==A.implementation?(_=na(A,y.mode,E),_.return=y,_):(_=s(_,A.children||[]),_.return=y,_)}function d(y,_,A,E,w){return _===null||_.tag!==7?(_=Hn(A,y.mode,E,w),_.return=y,_):(_=s(_,A),_.return=y,_)}function f(y,_,A){if(typeof _=="string"&&_!==""||typeof _=="number")return _=ta(""+_,y.mode,A),_.return=y,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case zs:return A=Ar(_.type,_.key,_.props,null,y.mode,A),A.ref=Bi(y,null,_),A.return=y,A;case jn:return _=na(_,y.mode,A),_.return=y,_;case on:var E=_._init;return f(y,E(_._payload),A)}if(Qi(_)||Ui(_))return _=Hn(_,y.mode,A,null),_.return=y,_;er(y,_)}return null}function p(y,_,A,E){var w=_!==null?_.key:null;if(typeof A=="string"&&A!==""||typeof A=="number")return w!==null?null:a(y,_,""+A,E);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case zs:return A.key===w?l(y,_,A,E):null;case jn:return A.key===w?u(y,_,A,E):null;case on:return w=A._init,p(y,_,w(A._payload),E)}if(Qi(A)||Ui(A))return w!==null?null:d(y,_,A,E,null);er(y,A)}return null}function g(y,_,A,E,w){if(typeof E=="string"&&E!==""||typeof E=="number")return y=y.get(A)||null,a(_,y,""+E,w);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case zs:return y=y.get(E.key===null?A:E.key)||null,l(_,y,E,w);case jn:return y=y.get(E.key===null?A:E.key)||null,u(_,y,E,w);case on:var C=E._init;return g(y,_,A,C(E._payload),w)}if(Qi(E)||Ui(E))return y=y.get(A)||null,d(_,y,E,w,null);er(_,E)}return null}function m(y,_,A,E){for(var w=null,C=null,T=_,I=_=0,P=null;T!==null&&I<A.length;I++){T.index>I?(P=T,T=null):P=T.sibling;var R=p(y,T,A[I],E);if(R===null){T===null&&(T=P);break}n&&T&&R.alternate===null&&e(y,T),_=r(R,_,I),C===null?w=R:C.sibling=R,C=R,T=P}if(I===A.length)return t(y,T),de&&kn(y,I),w;if(T===null){for(;I<A.length;I++)T=f(y,A[I],E),T!==null&&(_=r(T,_,I),C===null?w=T:C.sibling=T,C=T);return de&&kn(y,I),w}for(T=i(y,T);I<A.length;I++)P=g(T,y,I,A[I],E),P!==null&&(n&&P.alternate!==null&&T.delete(P.key===null?I:P.key),_=r(P,_,I),C===null?w=P:C.sibling=P,C=P);return n&&T.forEach(function(L){return e(y,L)}),de&&kn(y,I),w}function v(y,_,A,E){var w=Ui(A);if(typeof w!="function")throw Error(M(150));if(A=w.call(A),A==null)throw Error(M(151));for(var C=w=null,T=_,I=_=0,P=null,R=A.next();T!==null&&!R.done;I++,R=A.next()){T.index>I?(P=T,T=null):P=T.sibling;var L=p(y,T,R.value,E);if(L===null){T===null&&(T=P);break}n&&T&&L.alternate===null&&e(y,T),_=r(L,_,I),C===null?w=L:C.sibling=L,C=L,T=P}if(R.done)return t(y,T),de&&kn(y,I),w;if(T===null){for(;!R.done;I++,R=A.next())R=f(y,R.value,E),R!==null&&(_=r(R,_,I),C===null?w=R:C.sibling=R,C=R);return de&&kn(y,I),w}for(T=i(y,T);!R.done;I++,R=A.next())R=g(T,y,I,R.value,E),R!==null&&(n&&R.alternate!==null&&T.delete(R.key===null?I:R.key),_=r(R,_,I),C===null?w=R:C.sibling=R,C=R);return n&&T.forEach(function(V){return e(y,V)}),de&&kn(y,I),w}function S(y,_,A,E){if(typeof A=="object"&&A!==null&&A.type===ei&&A.key===null&&(A=A.props.children),typeof A=="object"&&A!==null){switch(A.$$typeof){case zs:e:{for(var w=A.key,C=_;C!==null;){if(C.key===w){if(w=A.type,w===ei){if(C.tag===7){t(y,C.sibling),_=s(C,A.props.children),_.return=y,y=_;break e}}else if(C.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===on&&wc(w)===C.type){t(y,C.sibling),_=s(C,A.props),_.ref=Bi(y,C,A),_.return=y,y=_;break e}t(y,C);break}else e(y,C);C=C.sibling}A.type===ei?(_=Hn(A.props.children,y.mode,E,A.key),_.return=y,y=_):(E=Ar(A.type,A.key,A.props,null,y.mode,E),E.ref=Bi(y,_,A),E.return=y,y=E)}return o(y);case jn:e:{for(C=A.key;_!==null;){if(_.key===C)if(_.tag===4&&_.stateNode.containerInfo===A.containerInfo&&_.stateNode.implementation===A.implementation){t(y,_.sibling),_=s(_,A.children||[]),_.return=y,y=_;break e}else{t(y,_);break}else e(y,_);_=_.sibling}_=na(A,y.mode,E),_.return=y,y=_}return o(y);case on:return C=A._init,S(y,_,C(A._payload),E)}if(Qi(A))return m(y,_,A,E);if(Ui(A))return v(y,_,A,E);er(y,A)}return typeof A=="string"&&A!==""||typeof A=="number"?(A=""+A,_!==null&&_.tag===6?(t(y,_.sibling),_=s(_,A),_.return=y,y=_):(t(y,_),_=ta(A,y.mode,E),_.return=y,y=_),o(y)):t(y,_)}return S}var xi=jf(!0),ep=jf(!1),Ur=In(null),Hr=null,li=null,ql=null;function $l(){ql=li=Hr=null}function Wl(n){var e=Ur.current;le(Ur),n._currentValue=e}function Oa(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function yi(n,e){Hr=n,ql=li=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(nt=!0),n.firstContext=null)}function Et(n){var e=n._currentValue;if(ql!==n)if(n={context:n,memoizedValue:e,next:null},li===null){if(Hr===null)throw Error(M(308));li=n,Hr.dependencies={lanes:0,firstContext:n}}else li=li.next=n;return e}var Ln=null;function Yl(n){Ln===null?Ln=[n]:Ln.push(n)}function tp(n,e,t,i){var s=e.interleaved;return s===null?(t.next=t,Yl(e)):(t.next=s.next,s.next=t),e.interleaved=t,Zt(n,i)}function Zt(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var an=!1;function Kl(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function np(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Jt(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function yn(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,j&2){var s=i.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e,Zt(n,t)}return s=i.interleaved,s===null?(e.next=e,Yl(i)):(e.next=s.next,s.next=e),i.interleaved=e,Zt(n,t)}function pr(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,Nl(n,t)}}function Cc(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var s=null,r=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};r===null?s=r=o:r=r.next=o,t=t.next}while(t!==null);r===null?s=r=e:r=r.next=e}else s=r=e;t={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Vr(n,e,t,i){var s=n.updateQueue;an=!1;var r=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?r=u:o.next=u,o=l;var d=n.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=l))}if(r!==null){var f=s.baseState;o=0,d=u=l=null,a=r;do{var p=a.lane,g=a.eventTime;if((i&p)===p){d!==null&&(d=d.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=n,v=a;switch(p=e,g=t,v.tag){case 1:if(m=v.payload,typeof m=="function"){f=m.call(g,f,p);break e}f=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=v.payload,p=typeof m=="function"?m.call(g,f,p):m,p==null)break e;f=pe({},f,p);break e;case 2:an=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,p=s.effects,p===null?s.effects=[a]:p.push(a))}else g={eventTime:g,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=g,l=f):d=d.next=g,o|=p;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;p=a,a=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(!0);if(d===null&&(l=f),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=d,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else r===null&&(s.shared.lanes=0);Bn|=o,n.lanes=o,n.memoizedState=f}}function Tc(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],s=i.callback;if(s!==null){if(i.callback=null,i=t,typeof s!="function")throw Error(M(191,s));s.call(i)}}}var Hs={},Gt=In(Hs),xs=In(Hs),Is=In(Hs);function Dn(n){if(n===Hs)throw Error(M(174));return n}function Jl(n,e){switch(re(Is,e),re(xs,n),re(Gt,Hs),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Aa(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Aa(e,n)}le(Gt),re(Gt,e)}function Ii(){le(Gt),le(xs),le(Is)}function ip(n){Dn(Is.current);var e=Dn(Gt.current),t=Aa(e,n.type);e!==t&&(re(xs,n),re(Gt,t))}function Xl(n){xs.current===n&&(le(Gt),le(xs))}var he=In(0);function Or(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Jo=[];function Ql(){for(var n=0;n<Jo.length;n++)Jo[n]._workInProgressVersionPrimary=null;Jo.length=0}var gr=tn.ReactCurrentDispatcher,Xo=tn.ReactCurrentBatchConfig,Gn=0,fe=null,Ie=null,Me=null,Gr=!1,as=!1,Ps=0,Xy=0;function Fe(){throw Error(M(321))}function Zl(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!kt(n[t],e[t]))return!1;return!0}function jl(n,e,t,i,s,r){if(Gn=r,fe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,gr.current=n===null||n.memoizedState===null?ev:tv,n=t(i,s),as){r=0;do{if(as=!1,Ps=0,25<=r)throw Error(M(301));r+=1,Me=Ie=null,e.updateQueue=null,gr.current=nv,n=t(i,s)}while(as)}if(gr.current=Br,e=Ie!==null&&Ie.next!==null,Gn=0,Me=Ie=fe=null,Gr=!1,e)throw Error(M(300));return n}function eu(){var n=Ps!==0;return Ps=0,n}function Ut(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Me===null?fe.memoizedState=Me=n:Me=Me.next=n,Me}function wt(){if(Ie===null){var n=fe.alternate;n=n!==null?n.memoizedState:null}else n=Ie.next;var e=Me===null?fe.memoizedState:Me.next;if(e!==null)Me=e,Ie=n;else{if(n===null)throw Error(M(310));Ie=n,n={memoizedState:Ie.memoizedState,baseState:Ie.baseState,baseQueue:Ie.baseQueue,queue:Ie.queue,next:null},Me===null?fe.memoizedState=Me=n:Me=Me.next=n}return Me}function Rs(n,e){return typeof e=="function"?e(n):e}function Qo(n){var e=wt(),t=e.queue;if(t===null)throw Error(M(311));t.lastRenderedReducer=n;var i=Ie,s=i.baseQueue,r=t.pending;if(r!==null){if(s!==null){var o=s.next;s.next=r.next,r.next=o}i.baseQueue=s=r,t.pending=null}if(s!==null){r=s.next,i=i.baseState;var a=o=null,l=null,u=r;do{var d=u.lane;if((Gn&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:n(i,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=i):l=l.next=f,fe.lanes|=d,Bn|=d}u=u.next}while(u!==null&&u!==r);l===null?o=i:l.next=a,kt(i,e.memoizedState)||(nt=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){s=n;do r=s.lane,fe.lanes|=r,Bn|=r,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Zo(n){var e=wt(),t=e.queue;if(t===null)throw Error(M(311));t.lastRenderedReducer=n;var i=t.dispatch,s=t.pending,r=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do r=n(r,o.action),o=o.next;while(o!==s);kt(r,e.memoizedState)||(nt=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),t.lastRenderedState=r}return[r,i]}function sp(){}function rp(n,e){var t=fe,i=wt(),s=e(),r=!kt(i.memoizedState,s);if(r&&(i.memoizedState=s,nt=!0),i=i.queue,tu(lp.bind(null,t,i,n),[n]),i.getSnapshot!==e||r||Me!==null&&Me.memoizedState.tag&1){if(t.flags|=2048,Ms(9,ap.bind(null,t,i,s,e),void 0,null),ke===null)throw Error(M(349));Gn&30||op(t,e,s)}return s}function op(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=fe.updateQueue,e===null?(e={lastEffect:null,stores:null},fe.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function ap(n,e,t,i){e.value=t,e.getSnapshot=i,up(e)&&cp(n)}function lp(n,e,t){return t(function(){up(e)&&cp(n)})}function up(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!kt(n,t)}catch{return!0}}function cp(n){var e=Zt(n,1);e!==null&&Mt(e,n,1,-1)}function xc(n){var e=Ut();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rs,lastRenderedState:n},e.queue=n,n=n.dispatch=jy.bind(null,fe,n),[e.memoizedState,n]}function Ms(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=fe.updateQueue,e===null?(e={lastEffect:null,stores:null},fe.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function dp(){return wt().memoizedState}function mr(n,e,t,i){var s=Ut();fe.flags|=n,s.memoizedState=Ms(1|e,t,void 0,i===void 0?null:i)}function ao(n,e,t,i){var s=wt();i=i===void 0?null:i;var r=void 0;if(Ie!==null){var o=Ie.memoizedState;if(r=o.destroy,i!==null&&Zl(i,o.deps)){s.memoizedState=Ms(e,t,r,i);return}}fe.flags|=n,s.memoizedState=Ms(1|e,t,r,i)}function Ic(n,e){return mr(8390656,8,n,e)}function tu(n,e){return ao(2048,8,n,e)}function hp(n,e){return ao(4,2,n,e)}function fp(n,e){return ao(4,4,n,e)}function pp(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function gp(n,e,t){return t=t!=null?t.concat([n]):null,ao(4,4,pp.bind(null,e,n),t)}function nu(){}function mp(n,e){var t=wt();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Zl(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function yp(n,e){var t=wt();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Zl(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function vp(n,e,t){return Gn&21?(kt(t,e)||(t=wf(),fe.lanes|=t,Bn|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,nt=!0),n.memoizedState=t)}function Qy(n,e){var t=ie;ie=t!==0&&4>t?t:4,n(!0);var i=Xo.transition;Xo.transition={};try{n(!1),e()}finally{ie=t,Xo.transition=i}}function _p(){return wt().memoizedState}function Zy(n,e,t){var i=_n(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},Ap(n))Sp(e,t);else if(t=tp(n,e,t,i),t!==null){var s=Ye();Mt(t,n,i,s),Ep(t,e,i)}}function jy(n,e,t){var i=_n(n),s={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(Ap(n))Sp(e,s);else{var r=n.alternate;if(n.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var o=e.lastRenderedState,a=r(o,t);if(s.hasEagerState=!0,s.eagerState=a,kt(a,o)){var l=e.interleaved;l===null?(s.next=s,Yl(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=tp(n,e,s,i),t!==null&&(s=Ye(),Mt(t,n,i,s),Ep(t,e,i))}}function Ap(n){var e=n.alternate;return n===fe||e!==null&&e===fe}function Sp(n,e){as=Gr=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Ep(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,Nl(n,t)}}var Br={readContext:Et,useCallback:Fe,useContext:Fe,useEffect:Fe,useImperativeHandle:Fe,useInsertionEffect:Fe,useLayoutEffect:Fe,useMemo:Fe,useReducer:Fe,useRef:Fe,useState:Fe,useDebugValue:Fe,useDeferredValue:Fe,useTransition:Fe,useMutableSource:Fe,useSyncExternalStore:Fe,useId:Fe,unstable_isNewReconciler:!1},ev={readContext:Et,useCallback:function(n,e){return Ut().memoizedState=[n,e===void 0?null:e],n},useContext:Et,useEffect:Ic,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,mr(4194308,4,pp.bind(null,e,n),t)},useLayoutEffect:function(n,e){return mr(4194308,4,n,e)},useInsertionEffect:function(n,e){return mr(4,2,n,e)},useMemo:function(n,e){var t=Ut();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=Ut();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=Zy.bind(null,fe,n),[i.memoizedState,n]},useRef:function(n){var e=Ut();return n={current:n},e.memoizedState=n},useState:xc,useDebugValue:nu,useDeferredValue:function(n){return Ut().memoizedState=n},useTransition:function(){var n=xc(!1),e=n[0];return n=Qy.bind(null,n[1]),Ut().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=fe,s=Ut();if(de){if(t===void 0)throw Error(M(407));t=t()}else{if(t=e(),ke===null)throw Error(M(349));Gn&30||op(i,e,t)}s.memoizedState=t;var r={value:t,getSnapshot:e};return s.queue=r,Ic(lp.bind(null,i,r,n),[n]),i.flags|=2048,Ms(9,ap.bind(null,i,r,t,e),void 0,null),t},useId:function(){var n=Ut(),e=ke.identifierPrefix;if(de){var t=Kt,i=Yt;t=(i&~(1<<32-Rt(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=Ps++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Xy++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},tv={readContext:Et,useCallback:mp,useContext:Et,useEffect:tu,useImperativeHandle:gp,useInsertionEffect:hp,useLayoutEffect:fp,useMemo:yp,useReducer:Qo,useRef:dp,useState:function(){return Qo(Rs)},useDebugValue:nu,useDeferredValue:function(n){var e=wt();return vp(e,Ie.memoizedState,n)},useTransition:function(){var n=Qo(Rs)[0],e=wt().memoizedState;return[n,e]},useMutableSource:sp,useSyncExternalStore:rp,useId:_p,unstable_isNewReconciler:!1},nv={readContext:Et,useCallback:mp,useContext:Et,useEffect:tu,useImperativeHandle:gp,useInsertionEffect:hp,useLayoutEffect:fp,useMemo:yp,useReducer:Zo,useRef:dp,useState:function(){return Zo(Rs)},useDebugValue:nu,useDeferredValue:function(n){var e=wt();return Ie===null?e.memoizedState=n:vp(e,Ie.memoizedState,n)},useTransition:function(){var n=Zo(Rs)[0],e=wt().memoizedState;return[n,e]},useMutableSource:sp,useSyncExternalStore:rp,useId:_p,unstable_isNewReconciler:!1};function Tt(n,e){if(n&&n.defaultProps){e=pe({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Ga(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:pe({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var lo={isMounted:function(n){return(n=n._reactInternals)?Yn(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Ye(),s=_n(n),r=Jt(i,s);r.payload=e,t!=null&&(r.callback=t),e=yn(n,r,s),e!==null&&(Mt(e,n,s,i),pr(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Ye(),s=_n(n),r=Jt(i,s);r.tag=1,r.payload=e,t!=null&&(r.callback=t),e=yn(n,r,s),e!==null&&(Mt(e,n,s,i),pr(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ye(),i=_n(n),s=Jt(t,i);s.tag=2,e!=null&&(s.callback=e),e=yn(n,s,i),e!==null&&(Mt(e,n,i,t),pr(e,n,i))}};function Pc(n,e,t,i,s,r,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,r,o):e.prototype&&e.prototype.isPureReactComponent?!Es(t,i)||!Es(s,r):!0}function wp(n,e,t){var i=!1,s=wn,r=e.contextType;return typeof r=="object"&&r!==null?r=Et(r):(s=st(e)?Vn:ze.current,i=e.contextTypes,r=(i=i!=null)?Ci(n,s):wn),e=new e(t,r),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=lo,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=r),e}function Rc(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&lo.enqueueReplaceState(e,e.state,null)}function Ba(n,e,t,i){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Kl(n);var r=e.contextType;typeof r=="object"&&r!==null?s.context=Et(r):(r=st(e)?Vn:ze.current,s.context=Ci(n,r)),s.state=n.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(Ga(n,e,r,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&lo.enqueueReplaceState(s,s.state,null),Vr(n,t,s,i),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function Pi(n,e){try{var t="",i=e;do t+=Mm(i),i=i.return;while(i);var s=t}catch(r){s=`
Error generating stack: `+r.message+`
`+r.stack}return{value:n,source:e,stack:s,digest:null}}function jo(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function za(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var iv=typeof WeakMap=="function"?WeakMap:Map;function Cp(n,e,t){t=Jt(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){qr||(qr=!0,ja=i),za(n,e)},t}function Tp(n,e,t){t=Jt(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var s=e.value;t.payload=function(){return i(s)},t.callback=function(){za(n,e)}}var r=n.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(t.callback=function(){za(n,e),typeof i!="function"&&(vn===null?vn=new Set([this]):vn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Mc(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new iv;var s=new Set;i.set(e,s)}else s=i.get(e),s===void 0&&(s=new Set,i.set(e,s));s.has(t)||(s.add(t),n=yv.bind(null,n,e,t),e.then(n,n))}function kc(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function bc(n,e,t,i,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Jt(-1,1),e.tag=2,yn(t,e,1))),t.lanes|=1),n)}var sv=tn.ReactCurrentOwner,nt=!1;function We(n,e,t,i){e.child=n===null?ep(e,null,t,i):xi(e,n.child,t,i)}function Nc(n,e,t,i,s){t=t.render;var r=e.ref;return yi(e,s),i=jl(n,e,t,i,r,s),t=eu(),n!==null&&!nt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,jt(n,e,s)):(de&&t&&Gl(e),e.flags|=1,We(n,e,i,s),e.child)}function Lc(n,e,t,i,s){if(n===null){var r=t.type;return typeof r=="function"&&!cu(r)&&r.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=r,xp(n,e,r,i,s)):(n=Ar(t.type,null,i,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(r=n.child,!(n.lanes&s)){var o=r.memoizedProps;if(t=t.compare,t=t!==null?t:Es,t(o,i)&&n.ref===e.ref)return jt(n,e,s)}return e.flags|=1,n=An(r,i),n.ref=e.ref,n.return=e,e.child=n}function xp(n,e,t,i,s){if(n!==null){var r=n.memoizedProps;if(Es(r,i)&&n.ref===e.ref)if(nt=!1,e.pendingProps=i=r,(n.lanes&s)!==0)n.flags&131072&&(nt=!0);else return e.lanes=n.lanes,jt(n,e,s)}return qa(n,e,t,i,s)}function Ip(n,e,t){var i=e.pendingProps,s=i.children,r=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},re(ci,lt),lt|=t;else{if(!(t&1073741824))return n=r!==null?r.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,re(ci,lt),lt|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=r!==null?r.baseLanes:t,re(ci,lt),lt|=i}else r!==null?(i=r.baseLanes|t,e.memoizedState=null):i=t,re(ci,lt),lt|=i;return We(n,e,s,t),e.child}function Pp(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function qa(n,e,t,i,s){var r=st(t)?Vn:ze.current;return r=Ci(e,r),yi(e,s),t=jl(n,e,t,i,r,s),i=eu(),n!==null&&!nt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,jt(n,e,s)):(de&&i&&Gl(e),e.flags|=1,We(n,e,t,s),e.child)}function Dc(n,e,t,i,s){if(st(t)){var r=!0;Lr(e)}else r=!1;if(yi(e,s),e.stateNode===null)yr(n,e),wp(e,t,i),Ba(e,t,i,s),i=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=Et(u):(u=st(t)?Vn:ze.current,u=Ci(e,u));var d=t.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==u)&&Rc(e,o,i,u),an=!1;var p=e.memoizedState;o.state=p,Vr(e,i,o,s),l=e.memoizedState,a!==i||p!==l||it.current||an?(typeof d=="function"&&(Ga(e,t,d,i),l=e.memoizedState),(a=an||Pc(e,t,a,i,p,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=u,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,np(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:Tt(e.type,a),o.props=u,f=e.pendingProps,p=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Et(l):(l=st(t)?Vn:ze.current,l=Ci(e,l));var g=t.getDerivedStateFromProps;(d=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||p!==l)&&Rc(e,o,i,l),an=!1,p=e.memoizedState,o.state=p,Vr(e,i,o,s);var m=e.memoizedState;a!==f||p!==m||it.current||an?(typeof g=="function"&&(Ga(e,t,g,i),m=e.memoizedState),(u=an||Pc(e,t,u,i,p,m,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=m),o.props=i,o.state=m,o.context=l,i=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),i=!1)}return $a(n,e,t,i,r,s)}function $a(n,e,t,i,s,r){Pp(n,e);var o=(e.flags&128)!==0;if(!i&&!o)return s&&Ac(e,t,!1),jt(n,e,r);i=e.stateNode,sv.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&o?(e.child=xi(e,n.child,null,r),e.child=xi(e,null,a,r)):We(n,e,a,r),e.memoizedState=i.state,s&&Ac(e,t,!0),e.child}function Rp(n){var e=n.stateNode;e.pendingContext?_c(n,e.pendingContext,e.pendingContext!==e.context):e.context&&_c(n,e.context,!1),Jl(n,e.containerInfo)}function Fc(n,e,t,i,s){return Ti(),zl(s),e.flags|=256,We(n,e,t,i),e.child}var Wa={dehydrated:null,treeContext:null,retryLane:0};function Ya(n){return{baseLanes:n,cachePool:null,transitions:null}}function Mp(n,e,t){var i=e.pendingProps,s=he.current,r=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(r=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),re(he,s&1),n===null)return Va(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,n=i.fallback,r?(i=e.mode,r=e.child,o={mode:"hidden",children:o},!(i&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=ho(o,i,0,null),n=Hn(n,i,t,null),r.return=e,n.return=e,r.sibling=n,e.child=r,e.child.memoizedState=Ya(t),e.memoizedState=Wa,n):iu(e,o));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return rv(n,e,o,i,a,s,t);if(r){r=i.fallback,o=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==s?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=An(s,l),i.subtreeFlags=s.subtreeFlags&14680064),a!==null?r=An(a,r):(r=Hn(r,o,t,null),r.flags|=2),r.return=e,i.return=e,i.sibling=r,e.child=i,i=r,r=e.child,o=n.child.memoizedState,o=o===null?Ya(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=n.childLanes&~t,e.memoizedState=Wa,i}return r=n.child,n=r.sibling,i=An(r,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function iu(n,e){return e=ho({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function tr(n,e,t,i){return i!==null&&zl(i),xi(e,n.child,null,t),n=iu(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function rv(n,e,t,i,s,r,o){if(t)return e.flags&256?(e.flags&=-257,i=jo(Error(M(422))),tr(n,e,o,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(r=i.fallback,s=e.mode,i=ho({mode:"visible",children:i.children},s,0,null),r=Hn(r,s,o,null),r.flags|=2,i.return=e,r.return=e,i.sibling=r,e.child=i,e.mode&1&&xi(e,n.child,null,o),e.child.memoizedState=Ya(o),e.memoizedState=Wa,r);if(!(e.mode&1))return tr(n,e,o,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var a=i.dgst;return i=a,r=Error(M(419)),i=jo(r,i,void 0),tr(n,e,o,i)}if(a=(o&n.childLanes)!==0,nt||a){if(i=ke,i!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(i.suspendedLanes|o)?0:s,s!==0&&s!==r.retryLane&&(r.retryLane=s,Zt(n,s),Mt(i,n,s,-1))}return uu(),i=jo(Error(M(421))),tr(n,e,o,i)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=vv.bind(null,n),s._reactRetry=e,null):(n=r.treeContext,ct=mn(s.nextSibling),dt=e,de=!0,Pt=null,n!==null&&(yt[vt++]=Yt,yt[vt++]=Kt,yt[vt++]=On,Yt=n.id,Kt=n.overflow,On=e),e=iu(e,i.children),e.flags|=4096,e)}function Uc(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),Oa(n.return,e,t)}function ea(n,e,t,i,s){var r=n.memoizedState;r===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:s}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=t,r.tailMode=s)}function kp(n,e,t){var i=e.pendingProps,s=i.revealOrder,r=i.tail;if(We(n,e,i.children,t),i=he.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Uc(n,t,e);else if(n.tag===19)Uc(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(re(he,i),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Or(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),ea(e,!1,s,t,r);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Or(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}ea(e,!0,t,null,r);break;case"together":ea(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function yr(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function jt(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Bn|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(M(153));if(e.child!==null){for(n=e.child,t=An(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=An(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function ov(n,e,t){switch(e.tag){case 3:Rp(e),Ti();break;case 5:ip(e);break;case 1:st(e.type)&&Lr(e);break;case 4:Jl(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,s=e.memoizedProps.value;re(Ur,i._currentValue),i._currentValue=s;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(re(he,he.current&1),e.flags|=128,null):t&e.child.childLanes?Mp(n,e,t):(re(he,he.current&1),n=jt(n,e,t),n!==null?n.sibling:null);re(he,he.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return kp(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),re(he,he.current),i)break;return null;case 22:case 23:return e.lanes=0,Ip(n,e,t)}return jt(n,e,t)}var bp,Ka,Np,Lp;bp=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Ka=function(){};Np=function(n,e,t,i){var s=n.memoizedProps;if(s!==i){n=e.stateNode,Dn(Gt.current);var r=null;switch(t){case"input":s=ma(n,s),i=ma(n,i),r=[];break;case"select":s=pe({},s,{value:void 0}),i=pe({},i,{value:void 0}),r=[];break;case"textarea":s=_a(n,s),i=_a(n,i),r=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=br)}Sa(t,i);var o;t=null;for(u in s)if(!i.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var a=s[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(gs.hasOwnProperty(u)?r||(r=[]):(r=r||[]).push(u,null));for(u in i){var l=i[u];if(a=s?.[u],i.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(r||(r=[]),r.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(r=r||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(r=r||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(gs.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&oe("scroll",n),r||a===l||(r=[])):(r=r||[]).push(u,l))}t&&(r=r||[]).push("style",t);var u=r;(e.updateQueue=u)&&(e.flags|=4)}};Lp=function(n,e,t,i){t!==i&&(e.flags|=4)};function zi(n,e){if(!de)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function Ue(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function av(n,e,t){var i=e.pendingProps;switch(Bl(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ue(e),null;case 1:return st(e.type)&&Nr(),Ue(e),null;case 3:return i=e.stateNode,Ii(),le(it),le(ze),Ql(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(js(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Pt!==null&&(nl(Pt),Pt=null))),Ka(n,e),Ue(e),null;case 5:Xl(e);var s=Dn(Is.current);if(t=e.type,n!==null&&e.stateNode!=null)Np(n,e,t,i,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(M(166));return Ue(e),null}if(n=Dn(Gt.current),js(e)){i=e.stateNode,t=e.type;var r=e.memoizedProps;switch(i[Vt]=e,i[Ts]=r,n=(e.mode&1)!==0,t){case"dialog":oe("cancel",i),oe("close",i);break;case"iframe":case"object":case"embed":oe("load",i);break;case"video":case"audio":for(s=0;s<ji.length;s++)oe(ji[s],i);break;case"source":oe("error",i);break;case"img":case"image":case"link":oe("error",i),oe("load",i);break;case"details":oe("toggle",i);break;case"input":Wu(i,r),oe("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!r.multiple},oe("invalid",i);break;case"textarea":Ku(i,r),oe("invalid",i)}Sa(t,r),s=null;for(var o in r)if(r.hasOwnProperty(o)){var a=r[o];o==="children"?typeof a=="string"?i.textContent!==a&&(r.suppressHydrationWarning!==!0&&Zs(i.textContent,a,n),s=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(r.suppressHydrationWarning!==!0&&Zs(i.textContent,a,n),s=["children",""+a]):gs.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&oe("scroll",i)}switch(t){case"input":qs(i),Yu(i,r,!0);break;case"textarea":qs(i),Ju(i);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(i.onclick=br)}i=s,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=lf(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=o.createElement(t,{is:i.is}):(n=o.createElement(t),t==="select"&&(o=n,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):n=o.createElementNS(n,t),n[Vt]=e,n[Ts]=i,bp(n,e,!1,!1),e.stateNode=n;e:{switch(o=Ea(t,i),t){case"dialog":oe("cancel",n),oe("close",n),s=i;break;case"iframe":case"object":case"embed":oe("load",n),s=i;break;case"video":case"audio":for(s=0;s<ji.length;s++)oe(ji[s],n);s=i;break;case"source":oe("error",n),s=i;break;case"img":case"image":case"link":oe("error",n),oe("load",n),s=i;break;case"details":oe("toggle",n),s=i;break;case"input":Wu(n,i),s=ma(n,i),oe("invalid",n);break;case"option":s=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},s=pe({},i,{value:void 0}),oe("invalid",n);break;case"textarea":Ku(n,i),s=_a(n,i),oe("invalid",n);break;default:s=i}Sa(t,s),a=s;for(r in a)if(a.hasOwnProperty(r)){var l=a[r];r==="style"?df(n,l):r==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&uf(n,l)):r==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&ms(n,l):typeof l=="number"&&ms(n,""+l):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(gs.hasOwnProperty(r)?l!=null&&r==="onScroll"&&oe("scroll",n):l!=null&&Il(n,r,l,o))}switch(t){case"input":qs(n),Yu(n,i,!1);break;case"textarea":qs(n),Ju(n);break;case"option":i.value!=null&&n.setAttribute("value",""+En(i.value));break;case"select":n.multiple=!!i.multiple,r=i.value,r!=null?fi(n,!!i.multiple,r,!1):i.defaultValue!=null&&fi(n,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=br)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ue(e),null;case 6:if(n&&e.stateNode!=null)Lp(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(M(166));if(t=Dn(Is.current),Dn(Gt.current),js(e)){if(i=e.stateNode,t=e.memoizedProps,i[Vt]=e,(r=i.nodeValue!==t)&&(n=dt,n!==null))switch(n.tag){case 3:Zs(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Zs(i.nodeValue,t,(n.mode&1)!==0)}r&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Vt]=e,e.stateNode=i}return Ue(e),null;case 13:if(le(he),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(de&&ct!==null&&e.mode&1&&!(e.flags&128))Zf(),Ti(),e.flags|=98560,r=!1;else if(r=js(e),i!==null&&i.dehydrated!==null){if(n===null){if(!r)throw Error(M(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(M(317));r[Vt]=e}else Ti(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ue(e),r=!1}else Pt!==null&&(nl(Pt),Pt=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||he.current&1?Pe===0&&(Pe=3):uu())),e.updateQueue!==null&&(e.flags|=4),Ue(e),null);case 4:return Ii(),Ka(n,e),n===null&&ws(e.stateNode.containerInfo),Ue(e),null;case 10:return Wl(e.type._context),Ue(e),null;case 17:return st(e.type)&&Nr(),Ue(e),null;case 19:if(le(he),r=e.memoizedState,r===null)return Ue(e),null;if(i=(e.flags&128)!==0,o=r.rendering,o===null)if(i)zi(r,!1);else{if(Pe!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Or(n),o!==null){for(e.flags|=128,zi(r,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)r=t,n=i,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=n,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,n=o.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return re(he,he.current&1|2),e.child}n=n.sibling}r.tail!==null&&ve()>Ri&&(e.flags|=128,i=!0,zi(r,!1),e.lanes=4194304)}else{if(!i)if(n=Or(o),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),zi(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!de)return Ue(e),null}else 2*ve()-r.renderingStartTime>Ri&&t!==1073741824&&(e.flags|=128,i=!0,zi(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(t=r.last,t!==null?t.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=ve(),e.sibling=null,t=he.current,re(he,i?t&1|2:t&1),e):(Ue(e),null);case 22:case 23:return lu(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?lt&1073741824&&(Ue(e),e.subtreeFlags&6&&(e.flags|=8192)):Ue(e),null;case 24:return null;case 25:return null}throw Error(M(156,e.tag))}function lv(n,e){switch(Bl(e),e.tag){case 1:return st(e.type)&&Nr(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Ii(),le(it),le(ze),Ql(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Xl(e),null;case 13:if(le(he),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(M(340));Ti()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return le(he),null;case 4:return Ii(),null;case 10:return Wl(e.type._context),null;case 22:case 23:return lu(),null;case 24:return null;default:return null}}var nr=!1,Oe=!1,uv=typeof WeakSet=="function"?WeakSet:Set,D=null;function ui(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){me(n,e,i)}else t.current=null}function Ja(n,e,t){try{t()}catch(i){me(n,e,i)}}var Hc=!1;function cv(n,e){if(ba=Rr,n=Vf(),Ol(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var s=i.anchorOffset,r=i.focusNode;i=i.focusOffset;try{t.nodeType,r.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,d=0,f=n,p=null;t:for(;;){for(var g;f!==t||s!==0&&f.nodeType!==3||(a=o+s),f!==r||i!==0&&f.nodeType!==3||(l=o+i),f.nodeType===3&&(o+=f.nodeValue.length),(g=f.firstChild)!==null;)p=f,f=g;for(;;){if(f===n)break t;if(p===t&&++u===s&&(a=o),p===r&&++d===i&&(l=o),(g=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=g}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Na={focusedElem:n,selectionRange:t},Rr=!1,D=e;D!==null;)if(e=D,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,D=n;else for(;D!==null;){e=D;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var v=m.memoizedProps,S=m.memoizedState,y=e.stateNode,_=y.getSnapshotBeforeUpdate(e.elementType===e.type?v:Tt(e.type,v),S);y.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var A=e.stateNode.containerInfo;A.nodeType===1?A.textContent="":A.nodeType===9&&A.documentElement&&A.removeChild(A.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(M(163))}}catch(E){me(e,e.return,E)}if(n=e.sibling,n!==null){n.return=e.return,D=n;break}D=e.return}return m=Hc,Hc=!1,m}function ls(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&n)===n){var r=s.destroy;s.destroy=void 0,r!==void 0&&Ja(e,t,r)}s=s.next}while(s!==i)}}function uo(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function Xa(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Dp(n){var e=n.alternate;e!==null&&(n.alternate=null,Dp(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Vt],delete e[Ts],delete e[Fa],delete e[Wy],delete e[Yy])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Fp(n){return n.tag===5||n.tag===3||n.tag===4}function Vc(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Fp(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Qa(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=br));else if(i!==4&&(n=n.child,n!==null))for(Qa(n,e,t),n=n.sibling;n!==null;)Qa(n,e,t),n=n.sibling}function Za(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(Za(n,e,t),n=n.sibling;n!==null;)Za(n,e,t),n=n.sibling}var be=null,It=!1;function rn(n,e,t){for(t=t.child;t!==null;)Up(n,e,t),t=t.sibling}function Up(n,e,t){if(Ot&&typeof Ot.onCommitFiberUnmount=="function")try{Ot.onCommitFiberUnmount(to,t)}catch{}switch(t.tag){case 5:Oe||ui(t,e);case 6:var i=be,s=It;be=null,rn(n,e,t),be=i,It=s,be!==null&&(It?(n=be,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):be.removeChild(t.stateNode));break;case 18:be!==null&&(It?(n=be,t=t.stateNode,n.nodeType===8?Yo(n.parentNode,t):n.nodeType===1&&Yo(n,t),As(n)):Yo(be,t.stateNode));break;case 4:i=be,s=It,be=t.stateNode.containerInfo,It=!0,rn(n,e,t),be=i,It=s;break;case 0:case 11:case 14:case 15:if(!Oe&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var r=s,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&Ja(t,e,o),s=s.next}while(s!==i)}rn(n,e,t);break;case 1:if(!Oe&&(ui(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(a){me(t,e,a)}rn(n,e,t);break;case 21:rn(n,e,t);break;case 22:t.mode&1?(Oe=(i=Oe)||t.memoizedState!==null,rn(n,e,t),Oe=i):rn(n,e,t);break;default:rn(n,e,t)}}function Oc(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new uv),e.forEach(function(i){var s=_v.bind(null,n,i);t.has(i)||(t.add(i),i.then(s,s))})}}function Ct(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var s=t[i];try{var r=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:be=a.stateNode,It=!1;break e;case 3:be=a.stateNode.containerInfo,It=!0;break e;case 4:be=a.stateNode.containerInfo,It=!0;break e}a=a.return}if(be===null)throw Error(M(160));Up(r,o,s),be=null,It=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){me(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Hp(e,n),e=e.sibling}function Hp(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ct(e,n),Lt(n),i&4){try{ls(3,n,n.return),uo(3,n)}catch(v){me(n,n.return,v)}try{ls(5,n,n.return)}catch(v){me(n,n.return,v)}}break;case 1:Ct(e,n),Lt(n),i&512&&t!==null&&ui(t,t.return);break;case 5:if(Ct(e,n),Lt(n),i&512&&t!==null&&ui(t,t.return),n.flags&32){var s=n.stateNode;try{ms(s,"")}catch(v){me(n,n.return,v)}}if(i&4&&(s=n.stateNode,s!=null)){var r=n.memoizedProps,o=t!==null?t.memoizedProps:r,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&r.type==="radio"&&r.name!=null&&of(s,r),Ea(a,o);var u=Ea(a,r);for(o=0;o<l.length;o+=2){var d=l[o],f=l[o+1];d==="style"?df(s,f):d==="dangerouslySetInnerHTML"?uf(s,f):d==="children"?ms(s,f):Il(s,d,f,u)}switch(a){case"input":ya(s,r);break;case"textarea":af(s,r);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!r.multiple;var g=r.value;g!=null?fi(s,!!r.multiple,g,!1):p!==!!r.multiple&&(r.defaultValue!=null?fi(s,!!r.multiple,r.defaultValue,!0):fi(s,!!r.multiple,r.multiple?[]:"",!1))}s[Ts]=r}catch(v){me(n,n.return,v)}}break;case 6:if(Ct(e,n),Lt(n),i&4){if(n.stateNode===null)throw Error(M(162));s=n.stateNode,r=n.memoizedProps;try{s.nodeValue=r}catch(v){me(n,n.return,v)}}break;case 3:if(Ct(e,n),Lt(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{As(e.containerInfo)}catch(v){me(n,n.return,v)}break;case 4:Ct(e,n),Lt(n);break;case 13:Ct(e,n),Lt(n),s=n.child,s.flags&8192&&(r=s.memoizedState!==null,s.stateNode.isHidden=r,!r||s.alternate!==null&&s.alternate.memoizedState!==null||(ou=ve())),i&4&&Oc(n);break;case 22:if(d=t!==null&&t.memoizedState!==null,n.mode&1?(Oe=(u=Oe)||d,Ct(e,n),Oe=u):Ct(e,n),Lt(n),i&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!d&&n.mode&1)for(D=n,d=n.child;d!==null;){for(f=D=d;D!==null;){switch(p=D,g=p.child,p.tag){case 0:case 11:case 14:case 15:ls(4,p,p.return);break;case 1:ui(p,p.return);var m=p.stateNode;if(typeof m.componentWillUnmount=="function"){i=p,t=p.return;try{e=i,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(v){me(i,t,v)}}break;case 5:ui(p,p.return);break;case 22:if(p.memoizedState!==null){Bc(f);continue}}g!==null?(g.return=p,D=g):Bc(f)}d=d.sibling}e:for(d=null,f=n;;){if(f.tag===5){if(d===null){d=f;try{s=f.stateNode,u?(r=s.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=cf("display",o))}catch(v){me(n,n.return,v)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(v){me(n,n.return,v)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Ct(e,n),Lt(n),i&4&&Oc(n);break;case 21:break;default:Ct(e,n),Lt(n)}}function Lt(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Fp(t)){var i=t;break e}t=t.return}throw Error(M(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(ms(s,""),i.flags&=-33);var r=Vc(n);Za(n,r,s);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Vc(n);Qa(n,a,o);break;default:throw Error(M(161))}}catch(l){me(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function dv(n,e,t){D=n,Vp(n)}function Vp(n,e,t){for(var i=(n.mode&1)!==0;D!==null;){var s=D,r=s.child;if(s.tag===22&&i){var o=s.memoizedState!==null||nr;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Oe;a=nr;var u=Oe;if(nr=o,(Oe=l)&&!u)for(D=s;D!==null;)o=D,l=o.child,o.tag===22&&o.memoizedState!==null?zc(s):l!==null?(l.return=o,D=l):zc(s);for(;r!==null;)D=r,Vp(r),r=r.sibling;D=s,nr=a,Oe=u}Gc(n)}else s.subtreeFlags&8772&&r!==null?(r.return=s,D=r):Gc(n)}}function Gc(n){for(;D!==null;){var e=D;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Oe||uo(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Oe)if(t===null)i.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Tt(e.type,t.memoizedProps);i.componentDidUpdate(s,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&Tc(e,r,i);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Tc(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&As(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(M(163))}Oe||e.flags&512&&Xa(e)}catch(p){me(e,e.return,p)}}if(e===n){D=null;break}if(t=e.sibling,t!==null){t.return=e.return,D=t;break}D=e.return}}function Bc(n){for(;D!==null;){var e=D;if(e===n){D=null;break}var t=e.sibling;if(t!==null){t.return=e.return,D=t;break}D=e.return}}function zc(n){for(;D!==null;){var e=D;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{uo(4,e)}catch(l){me(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var s=e.return;try{i.componentDidMount()}catch(l){me(e,s,l)}}var r=e.return;try{Xa(e)}catch(l){me(e,r,l)}break;case 5:var o=e.return;try{Xa(e)}catch(l){me(e,o,l)}}}catch(l){me(e,e.return,l)}if(e===n){D=null;break}var a=e.sibling;if(a!==null){a.return=e.return,D=a;break}D=e.return}}var hv=Math.ceil,zr=tn.ReactCurrentDispatcher,su=tn.ReactCurrentOwner,At=tn.ReactCurrentBatchConfig,j=0,ke=null,we=null,Le=0,lt=0,ci=In(0),Pe=0,ks=null,Bn=0,co=0,ru=0,us=null,tt=null,ou=0,Ri=1/0,qt=null,qr=!1,ja=null,vn=null,ir=!1,hn=null,$r=0,cs=0,el=null,vr=-1,_r=0;function Ye(){return j&6?ve():vr!==-1?vr:vr=ve()}function _n(n){return n.mode&1?j&2&&Le!==0?Le&-Le:Jy.transition!==null?(_r===0&&(_r=wf()),_r):(n=ie,n!==0||(n=window.event,n=n===void 0?16:Mf(n.type)),n):1}function Mt(n,e,t,i){if(50<cs)throw cs=0,el=null,Error(M(185));Ds(n,t,i),(!(j&2)||n!==ke)&&(n===ke&&(!(j&2)&&(co|=t),Pe===4&&un(n,Le)),rt(n,i),t===1&&j===0&&!(e.mode&1)&&(Ri=ve()+500,oo&&Pn()))}function rt(n,e){var t=n.callbackNode;Jm(n,e);var i=Pr(n,n===ke?Le:0);if(i===0)t!==null&&Zu(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&Zu(t),e===1)n.tag===0?Ky(qc.bind(null,n)):Jf(qc.bind(null,n)),qy(function(){!(j&6)&&Pn()}),t=null;else{switch(Cf(i)){case 1:t=bl;break;case 4:t=Sf;break;case 16:t=Ir;break;case 536870912:t=Ef;break;default:t=Ir}t=Yp(t,Op.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Op(n,e){if(vr=-1,_r=0,j&6)throw Error(M(327));var t=n.callbackNode;if(vi()&&n.callbackNode!==t)return null;var i=Pr(n,n===ke?Le:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=Wr(n,i);else{e=i;var s=j;j|=2;var r=Bp();(ke!==n||Le!==e)&&(qt=null,Ri=ve()+500,Un(n,e));do try{gv();break}catch(a){Gp(n,a)}while(!0);$l(),zr.current=r,j=s,we!==null?e=0:(ke=null,Le=0,e=Pe)}if(e!==0){if(e===2&&(s=Ia(n),s!==0&&(i=s,e=tl(n,s))),e===1)throw t=ks,Un(n,0),un(n,i),rt(n,ve()),t;if(e===6)un(n,i);else{if(s=n.current.alternate,!(i&30)&&!fv(s)&&(e=Wr(n,i),e===2&&(r=Ia(n),r!==0&&(i=r,e=tl(n,r))),e===1))throw t=ks,Un(n,0),un(n,i),rt(n,ve()),t;switch(n.finishedWork=s,n.finishedLanes=i,e){case 0:case 1:throw Error(M(345));case 2:bn(n,tt,qt);break;case 3:if(un(n,i),(i&130023424)===i&&(e=ou+500-ve(),10<e)){if(Pr(n,0)!==0)break;if(s=n.suspendedLanes,(s&i)!==i){Ye(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=Da(bn.bind(null,n,tt,qt),e);break}bn(n,tt,qt);break;case 4:if(un(n,i),(i&4194240)===i)break;for(e=n.eventTimes,s=-1;0<i;){var o=31-Rt(i);r=1<<o,o=e[o],o>s&&(s=o),i&=~r}if(i=s,i=ve()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*hv(i/1960))-i,10<i){n.timeoutHandle=Da(bn.bind(null,n,tt,qt),i);break}bn(n,tt,qt);break;case 5:bn(n,tt,qt);break;default:throw Error(M(329))}}}return rt(n,ve()),n.callbackNode===t?Op.bind(null,n):null}function tl(n,e){var t=us;return n.current.memoizedState.isDehydrated&&(Un(n,e).flags|=256),n=Wr(n,e),n!==2&&(e=tt,tt=t,e!==null&&nl(e)),n}function nl(n){tt===null?tt=n:tt.push.apply(tt,n)}function fv(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var s=t[i],r=s.getSnapshot;s=s.value;try{if(!kt(r(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function un(n,e){for(e&=~ru,e&=~co,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Rt(e),i=1<<t;n[t]=-1,e&=~i}}function qc(n){if(j&6)throw Error(M(327));vi();var e=Pr(n,0);if(!(e&1))return rt(n,ve()),null;var t=Wr(n,e);if(n.tag!==0&&t===2){var i=Ia(n);i!==0&&(e=i,t=tl(n,i))}if(t===1)throw t=ks,Un(n,0),un(n,e),rt(n,ve()),t;if(t===6)throw Error(M(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,bn(n,tt,qt),rt(n,ve()),null}function au(n,e){var t=j;j|=1;try{return n(e)}finally{j=t,j===0&&(Ri=ve()+500,oo&&Pn())}}function zn(n){hn!==null&&hn.tag===0&&!(j&6)&&vi();var e=j;j|=1;var t=At.transition,i=ie;try{if(At.transition=null,ie=1,n)return n()}finally{ie=i,At.transition=t,j=e,!(j&6)&&Pn()}}function lu(){lt=ci.current,le(ci)}function Un(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,zy(t)),we!==null)for(t=we.return;t!==null;){var i=t;switch(Bl(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Nr();break;case 3:Ii(),le(it),le(ze),Ql();break;case 5:Xl(i);break;case 4:Ii();break;case 13:le(he);break;case 19:le(he);break;case 10:Wl(i.type._context);break;case 22:case 23:lu()}t=t.return}if(ke=n,we=n=An(n.current,null),Le=lt=e,Pe=0,ks=null,ru=co=Bn=0,tt=us=null,Ln!==null){for(e=0;e<Ln.length;e++)if(t=Ln[e],i=t.interleaved,i!==null){t.interleaved=null;var s=i.next,r=t.pending;if(r!==null){var o=r.next;r.next=s,i.next=o}t.pending=i}Ln=null}return n}function Gp(n,e){do{var t=we;try{if($l(),gr.current=Br,Gr){for(var i=fe.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Gr=!1}if(Gn=0,Me=Ie=fe=null,as=!1,Ps=0,su.current=null,t===null||t.return===null){Pe=1,ks=e,we=null;break}e:{var r=n,o=t.return,a=t,l=e;if(e=Le,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,d=a,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var g=kc(o);if(g!==null){g.flags&=-257,bc(g,o,a,r,e),g.mode&1&&Mc(r,u,e),e=g,l=u;var m=e.updateQueue;if(m===null){var v=new Set;v.add(l),e.updateQueue=v}else m.add(l);break e}else{if(!(e&1)){Mc(r,u,e),uu();break e}l=Error(M(426))}}else if(de&&a.mode&1){var S=kc(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),bc(S,o,a,r,e),zl(Pi(l,a));break e}}r=l=Pi(l,a),Pe!==4&&(Pe=2),us===null?us=[r]:us.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var y=Cp(r,l,e);Cc(r,y);break e;case 1:a=l;var _=r.type,A=r.stateNode;if(!(r.flags&128)&&(typeof _.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(vn===null||!vn.has(A)))){r.flags|=65536,e&=-e,r.lanes|=e;var E=Tp(r,a,e);Cc(r,E);break e}}r=r.return}while(r!==null)}qp(t)}catch(w){e=w,we===t&&t!==null&&(we=t=t.return);continue}break}while(!0)}function Bp(){var n=zr.current;return zr.current=Br,n===null?Br:n}function uu(){(Pe===0||Pe===3||Pe===2)&&(Pe=4),ke===null||!(Bn&268435455)&&!(co&268435455)||un(ke,Le)}function Wr(n,e){var t=j;j|=2;var i=Bp();(ke!==n||Le!==e)&&(qt=null,Un(n,e));do try{pv();break}catch(s){Gp(n,s)}while(!0);if($l(),j=t,zr.current=i,we!==null)throw Error(M(261));return ke=null,Le=0,Pe}function pv(){for(;we!==null;)zp(we)}function gv(){for(;we!==null&&!Om();)zp(we)}function zp(n){var e=Wp(n.alternate,n,lt);n.memoizedProps=n.pendingProps,e===null?qp(n):we=e,su.current=null}function qp(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=lv(t,e),t!==null){t.flags&=32767,we=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Pe=6,we=null;return}}else if(t=av(t,e,lt),t!==null){we=t;return}if(e=e.sibling,e!==null){we=e;return}we=e=n}while(e!==null);Pe===0&&(Pe=5)}function bn(n,e,t){var i=ie,s=At.transition;try{At.transition=null,ie=1,mv(n,e,t,i)}finally{At.transition=s,ie=i}return null}function mv(n,e,t,i){do vi();while(hn!==null);if(j&6)throw Error(M(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(M(177));n.callbackNode=null,n.callbackPriority=0;var r=t.lanes|t.childLanes;if(Xm(n,r),n===ke&&(we=ke=null,Le=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||ir||(ir=!0,Yp(Ir,function(){return vi(),null})),r=(t.flags&15990)!==0,t.subtreeFlags&15990||r){r=At.transition,At.transition=null;var o=ie;ie=1;var a=j;j|=4,su.current=null,cv(n,t),Hp(t,n),Fy(Na),Rr=!!ba,Na=ba=null,n.current=t,dv(t),Gm(),j=a,ie=o,At.transition=r}else n.current=t;if(ir&&(ir=!1,hn=n,$r=s),r=n.pendingLanes,r===0&&(vn=null),qm(t.stateNode),rt(n,ve()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],i(s.value,{componentStack:s.stack,digest:s.digest});if(qr)throw qr=!1,n=ja,ja=null,n;return $r&1&&n.tag!==0&&vi(),r=n.pendingLanes,r&1?n===el?cs++:(cs=0,el=n):cs=0,Pn(),null}function vi(){if(hn!==null){var n=Cf($r),e=At.transition,t=ie;try{if(At.transition=null,ie=16>n?16:n,hn===null)var i=!1;else{if(n=hn,hn=null,$r=0,j&6)throw Error(M(331));var s=j;for(j|=4,D=n.current;D!==null;){var r=D,o=r.child;if(D.flags&16){var a=r.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(D=u;D!==null;){var d=D;switch(d.tag){case 0:case 11:case 15:ls(8,d,r)}var f=d.child;if(f!==null)f.return=d,D=f;else for(;D!==null;){d=D;var p=d.sibling,g=d.return;if(Dp(d),d===u){D=null;break}if(p!==null){p.return=g,D=p;break}D=g}}}var m=r.alternate;if(m!==null){var v=m.child;if(v!==null){m.child=null;do{var S=v.sibling;v.sibling=null,v=S}while(v!==null)}}D=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,D=o;else e:for(;D!==null;){if(r=D,r.flags&2048)switch(r.tag){case 0:case 11:case 15:ls(9,r,r.return)}var y=r.sibling;if(y!==null){y.return=r.return,D=y;break e}D=r.return}}var _=n.current;for(D=_;D!==null;){o=D;var A=o.child;if(o.subtreeFlags&2064&&A!==null)A.return=o,D=A;else e:for(o=_;D!==null;){if(a=D,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:uo(9,a)}}catch(w){me(a,a.return,w)}if(a===o){D=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,D=E;break e}D=a.return}}if(j=s,Pn(),Ot&&typeof Ot.onPostCommitFiberRoot=="function")try{Ot.onPostCommitFiberRoot(to,n)}catch{}i=!0}return i}finally{ie=t,At.transition=e}}return!1}function $c(n,e,t){e=Pi(t,e),e=Cp(n,e,1),n=yn(n,e,1),e=Ye(),n!==null&&(Ds(n,1,e),rt(n,e))}function me(n,e,t){if(n.tag===3)$c(n,n,t);else for(;e!==null;){if(e.tag===3){$c(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(vn===null||!vn.has(i))){n=Pi(t,n),n=Tp(e,n,1),e=yn(e,n,1),n=Ye(),e!==null&&(Ds(e,1,n),rt(e,n));break}}e=e.return}}function yv(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Ye(),n.pingedLanes|=n.suspendedLanes&t,ke===n&&(Le&t)===t&&(Pe===4||Pe===3&&(Le&130023424)===Le&&500>ve()-ou?Un(n,0):ru|=t),rt(n,e)}function $p(n,e){e===0&&(n.mode&1?(e=Ys,Ys<<=1,!(Ys&130023424)&&(Ys=4194304)):e=1);var t=Ye();n=Zt(n,e),n!==null&&(Ds(n,e,t),rt(n,t))}function vv(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),$p(n,t)}function _v(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(M(314))}i!==null&&i.delete(e),$p(n,t)}var Wp;Wp=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||it.current)nt=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return nt=!1,ov(n,e,t);nt=!!(n.flags&131072)}else nt=!1,de&&e.flags&1048576&&Xf(e,Fr,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;yr(n,e),n=e.pendingProps;var s=Ci(e,ze.current);yi(e,t),s=jl(null,e,i,n,s,t);var r=eu();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,st(i)?(r=!0,Lr(e)):r=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Kl(e),s.updater=lo,e.stateNode=s,s._reactInternals=e,Ba(e,i,n,t),e=$a(null,e,i,!0,r,t)):(e.tag=0,de&&r&&Gl(e),We(null,e,s,t),e=e.child),e;case 16:i=e.elementType;e:{switch(yr(n,e),n=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=Sv(i),n=Tt(i,n),s){case 0:e=qa(null,e,i,n,t);break e;case 1:e=Dc(null,e,i,n,t);break e;case 11:e=Nc(null,e,i,n,t);break e;case 14:e=Lc(null,e,i,Tt(i.type,n),t);break e}throw Error(M(306,i,""))}return e;case 0:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Tt(i,s),qa(n,e,i,s,t);case 1:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Tt(i,s),Dc(n,e,i,s,t);case 3:e:{if(Rp(e),n===null)throw Error(M(387));i=e.pendingProps,r=e.memoizedState,s=r.element,np(n,e),Vr(e,i,null,t);var o=e.memoizedState;if(i=o.element,r.isDehydrated)if(r={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){s=Pi(Error(M(423)),e),e=Fc(n,e,i,t,s);break e}else if(i!==s){s=Pi(Error(M(424)),e),e=Fc(n,e,i,t,s);break e}else for(ct=mn(e.stateNode.containerInfo.firstChild),dt=e,de=!0,Pt=null,t=ep(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ti(),i===s){e=jt(n,e,t);break e}We(n,e,i,t)}e=e.child}return e;case 5:return ip(e),n===null&&Va(e),i=e.type,s=e.pendingProps,r=n!==null?n.memoizedProps:null,o=s.children,La(i,s)?o=null:r!==null&&La(i,r)&&(e.flags|=32),Pp(n,e),We(n,e,o,t),e.child;case 6:return n===null&&Va(e),null;case 13:return Mp(n,e,t);case 4:return Jl(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=xi(e,null,i,t):We(n,e,i,t),e.child;case 11:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Tt(i,s),Nc(n,e,i,s,t);case 7:return We(n,e,e.pendingProps,t),e.child;case 8:return We(n,e,e.pendingProps.children,t),e.child;case 12:return We(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,s=e.pendingProps,r=e.memoizedProps,o=s.value,re(Ur,i._currentValue),i._currentValue=o,r!==null)if(kt(r.value,o)){if(r.children===s.children&&!it.current){e=jt(n,e,t);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var a=r.dependencies;if(a!==null){o=r.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(r.tag===1){l=Jt(-1,t&-t),l.tag=2;var u=r.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}r.lanes|=t,l=r.alternate,l!==null&&(l.lanes|=t),Oa(r.return,t,e),a.lanes|=t;break}l=l.next}}else if(r.tag===10)o=r.type===e.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(M(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),Oa(o,t,e),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}We(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,i=e.pendingProps.children,yi(e,t),s=Et(s),i=i(s),e.flags|=1,We(n,e,i,t),e.child;case 14:return i=e.type,s=Tt(i,e.pendingProps),s=Tt(i.type,s),Lc(n,e,i,s,t);case 15:return xp(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Tt(i,s),yr(n,e),e.tag=1,st(i)?(n=!0,Lr(e)):n=!1,yi(e,t),wp(e,i,s),Ba(e,i,s,t),$a(null,e,i,!0,n,t);case 19:return kp(n,e,t);case 22:return Ip(n,e,t)}throw Error(M(156,e.tag))};function Yp(n,e){return Af(n,e)}function Av(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _t(n,e,t,i){return new Av(n,e,t,i)}function cu(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Sv(n){if(typeof n=="function")return cu(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Rl)return 11;if(n===Ml)return 14}return 2}function An(n,e){var t=n.alternate;return t===null?(t=_t(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Ar(n,e,t,i,s,r){var o=2;if(i=n,typeof n=="function")cu(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case ei:return Hn(t.children,s,r,e);case Pl:o=8,s|=8;break;case ha:return n=_t(12,t,e,s|2),n.elementType=ha,n.lanes=r,n;case fa:return n=_t(13,t,e,s),n.elementType=fa,n.lanes=r,n;case pa:return n=_t(19,t,e,s),n.elementType=pa,n.lanes=r,n;case nf:return ho(t,s,r,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case ef:o=10;break e;case tf:o=9;break e;case Rl:o=11;break e;case Ml:o=14;break e;case on:o=16,i=null;break e}throw Error(M(130,n==null?n:typeof n,""))}return e=_t(o,t,e,s),e.elementType=n,e.type=i,e.lanes=r,e}function Hn(n,e,t,i){return n=_t(7,n,i,e),n.lanes=t,n}function ho(n,e,t,i){return n=_t(22,n,i,e),n.elementType=nf,n.lanes=t,n.stateNode={isHidden:!1},n}function ta(n,e,t){return n=_t(6,n,null,e),n.lanes=t,n}function na(n,e,t){return e=_t(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Ev(n,e,t,i,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Fo(0),this.expirationTimes=Fo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fo(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function du(n,e,t,i,s,r,o,a,l){return n=new Ev(n,e,t,a,l),e===1?(e=1,r===!0&&(e|=8)):e=0,r=_t(3,null,null,e),n.current=r,r.stateNode=n,r.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Kl(r),n}function wv(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:jn,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function Kp(n){if(!n)return wn;n=n._reactInternals;e:{if(Yn(n)!==n||n.tag!==1)throw Error(M(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(st(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(M(171))}if(n.tag===1){var t=n.type;if(st(t))return Kf(n,t,e)}return e}function Jp(n,e,t,i,s,r,o,a,l){return n=du(t,i,!0,n,s,r,o,a,l),n.context=Kp(null),t=n.current,i=Ye(),s=_n(t),r=Jt(i,s),r.callback=e??null,yn(t,r,s),n.current.lanes=s,Ds(n,s,i),rt(n,i),n}function fo(n,e,t,i){var s=e.current,r=Ye(),o=_n(s);return t=Kp(t),e.context===null?e.context=t:e.pendingContext=t,e=Jt(r,o),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=yn(s,e,o),n!==null&&(Mt(n,s,o,r),pr(n,s,o)),o}function Yr(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Wc(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function hu(n,e){Wc(n,e),(n=n.alternate)&&Wc(n,e)}function Cv(){return null}var Xp=typeof reportError=="function"?reportError:function(n){console.error(n)};function fu(n){this._internalRoot=n}po.prototype.render=fu.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(M(409));fo(n,e,null,null)};po.prototype.unmount=fu.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;zn(function(){fo(null,n,null,null)}),e[Qt]=null}};function po(n){this._internalRoot=n}po.prototype.unstable_scheduleHydration=function(n){if(n){var e=If();n={blockedOn:null,target:n,priority:e};for(var t=0;t<ln.length&&e!==0&&e<ln[t].priority;t++);ln.splice(t,0,n),t===0&&Rf(n)}};function pu(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function go(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Yc(){}function Tv(n,e,t,i,s){if(s){if(typeof i=="function"){var r=i;i=function(){var u=Yr(o);r.call(u)}}var o=Jp(e,i,n,0,null,!1,!1,"",Yc);return n._reactRootContainer=o,n[Qt]=o.current,ws(n.nodeType===8?n.parentNode:n),zn(),o}for(;s=n.lastChild;)n.removeChild(s);if(typeof i=="function"){var a=i;i=function(){var u=Yr(l);a.call(u)}}var l=du(n,0,!1,null,null,!1,!1,"",Yc);return n._reactRootContainer=l,n[Qt]=l.current,ws(n.nodeType===8?n.parentNode:n),zn(function(){fo(e,l,t,i)}),l}function mo(n,e,t,i,s){var r=t._reactRootContainer;if(r){var o=r;if(typeof s=="function"){var a=s;s=function(){var l=Yr(o);a.call(l)}}fo(e,o,n,s)}else o=Tv(t,e,n,s,i);return Yr(o)}Tf=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Zi(e.pendingLanes);t!==0&&(Nl(e,t|1),rt(e,ve()),!(j&6)&&(Ri=ve()+500,Pn()))}break;case 13:zn(function(){var i=Zt(n,1);if(i!==null){var s=Ye();Mt(i,n,1,s)}}),hu(n,1)}};Ll=function(n){if(n.tag===13){var e=Zt(n,134217728);if(e!==null){var t=Ye();Mt(e,n,134217728,t)}hu(n,134217728)}};xf=function(n){if(n.tag===13){var e=_n(n),t=Zt(n,e);if(t!==null){var i=Ye();Mt(t,n,e,i)}hu(n,e)}};If=function(){return ie};Pf=function(n,e){var t=ie;try{return ie=n,e()}finally{ie=t}};Ca=function(n,e,t){switch(e){case"input":if(ya(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var s=ro(i);if(!s)throw Error(M(90));rf(i),ya(i,s)}}}break;case"textarea":af(n,t);break;case"select":e=t.value,e!=null&&fi(n,!!t.multiple,e,!1)}};pf=au;gf=zn;var xv={usingClientEntryPoint:!1,Events:[Us,si,ro,hf,ff,au]},qi={findFiberByHostInstance:Nn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Iv={bundleType:qi.bundleType,version:qi.version,rendererPackageName:qi.rendererPackageName,rendererConfig:qi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:tn.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=vf(n),n===null?null:n.stateNode},findFiberByHostInstance:qi.findFiberByHostInstance||Cv,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var sr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sr.isDisabled&&sr.supportsFiber)try{to=sr.inject(Iv),Ot=sr}catch{}}ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xv;ft.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!pu(e))throw Error(M(200));return wv(n,e,null,t)};ft.createRoot=function(n,e){if(!pu(n))throw Error(M(299));var t=!1,i="",s=Xp;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=du(n,1,!1,null,null,t,!1,i,s),n[Qt]=e.current,ws(n.nodeType===8?n.parentNode:n),new fu(e)};ft.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(M(188)):(n=Object.keys(n).join(","),Error(M(268,n)));return n=vf(e),n=n===null?null:n.stateNode,n};ft.flushSync=function(n){return zn(n)};ft.hydrate=function(n,e,t){if(!go(e))throw Error(M(200));return mo(null,n,e,!0,t)};ft.hydrateRoot=function(n,e,t){if(!pu(n))throw Error(M(405));var i=t!=null&&t.hydratedSources||null,s=!1,r="",o=Xp;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=Jp(e,null,n,1,t??null,s,!1,r,o),n[Qt]=e.current,ws(n),i)for(n=0;n<i.length;n++)t=i[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new po(e)};ft.render=function(n,e,t){if(!go(e))throw Error(M(200));return mo(null,n,e,!1,t)};ft.unmountComponentAtNode=function(n){if(!go(n))throw Error(M(40));return n._reactRootContainer?(zn(function(){mo(null,null,n,!1,function(){n._reactRootContainer=null,n[Qt]=null})}),!0):!1};ft.unstable_batchedUpdates=au;ft.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!go(t))throw Error(M(200));if(n==null||n._reactInternals===void 0)throw Error(M(38));return mo(n,e,t,!1,i)};ft.version="18.3.1-next-f1338f8080-20240426";function Qp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Qp)}catch(n){console.error(n)}}Qp(),Xh.exports=ft;var Pv=Xh.exports,Kc=Pv;ca.createRoot=Kc.createRoot,ca.hydrateRoot=Kc.hydrateRoot;var il=(n=>(n.Basic="Base",n.Intermediate="Intermedio",n.Advanced="Avanzato",n))(il||{}),ot=(n=>(n.TrueFalse="true_false",n.MultipleChoice="multiple_choice",n.Basic="basic",n))(ot||{}),ds={};ds.d=(n,e)=>{for(var t in e)ds.o(e,t)&&!ds.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};ds.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var q=globalThis.pdfjsLib={};ds.d(q,{AbortException:()=>Cn,AnnotationEditorLayer:()=>$t,AnnotationEditorParamsType:()=>Q,AnnotationEditorType:()=>$,AnnotationEditorUIManager:()=>Tn,AnnotationLayer:()=>w_,AnnotationMode:()=>cn,ColorPicker:()=>mt,DOMSVGFactory:()=>xu,DrawLayer:()=>qe,FeatureTest:()=>Ke,GlobalWorkerOptions:()=>fs,ImageKind:()=>Sr,InvalidPDFException:()=>rl,MissingPDFException:()=>bs,OPS:()=>xt,OutputScale:()=>ol,PDFDataRangeTransport:()=>mg,PDFDateString:()=>eg,PDFWorker:()=>Re,PasswordResponses:()=>bv,PermissionFlag:()=>kv,PixelsPerInch:()=>Mi,RenderingCancelledException:()=>yu,TextLayer:()=>$e,TouchManager:()=>wo,UnexpectedResponseException:()=>Kr,Util:()=>H,VerbosityLevel:()=>yo,XfaLayer:()=>vg,build:()=>i_,createValidAbsoluteUrl:()=>Fv,fetchData:()=>So,getDocument:()=>K0,getFilenameFromUrl:()=>$v,getPdfFilenameFromUrl:()=>Wv,getXfaPageViewport:()=>Yv,isDataScheme:()=>Eo,isPdfFile:()=>vu,noContextMenu:()=>bt,normalizeUnicode:()=>Bv,setLayerDimensions:()=>qn,shadow:()=>Y,stopEvent:()=>ut,version:()=>n_});const Ge=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Zp=[1,0,0,1,0,0],sl=[.001,0,0,.001,0,0],Rv=1e7,ia=1.35,at={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},cn={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Mv="pdfjs_internal_editor_",$={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Q={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},kv={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},He={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Sr={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Te={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},$i={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},yo={ERRORS:0,WARNINGS:1,INFOS:5},xt={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},bv={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let vo=yo.WARNINGS;function Nv(n){Number.isInteger(n)&&(vo=n)}function Lv(){return vo}function _o(n){vo>=yo.INFOS&&console.log(`Info: ${n}`)}function W(n){vo>=yo.WARNINGS&&console.log(`Warning: ${n}`)}function se(n){throw new Error(n)}function Ce(n,e){n||se(e)}function Dv(n){switch(n?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Fv(n,e=null,t=null){if(!n)return null;try{if(t&&typeof n=="string"&&(t.addDefaultProtocol&&n.startsWith("www.")&&n.match(/\./g)?.length>=2&&(n=`http://${n}`),t.tryConvertEncoding))try{n=Gv(n)}catch{}const i=e?new URL(n,e):new URL(n);if(Dv(i))return i}catch{}return null}function Y(n,e,t,i=!1){return Object.defineProperty(n,e,{value:t,enumerable:!i,configurable:!0,writable:!1}),t}const Rn=function(){function e(t,i){this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e}();class Jc extends Rn{constructor(e,t){super(e,"PasswordException"),this.code=t}}class sa extends Rn{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class rl extends Rn{constructor(e){super(e,"InvalidPDFException")}}class bs extends Rn{constructor(e){super(e,"MissingPDFException")}}class Kr extends Rn{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class Uv extends Rn{constructor(e){super(e,"FormatError")}}class Cn extends Rn{constructor(e){super(e,"AbortException")}}function jp(n){(typeof n!="object"||n?.length===void 0)&&se("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const i=[];for(let s=0;s<e;s+=t){const r=Math.min(s+t,e),o=n.subarray(s,r);i.push(String.fromCharCode.apply(null,o))}return i.join("")}function Ao(n){typeof n!="string"&&se("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let i=0;i<e;++i)t[i]=n.charCodeAt(i)&255;return t}function Hv(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function gu(n){const e=Object.create(null);for(const[t,i]of n)e[t]=i;return e}function Vv(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function Ov(){try{return new Function(""),!0}catch{return!1}}class Ke{static get isLittleEndian(){return Y(this,"isLittleEndian",Vv())}static get isEvalSupported(){return Y(this,"isEvalSupported",Ov())}static get isOffscreenCanvasSupported(){return Y(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Y(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?Y(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):Y(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return Y(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const ra=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));class H{static makeHexColor(e,t,i){return`#${ra[e]}${ra[t]}${ra[i]}`}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const i=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[i,s]}static applyInverseTransform(e,t){const i=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/i,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/i;return[s,r]}static getAxialAlignedBoundingBox(e,t){const i=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),r=this.applyTransform([e[0],e[3]],t),o=this.applyTransform([e[2],e[1]],t);return[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],i=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],o=e[2]*t[1]+e[3]*t[3],a=(i+o)/2,l=Math.sqrt((i+o)**2-4*(i*o-r*s))/2,u=a+l||1,d=a-l||1;return[Math.sqrt(u),Math.sqrt(d)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>s)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[i,r,s,o]}static#e(e,t,i,s,r,o,a,l,u,d){if(u<=0||u>=1)return;const f=1-u,p=u*u,g=p*u,m=f*(f*(f*e+3*u*t)+3*p*i)+g*s,v=f*(f*(f*r+3*u*o)+3*p*a)+g*l;d[0]=Math.min(d[0],m),d[1]=Math.min(d[1],v),d[2]=Math.max(d[2],m),d[3]=Math.max(d[3],v)}static#t(e,t,i,s,r,o,a,l,u,d,f,p){if(Math.abs(u)<1e-12){Math.abs(d)>=1e-12&&this.#e(e,t,i,s,r,o,a,l,-f/d,p);return}const g=d**2-4*f*u;if(g<0)return;const m=Math.sqrt(g),v=2*u;this.#e(e,t,i,s,r,o,a,l,(-d+m)/v,p),this.#e(e,t,i,s,r,o,a,l,(-d-m)/v,p)}static bezierBoundingBox(e,t,i,s,r,o,a,l,u){return u?(u[0]=Math.min(u[0],e,a),u[1]=Math.min(u[1],t,l),u[2]=Math.max(u[2],e,a),u[3]=Math.max(u[3],t,l)):u=[Math.min(e,a),Math.min(t,l),Math.max(e,a),Math.max(t,l)],this.#t(e,i,r,a,t,s,o,l,3*(-e+3*(i-r)+a),6*(e-2*i+r),3*(i-e),u),this.#t(e,i,r,a,t,s,o,l,3*(-t+3*(s-o)+l),6*(t-2*s+o),3*(s-t),u),u}}function Gv(n){return decodeURIComponent(escape(n))}let oa=null,Xc=null;function Bv(n){return oa||(oa=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Xc=new Map([["","t"]])),n.replaceAll(oa,(e,t,i)=>t?t.normalize("NFKC"):Xc.get(i))}function zv(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),jp(n)}const mu="pdfjs_internal_id_";function qv(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(jp(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});const zt="http://www.w3.org/2000/svg";class Mi{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function So(n,e="text"){if(es(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,i)=>{const s=new XMLHttpRequest;s.open("GET",n,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})}class Vs{constructor({viewBox:e,userUnit:t,scale:i,rotation:s,offsetX:r=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=i,this.rotation=s,this.offsetX=r,this.offsetY=o,i*=t;const l=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let d,f,p,g;switch(s%=360,s<0&&(s+=360),s){case 180:d=-1,f=0,p=0,g=1;break;case 90:d=0,f=1,p=1,g=0;break;case 270:d=0,f=-1,p=-1,g=0;break;case 0:d=1,f=0,p=0,g=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(p=-p,g=-g);let m,v,S,y;d===0?(m=Math.abs(u-e[1])*i+r,v=Math.abs(l-e[0])*i+o,S=(e[3]-e[1])*i,y=(e[2]-e[0])*i):(m=Math.abs(l-e[0])*i+r,v=Math.abs(u-e[1])*i+o,S=(e[2]-e[0])*i,y=(e[3]-e[1])*i),this.transform=[d*i,f*i,p*i,g*i,m-d*i*l-p*i*u,v-f*i*l-g*i*u],this.width=S,this.height=y}get rawDims(){const{userUnit:e,viewBox:t}=this,i=t.map(s=>s*e);return Y(this,"rawDims",{pageWidth:i[2]-i[0],pageHeight:i[3]-i[1],pageX:i[0],pageY:i[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:r=!1}={}){return new Vs({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:r})}convertToViewportPoint(e,t){return H.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=H.applyTransform([e[0],e[1]],this.transform),i=H.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){return H.applyInverseTransform([e,t],this.transform)}}class yu extends Rn{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Eo(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function vu(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function $v(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function Wv(n,e="document.pdf"){if(typeof n!="string")return e;if(Eo(n))return W('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=t.exec(n);let r=i.exec(s[1])||i.exec(s[2])||i.exec(s[3]);if(r&&(r=r[0],r.includes("%")))try{r=i.exec(decodeURIComponent(r))[0]}catch{}return r||e}class Qc{started=Object.create(null);times=[];time(e){e in this.started&&W(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||W(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:i}of this.times)t=Math.max(i.length,t);for(const{name:i,start:s,end:r}of this.times)e.push(`${i.padEnd(t)} ${r-s}ms
`);return e.join("")}}function es(n,e){try{const{protocol:t}=e?new URL(n,e):new URL(n);return t==="http:"||t==="https:"}catch{return!1}}function bt(n){n.preventDefault()}function ut(n){n.preventDefault(),n.stopPropagation()}class eg{static#e;static toDateObject(e){if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const i=parseInt(t[1],10);let s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const u=t[7]||"Z";let d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let f=parseInt(t[9],10)||0;return f=f>=0&&f<=59?f:0,u==="-"?(o+=d,a+=f):u==="+"&&(o-=d,a-=f),new Date(Date.UTC(i,s,r,o,a,l))}}function Yv(n,{scale:e=1,rotation:t=0}){const{width:i,height:s}=n.attributes.style,r=[0,0,parseInt(i),parseInt(s)];return new Vs({viewBox:r,userUnit:1,scale:e,rotation:t})}function _u(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(W(`Not a valid color format: "${n}"`),[0,0,0])}function Kv(n){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of n.keys()){e.style.color=t;const i=window.getComputedStyle(e).color;n.set(t,_u(i))}e.remove()}function ce(n){const{a:e,b:t,c:i,d:s,e:r,f:o}=n.getTransform();return[e,t,i,s,r,o]}function Dt(n){const{a:e,b:t,c:i,d:s,e:r,f:o}=n.getTransform().invertSelf();return[e,t,i,s,r,o]}function qn(n,e,t=!1,i=!0){if(e instanceof Vs){const{pageWidth:s,pageHeight:r}=e.rawDims,{style:o}=n,a=Ke.isCSSRoundSupported,l=`var(--scale-factor) * ${s}px`,u=`var(--scale-factor) * ${r}px`,d=a?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,f=a?`round(down, ${u}, var(--scale-round-y, 1px))`:`calc(${u})`;!t||e.rotation%180===0?(o.width=d,o.height=f):(o.width=f,o.height=d)}i&&n.setAttribute("data-main-rotation",e.rotation)}class ol{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}class hs{#e=null;#t=null;#n;#i=null;#r=null;static#s=null;constructor(e){this.#n=e,hs.#s||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#n._uiManager._signal;e.addEventListener("contextmenu",bt,{signal:t}),e.addEventListener("pointerdown",hs.#l,{signal:t});const i=this.#i=document.createElement("div");i.className="buttons",e.append(i);const s=this.#n.toolbarPosition;if(s){const{style:r}=e,o=this.#n._uiManager.direction==="ltr"?1-s[0]:s[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return this.#h(),e}get div(){return this.#e}static#l(e){e.stopPropagation()}#a(e){this.#n._focusEventsAllowed=!1,ut(e)}#c(e){this.#n._focusEventsAllowed=!0,ut(e)}#u(e){const t=this.#n._uiManager._signal;e.addEventListener("focusin",this.#a.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#c.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",bt,{signal:t})}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#r?.shown()}#h(){const{editorType:e,_uiManager:t}=this.#n,i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",hs.#s[e]),this.#u(i),i.addEventListener("click",s=>{t.delete()},{signal:t._signal}),this.#i.append(i)}get#d(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#u(t),this.#i.prepend(t,this.#d),this.#r=e}addColorPicker(e){this.#t=e;const t=e.renderButton();this.#u(t),this.#i.prepend(t,this.#d)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class Jv{#e=null;#t=null;#n;constructor(e){this.#n=e}#i(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",bt,{signal:this.#n._signal});const t=this.#e=document.createElement("div");return t.className="buttons",e.append(t),this.#s(),e}#r(e,t){let i=0,s=0;for(const r of e){const o=r.y+r.height;if(o<i)continue;const a=r.x+(t?r.width:0);if(o>i){s=a,i=o;continue}t?a>s&&(s=a):a<s&&(s=a)}return[t?1-s:s,i]}show(e,t,i){const[s,r]=this.#r(t,i),{style:o}=this.#t||=this.#i();e.append(this.#t),o.insetInlineEnd=`${100*s}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#s(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=this.#n._signal;e.addEventListener("contextmenu",bt,{signal:i}),e.addEventListener("click",()=>{this.#n.highlightSelection("floating_button")},{signal:i}),this.#e.append(e)}}function Jr(n,e,t){for(const i of t)e.addEventListener(i,n[i].bind(n))}class Xv{#e=0;get id(){return`${Mv}${this.#e++}`}}class Au{#e=zv();#t=0;#n=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;const r=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return Y(this,"_isSVGFittingCanvas",r)}async#i(e,t){this.#n||=new Map;let i=this.#n.get(e);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let s;if(typeof t=="string"?(i.url=t,s=await So(t,"blob")):t instanceof File?s=i.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){const r=Au._isSVGFittingCanvas,o=new FileReader,a=new Image,l=new Promise((u,d)=>{a.onload=()=>{i.bitmap=a,i.isSvg=!0,u()},o.onload=async()=>{const f=i.svgUrl=o.result;a.src=await r?`${f}#svgView(preserveAspectRatio(none))`:f},a.onerror=o.onerror=d});o.readAsDataURL(s),await l}else i.bitmap=await createImageBitmap(s);i.refCounter=1}catch(s){W(s),i=null}return this.#n.set(e,i),i&&this.#n.set(i.id,i),i}async getFromFile(e){const{lastModified:t,name:i,size:s,type:r}=e;return this.#i(`${t}_${i}_${s}_${r}`,e)}async getFromUrl(e){return this.#i(e,e)}async getFromBlob(e,t){const i=await t;return this.#i(e,i)}async getFromId(e){this.#n||=new Map;const t=this.#n.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:i}=t;return delete t.blobPromise,this.getFromBlob(t.id,i)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#n||=new Map;let i=this.#n.get(e);if(i?.bitmap)return i.refCounter+=1,i;const s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#n.set(e,i),this.#n.set(i.id,i),i}getSvgUrl(e){const t=this.#n.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#n||=new Map;const t=this.#n.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:i}=t;if(!t.url&&!t.file){const s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),t.blobPromise=s.convertToBlob()}i.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class Qv{#e=[];#t=!1;#n;#i=-1;constructor(e=128){this.#n=e}add({cmd:e,undo:t,post:i,mustExec:s,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(s&&e(),this.#t)return;const l={cmd:e,undo:t,post:i,type:r};if(this.#i===-1){this.#e.length>0&&(this.#e.length=0),this.#i=0,this.#e.push(l);return}if(o&&this.#e[this.#i].type===r){a&&(l.undo=this.#e[this.#i].undo),this.#e[this.#i]=l;return}const u=this.#i+1;u===this.#n?this.#e.splice(0,1):(this.#i=u,u<this.#e.length&&this.#e.splice(u)),this.#e.push(l)}undo(){if(this.#i===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#i];e(),t?.(),this.#t=!1,this.#i-=1}redo(){if(this.#i<this.#e.length-1){this.#i+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#i];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#e.length-1}cleanType(e){if(this.#i!==-1){for(let t=this.#i;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#i-t),this.#i=t;return}this.#e.length=0,this.#i=-1}}destroy(){this.#e=null}}class Os{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Ke.platform;for(const[i,s,r={}]of e)for(const o of i){const a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const i=this.callbacks.get(this.#e(t));if(!i)return;const{callback:s,options:{bubbles:r=!1,args:o=[],checker:a=null}}=i;a&&!a(e,t)||(s.bind(e,...o,t)(),r||ut(t))}}class Su{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return Kv(e),Y(this,"_colors",e)}convert(e){const t=_u(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[i,s]of this._colors)if(s.every((r,o)=>r===t[o]))return Su._colorsMapping.get(i);return t}getHexCode(e){const t=this._colors.get(e);return t?H.makeHexColor(...t):e}}class Tn{#e=new AbortController;#t=null;#n=new Map;#i=new Map;#r=null;#s=null;#l=null;#a=new Qv;#c=null;#u=null;#h=0;#d=new Set;#f=null;#o=null;#p=new Set;_editorUndoBar=null;#m=!1;#g=!1;#y=!1;#A=null;#v=null;#S=null;#w=null;#T=!1;#I=null;#R=new Xv;#E=!1;#P=!1;#x=null;#k=null;#L=null;#F=null;#C=$.NONE;#_=new Set;#N=null;#G=null;#B=null;#z={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#U=[0,0];#D=null;#H=null;#q=null;#b=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=Tn.prototype,t=o=>o.#H.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),i=(o,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},s=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return Y(this,"_keyboardManager",new Os([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],e.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:i}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&o.#H.contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&o.#H.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}constructor(e,t,i,s,r,o,a,l,u,d,f,p,g){const m=this._signal=this.#e.signal;this.#H=e,this.#q=t,this.#r=i,this._eventBus=s,s._on("editingaction",this.onEditingAction.bind(this),{signal:m}),s._on("pagechanging",this.onPageChanging.bind(this),{signal:m}),s._on("scalechanging",this.onScaleChanging.bind(this),{signal:m}),s._on("rotationchanging",this.onRotationChanging.bind(this),{signal:m}),s._on("setpreference",this.onSetPreference.bind(this),{signal:m}),s._on("switchannotationeditorparams",v=>this.updateParams(v.type,v.value),{signal:m}),this.#te(),this.#re(),this.#K(),this.#s=r.annotationStorage,this.#A=r.filterFactory,this.#G=o,this.#w=a||null,this.#m=l,this.#g=u,this.#y=d,this.#F=f||null,this.viewParameters={realScale:Mi.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=g!==!1}destroy(){this.#b?.resolve(),this.#b=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#i.values())e.destroy();this.#i.clear(),this.#n.clear(),this.#p.clear(),this.#t=null,this.#_.clear(),this.#a.destroy(),this.#r?.destroy(),this.#I?.hide(),this.#I=null,this.#v&&(clearTimeout(this.#v),this.#v=null),this.#D&&(clearTimeout(this.#D),this.#D=null),this._editorUndoBar?.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#F}get useNewAltTextFlow(){return this.#g}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return Y(this,"hcmFilter",this.#G?this.#A.addHCMFilter(this.#G.foreground,this.#G.background):"none")}get direction(){return Y(this,"direction",getComputedStyle(this.#H).direction)}get highlightColors(){return Y(this,"highlightColors",this.#w?new Map(this.#w.split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return Y(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#u=e}setMainHighlightColorPicker(e){this.#L=e}editAltText(e,t=!1){this.#r?.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":this.#y=t;break}}onPageChanging({pageNumber:e}){this.#h=e-1}focusMainContainer(){this.#H.focus()}findParent(e,t){for(const i of this.#i.values()){const{x:s,y:r,width:o,height:a}=i.div.getBoundingClientRect();if(e>=s&&e<=s+o&&t>=r&&t<=r+a)return i}return null}disableUserSelect(e=!1){this.#q.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*Mi.PDF_TO_CSS_UNITS;for(const t of this.#p)t.onScaleChanging();this.#u?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#V({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#Y(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const i of this.#i.values())if(i.hasTextLayer(e))return i;return null}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:r,focusOffset:o}=t,a=t.toString(),u=this.#V(t).closest(".textLayer"),d=this.getSelectionBoxes(u);if(!d)return;t.empty();const f=this.#Y(u),p=this.#C===$.NONE,g=()=>{f?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:i,anchorOffset:s,focusNode:r,focusOffset:o,text:a}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode($.HIGHLIGHT,g);return}g()}#j(){const e=document.getSelection();if(!e||e.isCollapsed)return;const i=this.#V(e).closest(".textLayer"),s=this.getSelectionBoxes(i);s&&(this.#I||=new Jv(this),this.#I.show(i,s,this.direction==="ltr"))}addToAnnotationStorage(e){!e.isEmpty()&&this.#s&&!this.#s.has(e.id)&&this.#s.setValue(e.id,e)}#ee(){const e=document.getSelection();if(!e||e.isCollapsed){this.#N&&(this.#I?.hide(),this.#N=null,this.#M({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#N)return;const s=this.#V(e).closest(".textLayer");if(!s){this.#N&&(this.#I?.hide(),this.#N=null,this.#M({hasSelectedText:!1}));return}if(this.#I?.hide(),this.#N=t,this.#M({hasSelectedText:!0}),!(this.#C!==$.HIGHLIGHT&&this.#C!==$.NONE)&&(this.#C===$.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#T=this.isShiftKeyDown,!this.isShiftKeyDown)){const r=this.#C===$.HIGHLIGHT?this.#Y(s):null;r?.toggleDrawing();const o=new AbortController,a=this.combinedSignal(o),l=u=>{u.type==="pointerup"&&u.button!==0||(o.abort(),r?.toggleDrawing(!0),u.type==="pointerup"&&this.#W("main_toolbar"))};window.addEventListener("pointerup",l,{signal:a}),window.addEventListener("blur",l,{signal:a})}}#W(e=""){this.#C===$.HIGHLIGHT?this.highlightSelection(e):this.#m&&this.#j()}#te(){document.addEventListener("selectionchange",this.#ee.bind(this),{signal:this._signal})}#ne(){if(this.#S)return;this.#S=new AbortController;const e=this.combinedSignal(this.#S);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#ie(){this.#S?.abort(),this.#S=null}blur(){if(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#W("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#_)if(t.div.contains(e)){this.#k=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#k)return;const[e,t]=this.#k;this.#k=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#K(){if(this.#x)return;this.#x=new AbortController;const e=this.combinedSignal(this.#x);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#se(){this.#x?.abort(),this.#x=null}#J(){if(this.#c)return;this.#c=new AbortController;const e=this.combinedSignal(this.#c);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#X(){this.#c?.abort(),this.#c=null}#re(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#K(),this.#J()}removeEditListeners(){this.#se(),this.#X()}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const i of this.#o)if(i.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const i of this.#o)if(i.isHandlingMimeForPasting(t.type)){i.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of this.#_){const s=i.serialize(!0);s&&t.push(s)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const o of this.#o)if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let i=t.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(r){W(`paste: "${r.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const s=this.currentLayer;try{const r=[];for(const l of i){const u=await s.deserialize(l);if(!u)return;r.push(u)}const o=()=>{for(const l of r)this.#Q(l);this.#Z(r)},a=()=>{for(const l of r)l.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(r){W(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#C!==$.NONE&&!this.isEditorHandlingKeyboard&&Tn._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#T&&(this.#T=!1,this.#W("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#M(e){Object.entries(e).some(([i,s])=>this.#z[i]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#z,e)}),this.#C===$.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#O([[Q.HIGHLIGHT_FREE,!0]]))}#O(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#ne(),this.#J(),this.#M({isEditing:this.#C!==$.NONE,isEmpty:this.#$(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ie(),this.#X(),this.#M({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#o){this.#o=e;for(const t of this.#o)this.#O(t.defaultPropertiesToUpdate)}}getId(){return this.#R.id}get currentLayer(){return this.#i.get(this.#h)}getLayer(e){return this.#i.get(e)}get currentPageIndex(){return this.#h}addLayer(e){this.#i.set(e.pageIndex,e),this.#E?e.enable():e.disable()}removeLayer(e){this.#i.delete(e.pageIndex)}async updateMode(e,t=null,i=!1){if(this.#C!==e&&!(this.#b&&(await this.#b.promise,!this.#b))){if(this.#b=Promise.withResolvers(),this.#C=e,e===$.NONE){this.setEditingState(!1),this.#ae(),this._editorUndoBar?.hide(),this.#b.resolve();return}this.setEditingState(!0),await this.#oe(),this.unselectAll();for(const s of this.#i.values())s.updateMode(e);if(!t){i&&this.addNewEditorFromKeyboard(),this.#b.resolve();return}for(const s of this.#n.values())s.annotationElementId===t?(this.setSelected(s),s.enterInEditMode()):s.unselect();this.#b.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==this.#C&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){if(this.#o){switch(e){case Q.CREATE:this.currentLayer.addNewEditor();return;case Q.HIGHLIGHT_DEFAULT_COLOR:this.#L?.updateColor(t);break;case Q.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#B||=new Map).set(e,t),this.showAllEditors("highlight",t);break}for(const i of this.#_)i.updateParams(e,t);for(const i of this.#o)i.updateDefaultParams(e,t)}}showAllEditors(e,t,i=!1){for(const r of this.#n.values())r.editorType===e&&r.show(t);(this.#B?.get(Q.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#O([[Q.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#P!==e){this.#P=e;for(const t of this.#i.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#oe(){if(!this.#E){this.#E=!0;const e=[];for(const t of this.#i.values())e.push(t.enable());await Promise.all(e);for(const t of this.#n.values())t.enable()}}#ae(){if(this.unselectAll(),this.#E){this.#E=!1;for(const e of this.#i.values())e.disable();for(const e of this.#n.values())e.disable()}}getEditors(e){const t=[];for(const i of this.#n.values())i.pageIndex===e&&t.push(i);return t}getEditor(e){return this.#n.get(e)}addEditor(e){this.#n.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#v&&clearTimeout(this.#v),this.#v=setTimeout(()=>{this.focusMainContainer(),this.#v=null},0)),this.#n.delete(e.id),this.unselect(e),(!e.annotationElementId||!this.#d.has(e.annotationElementId))&&this.#s?.remove(e.id)}addDeletedAnnotationElement(e){this.#d.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#d.has(e)}removeDeletedAnnotationElement(e){this.#d.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#Q(e){const t=this.#i.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#O(e.propertiesToUpdate))}get#le(){let e=null;for(e of this.#_);return e}updateUI(e){this.#le===e&&this.#O(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#O(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#_.has(e)){this.#_.delete(e),e.unselect(),this.#M({hasSelectedEditor:this.hasSelection});return}this.#_.add(e),e.select(),this.#O(e.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}setSelected(e){this.#u?.commitOrRemove();for(const t of this.#_)t!==e&&t.unselect();this.#_.clear(),this.#_.add(e),e.select(),this.#O(e.propertiesToUpdate),this.#M({hasSelectedEditor:!0})}isSelected(e){return this.#_.has(e)}get firstSelectedEditor(){return this.#_.values().next().value}unselect(e){e.unselect(),this.#_.delete(e),this.#M({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#_.size!==0}get isEnterHandled(){return this.#_.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#a.undo(),this.#M({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#$()}),this._editorUndoBar?.hide()}redo(){this.#a.redo(),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#$()})}addCommands(e){this.#a.add(e),this.#M({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#$()})}cleanUndoStack(e){this.#a.cleanType(e)}#$(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const e of this.#n.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#_],i=()=>{this._editorUndoBar?.show(s,t.length===1?t[0].editorType:t.length);for(const r of t)r.remove()},s=()=>{for(const r of t)this.#Q(r)};this.addCommands({cmd:i,undo:s,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#Z(e){for(const t of this.#_)t.unselect();this.#_.clear();for(const t of e)t.isEmpty()||(this.#_.add(t),t.select());this.#M({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#_)e.commit();this.#Z(this.#n.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#C!==$.NONE))&&!this.#u?.commitOrRemove()&&this.hasSelection){for(const e of this.#_)e.unselect();this.#_.clear(),this.#M({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;this.#U[0]+=e,this.#U[1]+=t;const[s,r]=this.#U,o=[...this.#_],a=1e3;this.#D&&clearTimeout(this.#D),this.#D=setTimeout(()=>{this.#D=null,this.#U[0]=this.#U[1]=0,this.addCommands({cmd:()=>{for(const l of o)this.#n.has(l.id)&&l.translateInPage(s,r)},undo:()=>{for(const l of o)this.#n.has(l.id)&&l.translateInPage(-s,-r)},mustExec:!1})},a);for(const l of o)l.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(const e of this.#_)this.#f.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);const e=this.#f;this.#f=null;let t=!1;for(const[{x:s,y:r,pageIndex:o},a]of e)a.newX=s,a.newY=r,a.newPageIndex=o,t||=s!==a.savedX||r!==a.savedY||o!==a.savedPageIndex;if(!t)return!1;const i=(s,r,o,a)=>{if(this.#n.has(s.id)){const l=this.#i.get(a);l?s._setParentAndPosition(l,r,o):(s.pageIndex=a,s.x=r,s.y=o)}};return this.addCommands({cmd:()=>{for(const[s,{newX:r,newY:o,newPageIndex:a}]of e)i(s,r,o,a)},undo:()=>{for(const[s,{savedX:r,savedY:o,savedPageIndex:a}]of e)i(s,r,o,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#f)for(const i of this.#f.keys())i.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#_.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#C}get imageManager(){return Y(this,"imageManager",new Au)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,d=t.rangeCount;u<d;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:i,y:s,width:r,height:o}=e.getBoundingClientRect();let a;switch(e.getAttribute("data-main-rotation")){case"90":a=(u,d,f,p)=>({x:(d-s)/o,y:1-(u+f-i)/r,width:p/o,height:f/r});break;case"180":a=(u,d,f,p)=>({x:1-(u+f-i)/r,y:1-(d+p-s)/o,width:f/r,height:p/o});break;case"270":a=(u,d,f,p)=>({x:1-(d+p-s)/o,y:(u-i)/r,width:p/o,height:f/r});break;default:a=(u,d,f,p)=>({x:(u-i)/r,y:(d-s)/o,width:f/r,height:p/o});break}const l=[];for(let u=0,d=t.rangeCount;u<d;u++){const f=t.getRangeAt(u);if(!f.collapsed)for(const{x:p,y:g,width:m,height:v}of f.getClientRects())m===0||v===0||l.push(a(p,g,m,v))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#l||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#l?.delete(e)}renderAnnotationElement(e){const t=this.#l?.get(e.data.id);if(!t)return;const i=this.#s.getRawValue(t);i&&(this.#C===$.NONE&&!i.hasBeenModified||i.renderAnnotationElement(e))}}class Ht{#e=null;#t=!1;#n=null;#i=null;#r=null;#s=null;#l=!1;#a=null;#c=null;#u=null;#h=null;#d=!1;static#f=null;static _l10n=null;constructor(e){this.#c=e,this.#d=e._uiManager.useNewAltTextFlow,Ht.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){Ht._l10n??=e}async render(){const e=this.#n=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#i=document.createElement("span");e.append(t),this.#d?(e.classList.add("new"),e.setAttribute("data-l10n-id",Ht.#f.missing),t.setAttribute("data-l10n-id",Ht.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=this.#c._uiManager._signal;e.addEventListener("contextmenu",bt,{signal:i}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:i});const s=r=>{r.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#d&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#o}})};return e.addEventListener("click",s,{capture:!0,signal:i}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(this.#l=!0,s(r))},{signal:i}),await this.#p(),e}get#o(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#l}),this.#l=!1)}isEmpty(){return this.#d?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#d?this.#e!==null||!!this.#u:this.isEmpty()}get guessedText(){return this.#u}async setGuessedText(e){this.#e===null&&(this.#u=e,this.#h=await Ht._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#p())}toggleAltTextBadge(e=!1){if(!this.#d||this.#e){this.#a?.remove(),this.#a=null;return}if(!this.#a){const t=this.#a=document.createElement("div");t.className="noAltTextBadge",this.#c.div.append(t)}this.#a.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#u===t&&(t=this.#h),{altText:t,decorative:this.#t,guessedText:this.#u,textWithDisclaimer:this.#h}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:i,textWithDisclaimer:s,cancel:r=!1}){i&&(this.#u=i,this.#h=s),!(this.#e===e&&this.#t===t)&&(r||(this.#e=e,this.#t=t),this.#p())}toggle(e=!1){this.#n&&(!e&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#n.disabled=!e)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#o}})}destroy(){this.#n?.remove(),this.#n=null,this.#i=null,this.#r=null,this.#a?.remove(),this.#a=null}async#p(){const e=this.#n;if(!e)return;if(this.#d){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",Ht.#f[this.#o]),this.#i?.setAttribute("data-l10n-id",Ht.#f[`${this.#o}-label`]),!this.#e){this.#r?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#r?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#r;if(!t){this.#r=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#c.id}`;const s=100,r=this.#c._uiManager._signal;r.addEventListener("abort",()=>{clearTimeout(this.#s),this.#s=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#r.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:r}),e.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#r?.classList.remove("show")},{signal:r})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#c.getImageForAltText()?.setAttribute("aria-describedby",t.id)}}class wo{#e;#t=!1;#n=null;#i;#r;#s;#l;#a;#c=null;#u;#h=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:o=null,signal:a}){this.#e=e,this.#n=i,this.#i=t,this.#r=s,this.#s=r,this.#l=o,this.#u=new AbortController,this.#a=AbortSignal.any([a,this.#u.signal]),e.addEventListener("touchstart",this.#d.bind(this),{passive:!1,signal:this.#a})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return Y(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}#d(e){if(this.#i?.()||e.touches.length<2)return;if(!this.#h){this.#h=new AbortController;const s=AbortSignal.any([this.#a,this.#h.signal]),r=this.#e,o={signal:s,passive:!1};r.addEventListener("touchmove",this.#f.bind(this),o),r.addEventListener("touchend",this.#o.bind(this),o),r.addEventListener("touchcancel",this.#o.bind(this),o),this.#r?.()}if(ut(e),e.touches.length!==2||this.#n?.()){this.#c=null;return}let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]),this.#c={touch0X:t.screenX,touch0Y:t.screenY,touch1X:i.screenX,touch1Y:i.screenY}}#f(e){if(!this.#c||e.touches.length!==2)return;let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]);const{screenX:s,screenY:r}=t,{screenX:o,screenY:a}=i,l=this.#c,{touch0X:u,touch0Y:d,touch1X:f,touch1Y:p}=l,g=f-u,m=p-d,v=o-s,S=a-r,y=Math.hypot(v,S)||1,_=Math.hypot(g,m)||1;if(!this.#t&&Math.abs(_-y)<=wo.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=r,l.touch1X=o,l.touch1Y=a,e.preventDefault(),!this.#t){this.#t=!0;return}const A=[(s+o)/2,(r+a)/2];this.#s?.(A,_,y)}#o(e){this.#h.abort(),this.#h=null,this.#l?.(),this.#c&&(e.preventDefault(),this.#c=null,this.#t=!1)}destroy(){this.#u?.abort(),this.#u=null}}class B{#e=null;#t=null;#n=null;#i=!1;#r=null;#s="";#l=!1;#a=null;#c=null;#u=null;#h=null;#d="";#f=!1;#o=null;#p=!1;#m=!1;#g=!1;#y=null;#A=0;#v=0;#S=null;#w=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#T=!1;#I=B._zIndex++;static _borderLineWidth=-1;static _colorManager=new Su;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=B.prototype._resizeWithKeyboard,t=Tn.TRANSLATE_SMALL,i=Tn.TRANSLATE_BIG;return Y(this,"_resizerKeyboardManager",new Os([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],B.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:i,pageHeight:s,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[r,o];const[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Y(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new Zv({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(B._l10n??=e,B._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),B._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);B._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){se("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#T}set _isDraggable(e){this.#T=e,this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#I}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):this.#V(),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,i,s){const[r,o]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(e+i)/r,this.y=(t+s)/o,this.fixAndSetPosition()}#R([e,t],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#R(this.parentDimensions,e,t)}translateInPage(e,t){this.#o||=[this.x,this.y,this.width,this.height],this.#R(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){this.#o||=[this.x,this.y,this.width,this.height];const{div:i,parentDimensions:[s,r]}=this;if(this.x+=e/s,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:f,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,f,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this;const[l,u]=this.getBaseTranslation();o+=l,a+=u;const{style:d}=i;d.left=`${(100*o).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),i.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#o&&(this.#o[0]!==this.x||this.#o[1]!==this.y)}get _hasBeenResized(){return!!this.#o&&(this.#o[2]!==this.width||this.#o[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:i}=B,s=i/e,r=i/t;switch(this.rotation){case 90:return[-s,r];case 180:return[s,r];case 270:return[s,-r];default:return[-s,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[i,s]}=this;let{x:r,y:o,width:a,height:l}=this;if(a*=i,l*=s,r*=i,o*=s,this._mustFixPosition)switch(e){case 0:r=Math.max(0,Math.min(i-a,r)),o=Math.max(0,Math.min(s-l,o));break;case 90:r=Math.max(0,Math.min(i-l,r)),o=Math.min(s,Math.max(a,o));break;case 180:r=Math.min(i,Math.max(a,r)),o=Math.min(s,Math.max(l,o));break;case 270:r=Math.min(i,Math.max(l,r)),o=Math.max(0,Math.min(s-a,o));break}this.x=r/=i,this.y=o/=s;const[u,d]=this.getBaseTranslation();r+=u,o+=d,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}static#E(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return B.#E(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return B.#E(e,t,360-this.parentRotation)}#P(e){switch(e){case 90:{const[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,i]}=this;return[t*e,i*e]}setDims(e,t){const[i,s]=this.parentDimensions,{style:r}=this.div;r.width=`${(100*e/i).toFixed(2)}%`,this.#l||(r.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:i}=e,s=i.endsWith("%"),r=!this.#l&&t.endsWith("%");if(s&&r)return;const[o,a]=this.parentDimensions;s||(e.width=`${(100*parseFloat(i)/o).toFixed(2)}%`),!this.#l&&!r&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#x(){if(this.#a)return;this.#a=document.createElement("div"),this.#a.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const i of e){const s=document.createElement("div");this.#a.append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",this.#k.bind(this,i),{signal:t}),s.addEventListener("contextmenu",bt,{signal:t}),s.tabIndex=-1}this.div.prepend(this.#a)}#k(e,t){t.preventDefault();const{isMac:i}=Ke.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#n?.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,this.#c=[t.screenX,t.screenY];const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#C.bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",ut,{passive:!1,signal:o}),window.addEventListener("contextmenu",bt,{signal:o}),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{r.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=a,this.div.style.cursor=l,this.#F()};window.addEventListener("pointerup",u,{signal:o}),window.addEventListener("blur",u,{signal:o})}#L(e,t,i,s){this.width=i,this.height=s,this.x=e,this.y=t;const[r,o]=this.parentDimensions;this.setDims(r*i,o*s),this.fixAndSetPosition(),this._onResized()}_onResized(){}#F(){if(!this.#u)return;const{savedX:e,savedY:t,savedWidth:i,savedHeight:s}=this.#u;this.#u=null;const r=this.x,o=this.y,a=this.width,l=this.height;r===e&&o===t&&a===i&&l===s||this.addCommands({cmd:this.#L.bind(this,r,o,a,l),undo:this.#L.bind(this,e,t,i,s),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#C(e,t){const[i,s]=this.parentDimensions,r=this.x,o=this.y,a=this.width,l=this.height,u=B.MIN_SIZE/i,d=B.MIN_SIZE/s,f=this.#P(this.rotation),p=(k,U)=>[f[0]*k+f[2]*U,f[1]*k+f[3]*U],g=this.#P(360-this.rotation),m=(k,U)=>[g[0]*k+g[2]*U,g[1]*k+g[3]*U];let v,S,y=!1,_=!1;switch(e){case"topLeft":y=!0,v=(k,U)=>[0,0],S=(k,U)=>[k,U];break;case"topMiddle":v=(k,U)=>[k/2,0],S=(k,U)=>[k/2,U];break;case"topRight":y=!0,v=(k,U)=>[k,0],S=(k,U)=>[0,U];break;case"middleRight":_=!0,v=(k,U)=>[k,U/2],S=(k,U)=>[0,U/2];break;case"bottomRight":y=!0,v=(k,U)=>[k,U],S=(k,U)=>[0,0];break;case"bottomMiddle":v=(k,U)=>[k/2,U],S=(k,U)=>[k/2,0];break;case"bottomLeft":y=!0,v=(k,U)=>[0,U],S=(k,U)=>[k,0];break;case"middleLeft":_=!0,v=(k,U)=>[0,U/2],S=(k,U)=>[k,U/2];break}const A=v(a,l),E=S(a,l);let w=p(...E);const C=B._round(r+w[0]),T=B._round(o+w[1]);let I=1,P=1,R,L;if(t.fromKeyboard)({deltaX:R,deltaY:L}=t);else{const{screenX:k,screenY:U}=t,[b,O]=this.#c;[R,L]=this.screenToPageTranslation(k-b,U-O),this.#c[0]=k,this.#c[1]=U}if([R,L]=m(R/i,L/s),y){const k=Math.hypot(a,l);I=P=Math.max(Math.min(Math.hypot(E[0]-A[0]-R,E[1]-A[1]-L)/k,1/a,1/l),u/a,d/l)}else _?I=Math.max(u,Math.min(1,Math.abs(E[0]-A[0]-R)))/a:P=Math.max(d,Math.min(1,Math.abs(E[1]-A[1]-L)))/l;const V=B._round(a*I),J=B._round(l*P);w=p(...S(V,J));const ee=C-w[0],Ae=T-w[1];this.#o||=[this.x,this.y,this.width,this.height],this.width=V,this.height=J,this.x=ee,this.y=Ae,this.setDims(i*V,s*J),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}async addEditToolbar(){return this._editToolbar||this.#m?this._editToolbar:(this._editToolbar=new hs(this),this.div.append(this._editToolbar.render()),this.#n&&await this._editToolbar.addAltText(this.#n),this._editToolbar)}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#n?.destroy())}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#n||(Ht.initialize(B._l10n),this.#n=new Ht(this),this.#e&&(this.#n.data=this.#e,this.#e=null),await this.addEditToolbar())}get altTextData(){return this.#n?.data}set altTextData(e){this.#n&&(this.#n.data=e)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(e){await this.#n?.setGuessedText(e)}serializeAltText(e){return this.#n?.serialize(e)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#i?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#U();const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[i,s]=this.getInitialTranslation();return this.translate(i,s),Jr(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#w||=new wo({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#_.bind(this),onPinching:this.#N.bind(this),onPinchEnd:this.#G.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),this.div}#_(){this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#N(e,t,i){let r=.7*(i/t)+1-.7;if(r===1)return;const o=this.#P(this.rotation),a=(C,T)=>[o[0]*C+o[2]*T,o[1]*C+o[3]*T],[l,u]=this.parentDimensions,d=this.x,f=this.y,p=this.width,g=this.height,m=B.MIN_SIZE/l,v=B.MIN_SIZE/u;r=Math.max(Math.min(r,1/p,1/g),m/p,v/g);const S=B._round(p*r),y=B._round(g*r);if(S===p&&y===g)return;this.#o||=[d,f,p,g];const _=a(p/2,g/2),A=B._round(d+_[0]),E=B._round(f+_[1]),w=a(S/2,y/2);this.x=A-w[0],this.y=E-w[1],this.width=S,this.height=y,this.setDims(l*S,u*y),this.fixAndSetPosition(),this._onResizing()}#G(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#F()}pointerdown(e){const{isMac:t}=Ke.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#z(e);return}this.#B(e)}get isSelected(){return this._uiManager.isSelected(this)}#B(e){const{isMac:t}=Ke.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#z(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let i=!1;const s=new AbortController,r=this._uiManager.combinedSignal(s),o={capture:!0,passive:!1,signal:r},a=u=>{s.abort(),this.#r=null,this.#f=!1,this._uiManager.endDragSession()||this.#B(u),i&&this._onStopDragging()};t&&(this.#A=e.clientX,this.#v=e.clientY,this.#r=e.pointerId,this.#s=e.pointerType,window.addEventListener("pointermove",u=>{i||(i=!0,this._onStartDragging());const{clientX:d,clientY:f,pointerId:p}=u;if(p!==this.#r){ut(u);return}const[g,m]=this.screenToPageTranslation(d-this.#A,f-this.#v);this.#A=d,this.#v=f,this._uiManager.dragSelectedEditors(g,m)},o),window.addEventListener("touchmove",ut,o),window.addEventListener("pointerdown",u=>{u.pointerType===this.#s&&(this.#w||u.isPrimary)&&a(u),ut(u)},o));const l=u=>{if(!this.#r||this.#r===u.pointerId){a(u);return}ut(u)};window.addEventListener("pointerup",l,{signal:r}),window.addEventListener("blur",l,{signal:r})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,i=this.rotation){const s=this.parentScale,[r,o]=this.pageDimensions,[a,l]=this.pageTranslation,u=e/s,d=t/s,f=this.x*r,p=this.y*o,g=this.width*r,m=this.height*o;switch(i){case 0:return[f+u+a,o-p-d-m+l,f+u+g+a,o-p-d+l];case 90:return[f+d+a,o-p+u+l,f+d+m+a,o-p+u+g+l];case 180:return[f-u-g+a,o-p+d+l,f-u+a,o-p+d+m+l];case 270:return[f-d-m+a,o-p-u-g+l,f-d+a,o-p-u+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[i,s,r,o]=e,a=r-i,l=o-s;switch(this.rotation){case 0:return[i,t-o,a,l];case 90:return[i,t-s,l,a];case 180:return[r,t-s,a,l];case 270:return[r,t-o,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){this.#m=!0}disableEditMode(){this.#m=!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#g}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&s>0&&e<r&&i>0}#U(){if(this.#h||!this.div)return;this.#h=new AbortController;const e=this._uiManager.combinedSignal(this.#h);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#U()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){se("An editor must be serializable")}static async deserialize(e,t,i){const s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i});s.rotation=e.rotation,s.#e=e.accessibilityData;const[r,o]=s.pageDimensions,[a,l,u,d]=s.getRectInCurrentCoords(e.rect,o);return s.x=a/r,s.y=l/o,s.width=u/r,s.height=d/o,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#h?.abort(),this.#h=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#V(),this.removeEditToolbar(),this.#S){for(const e of this.#S.values())clearTimeout(e);this.#S=null}this.parent=null,this.#w?.destroy(),this.#w=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#x(),this.#a.classList.remove("hidden"),Jr(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#a.children;if(!this.#t){this.#t=Array.from(t);const o=this.#D.bind(this),a=this.#H.bind(this),l=this._uiManager._signal;for(const u of this.#t){const d=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",o,{signal:l}),u.addEventListener("blur",a,{signal:l}),u.addEventListener("focus",this.#q.bind(this,d),{signal:l}),u.setAttribute("data-l10n-id",B._l10nResizer[d])}}const i=this.#t[0];let s=0;for(const o of t){if(o===i)break;s++}const r=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(r!==s){if(r<s)for(let a=0;a<s-r;a++)this.#a.append(this.#a.firstChild);else if(r>s)for(let a=0;a<r-s;a++)this.#a.firstChild.before(this.#a.lastChild);let o=0;for(const a of t){const u=this.#t[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",B._l10nResizer[u])}}this.#b(0),this.#g=!0,this.#a.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#D(e){B._resizerKeyboardManager.exec(this,e)}#H(e){this.#g&&e.relatedTarget?.parentNode!==this.#a&&this.#V()}#q(e){this.#d=this.#g?e:""}#b(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#g&&this.#C(this.#d,{deltaX:e,deltaY:t,fromKeyboard:!0})}#V(){this.#g=!1,this.#b(-1),this.#F()}_stopResizingWithKeyboard(){this.#V(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}unselect(){this.#a?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#l=!0;const i=e/t,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#S||=new Map;const{action:i}=e;let s=this.#S.get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),this.#S.delete(i),this.#S.size===0&&(this.#S=null)},B._telemetryTimeout),this.#S.set(i,s);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#i=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#i=!0}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const i=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),i.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class Zv extends B{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Zc=3285377520,gt=4294901760,Ft=65535;class tg{constructor(e){this.h1=e?e&4294967295:Zc,this.h2=e?e&4294967295:Zc}update(e){let t,i;if(typeof e=="string"){t=new Uint8Array(e.length*2),i=0;for(let v=0,S=e.length;v<S;v++){const y=e.charCodeAt(v);y<=255?t[i++]=y:(t[i++]=y>>>8,t[i++]=y&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),i=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=i>>2,r=i-s*4,o=new Uint32Array(t.buffer,0,s);let a=0,l=0,u=this.h1,d=this.h2;const f=3432918353,p=461845907,g=f&Ft,m=p&Ft;for(let v=0;v<s;v++)v&1?(a=o[v],a=a*f&gt|a*g&Ft,a=a<<15|a>>>17,a=a*p&gt|a*m&Ft,u^=a,u=u<<13|u>>>19,u=u*5+3864292196):(l=o[v],l=l*f&gt|l*g&Ft,l=l<<15|l>>>17,l=l*p&gt|l*m&Ft,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,r){case 3:a^=t[s*4+2]<<16;case 2:a^=t[s*4+1]<<8;case 1:a^=t[s*4],a=a*f&gt|a*g&Ft,a=a<<15|a>>>17,a=a*p&gt|a*m&Ft,s&1?u^=a:d^=a}this.h1=u,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&gt|e*36045&Ft,t=t*4283543511&gt|((t<<16|e>>>16)*2950163797&gt)>>>16,e^=t>>>1,e=e*444984403&gt|e*60499&Ft,t=t*3301882366&gt|((t<<16|e>>>16)*3120437893&gt)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const al=Object.freeze({map:null,hash:"",transfer:void 0});class Eu{#e=!1;#t=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const i=this.#n.get(e);return i===void 0?t:Object.assign(t,i)}getRawValue(e){return this.#n.get(e)}remove(e){if(this.#n.delete(e),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of this.#n.values())if(t instanceof B)return;this.onAnnotationEditor(null)}}setValue(e,t){const i=this.#n.get(e);let s=!1;if(i!==void 0)for(const[r,o]of Object.entries(t))i[r]!==o&&(s=!0,i[r]=o);else s=!0,this.#n.set(e,t);s&&this.#i(),t instanceof B&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#n.has(e)}getAll(){return this.#n.size>0?gu(this.#n):null}setAll(e){for(const[t,i]of Object.entries(e))this.setValue(t,i)}get size(){return this.#n.size}#i(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new ng(this)}get serializable(){if(this.#n.size===0)return al;const e=new Map,t=new tg,i=[],s=Object.create(null);let r=!1;for(const[o,a]of this.#n){const l=a instanceof B?a.serialize(!1,s):a;l&&(e.set(o,l),t.update(`${o}:${JSON.stringify(l)}`),r||=!!l.bitmap)}if(r)for(const o of e.values())o.bitmap&&i.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:i}:al}get editorStats(){let e=null;const t=new Map;for(const i of this.#n.values()){if(!(i instanceof B))continue;const s=i.telemetryFinalData;if(!s)continue;const{type:r}=s;t.has(r)||t.set(r,Object.getPrototypeOf(i).constructor),e||=Object.create(null);const o=e[r]||=new Map;for(const[a,l]of Object.entries(s)){if(a==="type")continue;let u=o.get(a);u||(u=new Map,o.set(a,u));const d=u.get(l)??0;u.set(l,d+1)}}for(const[i,s]of t)e[i]=s.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){this.#t=null}get modifiedIds(){if(this.#t)return this.#t;const e=[];for(const t of this.#n.values())!(t instanceof B)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}}class ng extends Eu{#e;constructor(e){super();const{map:t,hash:i,transfer:s}=e.serializable,r=structuredClone(t,s?{transfer:s}:null);this.#e={map:r,hash:i,transfer:s}}get print(){se("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return Y(this,"modifiedIds",{ids:new Set,hash:""})}}class jv{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||this.#e.has(e.loadedName))){if(Ce(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:s,style:r}=e,o=new FontFace(i,s,r);this.addNativeFontFace(o);try{await o.load(),this.#e.add(i),t?.(e)}catch{W(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}se("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(s){throw W(`Failed to load font '${i.family}': '${s}'.`),e.disableFontFace=!0,s}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return Y(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(Ge||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),Y(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(Ce(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){const r=i.shift();setTimeout(r.callback,0)}}const{loadingRequests:i}=this,s={done:!1,complete:t,callback:e};return i.push(s),s}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Y(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function i(E,w){return E.charCodeAt(w)<<24|E.charCodeAt(w+1)<<16|E.charCodeAt(w+2)<<8|E.charCodeAt(w+3)&255}function s(E,w,C,T){const I=E.substring(0,w),P=E.substring(w+C);return I+T+P}let r,o;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let u=0;function d(E,w){if(++u>30){W("Load test font never loaded."),w();return}if(l.font="30px "+E,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){w();return}setTimeout(d.bind(null,E,w))}const f=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=s(p,976,f.length,f);const m=16,v=1482184792;let S=i(p,m);for(r=0,o=f.length-3;r<o;r+=4)S=S-v+i(f,r)|0;r<f.length&&(S=S-v+i(f+"XXX",r)|0),p=s(p,m,4,Hv(S));const y=`url(data:font/opentype;base64,${btoa(p)});`,_=`@font-face {font-family:"${f}";src:${y}}`;this.insertRule(_);const A=this._document.createElement("div");A.style.visibility="hidden",A.style.width=A.style.height="10px",A.style.position="absolute",A.style.top=A.style.left="0px";for(const E of[e.loadedName,f]){const w=this._document.createElement("span");w.textContent="Hi",w.style.fontFamily=E,A.append(w)}this._document.body.append(A),d(f,()=>{A.remove(),t.complete()})}}class e0{constructor(e,{disableFontFace:t=!1,fontExtraProperties:i=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(const r in e)this[r]=e[r];this.disableFontFace=t===!0,this.fontExtraProperties=i===!0,this._inspectFont=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${qv(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const i=this.loadedName+"_path_"+t;let s;try{s=e.get(i)}catch(o){W(`getPathGenerator - ignoring character: "${o}".`)}const r=new Path2D(s||"");return this.fontExtraProperties||e.delete(i),this.compiledGlyphs[t]=r}}const rr={DATA:1,ERROR:2},Se={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function jc(){}function je(n){if(n instanceof Cn||n instanceof rl||n instanceof bs||n instanceof Jc||n instanceof Kr||n instanceof sa)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||se('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new Cn(n.message);case"InvalidPDFException":return new rl(n.message);case"MissingPDFException":return new bs(n.message);case"PasswordException":return new Jc(n.message,n.code);case"UnexpectedResponseException":return new Kr(n.message,n.status);case"UnknownErrorException":return new sa(n.message,n.details)}return new sa(n.message,n.toString())}class ts{#e=new AbortController;constructor(e,t,i){this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#i(e);return}if(e.callback){const i=e.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],e.callback===rr.DATA)s.resolve(e.data);else if(e.callback===rr.ERROR)s.reject(je(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const i=this.sourceName,s=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:i,targetName:s,callback:rr.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:i,targetName:s,callback:rr.ERROR,callbackId:e.callbackId,reason:je(o)})});return}if(e.streamId){this.#n(e);return}t(e.data)}on(e,t){const i=this.actionHandler;if(i[e])throw new Error(`There is already an actionName called "${e}"`);i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){const s=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[s]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},i)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,i,s){const r=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:u=>{const d=Promise.withResolvers();return this.streamControllers[r]={controller:u,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:e,streamId:r,data:t,desiredSize:u.desiredSize},s),d.promise},pull:u=>{const d=Promise.withResolvers();return this.streamControllers[r].pullCall=d,l.postMessage({sourceName:o,targetName:a,stream:Se.PULL,streamId:r,desiredSize:u.desiredSize}),d.promise},cancel:u=>{Ce(u instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[r].cancelCall=d,this.streamControllers[r].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:Se.CANCEL,streamId:r,reason:je(u)}),d.promise}},i)}#n(e){const t=e.streamId,i=this.sourceName,s=e.sourceName,r=this.comObj,o=this,a=this.actionHandler[e.action],l={enqueue(u,d=1,f){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=d,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:i,targetName:s,stream:Se.ENQUEUE,streamId:t,chunk:u},f)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:i,targetName:s,stream:Se.CLOSE,streamId:t}),delete o.streamSinks[t])},error(u){Ce(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:i,targetName:s,stream:Se.ERROR,streamId:t,reason:je(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){r.postMessage({sourceName:i,targetName:s,stream:Se.START_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:i,targetName:s,stream:Se.START_COMPLETE,streamId:t,reason:je(u)})})}#i(e){const t=e.streamId,i=this.sourceName,s=e.sourceName,r=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Se.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(je(e.reason));break;case Se.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(je(e.reason));break;case Se.PULL:if(!a){r.postMessage({sourceName:i,targetName:s,stream:Se.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||jc).then(function(){r.postMessage({sourceName:i,targetName:s,stream:Se.PULL_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:i,targetName:s,stream:Se.PULL_COMPLETE,streamId:t,reason:je(u)})});break;case Se.ENQUEUE:if(Ce(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case Se.CLOSE:if(Ce(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),this.#r(o,t);break;case Se.ERROR:Ce(o,"error should have stream controller"),o.controller.error(je(e.reason)),this.#r(o,t);break;case Se.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(je(e.reason)),this.#r(o,t);break;case Se.CANCEL:if(!a)break;const l=je(e.reason);Promise.try(a.onCancel||jc,l).then(function(){r.postMessage({sourceName:i,targetName:s,stream:Se.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:i,targetName:s,stream:Se.CANCEL_COMPLETE,streamId:t,reason:je(u)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#r(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class ig{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){se("Abstract method `_createCanvas` called.")}}class t0 extends ig{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const i=this._document.createElement("canvas");return i.width=e,i.height=t,i}}class sg{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){se("Abstract method `_fetch` called.")}}class rg extends sg{async _fetch(e){const t=await So(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Ao(t)}}class og{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,i,s,r){return"none"}destroy(e=!1){}}class n0 extends og{#e;#t;#n;#i;#r;#s;#l=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#i=e,this.#r=t}get#a(){return this.#t||=new Map}get#c(){return this.#s||=new Map}get#u(){if(!this.#n){const e=this.#r.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const i=this.#r.createElementNS(zt,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#n=this.#r.createElementNS(zt,"defs"),e.append(i),i.append(this.#n),this.#r.body.append(e)}return this.#n}#h(e){if(e.length===1){const l=e[0],u=new Array(256);for(let f=0;f<256;f++)u[f]=l[f]/255;const d=u.join(",");return[d,d,d]}const[t,i,s]=e,r=new Array(256),o=new Array(256),a=new Array(256);for(let l=0;l<256;l++)r[l]=t[l]/255,o[l]=i[l]/255,a[l]=s[l]/255;return[r.join(","),o.join(","),a.join(",")]}#d(e){if(this.#e===void 0){this.#e="";const t=this.#r.URL;t!==this.#r.baseURI&&(Eo(t)?W('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=t.split("#",1)[0])}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#a.get(e);if(t)return t;const[i,s,r]=this.#h(e),o=e.length===1?i:`${i}${s}${r}`;if(t=this.#a.get(o),t)return this.#a.set(e,t),t;const a=`g_${this.#i}_transfer_map_${this.#l++}`,l=this.#d(a);this.#a.set(e,l),this.#a.set(o,l);const u=this.#p(a);return this.#g(i,s,r,u),l}addHCMFilter(e,t){const i=`${e}-${t}`,s="base";let r=this.#c.get(s);if(r?.key===i||(r?(r.filter?.remove(),r.key=i,r.url="none",r.filter=null):(r={key:i,url:"none",filter:null},this.#c.set(s,r)),!e||!t))return r.url;const o=this.#A(e);e=H.makeHexColor(...o);const a=this.#A(t);if(t=H.makeHexColor(...a),this.#u.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return r.url;const l=new Array(256);for(let g=0;g<=255;g++){const m=g/255;l[g]=m<=.03928?m/12.92:((m+.055)/1.055)**2.4}const u=l.join(","),d=`g_${this.#i}_hcm_filter`,f=r.filter=this.#p(d);this.#g(u,u,u,f),this.#o(f);const p=(g,m)=>{const v=o[g]/255,S=a[g]/255,y=new Array(m+1);for(let _=0;_<=m;_++)y[_]=v+_/m*(S-v);return y.join(",")};return this.#g(p(0,5),p(1,5),p(2,5),f),r.url=this.#d(d),r.url}addAlphaFilter(e){let t=this.#a.get(e);if(t)return t;const[i]=this.#h([e]),s=`alpha_${i}`;if(t=this.#a.get(s),t)return this.#a.set(e,t),t;const r=`g_${this.#i}_alpha_map_${this.#l++}`,o=this.#d(r);this.#a.set(e,o),this.#a.set(s,o);const a=this.#p(r);return this.#y(i,a),o}addLuminosityFilter(e){let t=this.#a.get(e||"luminosity");if(t)return t;let i,s;if(e?([i]=this.#h([e]),s=`luminosity_${i}`):s="luminosity",t=this.#a.get(s),t)return this.#a.set(e,t),t;const r=`g_${this.#i}_luminosity_map_${this.#l++}`,o=this.#d(r);this.#a.set(e,o),this.#a.set(s,o);const a=this.#p(r);return this.#f(a),e&&this.#y(i,a),o}addHighlightHCMFilter(e,t,i,s,r){const o=`${t}-${i}-${s}-${r}`;let a=this.#c.get(e);if(a?.key===o||(a?(a.filter?.remove(),a.key=o,a.url="none",a.filter=null):(a={key:o,url:"none",filter:null},this.#c.set(e,a)),!t||!i))return a.url;const[l,u]=[t,i].map(this.#A.bind(this));let d=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[p,g]=[s,r].map(this.#A.bind(this));f<d&&([d,f,p,g]=[f,d,g,p]),this.#u.style.color="";const m=(y,_,A)=>{const E=new Array(256),w=(f-d)/A,C=y/255,T=(_-y)/(255*A);let I=0;for(let P=0;P<=A;P++){const R=Math.round(d+P*w),L=C+P*T;for(let V=I;V<=R;V++)E[V]=L;I=R+1}for(let P=I;P<256;P++)E[P]=E[I-1];return E.join(",")},v=`g_${this.#i}_hcm_${e}_filter`,S=a.filter=this.#p(v);return this.#o(S),this.#g(m(p[0],g[0],5),m(p[1],g[1],5),m(p[2],g[2],5),S),a.url=this.#d(v),a.url}destroy(e=!1){e&&this.#s?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#t?.clear(),this.#t=null,this.#s?.clear(),this.#s=null,this.#l=0)}#f(e){const t=this.#r.createElementNS(zt,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#o(e){const t=this.#r.createElementNS(zt,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#p(e){const t=this.#r.createElementNS(zt,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#u.append(t),t}#m(e,t,i){const s=this.#r.createElementNS(zt,t);s.setAttribute("type","discrete"),s.setAttribute("tableValues",i),e.append(s)}#g(e,t,i,s){const r=this.#r.createElementNS(zt,"feComponentTransfer");s.append(r),this.#m(r,"feFuncR",e),this.#m(r,"feFuncG",t),this.#m(r,"feFuncB",i)}#y(e,t){const i=this.#r.createElementNS(zt,"feComponentTransfer");t.append(i),this.#m(i,"feFuncA",e)}#A(e){return this.#u.style.color=e,_u(getComputedStyle(this.#u).getPropertyValue("color"))}}class ag{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(i=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){se("Abstract method `_fetch` called.")}}class lg extends ag{async _fetch(e){const t=await So(e,"arraybuffer");return new Uint8Array(t)}}Ge&&W("Please use the `legacy` build in Node.js environments.");async function ug(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class i0 extends og{}class s0 extends ig{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class r0 extends sg{async _fetch(e){return ug(e)}}class o0 extends ag{async _fetch(e){return ug(e)}}const Ve={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function ll(n,e){if(!e)return;const t=e[2]-e[0],i=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,i),n.clip(s)}class wu{getPattern(){se("Abstract method `getPattern` called.")}}class a0 extends wu{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,s){let r;if(s===Ve.STROKE||s===Ve.FILL){const o=t.current.getClippedPathBoundingBox(s,ce(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,u=t.cachedCanvases.getCanvas("pattern",a,l),d=u.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-o[0],-o[1]),i=H.transform(i,[1,0,0,1,o[0],o[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),ll(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),r=e.createPattern(u.canvas,"no-repeat");const f=new DOMMatrix(i);r.setTransform(f)}else ll(e,this._bbox),r=this._createGradient(e);return r}}function aa(n,e,t,i,s,r,o,a){const l=e.coords,u=e.colors,d=n.data,f=n.width*4;let p;l[t+1]>l[i+1]&&(p=t,t=i,i=p,p=r,r=o,o=p),l[i+1]>l[s+1]&&(p=i,i=s,s=p,p=o,o=a,a=p),l[t+1]>l[i+1]&&(p=t,t=i,i=p,p=r,r=o,o=p);const g=(l[t]+e.offsetX)*e.scaleX,m=(l[t+1]+e.offsetY)*e.scaleY,v=(l[i]+e.offsetX)*e.scaleX,S=(l[i+1]+e.offsetY)*e.scaleY,y=(l[s]+e.offsetX)*e.scaleX,_=(l[s+1]+e.offsetY)*e.scaleY;if(m>=_)return;const A=u[r],E=u[r+1],w=u[r+2],C=u[o],T=u[o+1],I=u[o+2],P=u[a],R=u[a+1],L=u[a+2],V=Math.round(m),J=Math.round(_);let ee,Ae,k,U,b,O,z,Z;for(let X=V;X<=J;X++){if(X<S){const ne=X<m?0:(m-X)/(m-S);ee=g-(g-v)*ne,Ae=A-(A-C)*ne,k=E-(E-T)*ne,U=w-(w-I)*ne}else{let ne;X>_?ne=1:S===_?ne=0:ne=(S-X)/(S-_),ee=v-(v-y)*ne,Ae=C-(C-P)*ne,k=T-(T-R)*ne,U=I-(I-L)*ne}let ue;X<m?ue=0:X>_?ue=1:ue=(m-X)/(m-_),b=g-(g-y)*ue,O=A-(A-P)*ue,z=E-(E-R)*ue,Z=w-(w-L)*ue;const Qe=Math.round(Math.min(ee,b)),Bt=Math.round(Math.max(ee,b));let ge=f*X+Qe*4;for(let ne=Qe;ne<=Bt;ne++)ue=(ee-ne)/(ee-b),ue<0?ue=0:ue>1&&(ue=1),d[ge++]=Ae-(Ae-O)*ue|0,d[ge++]=k-(k-z)*ue|0,d[ge++]=U-(U-Z)*ue|0,d[ge++]=255}}function l0(n,e,t){const i=e.coords,s=e.colors;let r,o;switch(e.type){case"lattice":const a=e.verticesPerRow,l=Math.floor(i.length/a)-1,u=a-1;for(r=0;r<l;r++){let d=r*a;for(let f=0;f<u;f++,d++)aa(n,t,i[d],i[d+1],i[d+a],s[d],s[d+1],s[d+a]),aa(n,t,i[d+a+1],i[d+1],i[d+a],s[d+a+1],s[d+1],s[d+a])}break;case"triangles":for(r=0,o=i.length;r<o;r+=3)aa(n,t,i[r],i[r+1],i[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}class u0 extends wu{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,i){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,f=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),g=u/f,m=d/p,v={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/g,scaleY:1/m},S=f+2*2,y=p+2*2,_=i.getCanvas("mesh",S,y),A=_.context,E=A.createImageData(f,p);if(t){const C=E.data;for(let T=0,I=C.length;T<I;T+=4)C[T]=t[0],C[T+1]=t[1],C[T+2]=t[2],C[T+3]=255}for(const C of this._figures)l0(E,C,v);return A.putImageData(E,2,2),{canvas:_.canvas,offsetX:a-2*g,offsetY:l-2*m,scaleX:g,scaleY:m}}getPattern(e,t,i,s){ll(e,this._bbox);let r;if(s===Ve.SHADING)r=H.singularValueDecompose2dScale(ce(e));else if(r=H.singularValueDecompose2dScale(t.baseTransform),this.matrix){const a=H.singularValueDecompose2dScale(this.matrix);r=[r[0]*a[0],r[1]*a[1]]}const o=this._createMeshCanvas(r,s===Ve.SHADING?null:this._background,t.cachedCanvases);return s!==Ve.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class c0 extends wu{getPattern(){return"hotpink"}}function d0(n){switch(n[0]){case"RadialAxial":return new a0(n);case"Mesh":return new u0(n);case"Dummy":return new c0}throw new Error(`Unknown IR type: ${n[0]}`)}const ed={COLORED:1,UNCOLORED:2};class Cu{static MAX_PATTERN_SIZE=3e3;constructor(e,t,i,s,r){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=i,this.canvasGraphicsFactory=s,this.baseTransform=r}createPatternCanvas(e){const{bbox:t,operatorList:i,paintType:s,tilingType:r,color:o,canvasGraphicsFactory:a}=this;let{xstep:l,ystep:u}=this;l=Math.abs(l),u=Math.abs(u),_o("TilingType: "+r);const d=t[0],f=t[1],p=t[2],g=t[3],m=p-d,v=g-f,S=H.singularValueDecompose2dScale(this.matrix),y=H.singularValueDecompose2dScale(this.baseTransform),_=S[0]*y[0],A=S[1]*y[1];let E=m,w=v,C=!1,T=!1;const I=Math.ceil(l*_),P=Math.ceil(u*A),R=Math.ceil(m*_),L=Math.ceil(v*A);I>=R?E=l:C=!0,P>=L?w=u:T=!0;const V=this.getSizeAndScale(E,this.ctx.canvas.width,_),J=this.getSizeAndScale(w,this.ctx.canvas.height,A),ee=e.cachedCanvases.getCanvas("pattern",V.size,J.size),Ae=ee.context,k=a.createCanvasGraphics(Ae);if(k.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(k,s,o),Ae.translate(-V.scale*d,-J.scale*f),k.transform(V.scale,0,0,J.scale,0,0),Ae.save(),this.clipBbox(k,d,f,p,g),k.baseTransform=ce(k.ctx),k.executeOperatorList(i),k.endDrawing(),Ae.restore(),C||T){const U=ee.canvas;C&&(E=l),T&&(w=u);const b=this.getSizeAndScale(E,this.ctx.canvas.width,_),O=this.getSizeAndScale(w,this.ctx.canvas.height,A),z=b.size,Z=O.size,X=e.cachedCanvases.getCanvas("pattern-workaround",z,Z),ue=X.context,Qe=C?Math.floor(m/l):0,Bt=T?Math.floor(v/u):0;for(let ge=0;ge<=Qe;ge++)for(let ne=0;ne<=Bt;ne++)ue.drawImage(U,z*ge,Z*ne,z,Z,0,0,z,Z);return{canvas:X.canvas,scaleX:b.scale,scaleY:O.scale,offsetX:d,offsetY:f}}return{canvas:ee.canvas,scaleX:V.scale,scaleY:J.scale,offsetX:d,offsetY:f}}getSizeAndScale(e,t,i){const s=Math.max(Cu.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*i);return r>=s?r=s:i=r/e,{scale:i,size:r}}clipBbox(e,t,i,s,r){const o=s-t,a=r-i;e.ctx.rect(t,i,o,a),e.current.updateRectMinMax(ce(e.ctx),[t,i,s,r]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,i){const s=e.ctx,r=e.current;switch(t){case ed.COLORED:const o=this.ctx;s.fillStyle=o.fillStyle,s.strokeStyle=o.strokeStyle,r.fillColor=o.fillStyle,r.strokeColor=o.strokeStyle;break;case ed.UNCOLORED:const a=H.makeHexColor(i[0],i[1],i[2]);s.fillStyle=a,s.strokeStyle=a,r.fillColor=a,r.strokeColor=a;break;default:throw new Uv(`Unsupported paint type: ${t}`)}}getPattern(e,t,i,s){let r=i;s!==Ve.SHADING&&(r=H.transform(r,t.baseTransform),this.matrix&&(r=H.transform(r,this.matrix)));const o=this.createPatternCanvas(t);let a=new DOMMatrix(r);a=a.translate(o.offsetX,o.offsetY),a=a.scale(1/o.scaleX,1/o.scaleY);const l=e.createPattern(o.canvas,"repeat");return l.setTransform(a),l}}function h0({src:n,srcPos:e=0,dest:t,width:i,height:s,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const a=Ke.isLittleEndian?4278190080:255,[l,u]=o?[r,a]:[a,r],d=i>>3,f=i&7,p=n.length;t=new Uint32Array(t.buffer);let g=0;for(let m=0;m<s;m++){for(const S=e+d;e<S;e++){const y=e<p?n[e]:255;t[g++]=y&128?u:l,t[g++]=y&64?u:l,t[g++]=y&32?u:l,t[g++]=y&16?u:l,t[g++]=y&8?u:l,t[g++]=y&4?u:l,t[g++]=y&2?u:l,t[g++]=y&1?u:l}if(f===0)continue;const v=e<p?n[e++]:255;for(let S=0;S<f;S++)t[g++]=v&1<<7-S?u:l}return{srcPos:e,destPos:g}}const td=16,nd=100,f0=15,id=10,sd=1e3,et=16;function p0(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(i,s){e.translate(i,s),this.__originalTranslate(i,s)},n.scale=function(i,s){e.scale(i,s),this.__originalScale(i,s)},n.transform=function(i,s,r,o,a,l){e.transform(i,s,r,o,a,l),this.__originalTransform(i,s,r,o,a,l)},n.setTransform=function(i,s,r,o,a,l){e.setTransform(i,s,r,o,a,l),this.__originalSetTransform(i,s,r,o,a,l)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(i){e.rotate(i),this.__originalRotate(i)},n.clip=function(i){e.clip(i),this.__originalClip(i)},n.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},n.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},n.bezierCurveTo=function(t,i,s,r,o,a){e.bezierCurveTo(t,i,s,r,o,a),this.__originalBezierCurveTo(t,i,s,r,o,a)},n.rect=function(t,i,s,r){e.rect(t,i,s,r),this.__originalRect(t,i,s,r)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class g0{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,i)):(s=this.canvasFactory.create(t,i),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function or(n,e,t,i,s,r,o,a,l,u){const[d,f,p,g,m,v]=ce(n);if(f===0&&p===0){const _=o*d+m,A=Math.round(_),E=a*g+v,w=Math.round(E),C=(o+l)*d+m,T=Math.abs(Math.round(C)-A)||1,I=(a+u)*g+v,P=Math.abs(Math.round(I)-w)||1;return n.setTransform(Math.sign(d),0,0,Math.sign(g),A,w),n.drawImage(e,t,i,s,r,0,0,T,P),n.setTransform(d,f,p,g,m,v),[T,P]}if(d===0&&g===0){const _=a*p+m,A=Math.round(_),E=o*f+v,w=Math.round(E),C=(a+u)*p+m,T=Math.abs(Math.round(C)-A)||1,I=(o+l)*f+v,P=Math.abs(Math.round(I)-w)||1;return n.setTransform(0,Math.sign(f),Math.sign(p),0,A,w),n.drawImage(e,t,i,s,r,0,0,P,T),n.setTransform(d,f,p,g,m,v),[P,T]}n.drawImage(e,t,i,s,r,o,a,l,u);const S=Math.hypot(d,f),y=Math.hypot(p,g);return[S*l,y*u]}function m0(n){const{width:e,height:t}=n;if(e>sd||t>sd)return null;const i=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=e+1;let o=new Uint8Array(r*(t+1)),a,l,u;const d=e+7&-8;let f=new Uint8Array(d*t),p=0;for(const y of n.data){let _=128;for(;_>0;)f[p++]=y&_?0:255,_>>=1}let g=0;for(p=0,f[p]!==0&&(o[0]=1,++g),l=1;l<e;l++)f[p]!==f[p+1]&&(o[l]=f[p]?2:1,++g),p++;for(f[p]!==0&&(o[l]=2,++g),a=1;a<t;a++){p=a*d,u=a*r,f[p-d]!==f[p]&&(o[u]=f[p]?1:8,++g);let y=(f[p]?4:0)+(f[p-d]?8:0);for(l=1;l<e;l++)y=(y>>2)+(f[p+1]?4:0)+(f[p-d+1]?8:0),s[y]&&(o[u+l]=s[y],++g),p++;if(f[p-d]!==f[p]&&(o[u+l]=f[p]?2:4,++g),g>i)return null}for(p=d*(t-1),u=a*r,f[p]!==0&&(o[u]=8,++g),l=1;l<e;l++)f[p]!==f[p+1]&&(o[u+l]=f[p]?4:8,++g),p++;if(f[p]!==0&&(o[u+l]=4,++g),g>i)return null;const m=new Int32Array([0,r,-1,0,-r,0,0,0,1]),v=new Path2D;for(a=0;g&&a<=t;a++){let y=a*r;const _=y+e;for(;y<_&&!o[y];)y++;if(y===_)continue;v.moveTo(y%r,a);const A=y;let E=o[y];do{const w=m[E];do y+=w;while(!o[y]);const C=o[y];C!==5&&C!==10?(E=C,o[y]=0):(E=C&51*E>>4,o[y]&=E>>2|E<<2),v.lineTo(y%r,y/r|0),o[y]||--g}while(A!==y);--a}return f=null,o=null,function(y){y.save(),y.scale(1/e,-1/t),y.translate(0,-t),y.fill(v),y.beginPath(),y.restore()}}class rd{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Zp,this.textMatrixScale=1,this.fontMatrix=sl,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=He.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,i){[t,i]=H.applyTransform([t,i],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(e,t){const i=H.applyTransform(t,e),s=H.applyTransform(t.slice(2),e),r=H.applyTransform([t[0],t[3]],e),o=H.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,i[0],s[0],r[0],o[0]),this.minY=Math.min(this.minY,i[1],s[1],r[1],o[1]),this.maxX=Math.max(this.maxX,i[0],s[0],r[0],o[0]),this.maxY=Math.max(this.maxY,i[1],s[1],r[1],o[1])}updateScalingPathMinMax(e,t){H.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,i,s,r,o,a,l,u,d){const f=H.bezierBoundingBox(t,i,s,r,o,a,l,u,d);d||this.updateRectMinMax(e,f)}getPathBoundingBox(e=Ve.FILL,t=null){const i=[this.minX,this.minY,this.maxX,this.maxY];if(e===Ve.STROKE){t||se("Stroke bounding box must include transform.");const s=H.singularValueDecompose2dScale(t),r=s[0]*this.lineWidth/2,o=s[1]*this.lineWidth/2;i[0]-=r,i[1]-=o,i[2]+=r,i[3]+=o}return i}updateClipFromPath(){const e=H.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=Ve.FILL,t=null){return H.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function od(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,i=e.width,s=t%et,r=(t-s)/et,o=s===0?r:r+1,a=n.createImageData(i,et);let l=0,u;const d=e.data,f=a.data;let p,g,m,v;if(e.kind===Sr.GRAYSCALE_1BPP){const S=d.byteLength,y=new Uint32Array(f.buffer,0,f.byteLength>>2),_=y.length,A=i+7>>3,E=4294967295,w=Ke.isLittleEndian?4278190080:255;for(p=0;p<o;p++){for(m=p<r?et:s,u=0,g=0;g<m;g++){const C=S-l;let T=0;const I=C>A?i:C*8-7,P=I&-8;let R=0,L=0;for(;T<P;T+=8)L=d[l++],y[u++]=L&128?E:w,y[u++]=L&64?E:w,y[u++]=L&32?E:w,y[u++]=L&16?E:w,y[u++]=L&8?E:w,y[u++]=L&4?E:w,y[u++]=L&2?E:w,y[u++]=L&1?E:w;for(;T<I;T++)R===0&&(L=d[l++],R=128),y[u++]=L&R?E:w,R>>=1}for(;u<_;)y[u++]=0;n.putImageData(a,0,p*et)}}else if(e.kind===Sr.RGBA_32BPP){for(g=0,v=i*et*4,p=0;p<r;p++)f.set(d.subarray(l,l+v)),l+=v,n.putImageData(a,0,g),g+=et;p<o&&(v=i*s*4,f.set(d.subarray(l,l+v)),n.putImageData(a,0,g))}else if(e.kind===Sr.RGB_24BPP)for(m=et,v=i*m,p=0;p<o;p++){for(p>=r&&(m=s,v=i*m),u=0,g=v;g--;)f[u++]=d[l++],f[u++]=d[l++],f[u++]=d[l++],f[u++]=255;n.putImageData(a,0,p*et)}else throw new Error(`bad image kind: ${e.kind}`)}function ad(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,i=e.width,s=t%et,r=(t-s)/et,o=s===0?r:r+1,a=n.createImageData(i,et);let l=0;const u=e.data,d=a.data;for(let f=0;f<o;f++){const p=f<r?et:s;({srcPos:l}=h0({src:u,srcPos:l,dest:d,width:i,height:p,nonBlackColor:0})),n.putImageData(a,0,f*et)}}function Wi(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of t)n[i]!==void 0&&(e[i]=n[i]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function ar(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!Ge){const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}}function ld(n,e){if(e)return!0;const t=H.singularValueDecompose2dScale(n);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const i=Math.fround((globalThis.devicePixelRatio||1)*Mi.PDF_TO_CSS_UNITS);return t[0]<=i&&t[1]<=i}const y0=["butt","round","square"],v0=["miter","round","bevel"],_0={},ud={};class _i{constructor(e,t,i,s,r,{optionalContentConfig:o,markedContentStack:a=null},l,u){this.ctx=e,this.current=new rd(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=s,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new g0(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:i=!1,background:s=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,i){const l=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...ce(this.compositeCtx))}this.ctx.save(),ar(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=ce(this.ctx)}executeOperatorList(e,t,i,s){const r=e.argsArray,o=e.fnArray;let a=t||0;const l=r.length;if(l===a)return a;const u=l-a>id&&typeof i=="function",d=u?Date.now()+f0:0;let f=0;const p=this.commonObjs,g=this.objs;let m;for(;;){if(s!==void 0&&a===s.nextBreakPoint)return s.breakIt(a,i),a;if(m=o[a],m!==xt.dependency)this[m].apply(this,r[a]);else for(const v of r[a]){const S=v.startsWith("g_")?p:g;if(!S.has(v))return S.get(v,i),a}if(a++,a===l)return a;if(u&&++f>id){if(Date.now()>d)return i(),a;f=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const i=e.width??e.displayWidth,s=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=i,l=s,u="prescale1",d,f;for(;r>2&&a>1||o>2&&l>1;){let p=a,g=l;r>2&&a>1&&(p=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),r/=a/p),o>2&&l>1&&(g=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/g),d=this.cachedCanvases.getCanvas(u,p,g),f=d.context,f.clearRect(0,0,p,g),f.drawImage(e,0,0,a,l,0,0,p,g),e=d.canvas,a=p,l=g,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:i,height:s}=e,r=this.current.fillColor,o=this.current.patternFill,a=ce(t);let l,u,d,f;if((e.bitmap||e.data)&&e.count>1){const I=e.bitmap||e.data.buffer;u=JSON.stringify(o?a:[a.slice(0,4),r]),l=this._cachedBitmapsMap.get(I),l||(l=new Map,this._cachedBitmapsMap.set(I,l));const P=l.get(u);if(P&&!o){const R=Math.round(Math.min(a[0],a[2])+a[4]),L=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:P,offsetX:R,offsetY:L}}d=P}d||(f=this.cachedCanvases.getCanvas("maskCanvas",i,s),ad(f.context,e));let p=H.transform(a,[1/i,0,0,-1/s,0,0]);p=H.transform(p,[1,0,0,1,0,-s]);const[g,m,v,S]=H.getAxialAlignedBoundingBox([0,0,i,s],p),y=Math.round(v-g)||1,_=Math.round(S-m)||1,A=this.cachedCanvases.getCanvas("fillCanvas",y,_),E=A.context,w=g,C=m;E.translate(-w,-C),E.transform(...p),d||(d=this._scaleImage(f.canvas,Dt(E)),d=d.img,l&&o&&l.set(u,d)),E.imageSmoothingEnabled=ld(ce(E),e.interpolate),or(E,d,0,0,d.width,d.height,0,0,i,s),E.globalCompositeOperation="source-in";const T=H.transform(Dt(E),[1,0,0,1,-w,-C]);return E.fillStyle=o?r.getPattern(t,this,T,Ve.FILL):r,E.fillRect(0,0,i,s),l&&!o&&(this.cachedCanvases.delete("fillCanvas"),l.set(u,A.canvas)),{canvas:A.canvas,offsetX:Math.round(w),offsetY:Math.round(C)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=y0[e]}setLineJoin(e){this.ctx.lineJoin=v0[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,i]of e)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;const r=this.ctx;r.setTransform(...ce(this.suspendedCtx)),Wi(this.suspendedCtx,r),p0(r,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Wi(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,i,s){const r=s[0],o=s[1],a=s[2]-r,l=s[3]-o;a===0||l===0||(this.genericComposeSMask(t.context,i,a,l,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}genericComposeSMask(e,t,i,s,r,o,a,l,u,d,f){let p=e.canvas,g=l-d,m=u-f;if(o){const S=H.makeHexColor(...o);if(g<0||m<0||g+i>p.width||m+s>p.height){const y=this.cachedCanvases.getCanvas("maskExtension",i,s),_=y.context;_.drawImage(p,-g,-m),_.globalCompositeOperation="destination-atop",_.fillStyle=S,_.fillRect(0,0,i,s),_.globalCompositeOperation="source-over",p=y.canvas,g=m=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const y=new Path2D;y.rect(g,m,i,s),e.clip(y),e.globalCompositeOperation="destination-atop",e.fillStyle=S,e.fillRect(g,m,i,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));const v=new Path2D;v.rect(l,u,i,s),t.clip(v),t.globalCompositeOperation="destination-in",t.drawImage(p,g,m,i,s,l,u,i,s),t.restore()}save(){this.inSMaskMode?(Wi(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Wi(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,i,s,r,o){this.ctx.transform(e,t,i,s,r,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i){const s=this.ctx,r=this.current;let o=r.x,a=r.y,l,u;const d=ce(s),f=d[0]===0&&d[3]===0||d[1]===0&&d[2]===0,p=f?i.slice(0):null;for(let g=0,m=0,v=e.length;g<v;g++)switch(e[g]|0){case xt.rectangle:o=t[m++],a=t[m++];const S=t[m++],y=t[m++],_=o+S,A=a+y;s.moveTo(o,a),S===0||y===0?s.lineTo(_,A):(s.lineTo(_,a),s.lineTo(_,A),s.lineTo(o,A)),f||r.updateRectMinMax(d,[o,a,_,A]),s.closePath();break;case xt.moveTo:o=t[m++],a=t[m++],s.moveTo(o,a),f||r.updatePathMinMax(d,o,a);break;case xt.lineTo:o=t[m++],a=t[m++],s.lineTo(o,a),f||r.updatePathMinMax(d,o,a);break;case xt.curveTo:l=o,u=a,o=t[m+4],a=t[m+5],s.bezierCurveTo(t[m],t[m+1],t[m+2],t[m+3],o,a),r.updateCurvePathMinMax(d,l,u,t[m],t[m+1],t[m+2],t[m+3],o,a,p),m+=6;break;case xt.curveTo2:l=o,u=a,s.bezierCurveTo(o,a,t[m],t[m+1],t[m+2],t[m+3]),r.updateCurvePathMinMax(d,l,u,o,a,t[m],t[m+1],t[m+2],t[m+3],p),o=t[m+2],a=t[m+3],m+=4;break;case xt.curveTo3:l=o,u=a,o=t[m+2],a=t[m+3],s.bezierCurveTo(t[m],t[m+1],o,a,o,a),r.updateCurvePathMinMax(d,l,u,t[m],t[m+1],o,a,o,a,p),m+=4;break;case xt.closePath:s.closePath();break}f&&r.updateScalingPathMinMax(d,p),r.setCurrentPoint(o,a)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,i=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&i?.getPattern?(t.save(),t.strokeStyle=i.getPattern(t,this,Dt(t),Ve.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,i=this.current.fillColor,s=this.current.patternFill;let r=!1;s&&(t.save(),t.fillStyle=i.getPattern(t,this,Dt(t),Ve.FILL),r=!0);const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(o)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=_0}eoClip(){this.pendingClip=ud}beginText(){this.current.textMatrix=Zp,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const i=new Path2D,s=t.getTransform().invertSelf();for(const{transform:r,x:o,y:a,fontSize:l,path:u}of e)i.addPath(u,new DOMMatrix(r).preMultiplySelf(s).translate(o,a).scale(l,-l));t.clip(i),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){const i=this.commonObjs.get(e),s=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=i.fontMatrix||sl,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&W("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;const r=i.loadedName||"sans-serif",o=i.systemFontInfo?.css||`"${r}", ${i.fallbackName}`;let a="normal";i.black?a="900":i.bold&&(a="bold");const l=i.italic?"italic":"normal";let u=t;t<td?u=td:t>nd&&(u=nd),this.current.fontSizeScale=t/u,this.ctx.font=`${l} ${a} ${u}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,i,s,r,o){this.current.textMatrix=[e,t,i,s,r,o],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#n(e,t,i){const s=new Path2D;return s.addPath(e,new DOMMatrix(i).invertSelf().multiplySelf(t)),s}paintChar(e,t,i,s,r){const o=this.ctx,a=this.current,l=a.font,u=a.textRenderingMode,d=a.fontSize/a.fontSizeScale,f=u&He.FILL_STROKE_MASK,p=!!(u&He.ADD_TO_PATH_FLAG),g=a.patternFill&&!l.missingFile,m=a.patternStroke&&!l.missingFile;let v;if((l.disableFontFace||p||g||m)&&(v=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||g||m){if(o.save(),o.translate(t,i),o.scale(d,-d),f===He.FILL||f===He.FILL_STROKE)if(s){const S=o.getTransform();o.setTransform(...s),o.fill(this.#n(v,S,s))}else o.fill(v);if(f===He.STROKE||f===He.FILL_STROKE)if(r){const S=o.getTransform();o.setTransform(...r),o.stroke(this.#n(v,S,r))}else o.lineWidth/=d,o.stroke(v);o.restore()}else(f===He.FILL||f===He.FILL_STROKE)&&o.fillText(e,t,i),(f===He.STROKE||f===He.FILL_STROKE)&&o.strokeText(e,t,i);p&&(this.pendingTextPaths||=[]).push({transform:ce(o),x:t,y:i,fontSize:d,path:v})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let i=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){i=!0;break}return Y(this,"isFontSubpixelAAEnabled",i)}showText(e){const t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(e);const s=t.fontSize;if(s===0)return;const r=this.ctx,o=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,u=t.fontDirection,d=t.textHScale*u,f=e.length,p=i.vertical,g=p?1:-1,m=i.defaultVMetrics,v=s*t.fontMatrix[0],S=t.textRenderingMode===He.FILL&&!i.disableFontFace&&!t.patternFill;r.save(),r.transform(...t.textMatrix),r.translate(t.x,t.y+t.textRise),u>0?r.scale(d,-1):r.scale(d,1);let y,_;if(t.patternFill){r.save();const T=t.fillColor.getPattern(r,this,Dt(r),Ve.FILL);y=ce(r),r.restore(),r.fillStyle=T}if(t.patternStroke){r.save();const T=t.strokeColor.getPattern(r,this,Dt(r),Ve.STROKE);_=ce(r),r.restore(),r.strokeStyle=T}let A=t.lineWidth;const E=t.textMatrixScale;if(E===0||A===0){const T=t.textRenderingMode&He.FILL_STROKE_MASK;(T===He.STROKE||T===He.FILL_STROKE)&&(A=this.getSinglePixelWidth())}else A/=E;if(o!==1&&(r.scale(o,o),A/=o),r.lineWidth=A,i.isInvalidPDFjsFont){const T=[];let I=0;for(const P of e)T.push(P.unicode),I+=P.width;r.fillText(T.join(""),0,0),t.x+=I*v*d,r.restore(),this.compose();return}let w=0,C;for(C=0;C<f;++C){const T=e[C];if(typeof T=="number"){w+=g*T*s/1e3;continue}let I=!1;const P=(T.isSpace?l:0)+a,R=T.fontChar,L=T.accent;let V,J,ee=T.width;if(p){const k=T.vmetric||m,U=-(T.vmetric?k[1]:ee*.5)*v,b=k[2]*v;ee=k?-k[0]:ee,V=U/o,J=(w+b)/o}else V=w/o,J=0;if(i.remeasure&&ee>0){const k=r.measureText(R).width*1e3/s*o;if(ee<k&&this.isFontSubpixelAAEnabled){const U=ee/k;I=!0,r.save(),r.scale(U,1),V/=U}else ee!==k&&(V+=(ee-k)/2e3*s/o)}if(this.contentVisible&&(T.isInFont||i.missingFile)){if(S&&!L)r.fillText(R,V,J);else if(this.paintChar(R,V,J,y,_),L){const k=V+s*L.offset.x/o,U=J-s*L.offset.y/o;this.paintChar(L.fontChar,k,U,y,_)}}const Ae=p?ee*v-P*u:ee*v+P*u;w+=Ae,I&&r.restore()}p?t.y-=w:t.x+=w*d,r.restore(),this.compose()}showType3Text(e){const t=this.ctx,i=this.current,s=i.font,r=i.fontSize,o=i.fontDirection,a=s.vertical?1:-1,l=i.charSpacing,u=i.wordSpacing,d=i.textHScale*o,f=i.fontMatrix||sl,p=e.length,g=i.textRenderingMode===He.INVISIBLE;let m,v,S,y;if(!(g||r===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...i.textMatrix),t.translate(i.x,i.y),t.scale(d,o),m=0;m<p;++m){if(v=e[m],typeof v=="number"){y=a*v*r/1e3,this.ctx.translate(y,0),i.x+=y*d;continue}const _=(v.isSpace?u:0)+l,A=s.charProcOperatorList[v.operatorListId];if(!A){W(`Type3 character "${v.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=v,this.save(),t.scale(r,r),t.transform(...f),this.executeOperatorList(A),this.restore()),S=H.applyTransform([v.width,0],f)[0]*r+_,t.translate(S,0),i.x+=S*d}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,i,s,r,o){this.ctx.rect(i,s,r-i,o-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const i=e[1],s=this.baseTransform||ce(this.ctx),r={createCanvasGraphics:o=>new _i(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Cu(e,i,this.ctx,r,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,i){this.ctx.strokeStyle=this.current.strokeColor=H.makeHexColor(e,t,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,i){this.ctx.fillStyle=this.current.fillColor=H.makeHexColor(e,t,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=d0(this.getObject(e)),this.cachedPatterns.set(e,i)),t&&(i.matrix=t),i}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const i=this._getPattern(e);t.fillStyle=i.getPattern(t,this,Dt(t),Ve.SHADING);const s=Dt(t);if(s){const{width:r,height:o}=t.canvas,[a,l,u,d]=H.getAxialAlignedBoundingBox([0,0,r,o],s);this.ctx.fillRect(a,l,u-a,d-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){se("Should not call beginInlineImage")}beginImageData(){se("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=ce(this.ctx),t)){const i=t[2]-t[0],s=t[3]-t[1];this.ctx.rect(t[0],t[1],i,s),this.current.updateRectMinMax(ce(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||_o("TODO: Support non-isolated groups."),e.knockout&&W("Knockout groups not supported.");const i=ce(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=H.getAxialAlignedBoundingBox(e.bbox,ce(t));const r=[0,0,t.canvas.width,t.canvas.height];s=H.intersect(s,r)||[0,0,0,0];const o=Math.floor(s[0]),a=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-o,1),u=Math.max(Math.ceil(s[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,u]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(d,l,u),p=f.context;p.translate(-o,-a),p.transform(...i),e.smask?this.smaskStack.push({canvas:f.canvas,context:p,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.save()),Wi(t,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const s=ce(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);const r=H.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,i,s,r){if(this.#e(),ar(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const o=t[2]-t[0],a=t[3]-t[1];if(r&&this.annotationCanvasMap){i=i.slice(),i[4]-=t[0],i[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=a;const[l,u]=H.singularValueDecompose2dScale(ce(this.ctx)),{viewportScale:d}=this,f=Math.ceil(o*this.outputScaleX*d),p=Math.ceil(a*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(f,p);const{canvas:g,context:m}=this.annotationCanvas;this.annotationCanvasMap.set(e,g),this.annotationCanvas.savedCtx=this.ctx,this.ctx=m,this.ctx.save(),this.ctx.setTransform(l,0,0,-u,0,a*u),ar(this.ctx)}else ar(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],o,a),this.ctx.clip(),this.ctx.beginPath()}this.current=new rd(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const i=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=m0(e)),s.compiled)){s.compiled(i);return}const r=this._createMaskCanvas(e),o=r.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(o,r.offsetX,r.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,i=0,s=0,r,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);const a=this.ctx;a.save();const l=ce(a);a.transform(t,i,s,r,0,0);const u=this._createMaskCanvas(e);a.setTransform(1,0,0,1,u.offsetX-l[4],u.offsetY-l[5]);for(let d=0,f=o.length;d<f;d+=2){const p=H.transform(l,[t,i,s,r,o[d],o[d+1]]),[g,m]=H.applyTransform([0,0],p);a.drawImage(u.canvas,g,m)}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(const r of e){const{data:o,width:a,height:l,transform:u}=r,d=this.cachedCanvases.getCanvas("maskCanvas",a,l),f=d.context;f.save();const p=this.getObject(o,r);ad(f,p),f.globalCompositeOperation="source-in",f.fillStyle=s?i.getPattern(f,this,Dt(t),Ve.FILL):i,f.fillRect(0,0,a,l),f.restore(),t.save(),t.transform(...u),t.scale(1,-1),or(t,d.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){W("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,i,s){if(!this.contentVisible)return;const r=this.getObject(e);if(!r){W("Dependent image isn't ready yet");return}const o=r.width,a=r.height,l=[];for(let u=0,d=s.length;u<d;u+=2)l.push({transform:[t,0,0,i,s[u],s[u+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(r,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:i,height:s}=e,r=this.cachedCanvases.getCanvas("inlineImage",i,s),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,i=e.height,s=this.ctx;if(this.save(),!Ge){const{filter:a}=s;a!=="none"&&a!==""&&(s.filter="none")}s.scale(1/t,-1/i);let r;if(e.bitmap)r=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)r=e;else{const l=this.cachedCanvases.getCanvas("inlineImage",t,i).context;od(l,e),r=this.applyTransferMapsToCanvas(l)}const o=this._scaleImage(r,Dt(s));s.imageSmoothingEnabled=ld(ce(s),e.interpolate),or(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-i,t,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const i=this.ctx;let s;if(e.bitmap)s=e.bitmap;else{const r=e.width,o=e.height,l=this.cachedCanvases.getCanvas("inlineImage",r,o).context;od(l,e),s=this.applyTransferMapsToCanvas(l)}for(const r of t)i.save(),i.transform(...r.transform),i.scale(1,-1),or(i,s,r.x,r.y,r.w,r.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const i=this.ctx;this.pendingClip&&(t||(this.pendingClip===ud?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=ce(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:i,c:s,d:r}=this.ctx.getTransform();let o,a;if(i===0&&s===0){const l=Math.abs(t),u=Math.abs(r);if(l===u)if(e===0)o=a=1/l;else{const d=l*e;o=a=d<1?1/d:1}else if(e===0)o=1/l,a=1/u;else{const d=l*e,f=u*e;o=d<1?1/d:1,a=f<1?1/f:1}}else{const l=Math.abs(t*r-i*s),u=Math.hypot(t,i),d=Math.hypot(s,r);if(e===0)o=d/l,a=u/l;else{const f=e*l;o=d>f?d/f:1,a=u>f?u/f:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:i}=this.current,[s,r]=this.getScaleForStroking();if(t.lineWidth=i||1,s===1&&r===1){t.stroke();return}const o=t.getLineDash();if(e&&t.save(),t.scale(s,r),o.length>0){const a=Math.max(s,r);t.setLineDash(o.map(l=>l/a)),t.lineDashOffset/=a}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const n in xt)_i.prototype[n]!==void 0&&(_i.prototype[xt[n]]=_i.prototype[n]);class fs{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class A0{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}getAll(){return gu(this.#e)}has(e){return this.#e.has(e)}}const Zn=Symbol("INTERNAL");class S0{#e=!1;#t=!1;#n=!1;#i=!0;constructor(e,{name:t,intent:i,usage:s,rbGroups:r}){this.#e=!!(e&at.DISPLAY),this.#t=!!(e&at.PRINT),this.name=t,this.intent=i,this.usage=s,this.rbGroups=r}get visible(){if(this.#n)return this.#i;if(!this.#i)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,i=!1){e!==Zn&&se("Internal method `_setVisible` called."),this.#n=i,this.#i=t}}class E0{#e=null;#t=new Map;#n=null;#i=null;constructor(e,t=at.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#i=e.order;for(const i of e.groups)this.#t.set(i.id,new S0(t,i));if(e.baseState==="OFF")for(const i of this.#t.values())i._setVisible(Zn,!1);for(const i of e.on)this.#t.get(i)._setVisible(Zn,!0);for(const i of e.off)this.#t.get(i)._setVisible(Zn,!1);this.#n=this.getHash()}}#r(e){const t=e.length;if(t<2)return!0;const i=e[0];for(let s=1;s<t;s++){const r=e[s];let o;if(Array.isArray(r))o=this.#r(r);else if(this.#t.has(r))o=this.#t.get(r).visible;else return W(`Optional content group not found: ${r}`),!0;switch(i){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return i==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return _o("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(W(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#r(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return W(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return W(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return W(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return W(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return W(`Unknown optional content policy ${e.policy}.`),!0}return W(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,i=!0){const s=this.#t.get(e);if(!s){W(`Optional content group not found: ${e}`);return}if(i&&t&&s.rbGroups.length)for(const r of s.rbGroups)for(const o of r)o!==e&&this.#t.get(o)?._setVisible(Zn,!1,!0);s._setVisible(Zn,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let i;for(const s of e){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}const r=this.#t.get(s);if(r)switch(i){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!r.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#t.size?this.#i?this.#i.slice():[...this.#t.keys()]:null}getGroups(){return this.#t.size>0?gu(this.#t):null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new tg;for(const[t,i]of this.#t)e.update(`${t}:${i.visible}`);return this.#e=e.hexdigest()}}class w0{constructor(e,{disableRange:t=!1,disableStream:i=!1}){Ce(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:r,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,r?.length>0){const l=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,u)=>{this._onReceiveData({begin:l,chunk:u})}),e.addProgressListener((l,u)=>{this._onProgress({loaded:l,total:u})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const s=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(i),!0)});Ce(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Ce(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new C0(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new T0(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class C0{constructor(e,t,i=!1,s=null){this._stream=e,this._done=i||!1,this._filename=vu(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class T0{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function x0(n){let e=!0,t=i("filename\\*","i").exec(n);if(t){t=t[1];let d=a(t);return d=unescape(d),d=l(d),d=u(d),r(d)}if(t=o(n),t){const d=u(t);return r(d)}if(t=i("filename","i").exec(n),t){t=t[1];let d=a(t);return d=u(d),r(d)}function i(d,f){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function s(d,f){if(d){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const p=new TextDecoder(d,{fatal:!0}),g=Ao(f);f=p.decode(g),e=!1}catch{}}return f}function r(d){return e&&/[\x80-\xff]/.test(d)&&(d=s("utf-8",d),e&&(d=s("iso-8859-1",d))),d}function o(d){const f=[];let p;const g=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=g.exec(d))!==null;){let[,v,S,y]=p;if(v=parseInt(v,10),v in f){if(v===0)break;continue}f[v]=[S,y]}const m=[];for(let v=0;v<f.length&&v in f;++v){let[S,y]=f[v];y=a(y),S&&(y=unescape(y),v===0&&(y=l(y))),m.push(y)}return m.join("")}function a(d){if(d.startsWith('"')){const f=d.slice(1).split('\\"');for(let p=0;p<f.length;++p){const g=f[p].indexOf('"');g!==-1&&(f[p]=f[p].slice(0,g),f.length=p+1),f[p]=f[p].replaceAll(/\\(.)/g,"$1")}d=f.join('"')}return d}function l(d){const f=d.indexOf("'");if(f===-1)return d;const p=d.slice(0,f),m=d.slice(f+1).replace(/^[^']*'/,"");return s(p,m)}function u(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,p,g,m){if(g==="q"||g==="Q")return m=m.replaceAll("_"," "),m=m.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,S){return String.fromCharCode(parseInt(S,16))}),s(p,m);try{m=atob(m)}catch{}return s(p,m)})}return""}function cg(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const i in e){const s=e[i];s!==void 0&&t.append(i,s)}return t}function Co(n){try{return new URL(n).origin}catch{}return null}function dg({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:i}){const s={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(n.get("Content-Length"),10);return!Number.isInteger(r)||(s.suggestedLength=r,r<=2*t)||i||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function hg(n){const e=n.get("Content-Disposition");if(e){let t=x0(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(vu(t))return t}return null}function To(n,e){return n===404||n===0&&e.startsWith("file:")?new bs('Missing PDF "'+e+'".'):new Kr(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n)}function fg(n){return n===200||n===206}function pg(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function gg(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(W(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class cd{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=cg(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Ce(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new I0(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new P0(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class I0{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const i=new Headers(e.headers),s=t.url;fetch(s,pg(i,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=Co(r.url),!fg(r.status))throw To(r.status,s);this._reader=r.body.getReader(),this._headersCapability.resolve();const o=r.headers,{allowRangeRequests:a,suggestedLength:l}=dg({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=hg(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Cn("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:gg(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class P0{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;const s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${i-1}`);const o=s.url;fetch(o,pg(r,this._withCredentials,this._abortController)).then(a=>{const l=Co(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!fg(a.status))throw To(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:gg(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const la=200,ua=206;function R0(n){const e=n.response;return typeof e!="string"?e:Ao(e).buffer}class M0{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:i}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=cg(this.isHttp,t),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=ua):s.expectedStatus=la,t.responseType="arraybuffer",Ce(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){const i=this.pendingRequests[e];i&&i.onProgress?.(t)}onStateChange(e,t){const i=this.pendingRequests[e];if(!i)return;const s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){i.onError(s.status);return}const r=s.status||la;if(!(r===la&&i.expectedStatus===ua)&&r!==i.expectedStatus){i.onError(s.status);return}const a=R0(s);if(r===ua){const l=s.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);u?i.onDone({begin:parseInt(u[1],10),chunk:a}):(W('Missing or invalid "Content-Range" header.'),i.onError(0))}else a?i.onDone({begin:0,chunk:a}):i.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class k0{constructor(e){this._source=e,this._manager=new M0(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Ce(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new b0(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const i=new N0(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class b0{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Co(t.responseURL);const i=t.getAllResponseHeaders(),s=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[l,...u]=a.split(": ");return[l,u.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=dg({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=hg(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=To(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class N0{constructor(e,t,i){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=Co(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=To(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const L0=/^[a-z][a-z0-9\-+.]+:/i;function D0(n){if(L0.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class F0{constructor(e){this.source=e,this.url=D0(e.url),Ce(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Ce(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new U0(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new H0(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class U0{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new bs(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Cn("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class H0{constructor(e,t,i){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=e.source;this._isStreamingSupported=!s.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const V0=1e5,Ze=30,O0=.8;class $e{#e=Promise.withResolvers();#t=null;#n=!1;#i=!!globalThis.FontInspector?.enabled;#r=null;#s=null;#l=0;#a=0;#c=null;#u=null;#h=0;#d=0;#f=Object.create(null);#o=[];#p=null;#m=[];#g=new WeakMap;#y=null;static#A=new Map;static#v=new Map;static#S=new WeakMap;static#w=null;static#T=new Set;constructor({textContentSource:e,container:t,viewport:i}){if(e instanceof ReadableStream)this.#p=e;else if(typeof e=="object")this.#p=new ReadableStream({start(l){l.enqueue(e),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#u=t,this.#d=i.scale*(globalThis.devicePixelRatio||1),this.#h=i.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:r,pageX:o,pageY:a}=i.rawDims;this.#y=[1,0,0,-1,-o,a+r],this.#a=s,this.#l=r,$e.#k(),qn(t,i),this.#e.promise.finally(()=>{$e.#T.delete(this),this.#s=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Ke.platform;return Y(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#c.read().then(({value:t,done:i})=>{if(i){this.#e.resolve();return}this.#r??=t.lang,Object.assign(this.#f,t.styles),this.#I(t.items),e()},this.#e.reject)};return this.#c=this.#p.getReader(),$e.#T.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const i=e.scale*(globalThis.devicePixelRatio||1),s=e.rotation;if(s!==this.#h&&(t?.(),this.#h=s,qn(this.#u,{rotation:s})),i!==this.#d){t?.(),this.#d=i;const r={div:null,properties:null,ctx:$e.#P(this.#r)};for(const o of this.#m)r.properties=this.#g.get(o),r.div=o,this.#E(r)}}cancel(){const e=new Cn("TextLayer task cancelled.");this.#c?.cancel(e).catch(()=>{}),this.#c=null,this.#e.reject(e)}get textDivs(){return this.#m}get textContentItemsStr(){return this.#o}#I(e){if(this.#n)return;this.#s.ctx??=$e.#P(this.#r);const t=this.#m,i=this.#o;for(const s of e){if(t.length>V0){W("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){const r=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),s.id!==null&&this.#t.setAttribute("id",`${s.id}`),r.append(this.#t)}else s.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}i.push(s.str),this.#R(s)}}#R(e){const t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#m.push(t);const s=H.transform(this.#y,e.transform);let r=Math.atan2(s[1],s[0]);const o=this.#f[e.fontName];o.vertical&&(r+=Math.PI/2);let a=this.#i&&o.fontSubstitution||o.fontFamily;a=$e.fontFamilyMap.get(a)||a;const l=Math.hypot(s[2],s[3]),u=l*$e.#L(a,this.#r);let d,f;r===0?(d=s[4],f=s[5]-u):(d=s[4]+u*Math.sin(r),f=s[5]-u*Math.cos(r));const p="calc(var(--scale-factor)*",g=t.style;this.#t===this.#u?(g.left=`${(100*d/this.#a).toFixed(2)}%`,g.top=`${(100*f/this.#l).toFixed(2)}%`):(g.left=`${p}${d.toFixed(2)}px)`,g.top=`${p}${f.toFixed(2)}px)`),g.fontSize=`${p}${($e.#w*l).toFixed(2)}px)`,g.fontFamily=a,i.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#i&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(i.angle=r*(180/Math.PI));let m=!1;if(e.str.length>1)m=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const v=Math.abs(e.transform[0]),S=Math.abs(e.transform[3]);v!==S&&Math.max(v,S)/Math.min(v,S)>1.5&&(m=!0)}if(m&&(i.canvasWidth=o.vertical?e.height:e.width),this.#g.set(t,i),this.#s.div=t,this.#s.properties=i,this.#E(this.#s),i.hasText&&this.#t.append(t),i.hasEOL){const v=document.createElement("br");v.setAttribute("role","presentation"),this.#t.append(v)}}#E(e){const{div:t,properties:i,ctx:s}=e,{style:r}=t;let o="";if($e.#w>1&&(o=`scale(${1/$e.#w})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:a}=r,{canvasWidth:l,fontSize:u}=i;$e.#x(s,u*this.#d,a);const{width:d}=s.measureText(t.textContent);d>0&&(o=`scaleX(${l*this.#d/d}) ${o}`)}i.angle!==0&&(o=`rotate(${i.angle}deg) ${o}`),o.length>0&&(r.transform=o)}static cleanup(){if(!(this.#T.size>0)){this.#A.clear();for(const{canvas:e}of this.#v.values())e.remove();this.#v.clear()}}static#P(e=null){let t=this.#v.get(e||="");if(!t){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#v.set(e,t),this.#S.set(t,{size:0,family:""})}return t}static#x(e,t,i){const s=this.#S.get(e);t===s.size&&i===s.family||(e.font=`${t}px ${i}`,s.size=t,s.family=i)}static#k(){if(this.#w!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#w=e.getBoundingClientRect().height,e.remove()}static#L(e,t){const i=this.#A.get(e);if(i)return i;const s=this.#P(t);s.canvas.width=s.canvas.height=Ze,this.#x(s,Ze,e);const r=s.measureText("");let o=r.fontBoundingBoxAscent,a=Math.abs(r.fontBoundingBoxDescent);if(o){const d=o/(o+a);return this.#A.set(e,d),s.canvas.width=s.canvas.height=0,d}s.strokeStyle="red",s.clearRect(0,0,Ze,Ze),s.strokeText("g",0,0);let l=s.getImageData(0,0,Ze,Ze).data;a=0;for(let d=l.length-1-3;d>=0;d-=4)if(l[d]>0){a=Math.ceil(d/4/Ze);break}s.clearRect(0,0,Ze,Ze),s.strokeText("A",0,Ze),l=s.getImageData(0,0,Ze,Ze).data,o=0;for(let d=0,f=l.length;d<f;d+=4)if(l[d]>0){o=Ze-Math.floor(d/4/Ze);break}s.canvas.width=s.canvas.height=0;const u=o?o/(o+a):O0;return this.#A.set(e,u),u}}class Ns{static textContent(e){const t=[],i={items:t,styles:Object.create(null)};function s(r){if(!r)return;let o=null;const a=r.name;if(a==="#text")o=r.value;else if(Ns.shouldBuildText(a))r?.attributes?.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(const l of r.children)s(l)}return s(e),i}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const G0=65536,B0=100,z0=5e3,q0=Ge?s0:t0,$0=Ge?r0:rg,W0=Ge?i0:n0,Y0=Ge?o0:lg;function K0(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new Tu,{docId:t}=e,i=n.url?J0(n.url):null,s=n.data?X0(n.data):null,r=n.httpHeaders||null,o=n.withCredentials===!0,a=n.password??null,l=n.range instanceof mg?n.range:null,u=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:G0;let d=n.worker instanceof Re?n.worker:null;const f=n.verbosity,p=typeof n.docBaseUrl=="string"&&!Eo(n.docBaseUrl)?n.docBaseUrl:null,g=typeof n.cMapUrl=="string"?n.cMapUrl:null,m=n.cMapPacked!==!1,v=n.CMapReaderFactory||$0,S=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,y=n.StandardFontDataFactory||Y0,_=n.stopAtErrors!==!0,A=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,E=n.isEvalSupported!==!1,w=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!Ge,C=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!Ge&&(Ke.platform.isFirefox||!globalThis.chrome),T=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,I=typeof n.disableFontFace=="boolean"?n.disableFontFace:Ge,P=n.fontExtraProperties===!0,R=n.enableXfa===!0,L=n.ownerDocument||globalThis.document,V=n.disableRange===!0,J=n.disableStream===!0,ee=n.disableAutoFetch===!0,Ae=n.pdfBug===!0,k=n.CanvasFactory||q0,U=n.FilterFactory||W0,b=n.enableHWA===!0,O=l?l.length:n.length??NaN,z=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!Ge&&!I,Z=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:v===rg&&y===lg&&g&&S&&es(g,document.baseURI)&&es(S,document.baseURI),X=null;Nv(f);const ue={canvasFactory:new k({ownerDocument:L,enableHWA:b}),filterFactory:new U({docId:t,ownerDocument:L}),cMapReaderFactory:Z?null:new v({baseUrl:g,isCompressed:m}),standardFontDataFactory:Z?null:new y({baseUrl:S})};if(!d){const ge={verbosity:f,port:fs.workerPort};d=ge.port?Re.fromPort(ge):new Re(ge),e._worker=d}const Qe={docId:t,apiVersion:"4.10.38",data:s,password:a,disableAutoFetch:ee,rangeChunkSize:u,length:O,docBaseUrl:p,enableXfa:R,evaluatorOptions:{maxImageSize:A,disableFontFace:I,ignoreErrors:_,isEvalSupported:E,isOffscreenCanvasSupported:w,isImageDecoderSupported:C,canvasMaxAreaInBytes:T,fontExtraProperties:P,useSystemFonts:z,cMapUrl:Z?g:null,standardFontDataUrl:Z?S:null}},Bt={disableFontFace:I,fontExtraProperties:P,ownerDocument:L,pdfBug:Ae,styleElement:X,loadingParams:{disableAutoFetch:ee,enableXfa:R}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const ge=d.messageHandler.sendWithPromise("GetDocRequest",Qe,s?[s.buffer]:null);let ne;if(l)ne=new w0(l,{disableRange:V,disableStream:J});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");let Xn;if(Ge)if(es(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Xn=cd}else Xn=F0;else Xn=es(i)?cd:k0;ne=new Xn({url:i,length:O,httpHeaders:r,withCredentials:o,rangeChunkSize:u,disableRange:V,disableStream:J})}return ge.then(Xn=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const Vu=new ts(t,Xn,d.port),em=new e_(Vu,e,ne,Bt,ue);e._transport=em,Vu.send("Ready",null)})}).catch(e._capability.reject),e}function J0(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(Ge&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function X0(n){if(Ge&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return Ao(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n?.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function dd(n){return typeof n=="object"&&Number.isInteger(n?.num)&&n.num>=0&&Number.isInteger(n?.gen)&&n.gen>=0}class Tu{static#e=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${Tu.#e++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}}class mg{constructor(e,t,i=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const i of this._rangeListeners)i(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const i of this._progressListeners)i(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){se("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Q0{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Y(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Z0{#e=null;#t=!1;constructor(e,t,i,s=!1){this._pageIndex=e,this._pageInfo=t,this._transport=i,this._stats=s?new Qc:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new yg,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:r=!1}={}){return new Vs({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Y(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:i="display",annotationMode:s=cn.ENABLE,transform:r=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:u=null,printAnnotationStorage:d=null,isEditing:f=!1}){this._stats?.time("Overall");const p=this._transport.getRenderingIntent(i,s,d,f),{renderingIntent:g,cacheKey:m}=p;this.#t=!1,this.#i(),a||=this._transport.getOptionalContentConfig(g);let v=this._intentStates.get(m);v||(v=Object.create(null),this._intentStates.set(m,v)),v.streamReaderCancelTimeout&&(clearTimeout(v.streamReaderCancelTimeout),v.streamReaderCancelTimeout=null);const S=!!(g&at.PRINT);v.displayReadyCapability||(v.displayReadyCapability=Promise.withResolvers(),v.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(p));const y=E=>{v.renderTasks.delete(_),(this._maybeCleanupAfterRender||S)&&(this.#t=!0),this.#n(!S),E?(_.capability.reject(E),this._abortOperatorList({intentState:v,reason:E instanceof Error?E:new Error(E)})):_.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},_=new di({callback:y,params:{canvasContext:e,viewport:t,transform:r,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:v.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!S,pdfBug:this._pdfBug,pageColors:u});(v.renderTasks||=new Set).add(_);const A=_.task;return Promise.all([v.displayReadyCapability.promise,a]).then(([E,w])=>{if(this.destroyed){y();return}if(this._stats?.time("Rendering"),!(w.renderingIntent&g))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");_.initializeGraphics({transparency:E,optionalContentConfig:w}),_.operatorListChanged()}).catch(y),A}getOperatorList({intent:e="display",annotationMode:t=cn.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const o=this._transport.getRenderingIntent(e,t,i,s,!0);let a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=r,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>Ns.textContent(i));const t=this.streamTextContent(e);return new Promise(function(i,s){function r(){o.read().then(function({value:l,done:u}){if(u){i(a);return}a.lang??=l.lang,Object.assign(a.styles,l.styles),a.items.push(...l.items),r()},s)}const o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),this.#t=!1,this.#i(),Promise.all(e)}cleanup(e=!1){this.#t=!0;const t=this.#n(!1);return e&&t&&(this._stats&&=new Qc),t}#n(e=!1){if(this.#i(),!this.#t||this.destroyed)return!1;if(e)return this.#e=setTimeout(()=>{this.#e=null,this.#n(!1)},z0),!1;for(const{renderTasks:t,operatorList:i}of this._intentStates.values())if(t.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}#i(){this.#e&&(clearTimeout(this.#e),this.#e=null)}_startRenderPage(e,t){const i=this._intentStates.get(t);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let i=0,s=e.length;i<s;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const i of t.renderTasks)i.operatorListChanged();e.lastChunk&&this.#n(!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:i,modifiedIds:s}){const{map:r,transfer:o}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:s},o).getReader(),u=this._intentStates.get(t);u.streamReader=l;const d=()=>{l.read().then(({value:f,done:p})=>{if(p){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(f,u),d())},f=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const p of u.renderTasks)p.operatorListChanged();this.#n(!0)}if(u.displayReadyCapability)u.displayReadyCapability.reject(f);else if(u.opListReadCapability)u.opListReadCapability.reject(f);else throw f}})};d()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(t instanceof yu){let s=B0;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new Cn(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[s,r]of this._intentStates)if(r===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}class j0{#e=new Map;#t=Promise.resolve();postMessage(e,t){const i={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[s]of this.#e)s.call(this,i)})}addEventListener(e,t,i=null){let s=null;if(i?.signal instanceof AbortSignal){const{signal:r}=i;if(r.aborted){W("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);s=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}this.#e.set(t,s)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}class Re{static#e=0;static#t=!1;static#n;static{Ge&&(this.#t=!0,fs.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(e,t)=>{let i;try{if(i=new URL(e),!i.origin||i.origin==="null")return!1}catch{return!1}const s=new URL(t,i);return i.origin===s.origin},this._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}}constructor({name:e=null,port:t=null,verbosity:i=Lv()}={}){if(this.name=e,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if(Re.#n?.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(Re.#n||=new WeakMap).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}#i(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new ts("main","worker",e),this._messageHandler.on("ready",function(){}),this.#i()}_initialize(){if(Re.#t||Re.#r){this._setupFakeWorker();return}let{workerSrc:e}=Re;try{Re._isSameOrigin(window.location.href,e)||(e=Re._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),i=new ts("main","worker",t),s=()=>{r.abort(),i.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:r.signal}),i.on("test",a=>{if(r.abort(),this.destroyed||!a){s();return}this._messageHandler=i,this._port=t,this._webWorker=t,this.#i()}),i.on("ready",a=>{if(r.abort(),this.destroyed){s();return}try{o()}catch{this._setupFakeWorker()}});const o=()=>{const a=new Uint8Array;i.send("test",a,[a.buffer])};o();return}catch{_o("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){Re.#t||(W("Setting up fake worker."),Re.#t=!0),Re._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new j0;this._port=t;const i=`fake${Re.#e++}`,s=new ts(i+"_worker",i,t);e.setup(s,t),this._messageHandler=new ts(i,i+"_worker",t),this.#i()}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,Re.#n?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(e){if(!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const t=this.#n?.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Re(e)}static get workerSrc(){if(fs.workerSrc)return fs.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#r(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return Y(this,"_setupFakeWorkerGlobal",(async()=>this.#r?this.#r:(await import(this.workerSrc)).WorkerMessageHandler)())}}class e_{#e=new Map;#t=new Map;#n=new Map;#i=new Map;#r=null;constructor(e,t,i,s,r){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new yg,this.fontLoader=new jv({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#s(e,t=null){const i=this.#e.get(e);if(i)return i;const s=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,s),s}get annotationStorage(){return Y(this,"annotationStorage",new Eu)}getRenderingIntent(e,t=cn.ENABLE,i=null,s=!1,r=!1){let o=at.DISPLAY,a=al;switch(e){case"any":o=at.ANY;break;case"display":break;case"print":o=at.PRINT;break;default:W(`getRenderingIntent - invalid intent: ${e}`)}const l=o&at.PRINT&&i instanceof ng?i:this.annotationStorage;switch(t){case cn.DISABLE:o+=at.ANNOTATIONS_DISABLE;break;case cn.ENABLE:break;case cn.ENABLE_FORMS:o+=at.ANNOTATIONS_FORMS;break;case cn.ENABLE_STORAGE:o+=at.ANNOTATIONS_STORAGE,a=l.serializable;break;default:W(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(o+=at.IS_EDITING),r&&(o+=at.OPLIST);const{ids:u,hash:d}=l.modifiedIds,f=[o,a.hash,d];return{renderingIntent:o,cacheKey:f.join("_"),annotationStorageSerializable:a,modifiedIds:u}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of this.#t.values())e.push(i._destroy());this.#t.clear(),this.#n.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),$e.cleanup(),this._networkStream?.cancelAllRequests(new Cn("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,s)=>{Ce(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},s.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){s.close();return}Ce(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{this._fullReader.cancel(r),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async i=>{await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:r,contentLength:o}=this._fullReader;return(!s||!r)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=a=>{t.onProgress?.({loaded:a.loaded,total:a.total})}),{isStreamingSupported:s,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(i,s)=>{Ce(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(i.begin,i.end);if(!r){s.close();return}s.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){s.close();return}Ce(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{r.cancel(o),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new Q0(i,this))}),e.on("DocException",i=>{t._capability.reject(je(i))}),e.on("PasswordRequest",i=>{this.#r=Promise.withResolvers();try{if(!t.onPassword)throw je(i);const s=r=>{r instanceof Error?this.#r.reject(r):this.#r.resolve({password:r})};t.onPassword(s,i.code)}catch(s){this.#r.reject(s)}return this.#r.promise}),e.on("DataLoaded",i=>{t.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;this.#t.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,s,r])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":const{disableFontFace:o,fontExtraProperties:a,pdfBug:l}=this._params;if("error"in r){const p=r.error;W(`Error during font loading: ${p}`),this.commonObjs.resolve(i,p);break}const u=l&&globalThis.FontInspector?.enabled?(p,g)=>globalThis.FontInspector.fontAdded(p,g):null,d=new e0(r,{disableFontFace:o,fontExtraProperties:a,inspectFont:u});this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!a&&d.data&&(d.data=null),this.commonObjs.resolve(i,d)});break;case"CopyLocalImage":const{imageRef:f}=r;Ce(f,"The imageRef must be defined.");for(const p of this.#t.values())for(const[,g]of p.objs)if(g?.ref===f)return g.dataLen?(this.commonObjs.resolve(i,structuredClone(g)),g.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,r);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([i,s,r,o])=>{if(this.destroyed)return;const a=this.#t.get(s);if(!a.objs.has(i)){if(a._intentStates.size===0){o?.bitmap?.close();return}switch(r){case"Image":a.objs.resolve(i,o),o?.dataLen>Rv&&(a._maybeCleanupAfterRender=!0);break;case"Pattern":a.objs.resolve(i,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",i=>{this.destroyed||t.onProgress?.({loaded:i.loaded,total:i.total})}),e.on("FetchBuiltInCMap",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(i)}),e.on("FetchStandardFontData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&W("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,i=this.#n.get(t);if(i)return i;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&this.#i.set(r.refStr,e);const o=new Z0(t,r,this,this._params.pdfBug);return this.#t.set(t,o),o});return this.#n.set(t,s),s}getPageIndex(e){return dd(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#s("GetOptionalContentConfig").then(t=>new E0(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#e.get(e);if(t)return t;const i=this.messageHandler.sendWithPromise(e,null).then(s=>({info:s[0],metadata:s[1]?new A0(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),$e.cleanup()}}cachedPageNumber(e){if(!dd(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#i.get(t)??null}}const Yi=Symbol("INITIAL_DATA");class yg{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:Yi}}get(e,t=null){if(t){const s=this.#t(e);return s.promise.then(()=>t(s.data)),null}const i=this.#e[e];if(!i||i.data===Yi)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){const t=this.#e[e];return!!t&&t.data!==Yi}delete(e){const t=this.#e[e];return!t||t.data===Yi?!1:(delete this.#e[e],!0)}resolve(e,t=null){const i=this.#t(e);i.data=t,i.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==Yi&&(yield[e,t])}}}class t_{#e=null;constructor(e){this.#e=e,this.onContinue=null}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}class di{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:i,commonObjs:s,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:u,useRequestAnimationFrame:d=!1,pdfBug:f=!1,pageColors:p=null}){this.callback=e,this.params=t,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=u,this._pdfBug=f,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new t_(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(di.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");di.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:s,transform:r,background:o}=this.params;this.gfx=new _i(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:s,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),di.#t.delete(this._canvas),this.callback(e||new yu(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),di.#t.delete(this._canvas),this.callback())))}}const n_="4.10.38",i_="f9bea397f";function hd(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function Ki(n){return Math.max(0,Math.min(255,255*n))}class fd{static CMYK_G([e,t,i,s]){return["G",1-Math.min(1,.3*e+.59*i+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Ki(e),[e,e,e]}static G_HTML([e]){const t=hd(e);return`#${t}${t}${t}`}static RGB_G([e,t,i]){return["G",.3*e+.59*t+.11*i]}static RGB_rgb(e){return e.map(Ki)}static RGB_HTML(e){return`#${e.map(hd).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,i,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,i+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,i,s]){return[Ki(1-Math.min(1,e+s)),Ki(1-Math.min(1,i+s)),Ki(1-Math.min(1,t+s))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,i]){const s=1-e,r=1-t,o=1-i,a=Math.min(s,r,o);return["CMYK",s,r,o,a]}}class s_{create(e,t,i=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){se("Abstract method `_createSVG` called.")}}class xu extends s_{_createSVG(e){return document.createElementNS(zt,e)}}class vg{static setupStorage(e,t,i,s,r){const o=s.getValue(t,{value:null});switch(i.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(o.value===i.attributes.xfaOn?e.setAttribute("checked",!0):o.value===i.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",a=>{s.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",a=>{s.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const a of i.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{const l=a.target.options,u=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:i=null,intent:s,linkService:r}){const{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${s}`);for(const[l,u]of Object.entries(o))if(u!=null)switch(l){case"class":u.length&&e.setAttribute(l,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,u)}a&&r.addLinkAttributes(e,o.href,o.newWindow),i&&o.dataId&&this.setupStorage(e,o.dataId,t,i)}static render(e){const t=e.annotationStorage,i=e.linkService,s=e.xfaHtml,r=e.intent||"display",o=document.createElement(s.name);s.attributes&&this.setAttributes({html:o,element:s,intent:r,linkService:i});const a=r!=="richText",l=e.div;if(l.append(o),e.viewport){const f=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=f}a&&l.setAttribute("class","xfaLayer xfaFont");const u=[];if(s.children.length===0){if(s.value){const f=document.createTextNode(s.value);o.append(f),a&&Ns.shouldBuildText(s.name)&&u.push(f)}return{textDivs:u}}const d=[[s,-1,o]];for(;d.length>0;){const[f,p,g]=d.at(-1);if(p+1===f.children.length){d.pop();continue}const m=f.children[++d.at(-1)[1]];if(m===null)continue;const{name:v}=m;if(v==="#text"){const y=document.createTextNode(m.value);u.push(y),g.append(y);continue}const S=m?.attributes?.xmlns?document.createElementNS(m.attributes.xmlns,v):document.createElement(v);if(g.append(S),m.attributes&&this.setAttributes({html:S,element:m,storage:t,intent:r,linkService:i}),m.children?.length>0)d.push([m,-1,S]);else if(m.value){const y=document.createTextNode(m.value);a&&Ns.shouldBuildText(v)&&u.push(y),S.append(y)}}for(const f of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))f.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Gs=1e3,r_=9,$n=new WeakSet;function Sn(n){return{width:n[2]-n[0],height:n[3]-n[1]}}class o_{static create(e){switch(e.data.annotationType){case Te.LINK:return new _g(e);case Te.TEXT:return new a_(e);case Te.WIDGET:switch(e.data.fieldType){case"Tx":return new l_(e);case"Btn":return e.data.radioButton?new Ag(e):e.data.checkBox?new c_(e):new d_(e);case"Ch":return new h_(e);case"Sig":return new u_(e)}return new Kn(e);case Te.POPUP:return new ul(e);case Te.FREETEXT:return new Sg(e);case Te.LINE:return new p_(e);case Te.SQUARE:return new g_(e);case Te.CIRCLE:return new m_(e);case Te.POLYLINE:return new Eg(e);case Te.CARET:return new v_(e);case Te.INK:return new Iu(e);case Te.POLYGON:return new y_(e);case Te.HIGHLIGHT:return new wg(e);case Te.UNDERLINE:return new __(e);case Te.SQUIGGLY:return new A_(e);case Te.STRIKEOUT:return new S_(e);case Te.STAMP:return new Cg(e);case Te.FILEATTACHMENT:return new E_(e);default:return new _e(e)}}}class _e{#e=null;#t=!1;#n=null;constructor(e,{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:i}){return!!(e?.str||t?.str||i?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return _e._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;this.#e||={rect:this.data.rect.slice(0)};const{rect:t}=e;t&&this.#i(t),this.#n?.popup.updateEdited(e)}resetEdited(){this.#e&&(this.#i(this.#e.rect),this.#n?.popup.resetEdited(),this.#e=null)}#i(e){const{container:{style:t},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:l}}}}=this;i?.splice(0,4,...e);const{width:u,height:d}=Sn(e);t.left=`${100*(e[0]-a)/r}%`,t.top=`${100*(o-e[3]+l)/o}%`,s===0?(t.width=`${100*u/r}%`,t.height=`${100*d/o}%`):this.setRotation(s)}_createContainer(e){const{data:t,parent:{page:i,viewport:s}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),this instanceof Kn||(r.tabIndex=Gs);const{style:o}=r;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof ul){const{rotation:v}=t;return!t.hasOwnCanvas&&v!==0&&this.setRotation(v,r),r}const{width:a,height:l}=Sn(t.rect);if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const v=t.borderStyle.horizontalCornerRadius,S=t.borderStyle.verticalCornerRadius;if(v>0||S>0){const _=`calc(${v}px * var(--scale-factor)) / calc(${S}px * var(--scale-factor))`;o.borderRadius=_}else if(this instanceof Ag){const _=`calc(${a}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;o.borderRadius=_}switch(t.borderStyle.style){case $i.SOLID:o.borderStyle="solid";break;case $i.DASHED:o.borderStyle="dashed";break;case $i.BEVELED:W("Unimplemented border style: beveled");break;case $i.INSET:W("Unimplemented border style: inset");break;case $i.UNDERLINE:o.borderBottomStyle="solid";break}const y=t.borderColor||null;y?(this.#t=!0,o.borderColor=H.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):o.borderWidth=0}const u=H.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]),{pageWidth:d,pageHeight:f,pageX:p,pageY:g}=s.rawDims;o.left=`${100*(u[0]-p)/d}%`,o.top=`${100*(u[1]-g)/f}%`;const{rotation:m}=t;return t.hasOwnCanvas||m===0?(o.width=`${100*a/d}%`,o.height=`${100*l/f}%`):this.setRotation(m,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims,{width:r,height:o}=Sn(this.data.rect);let a,l;e%180===0?(a=100*r/i,l=100*o/s):(a=100*o/i,l=100*r/s),t.style.width=`${a}%`,t.style.height=`${l}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,i,s)=>{const r=s.detail[t],o=r[0],a=r.slice(1);s.target.style[i]=fd[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[i]:fd[`${o}_rgb`](a)})};return Y(this,"_commonActions",{display:t=>{const{display:i}=t.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:i}=t.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const i=t.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,t){const i=this._commonActions;for(const s of Object.keys(t.detail))(e[s]||i[s])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const i=this._commonActions;for(const[s,r]of Object.entries(t)){const o=i[s];if(o){const a={detail:{[s]:r},target:e};o(a),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,i,s,r]=this.data.rect.map(v=>Math.fround(v));if(e.length===8){const[v,S,y,_]=e.subarray(2,6);if(s===v&&r===S&&t===y&&i===_)return}const{style:o}=this.container;let a;if(this.#t){const{borderColor:v,borderWidth:S}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${v}" stroke-width="${S}">`],this.container.classList.add("hasBorder")}const l=s-t,u=r-i,{svgFactory:d}=this,f=d.createElement("svg");f.classList.add("quadrilateralsContainer"),f.setAttribute("width",0),f.setAttribute("height",0);const p=d.createElement("defs");f.append(p);const g=d.createElement("clipPath"),m=`clippath_${this.data.id}`;g.setAttribute("id",m),g.setAttribute("clipPathUnits","objectBoundingBox"),p.append(g);for(let v=2,S=e.length;v<S;v+=8){const y=e[v],_=e[v+1],A=e[v+2],E=e[v+3],w=d.createElement("rect"),C=(A-t)/l,T=(r-_)/u,I=(y-A)/l,P=(_-E)/u;w.setAttribute("x",C),w.setAttribute("y",T),w.setAttribute("width",I),w.setAttribute("height",P),g.append(w),a?.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${T}" width="${I}" height="${P}"/>`)}this.#t&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(f),this.container.style.clipPath=`url(#${m})`}_createPopup(){const{data:e}=this,t=this.#n=new ul({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]});this.parent.div.append(t.render())}render(){se("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const i=[];if(this._fieldObjects){const s=this._fieldObjects[e];if(s)for(const{page:r,id:o,exportValues:a}of s){if(r===-1||o===t)continue;const l=typeof a=="string"?a:null,u=document.querySelector(`[data-element-id="${o}"]`);if(u&&!$n.has(u)){W(`_getElementsByName - element not allowed: ${o}`);continue}i.push({id:o,exportValue:l,domElement:u})}return i}for(const s of document.getElementsByName(e)){const{exportValue:r}=s,o=s.getAttribute("data-element-id");o!==t&&$n.has(s)&&i.push({id:o,exportValue:r,domElement:s})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}}class _g extends _e{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let s=!1;return e.url?(t.addLinkAttributes(i,e.url,e.newWindow),s=!0):e.action?(this._bindNamedAction(i,e.action),s=!0):e.attachment?(this.#t(i,e.attachment,e.attachmentDest),s=!0):e.setOCGState?(this.#n(i,e.setOCGState),s=!0):e.dest?(this._bindLink(i,e.dest),s=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),s=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(i),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e()}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),this.#e()}#t(e,t,i=null){e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,i),!1),this.#e()}#n(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(t.actions)){const r=i.get(s);r&&(e[r]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:s}}),!1))}e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){W('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{i?.();const{fields:s,refs:r,include:o}=t,a=[];if(s.length!==0||r.length!==0){const d=new Set(r);for(const f of s){const p=this._fieldObjects[f]||[];for(const{id:g}of p)d.add(g)}for(const f of Object.values(this._fieldObjects))for(const p of f)d.has(p.id)===o&&a.push(p)}else for(const d of Object.values(this._fieldObjects))a.push(...d);const l=this.annotationStorage,u=[];for(const d of a){const{id:f}=d;switch(u.push(f),d.type){case"text":{const g=d.defaultValue||"";l.setValue(f,{value:g});break}case"checkbox":case"radiobutton":{const g=d.defaultValue===d.exportValues;l.setValue(f,{value:g});break}case"combobox":case"listbox":{const g=d.defaultValue||"";l.setValue(f,{value:g});break}default:continue}const p=document.querySelector(`[data-element-id="${f}"]`);if(p){if(!$n.has(p)){W(`_bindResetFormAction - element not allowed: ${f}`);continue}}else continue;p.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}}),!1}}}class a_ extends _e{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Kn extends _e{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Ke.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,i,s,r){i.includes("mouse")?e.addEventListener(i,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(i,o=>{if(i==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(i==="focus"){if(t.focused)return;t.focused=!0}r&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o)}})})}_setEventListeners(e,t,i,s){for(const[r,o]of i)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,r,o,s),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":H.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||r_,r=e.style;let o;const a=2,l=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(u/(ia*s))||1,f=u/d;o=Math.min(s,l(f/ia))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(s,l(u/ia))}r.fontSize=`calc(${o}px * var(--scale-factor))`,r.color=H.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class l_ extends Kn{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,i,s){const r=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=i),r.setValue(o.id,{[s]:i})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const s=e.getValue(t,{value:this.data.fieldValue});let r=s.value||"";const o=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;o&&r.length>o&&(r=r.slice(0,o));let a=s.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const l={userValue:r,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=a??r,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",a??r),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),$n.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=Gs,this._setRequired(i,this.data.required),o&&(i.maxLength=o),i.addEventListener("input",d=>{e.setValue(t,{value:d.target.value}),this.setPropertyOnSiblings(i,"value",d.target.value,"value"),l.formattedValue=null}),i.addEventListener("resetform",d=>{const f=this.data.defaultFieldValue??"";i.value=l.userValue=f,l.formattedValue=null});let u=d=>{const{formattedValue:f}=l;f!=null&&(d.target.value=f),d.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",f=>{if(l.focused)return;const{target:p}=f;l.userValue&&(p.value=l.userValue),l.lastCommittedValue=p.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),i.addEventListener("updatefromsandbox",f=>{this.showElementAndHideCanvas(f.target);const p={value(g){l.userValue=g.detail.value??"",e.setValue(t,{value:l.userValue.toString()}),g.target.value=l.userValue},formattedValue(g){const{formattedValue:m}=g.detail;l.formattedValue=m,m!=null&&g.target!==document.activeElement&&(g.target.value=m),e.setValue(t,{formattedValue:m})},selRange(g){g.target.setSelectionRange(...g.detail.selRange)},charLimit:g=>{const{charLimit:m}=g.detail,{target:v}=g;if(m===0){v.removeAttribute("maxLength");return}v.setAttribute("maxLength",m);let S=l.userValue;!S||S.length<=m||(S=S.slice(0,m),v.value=l.userValue=S,e.setValue(t,{value:S}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:S,willCommit:!0,commitKey:1,selStart:v.selectionStart,selEnd:v.selectionEnd}}))}};this._dispatchEventFromSandbox(p,f)}),i.addEventListener("keydown",f=>{l.commitKey=1;let p=-1;if(f.key==="Escape"?p=0:f.key==="Enter"&&!this.data.multiLine?p=2:f.key==="Tab"&&(l.commitKey=3),p===-1)return;const{value:g}=f.target;l.lastCommittedValue!==g&&(l.lastCommittedValue=g,l.userValue=g,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:g,willCommit:!0,commitKey:p,selStart:f.target.selectionStart,selEnd:f.target.selectionEnd}}))});const d=u;u=null,i.addEventListener("blur",f=>{if(!l.focused||!f.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{value:p}=f.target;l.userValue=p,l.lastCommittedValue!==p&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:p,willCommit:!0,commitKey:l.commitKey,selStart:f.target.selectionStart,selEnd:f.target.selectionEnd}}),d(f)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",f=>{l.lastCommittedValue=null;const{data:p,target:g}=f,{value:m,selectionStart:v,selectionEnd:S}=g;let y=v,_=S;switch(f.inputType){case"deleteWordBackward":{const A=m.substring(0,v).match(/\w*[^\w]*$/);A&&(y-=A[0].length);break}case"deleteWordForward":{const A=m.substring(v).match(/^[^\w]*\w*/);A&&(_+=A[0].length);break}case"deleteContentBackward":v===S&&(y-=1);break;case"deleteContentForward":v===S&&(_+=1);break}f.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:m,change:p||"",willCommit:!1,selStart:y,selEnd:_}})}),this._setEventListeners(i,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],f=>f.target.value)}if(u&&i.addEventListener("blur",u),this.data.comb){const f=(this.data.rect[2]-this.data.rect[0])/o;i.classList.add("comb"),i.style.letterSpacing=`calc(${f}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class u_ extends Kn{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class c_ extends Kn{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,i=t.id;let s=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return $n.add(r),r.setAttribute("data-element-id",i),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=Gs,r.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const u of this._getElementsByName(a,i)){const d=l&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=d),e.setValue(u.id,{value:d})}e.setValue(i,{value:l})}),r.addEventListener("resetform",o=>{const a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class Ag extends Kn{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,i=t.id;let s=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(i,{value:s})),s)for(const o of this._getElementsByName(t.fieldName,i))e.setValue(o.id,{value:!1});const r=document.createElement("input");if($n.add(r),r.setAttribute("data-element-id",i),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.tabIndex=Gs,r.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const u of this._getElementsByName(a,i))e.setValue(u.id,{value:!1});e.setValue(i,{value:l})}),r.addEventListener("resetform",o=>{const a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;r.addEventListener("updatefromsandbox",a=>{const l={value:u=>{const d=o===u.detail.value;for(const f of this._getElementsByName(u.target.name)){const p=d&&f.id===i;f.domElement&&(f.domElement.checked=p),e.setValue(f.id,{value:p})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class d_ extends _g{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),e}}class h_ extends Kn{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");$n.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=Gs;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",d=>{const f=this.data.defaultFieldValue;for(const p of s.options)p.selected=p.value===f});for(const d of this.data.options){const f=document.createElement("option");f.textContent=d.displayValue,f.value=d.exportValue,i.value.includes(d.exportValue)&&(f.setAttribute("selected",!0),r=!1),s.append(f)}let o=null;if(r){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),s.prepend(d),o=()=>{d.remove(),s.removeEventListener("input",o),o=null},s.addEventListener("input",o)}const a=d=>{const f=d?"value":"textContent",{options:p,multiple:g}=s;return g?Array.prototype.filter.call(p,m=>m.selected).map(m=>m[f]):p.selectedIndex===-1?null:p[p.selectedIndex][f]};let l=a(!1);const u=d=>{const f=d.target.options;return Array.prototype.map.call(f,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",d=>{const f={value(p){o?.();const g=p.detail.value,m=new Set(Array.isArray(g)?g:[g]);for(const v of s.options)v.selected=m.has(v.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(p){s.multiple=!0},remove(p){const g=s.options,m=p.detail.remove;g[m].selected=!1,s.remove(m),g.length>0&&Array.prototype.findIndex.call(g,S=>S.selected)===-1&&(g[0].selected=!0),e.setValue(t,{value:a(!0),items:u(p)}),l=a(!1)},clear(p){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(p){const{index:g,displayValue:m,exportValue:v}=p.detail.insert,S=s.children[g],y=document.createElement("option");y.textContent=m,y.value=v,S?S.before(y):s.append(y),e.setValue(t,{value:a(!0),items:u(p)}),l=a(!1)},items(p){const{items:g}=p.detail;for(;s.length!==0;)s.remove(0);for(const m of g){const{displayValue:v,exportValue:S}=m,y=document.createElement("option");y.textContent=v,y.value=S,s.append(y)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:a(!0),items:u(p)}),l=a(!1)},indices(p){const g=new Set(p.detail.indices);for(const m of p.target.options)m.selected=g.has(m.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(f,d)}),s.addEventListener("input",d=>{const f=a(!0),p=a(!1);e.setValue(t,{value:f}),d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:p,changeEx:f,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):s.addEventListener("input",function(d){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class ul extends _e{constructor(e){const{data:t,elements:i}=e;super(e,{isRenderable:_e._hasPopupData(t)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new f_({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",t.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(i=>`${mu}${i}`).join(",")),this.container}}class f_{#e=this.#I.bind(this);#t=this.#x.bind(this);#n=this.#P.bind(this);#i=this.#E.bind(this);#r=null;#s=null;#l=null;#a=null;#c=null;#u=null;#h=null;#d=!1;#f=null;#o=null;#p=null;#m=null;#g=null;#y=null;#A=!1;constructor({container:e,color:t,elements:i,titleObj:s,modificationDate:r,contentsObj:o,richText:a,parent:l,rect:u,parentRect:d,open:f}){this.#s=e,this.#g=s,this.#l=o,this.#m=a,this.#u=l,this.#r=t,this.#p=u,this.#h=d,this.#c=i,this.#a=eg.toDateObject(r),this.trigger=i.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",this.#i),p.addEventListener("mouseenter",this.#n),p.addEventListener("mouseleave",this.#t),p.classList.add("popupTriggerArea");for(const p of i)p.container?.addEventListener("keydown",this.#e);this.#s.hidden=!0,f&&this.#E()}render(){if(this.#f)return;const e=this.#f=document.createElement("div");if(e.className="popup",this.#r){const r=e.style.outlineColor=H.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`:e.style.backgroundColor=H.makeHexColor(...this.#r.map(a=>Math.floor(.7*(255-a)+a)))}const t=document.createElement("span");t.className="header";const i=document.createElement("h1");if(t.append(i),{dir:i.dir,str:i.textContent}=this.#g,e.append(t),this.#a){const r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#a.valueOf()})),t.append(r)}const s=this.#v;if(s)vg.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const r=this._formatContents(this.#l);e.append(r)}this.#s.append(e)}get#v(){const e=this.#m,t=this.#l;return e?.str&&(!t?.str||t.str===e.str)&&this.#m.html||null}get#S(){return this.#v?.attributes?.style?.fontSize||0}get#w(){return this.#v?.attributes?.style?.color||null}#T(e){const t=[],i={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:this.#w,fontSize:this.#S?`calc(${this.#S}px * var(--scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:s});return i}_formatContents({str:e,dir:t}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=t;const s=e.split(/(?:\r\n?|\n)/);for(let r=0,o=s.length;r<o;++r){const a=s[r];i.append(document.createTextNode(a)),r<o-1&&i.append(document.createElement("br"))}return i}#I(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#d)&&this.#E()}updateEdited({rect:e,popupContent:t}){this.#y||={contentsObj:this.#l,richText:this.#m},e&&(this.#o=null),t&&(this.#m=this.#T(t),this.#l=null),this.#f?.remove(),this.#f=null}resetEdited(){this.#y&&({contentsObj:this.#l,richText:this.#m}=this.#y,this.#y=null,this.#f?.remove(),this.#f=null,this.#o=null)}#R(){if(this.#o!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:i,pageX:s,pageY:r}}}=this.#u;let o=!!this.#h,a=o?this.#h:this.#p;for(const m of this.#c)if(!a||H.intersect(m.data.rect,a)!==null){a=m.data.rect,o=!0;break}const l=H.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),d=o?a[2]-a[0]+5:0,f=l[0]+d,p=l[1];this.#o=[100*(f-s)/t,100*(p-r)/i];const{style:g}=this.#s;g.left=`${this.#o[0]}%`,g.top=`${this.#o[1]}%`}#E(){this.#d=!this.#d,this.#d?(this.#P(),this.#s.addEventListener("click",this.#i),this.#s.addEventListener("keydown",this.#e)):(this.#x(),this.#s.removeEventListener("click",this.#i),this.#s.removeEventListener("keydown",this.#e))}#P(){this.#f||this.render(),this.isVisible?this.#d&&this.#s.classList.add("focused"):(this.#R(),this.#s.hidden=!1,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)+1e3)}#x(){this.#s.classList.remove("focused"),!(this.#d||!this.isVisible)&&(this.#s.hidden=!0,this.#s.style.zIndex=parseInt(this.#s.style.zIndex)-1e3)}forceHide(){this.#A=this.isVisible,this.#A&&(this.#s.hidden=!0)}maybeShow(){this.#A&&(this.#f||this.#P(),this.#A=!1,this.#s.hidden=!1)}get isVisible(){return this.#s.hidden===!1}}class Sg extends _e{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=$.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class p_ extends _e{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:t,height:i}=Sn(e.rect),s=this.svgFactory.create(t,i,!0),r=this.#e=this.svgFactory.createElement("svg:line");return r.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),r.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),r.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),r.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),s.append(r),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class g_ extends _e{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:t,height:i}=Sn(e.rect),s=this.svgFactory.create(t,i,!0),r=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",r/2),o.setAttribute("y",r/2),o.setAttribute("width",t-r),o.setAttribute("height",i-r),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class m_ extends _e{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:t,height:i}=Sn(e.rect),s=this.svgFactory.create(t,i,!0),r=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",t/2),o.setAttribute("cy",i/2),o.setAttribute("rx",t/2-r/2),o.setAttribute("ry",i/2-r/2),o.setAttribute("stroke-width",r||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Eg extends _e{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:i,popupRef:s}}=this;if(!t)return this.container;const{width:r,height:o}=Sn(e),a=this.svgFactory.create(r,o,!0);let l=[];for(let d=0,f=t.length;d<f;d+=2){const p=t[d]-e[0],g=e[3]-t[d+1];l.push(`${p},${g}`)}l=l.join(" ");const u=this.#e=this.svgFactory.createElement(this.svgElementName);return u.setAttribute("points",l),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),a.append(u),this.container.append(a),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class y_ extends Eg{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class v_ extends _e{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Iu extends _e{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?$.HIGHLIGHT:$.INK}#n(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:i,borderStyle:s,popupRef:r}}=this,{transform:o,width:a,height:l}=this.#n(t,e),u=this.svgFactory.create(a,l,!0),d=this.#e=this.svgFactory.createElement("svg:g");u.append(d),d.setAttribute("stroke-width",s.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",o);for(let f=0,p=i.length;f<p;f++){const g=this.svgFactory.createElement(this.svgElementName);this.#t.push(g),g.setAttribute("points",i[f].join(",")),d.append(g)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(u),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:i,rect:s}=e,r=this.#e;if(t>=0&&r.setAttribute("stroke-width",t||1),i)for(let o=0,a=this.#t.length;o<a;o++)this.#t[o].setAttribute("points",i[o].join(","));if(s){const{transform:o,width:a,height:l}=this.#n(this.data.rotation,s);r.parentElement.setAttribute("viewBox",`0 0 ${a} ${l}`),r.setAttribute("transform",o)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class wg extends _e{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=$.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class __ extends _e{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class A_ extends _e{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class S_ extends _e{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class Cg extends _e{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=$.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class E_ extends _e{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let i;t.hasAppearance||t.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#t.bind(this)),this.#e=i;const{isMac:s}=Ke.platform;return e.addEventListener("keydown",r=>{r.key==="Enter"&&(s?r.metaKey:r.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class w_{#e=null;#t=null;#n=new Map;#i=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,annotationEditorUIManager:s,page:r,viewport:o,structTreeLayer:a}){this.div=e,this.#e=t,this.#t=i,this.#i=a||null,this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return this.#n.size>0}async#r(e,t){const i=e.firstChild||e,s=i.id=`${mu}${t}`,r=await this.#i?.getAriaAttributes(s);if(r)for(const[o,a]of r)i.setAttribute(o,a);this.div.append(e),this.#e?.moveElementInDOM(this.div,e,i,!1)}async render(e){const{annotations:t}=e,i=this.div;qn(i,this.viewport);const s=new Map,r={data:null,layer:i,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new xu,annotationStorage:e.annotationStorage||new Eu,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const a=o.annotationType===Te.POPUP;if(a){const d=s.get(o.id);if(!d)continue;r.elements=d}else{const{width:d,height:f}=Sn(o.rect);if(d<=0||f<=0)continue}r.data=o;const l=o_.create(r);if(!l.isRenderable)continue;if(!a&&o.popupRef){const d=s.get(o.popupRef);d?d.push(l):s.set(o.popupRef,[l])}const u=l.render();o.hidden&&(u.style.visibility="hidden"),await this.#r(u,o.id),l._isEditable&&(this.#n.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}this.#s()}update({viewport:e}){const t=this.div;this.viewport=e,qn(t,{rotation:e.rotation}),this.#s(),t.hidden=!1}#s(){if(!this.#t)return;const e=this.div;for(const[t,i]of this.#t){const s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;i.className="annotationContent";const{firstChild:r}=s;r?r.nodeName==="CANVAS"?r.replaceWith(i):r.classList.contains("annotationContent")?r.after(i):r.before(i):s.append(i)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(e){return this.#n.get(e)}}const lr=/\r\n?|\n/g;class xe extends B{#e;#t="";#n=`${this.id}-editor`;#i=null;#r;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=xe.prototype,t=r=>r.isEmpty(),i=Tn.TRANSLATE_SMALL,s=Tn.TRANSLATE_BIG;return Y(this,"_keyboardManager",new Os([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,s],checker:t}]]))}static _type="freetext";static _editorType=$.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.#e=e.color||xe._defaultColor||B._defaultLineColor,this.#r=e.fontSize||xe._defaultFontSize}static initialize(e,t){B.initialize(e,t);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case Q.FREETEXT_SIZE:xe._defaultFontSize=t;break;case Q.FREETEXT_COLOR:xe._defaultColor=t;break}}updateParams(e,t){switch(e){case Q.FREETEXT_SIZE:this.#s(t);break;case Q.FREETEXT_COLOR:this.#l(t);break}}static get defaultPropertiesToUpdate(){return[[Q.FREETEXT_SIZE,xe._defaultFontSize],[Q.FREETEXT_COLOR,xe._defaultColor||B._defaultLineColor]]}get propertiesToUpdate(){return[[Q.FREETEXT_SIZE,this.#r],[Q.FREETEXT_COLOR,this.#e]]}#s(e){const t=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--scale-factor))`,this.translate(0,-(s-this.#r)*this.parentScale),this.#r=s,this.#c()},i=this.#r;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#l(e){const t=s=>{this.#e=this.editorDiv.style.color=s},i=this.#e;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-xe._internalPadding*e,-(xe._internalPadding+this.#r)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar($.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const e=this._uiManager.combinedSignal(this.#i);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#n),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#a(){const e=[];this.editorDiv.normalize();let t=null;for(const i of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(e.push(xe.#u(i)),t=i);return e.join(`
`)}#c(){const[e,t]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:s,div:r}=this,o=r.style.display,a=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",s.div.append(this.div),i=r.getBoundingClientRect(),r.remove(),r.style.display=o,r.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/t):(this.width=i.height/e,this.height=i.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#t,t=this.#t=this.#a().trimEnd();if(e===t)return;const i=s=>{if(this.#t=s,!s){this.remove();return}this.#h(),this._uiManager.rebuild(this),this.#c()};this.addCommands({cmd:()=>{i(t)},undo:()=>{i(e)},mustExec:!1}),this.#c()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){xe._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#n),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#r}px * var(--scale-factor))`,i.color=this.#e,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Jr(this,this.div,["dblclick","keydown"]),this.width){const[s,r]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[a,l]=this.getInitialTranslation();[a,l]=this.pageTranslationToScreen(a,l);const[u,d]=this.pageDimensions,[f,p]=this.pageTranslation;let g,m;switch(this.rotation){case 0:g=e+(o[0]-f)/u,m=t+this.height-(o[1]-p)/d;break;case 90:g=e+(o[0]-f)/u,m=t-(o[1]-p)/d,[a,l]=[l,-a];break;case 180:g=e-this.width+(o[0]-f)/u,m=t-(o[1]-p)/d,[a,l]=[-a,-l];break;case 270:g=e+(o[0]-f-this.height*d)/u,m=t+(o[1]-p-this.width*u)/d,[a,l]=[-l,a];break}this.setAt(g*s,m*r,a,l)}else this.setAt(e*s,t*r,this.width*s,this.height*r);this.#h(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#u(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(lr,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:i}=t;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();const s=xe.#f(t.getData("text")||"").replaceAll(lr,`
`);if(!s)return;const r=window.getSelection();if(!r.rangeCount)return;this.editorDiv.normalize(),r.deleteFromDocument();const o=r.getRangeAt(0);if(!s.includes(`
`)){o.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),r.collapseToStart();return}const{startContainer:a,startOffset:l}=o,u=[],d=[];if(a.nodeType===Node.TEXT_NODE){const g=a.parentElement;if(d.push(a.nodeValue.slice(l).replaceAll(lr,"")),g!==this.editorDiv){let m=u;for(const v of this.editorDiv.childNodes){if(v===g){m=d;continue}m.push(xe.#u(v))}}u.push(a.nodeValue.slice(0,l).replaceAll(lr,""))}else if(a===this.editorDiv){let g=u,m=0;for(const v of this.editorDiv.childNodes)m++===l&&(g=d),g.push(xe.#u(v))}this.#t=`${u.join(`
`)}${s}${d.join(`
`)}`,this.#h();const f=new Range;let p=u.reduce((g,m)=>g+m.length,0);for(const{firstChild:g}of this.editorDiv.childNodes)if(g.nodeType===Node.TEXT_NODE){const m=g.nodeValue.length;if(p<=m){f.setStart(g,p),f.setEnd(g,p);break}p-=m}r.removeAllRanges(),r.addRange(f)}#h(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const e of this.#t.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#d(){return this.#t.replaceAll(""," ")}static#f(e){return e.replaceAll(" ","")}get contentDiv(){return this.editorDiv}static async deserialize(e,t,i){let s=null;if(e instanceof Sg){const{data:{defaultAppearanceData:{fontSize:o,fontColor:a},rect:l,rotation:u,id:d,popupRef:f},textContent:p,textPosition:g,parent:{page:{pageNumber:m}}}=e;if(!p||p.length===0)return null;s=e={annotationType:$.FREETEXT,color:Array.from(a),fontSize:o,value:p.join(`
`),position:g,pageIndex:m-1,rect:l.slice(0),rotation:u,id:d,deleted:!1,popupRef:f}}const r=await super.deserialize(e,t,i);return r.#r=e.fontSize,r.#e=H.makeHexColor(...e.color),r.#t=xe.#f(e.value),r.annotationElementId=e.id||null,r._initialData=s,r}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=xe._internalPadding*this.parentScale,i=this.getRect(t,t),s=B._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#e),r={annotationType:$.FREETEXT,color:s,fontSize:this.#r,value:this.#d(),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?r:this.annotationElementId&&!this.#o(r)?null:(r.id=this.annotationElementId,r)}#o(e){const{value:t,fontSize:i,color:s,pageIndex:r}=this._initialData;return this._hasBeenMoved||e.value!==t||e.fontSize!==i||e.color.some((o,a)=>o!==s[a])||e.pageIndex!==r}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(this.deleted)return t;const{style:i}=t;i.fontSize=`calc(${this.#r}px * var(--scale-factor))`,i.color=this.#e,t.replaceChildren();for(const r of this.#t.split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),t.append(o)}const s=xe._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(s,s),popupContent:this.#t}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class F{static PRECISION=1e-4;toSVGPath(){se("Abstract method `toSVGPath` must be implemented.")}get box(){se("Abstract getter `box` must be implemented.")}serialize(e,t){se("Abstract method `serialize` must be implemented.")}static _rescale(e,t,i,s,r,o){o||=new Float32Array(e.length);for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a]*s,o[a+1]=i+e[a+1]*r;return o}static _rescaleAndSwap(e,t,i,s,r,o){o||=new Float32Array(e.length);for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a+1]*s,o[a+1]=i+e[a]*r;return o}static _translate(e,t,i,s){s||=new Float32Array(e.length);for(let r=0,o=e.length;r<o;r+=2)s[r]=t+e[r],s[r+1]=i+e[r+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,i,s,r){switch(r){case 90:return[1-t/i,e/s];case 180:return[1-e/i,1-t/s];case 270:return[t/i,1-e/s];default:return[e/i,t/s]}}static _normalizePagePoint(e,t,i){switch(i){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,i,s,r,o){return[(e+5*i)/6,(t+5*s)/6,(5*i+r)/6,(5*s+o)/6,(i+r)/2,(s+o)/2]}}class Fn{#e;#t=[];#n;#i;#r=[];#s=new Float32Array(18);#l;#a;#c;#u;#h;#d;#f=[];static#o=8;static#p=2;static#m=Fn.#o+Fn.#p;constructor({x:e,y:t},i,s,r,o,a=0){this.#e=i,this.#d=r*s,this.#i=o,this.#s.set([NaN,NaN,NaN,NaN,e,t],6),this.#n=a,this.#u=Fn.#o*s,this.#c=Fn.#m*s,this.#h=s,this.#f.push(e,t)}isEmpty(){return isNaN(this.#s[8])}#g(){const e=this.#s.subarray(4,6),t=this.#s.subarray(16,18),[i,s,r,o]=this.#e;return[(this.#l+(e[0]-t[0])/2-i)/r,(this.#a+(e[1]-t[1])/2-s)/o,(this.#l+(t[0]-e[0])/2-i)/r,(this.#a+(t[1]-e[1])/2-s)/o]}add({x:e,y:t}){this.#l=e,this.#a=t;const[i,s,r,o]=this.#e;let[a,l,u,d]=this.#s.subarray(8,12);const f=e-u,p=t-d,g=Math.hypot(f,p);if(g<this.#c)return!1;const m=g-this.#u,v=m/g,S=v*f,y=v*p;let _=a,A=l;a=u,l=d,u+=S,d+=y,this.#f?.push(e,t);const E=-y/m,w=S/m,C=E*this.#d,T=w*this.#d;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([u+C,d+T],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([u-C,d-T],16),isNaN(this.#s[6])?(this.#r.length===0&&(this.#s.set([a+C,l+T],2),this.#r.push(NaN,NaN,NaN,NaN,(a+C-i)/r,(l+T-s)/o),this.#s.set([a-C,l-T],14),this.#t.push(NaN,NaN,NaN,NaN,(a-C-i)/r,(l-T-s)/o)),this.#s.set([_,A,a,l,u,d],6),!this.isEmpty()):(this.#s.set([_,A,a,l,u,d],6),Math.abs(Math.atan2(A-l,_-a)-Math.atan2(y,S))<Math.PI/2?([a,l,u,d]=this.#s.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((a+u)/2-i)/r,((l+d)/2-s)/o),[a,l,_,A]=this.#s.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((_+a)/2-i)/r,((A+l)/2-s)/o),!0):([_,A,a,l,u,d]=this.#s.subarray(0,6),this.#r.push(((_+5*a)/6-i)/r,((A+5*l)/6-s)/o,((5*a+u)/6-i)/r,((5*l+d)/6-s)/o,((a+u)/2-i)/r,((l+d)/2-s)/o),[u,d,a,l,_,A]=this.#s.subarray(12,18),this.#t.push(((_+5*a)/6-i)/r,((A+5*l)/6-s)/o,((5*a+u)/6-i)/r,((5*l+d)/6-s)/o,((a+u)/2-i)/r,((l+d)/2-s)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#r,t=this.#t;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#y();const i=[];i.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);this.#v(i);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return this.#A(i),i.join(" ")}#y(){const[e,t,i,s]=this.#e,[r,o,a,l]=this.#g();return`M${(this.#s[2]-e)/i} ${(this.#s[3]-t)/s} L${(this.#s[4]-e)/i} ${(this.#s[5]-t)/s} L${r} ${o} L${a} ${l} L${(this.#s[16]-e)/i} ${(this.#s[17]-t)/s} L${(this.#s[14]-e)/i} ${(this.#s[15]-t)/s} Z`}#A(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#v(e){const[t,i,s,r]=this.#e,o=this.#s.subarray(4,6),a=this.#s.subarray(16,18),[l,u,d,f]=this.#g();e.push(`L${(o[0]-t)/s} ${(o[1]-i)/r} L${l} ${u} L${d} ${f} L${(a[0]-t)/s} ${(a[1]-i)/r}`)}newFreeDrawOutline(e,t,i,s,r,o){return new Tg(e,t,i,s,r,o)}getOutlines(){const e=this.#r,t=this.#t,i=this.#s,[s,r,o,a]=this.#e,l=new Float32Array((this.#f?.length??0)+2);for(let f=0,p=l.length-2;f<p;f+=2)l[f]=(this.#f[f]-s)/o,l[f+1]=(this.#f[f+1]-r)/a;if(l[l.length-2]=(this.#l-s)/o,l[l.length-1]=(this.#a-r)/a,isNaN(i[6])&&!this.isEmpty())return this.#S(l);const u=new Float32Array(this.#r.length+24+this.#t.length);let d=e.length;for(let f=0;f<d;f+=2){if(isNaN(e[f])){u[f]=u[f+1]=NaN;continue}u[f]=e[f],u[f+1]=e[f+1]}d=this.#T(u,d);for(let f=t.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(t[f+p])){u[d]=u[d+1]=NaN,d+=2;continue}u[d]=t[f+p],u[d+1]=t[f+p+1],d+=2}return this.#w(u,d),this.newFreeDrawOutline(u,l,this.#e,this.#h,this.#n,this.#i)}#S(e){const t=this.#s,[i,s,r,o]=this.#e,[a,l,u,d]=this.#g(),f=new Float32Array(36);return f.set([NaN,NaN,NaN,NaN,(t[2]-i)/r,(t[3]-s)/o,NaN,NaN,NaN,NaN,(t[4]-i)/r,(t[5]-s)/o,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,(t[16]-i)/r,(t[17]-s)/o,NaN,NaN,NaN,NaN,(t[14]-i)/r,(t[15]-s)/o],0),this.newFreeDrawOutline(f,e,this.#e,this.#h,this.#n,this.#i)}#w(e,t){const i=this.#t;return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+=6}#T(e,t){const i=this.#s.subarray(4,6),s=this.#s.subarray(16,18),[r,o,a,l]=this.#e,[u,d,f,p]=this.#g();return e.set([NaN,NaN,NaN,NaN,(i[0]-r)/a,(i[1]-o)/l,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(s[0]-r)/a,(s[1]-o)/l],t),t+=24}}class Tg extends F{#e;#t=new Float32Array(4);#n;#i;#r;#s;#l;constructor(e,t,i,s,r,o){super(),this.#l=e,this.#r=t,this.#e=i,this.#s=s,this.#n=r,this.#i=o,this.lastPoint=[NaN,NaN],this.#a(o);const[a,l,u,d]=this.#t;for(let f=0,p=e.length;f<p;f+=2)e[f]=(e[f]-a)/u,e[f+1]=(e[f+1]-l)/d;for(let f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-a)/u,t[f+1]=(t[f+1]-l)/d}toSVGPath(){const e=[`M${this.#l[4]} ${this.#l[5]}`];for(let t=6,i=this.#l.length;t<i;t+=6){if(isNaN(this.#l[t])){e.push(`L${this.#l[t+4]} ${this.#l[t+5]}`);continue}e.push(`C${this.#l[t]} ${this.#l[t+1]} ${this.#l[t+2]} ${this.#l[t+3]} ${this.#l[t+4]} ${this.#l[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,i,s],r){const o=i-e,a=s-t;let l,u;switch(r){case 0:l=F._rescale(this.#l,e,s,o,-a),u=F._rescale(this.#r,e,s,o,-a);break;case 90:l=F._rescaleAndSwap(this.#l,e,t,o,a),u=F._rescaleAndSwap(this.#r,e,t,o,a);break;case 180:l=F._rescale(this.#l,i,t,-o,a),u=F._rescale(this.#r,i,t,-o,a);break;case 270:l=F._rescaleAndSwap(this.#l,i,s,-o,-a),u=F._rescaleAndSwap(this.#r,i,s,-o,-a);break}return{outline:Array.from(l),points:[Array.from(u)]}}#a(e){const t=this.#l;let i=t[4],s=t[5],r=i,o=s,a=i,l=s,u=i,d=s;const f=e?Math.max:Math.min;for(let g=6,m=t.length;g<m;g+=6){if(isNaN(t[g]))r=Math.min(r,t[g+4]),o=Math.min(o,t[g+5]),a=Math.max(a,t[g+4]),l=Math.max(l,t[g+5]),d<t[g+5]?(u=t[g+4],d=t[g+5]):d===t[g+5]&&(u=f(u,t[g+4]));else{const v=H.bezierBoundingBox(i,s,...t.slice(g,g+6));r=Math.min(r,v[0]),o=Math.min(o,v[1]),a=Math.max(a,v[2]),l=Math.max(l,v[3]),d<v[3]?(u=v[2],d=v[3]):d===v[3]&&(u=f(u,v[2]))}i=t[g+4],s=t[g+5]}const p=this.#t;p[0]=r-this.#n,p[1]=o-this.#n,p[2]=a-r+2*this.#n,p[3]=l-o+2*this.#n,this.lastPoint=[u,d]}get box(){return this.#t}newOutliner(e,t,i,s,r,o=0){return new Fn(e,t,i,s,r,o)}getNewOutline(e,t){const[i,s,r,o]=this.#t,[a,l,u,d]=this.#e,f=r*u,p=o*d,g=i*u+a,m=s*d+l,v=this.newOutliner({x:this.#r[0]*f+g,y:this.#r[1]*p+m},this.#e,this.#s,e,this.#i,t??this.#n);for(let S=2;S<this.#r.length;S+=2)v.add({x:this.#r[S]*f+g,y:this.#r[S+1]*p+m});return v.getOutlines()}}class cl{#e;#t;#n=[];#i=[];constructor(e,t=0,i=0,s=!0){let r=1/0,o=-1/0,a=1/0,l=-1/0;const u=10**-4;for(const{x:S,y,width:_,height:A}of e){const E=Math.floor((S-t)/u)*u,w=Math.ceil((S+_+t)/u)*u,C=Math.floor((y-t)/u)*u,T=Math.ceil((y+A+t)/u)*u,I=[E,C,T,!0],P=[w,C,T,!1];this.#n.push(I,P),r=Math.min(r,E),o=Math.max(o,w),a=Math.min(a,C),l=Math.max(l,T)}const d=o-r+2*i,f=l-a+2*i,p=r-i,g=a-i,m=this.#n.at(s?-1:-2),v=[m[0],m[2]];for(const S of this.#n){const[y,_,A]=S;S[0]=(y-p)/d,S[1]=(_-g)/f,S[2]=(A-g)/f}this.#e=new Float32Array([p,g,d,f]),this.#t=v}getOutlines(){this.#n.sort((t,i)=>t[0]-i[0]||t[1]-i[1]||t[2]-i[2]);const e=[];for(const t of this.#n)t[3]?(e.push(...this.#c(t)),this.#l(t)):(this.#a(t),e.push(...this.#c(t)));return this.#r(e)}#r(e){const t=[],i=new Set;for(const o of e){const[a,l,u]=o;t.push([a,l,o],[a,u,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){const l=t[o][2],u=t[o+1][2];l.push(u),u.push(l),i.add(l),i.add(u)}const s=[];let r;for(;i.size>0;){const o=i.values().next().value;let[a,l,u,d,f]=o;i.delete(o);let p=a,g=l;for(r=[a,u],s.push(r);;){let m;if(i.has(d))m=d;else if(i.has(f))m=f;else break;i.delete(m),[a,l,u,d,f]=m,p!==a&&(r.push(p,g,a,g===l?l:u),p=a),g=g===l?u:l}r.push(p,g)}return new C_(s,this.#e,this.#t)}#s(e){const t=this.#i;let i=0,s=t.length-1;for(;i<=s;){const r=i+s>>1,o=t[r][0];if(o===e)return r;o<e?i=r+1:s=r-1}return s+1}#l([,e,t]){const i=this.#s(e);this.#i.splice(i,0,[e,t])}#a([,e,t]){const i=this.#s(e);for(let s=i;s<this.#i.length;s++){const[r,o]=this.#i[s];if(r!==e)break;if(r===e&&o===t){this.#i.splice(s,1);return}}for(let s=i-1;s>=0;s--){const[r,o]=this.#i[s];if(r!==e)break;if(r===e&&o===t){this.#i.splice(s,1);return}}}#c(e){const[t,i,s]=e,r=[[t,i,s]],o=this.#s(s);for(let a=0;a<o;a++){const[l,u]=this.#i[a];for(let d=0,f=r.length;d<f;d++){const[,p,g]=r[d];if(!(u<=p||g<=l)){if(p>=l){if(g>u)r[d][1]=u;else{if(f===1)return[];r.splice(d,1),d--,f--}continue}r[d][2]=l,g>u&&r.push([t,u,g])}}}return r}}class C_ extends F{#e;#t;constructor(e,t,i){super(),this.#t=e,this.#e=t,this.lastPoint=i}toSVGPath(){const e=[];for(const t of this.#t){let[i,s]=t;e.push(`M${i} ${s}`);for(let r=2;r<t.length;r+=2){const o=t[r],a=t[r+1];o===i?(e.push(`V${a}`),s=a):a===s&&(e.push(`H${o}`),i=o)}e.push("Z")}return e.join(" ")}serialize([e,t,i,s],r){const o=[],a=i-e,l=s-t;for(const u of this.#t){const d=new Array(u.length);for(let f=0;f<u.length;f+=2)d[f]=e+u[f]*a,d[f+1]=s-u[f+1]*l;o.push(d)}return o}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class dl extends Fn{newFreeDrawOutline(e,t,i,s,r,o){return new T_(e,t,i,s,r,o)}}class T_ extends Tg{newOutliner(e,t,i,s,r,o=0){return new dl(e,t,i,s,r,o)}}class mt{#e=null;#t=null;#n;#i=null;#r=!1;#s=!1;#l=null;#a;#c=null;#u=null;#h;static#d=null;static get _keyboardManager(){return Y(this,"_keyboardManager",new Os([[["Escape","mac+Escape"],mt.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],mt.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],mt.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],mt.prototype._moveToPrevious],[["Home","mac+Home"],mt.prototype._moveToBeginning],[["End","mac+End"],mt.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#s=!1,this.#h=Q.HIGHLIGHT_COLOR,this.#l=e):(this.#s=!0,this.#h=Q.HIGHLIGHT_DEFAULT_COLOR),this.#u=e?._uiManager||t,this.#a=this.#u._eventBus,this.#n=e?.color||this.#u?.highlightColors.values().next().value||"#FFFF98",mt.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=this.#u._signal;e.addEventListener("click",this.#m.bind(this),{signal:t}),e.addEventListener("keydown",this.#p.bind(this),{signal:t});const i=this.#t=document.createElement("span");return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=this.#n,e.append(i),e}renderMainDropdown(){const e=this.#i=this.#f();return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}#f(){const e=document.createElement("div"),t=this.#u._signal;e.addEventListener("contextmenu",bt,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[i,s]of this.#u.highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",s),r.title=i,r.setAttribute("data-l10n-id",mt.#d[i]);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=s,r.setAttribute("aria-selected",s===this.#n),r.addEventListener("click",this.#o.bind(this,s),{signal:t}),e.append(r)}return e.addEventListener("keydown",this.#p.bind(this),{signal:t}),e}#o(e,t){t.stopPropagation(),this.#a.dispatch("switchannotationeditorparams",{source:this,type:this.#h,value:e})}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#m(e);return}const t=e.target.getAttribute("data-color");t&&this.#o(t,e)}_moveToNext(e){if(!this.#y){this.#m(e);return}if(e.target===this.#e){this.#i.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#i?.firstChild||e.target===this.#e){this.#y&&this._hideDropdownFromKeyboard();return}this.#y||this.#m(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#y){this.#m(e);return}this.#i.firstChild?.focus()}_moveToEnd(e){if(!this.#y){this.#m(e);return}this.#i.lastChild?.focus()}#p(e){mt._keyboardManager.exec(this,e)}#m(e){if(this.#y){this.hideDropdown();return}if(this.#r=e.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#g.bind(this),{signal:this.#u.combinedSignal(this.#c)})),this.#i){this.#i.classList.remove("hidden");return}const t=this.#i=this.#f();this.#e.append(t)}#g(e){this.#i?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#i?.classList.add("hidden"),this.#c?.abort(),this.#c=null}get#y(){return this.#i&&!this.#i.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#y){this.#l?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#i)return;const t=this.#u.highlightColors.values();for(const i of this.#i.children)i.setAttribute("aria-selected",t.next().value===e)}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#i?.remove(),this.#i=null}}class ye extends B{#e=null;#t=0;#n;#i=null;#r=null;#s=null;#l=null;#a=0;#c=null;#u=null;#h=null;#d=!1;#f=null;#o;#p=null;#m="";#g;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=$.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=ye.prototype;return Y(this,"_keyboardManager",new Os([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||ye._defaultColor,this.#g=e.thickness||ye._defaultThickness,this.#o=e.opacity||ye._defaultOpacity,this.#n=e.boxes||null,this.#y=e.methodOfCreation||"",this.#m=e.text||"",this._isDraggable=!1,e.highlightId>-1?(this.#d=!0,this.#v(e),this.#R()):this.#n&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#l=e.focusNode,this.#a=e.focusOffset,this.#A(),this.#R(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#g,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#A(){const e=new cl(this.#n,.001);this.#u=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#u.box;const t=new cl(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#s=t.getOutlines();const{lastPoint:i}=this.#s;this.#f=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#v({highlightOutlines:e,highlightId:t,clipPathId:i}){this.#u=e;const s=1.5;if(this.#s=e.getNewOutline(this.#g/2+s,.0025),t>=0)this.#h=t,this.#i=i,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},!0);else if(this.parent){const d=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#h,{bbox:ye.#E(this.#u.box,(d-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:ye.#E(this.#s.box,d),path:{d:this.#s.toSVGPath()}})}const[r,o,a,l]=e.box;switch(this.rotation){case 0:this.x=r,this.y=o,this.width=a,this.height=l;break;case 90:{const[d,f]=this.parentDimensions;this.x=o,this.y=1-r,this.width=a*f/d,this.height=l*d/f;break}case 180:this.x=1-r,this.y=1-o,this.width=a,this.height=l;break;case 270:{const[d,f]=this.parentDimensions;this.x=1-o,this.y=r,this.width=a*f/d,this.height=l*d/f;break}}const{lastPoint:u}=this.#s;this.#f=[(u[0]-r)/a,(u[1]-o)/l]}static initialize(e,t){B.initialize(e,t),ye._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case Q.HIGHLIGHT_DEFAULT_COLOR:ye._defaultColor=t;break;case Q.HIGHLIGHT_THICKNESS:ye._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#f}updateParams(e,t){switch(e){case Q.HIGHLIGHT_COLOR:this.#S(t);break;case Q.HIGHLIGHT_THICKNESS:this.#w(t);break}}static get defaultPropertiesToUpdate(){return[[Q.HIGHLIGHT_DEFAULT_COLOR,ye._defaultColor],[Q.HIGHLIGHT_THICKNESS,ye._defaultThickness]]}get propertiesToUpdate(){return[[Q.HIGHLIGHT_COLOR,this.color||ye._defaultColor],[Q.HIGHLIGHT_THICKNESS,this.#g||ye._defaultThickness],[Q.HIGHLIGHT_FREE,this.#d]]}#S(e){const t=(r,o)=>{this.color=r,this.#o=o,this.parent?.drawLayer.updateProperties(this.#h,{root:{fill:r,"fill-opacity":o}}),this.#r?.updateColor(r)},i=this.color,s=this.#o;this.addCommands({cmd:t.bind(this,e,ye._defaultOpacity),undo:t.bind(this,i,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}#w(e){const t=this.#g,i=s=>{this.#g=s,this.#T(s)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Q.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(this.#r=new mt({editor:this}),e.addColorPicker(this.#r)),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#k())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#k())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#I(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#R(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#I():e&&(this.#R(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#T(e){if(!this.#d)return;this.#v({highlightOutlines:this.#u.getNewOutline(e/2)}),this.fixAndSetPosition();const[t,i]=this.parentDimensions;this.setDims(this.width*t,this.height*i)}#I(){this.#h===null||!this.parent||(this.parent.drawLayer.remove(this.#h),this.#h=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#R(e=this.parent){this.#h===null&&({id:this.#h,clipPathId:this.#i}=e.drawLayer.draw({bbox:this.#u.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#o},rootClass:{highlight:!0,free:this.#d},path:{d:this.#u.toSVGPath()}},!1,!0),this.#p=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},this.#d),this.#c&&(this.#c.style.clipPath=this.#i))}static#E([e,t,i,s],r){switch(r){case 90:return[1-t-s,e,s,i];case 180:return[1-e-i,1-t-s,i,s];case 270:return[t,1-e-i,s,i]}return[e,t,i,s]}rotate(e){const{drawLayer:t}=this.parent;let i;this.#d?(e=(e-this.rotation+360)%360,i=ye.#E(this.#u.box,e)):i=ye.#E([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#h,{bbox:i,root:{"data-main-rotation":e}}),t.updateProperties(this.#p,{bbox:ye.#E(this.#s.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#m&&(e.setAttribute("aria-label",this.#m),e.setAttribute("role","mark")),this.#d?e.classList.add("free"):this.div.addEventListener("keydown",this.#P.bind(this),{signal:this._uiManager._signal});const t=this.#c=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#i;const[i,s]=this.parentDimensions;return this.setDims(this.width*i,this.height*s),Jr(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#P(e){ye._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#x(!0);break;case 1:case 3:this.#x(!1);break}}#x(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#l,this.#a)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#d||this.#x(!1))}get _mustFixPosition(){return!this.#d}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#h,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!e}}))}#k(){return this.#d?this.rotation:0}#L(){if(this.#d)return null;const[e,t]=this.pageDimensions,[i,s]=this.pageTranslation,r=this.#n,o=new Float32Array(r.length*8);let a=0;for(const{x:l,y:u,width:d,height:f}of r){const p=l*e+i,g=(1-u)*t+s;o[a]=o[a+4]=p,o[a+1]=o[a+3]=g,o[a+2]=o[a+6]=p+d*e,o[a+5]=o[a+7]=g-f*t,a+=8}return o}#F(e){return this.#u.serialize(e,this.#k())}static startHighlighting(e,t,{target:i,x:s,y:r}){const{x:o,y:a,width:l,height:u}=i.getBoundingClientRect(),d=new AbortController,f=e.combinedSignal(d),p=g=>{d.abort(),this.#_(e,g)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",ut,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",bt,{signal:f}),i.addEventListener("pointermove",this.#C.bind(this,e),{signal:f}),this._freeHighlight=new dl({x:s,y:r},[o,a,l,u],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#C(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#_(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,i){let s=null;if(e instanceof wg){const{data:{quadPoints:m,rect:v,rotation:S,id:y,color:_,opacity:A,popupRef:E},parent:{page:{pageNumber:w}}}=e;s=e={annotationType:$.HIGHLIGHT,color:Array.from(_),opacity:A,quadPoints:m,boxes:null,pageIndex:w-1,rect:v.slice(0),rotation:S,id:y,deleted:!1,popupRef:E}}else if(e instanceof Iu){const{data:{inkLists:m,rect:v,rotation:S,id:y,color:_,borderStyle:{rawWidth:A},popupRef:E},parent:{page:{pageNumber:w}}}=e;s=e={annotationType:$.HIGHLIGHT,color:Array.from(_),thickness:A,inkLists:m,boxes:null,pageIndex:w-1,rect:v.slice(0),rotation:S,id:y,deleted:!1,popupRef:E}}const{color:r,quadPoints:o,inkLists:a,opacity:l}=e,u=await super.deserialize(e,t,i);u.color=H.makeHexColor(...r),u.#o=l||1,a&&(u.#g=e.thickness),u.annotationElementId=e.id||null,u._initialData=s;const[d,f]=u.pageDimensions,[p,g]=u.pageTranslation;if(o){const m=u.#n=[];for(let v=0;v<o.length;v+=8)m.push({x:(o[v]-p)/d,y:1-(o[v+1]-g)/f,width:(o[v+2]-o[v])/d,height:(o[v+1]-o[v+5])/f});u.#A(),u.#R(),u.rotate(u.rotation)}else if(a){u.#d=!0;const m=a[0],v={x:m[0]-p,y:f-(m[1]-g)},S=new dl(v,[0,0,d,f],1,u.#g/2,!0,.001);for(let A=0,E=m.length;A<E;A+=2)v.x=m[A]-p,v.y=f-(m[A+1]-g),S.add(v);const{id:y,clipPathId:_}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:S.toSVGPath()}},!0,!0);u.#v({highlightOutlines:S.getOutlines(),highlightId:y,clipPathId:_}),u.#R()}return u}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=this.getRect(0,0),i=B._colorManager.convert(this.color),s={annotationType:$.HIGHLIGHT,color:i,opacity:this.#o,thickness:this.#g,quadPoints:this.#L(),outlines:this.#F(t),pageIndex:this.pageIndex,rect:t,rotation:this.#k(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#N(s)?null:(s.id=this.annotationElementId,s)}#N(e){const{color:t}=this._initialData;return e.color.some((i,s)=>i!==t[s])}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class x_{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,i]of Object.entries(e))this.updateProperty(t,i)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){se("Not implemented")}}class G extends B{#e=null;#t;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#i=null;static#r=null;static#s=NaN;static#l=null;static#a=null;static#c=NaN;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,e.drawOutlines&&(this.#u(e),this.#f())}#u({drawOutlines:e,drawId:t,drawingOptions:i}){this.#e=e,this._drawingOptions||=i,t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#h(e,this.parent),this.#m(e.box)}#h(e,t){const{id:i}=t.drawLayer.draw(G._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return i}static _mergeSVGProperties(e,t){const i=new Set(Object.keys(e));for(const[s,r]of Object.entries(t))i.has(s)?Object.assign(e[s],r):e[s]=r;return e}static getDefaultDrawingOptions(e){se("Not implemented")}static get typesMap(){se("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const i=this.typesMap.get(e);i&&this._defaultDrawingOptions.updateProperty(i,t),this._currentParent&&(G.#n.updateProperty(i,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const i=this.constructor.typesMap.get(e);i&&this._updateProperty(e,i,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[i,s]of this.typesMap)e.push([i,t[s]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[i,s]of this.constructor.typesMap)e.push([i,t[s]]);return e}_updateProperty(e,t,i){const s=this._drawingOptions,r=s[t],o=a=>{s.updateProperty(t,a);const l=this.#e.updateProperty(t,a);l&&this.#m(l),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties())};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,G._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#p()),{bbox:this.#g()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,G._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#p()),{bbox:this.#g()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#g(e,t)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,G._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#g()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#d(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#m(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#d()):e&&(this._uiManager.addShouldRescale(this),this.#f(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#d(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#h(this.#e,e)}}#o([e,t,i,s]){const{parentDimensions:[r,o],rotation:a}=this;switch(a){case 90:return[t,1-e,i*(o/r),s*(r/o)];case 180:return[1-e,1-t,i,s];case 270:return[1-t,e,i*(o/r),s*(r/o)];default:return[e,t,i,s]}}#p(){const{x:e,y:t,width:i,height:s,parentDimensions:[r,o],rotation:a}=this;switch(a){case 90:return[1-t,e,i*(r/o),s*(o/r)];case 180:return[1-e,1-t,i,s];case 270:return[t,1-e,i*(r/o),s*(o/r)];default:return[e,t,i,s]}}#m(e){if([this.x,this.y,this.width,this.height]=this.#o(e),this.div){this.fixAndSetPosition();const[t,i]=this.parentDimensions;this.setDims(this.width*t,this.height*i)}this._onResized()}#g(){const{x:e,y:t,width:i,height:s,rotation:r,parentRotation:o,parentDimensions:[a,l]}=this;switch((r*4+o)/90){case 1:return[1-t-s,e,s,i];case 2:return[1-e-i,1-t-s,i,s];case 3:return[t,1-e-i,s,i];case 4:return[e,t-i*(a/l),s*(l/a),i*(a/l)];case 5:return[1-t,e,i*(a/l),s*(l/a)];case 6:return[1-e-s*(l/a),1-t,s*(l/a),i*(a/l)];case 7:return[t-i*(a/l),1-e-s*(l/a),i*(a/l),s*(l/a)];case 8:return[e-i,t-s,i,s];case 9:return[1-t,e-i,s,i];case 10:return[1-e,1-t,i,s];case 11:return[t-s,1-e,s,i];case 12:return[e-s*(l/a),t,s*(l/a),i*(a/l)];case 13:return[1-t-i*(a/l),e-s*(l/a),i*(a/l),s*(l/a)];case 14:return[1-e,1-t-i*(a/l),s*(l/a),i*(a/l)];case 15:return[t,1-e,i*(a/l),s*(l/a)];default:return[e,t,i,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,G._mergeSVGProperties({bbox:this.#g()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#m(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const e=super.render();e.classList.add("draw");const t=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal";const[i,s]=this.parentDimensions;return this.setDims(this.width*i,this.height*s),this._uiManager.addShouldRescale(this),this.disableEditing(),e}static createDrawerInstance(e,t,i,s,r){se("Not implemented")}static startDrawing(e,t,i,s){const{target:r,offsetX:o,offsetY:a,pointerId:l,pointerType:u}=s;if(G.#l&&G.#l!==u)return;const{viewport:{rotation:d}}=e,{width:f,height:p}=r.getBoundingClientRect(),g=G.#i=new AbortController,m=e.combinedSignal(g);if(G.#s||=l,G.#l??=u,window.addEventListener("pointerup",v=>{G.#s===v.pointerId?this._endDraw(v):G.#a?.delete(v.pointerId)},{signal:m}),window.addEventListener("pointercancel",v=>{G.#s===v.pointerId?this._currentParent.endDrawingSession():G.#a?.delete(v.pointerId)},{signal:m}),window.addEventListener("pointerdown",v=>{G.#l===v.pointerType&&((G.#a||=new Set).add(v.pointerId),G.#n.isCancellable()&&(G.#n.removeLastElement(),G.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",bt,{signal:m}),r.addEventListener("pointermove",this._drawMove.bind(this),{signal:m}),r.addEventListener("touchmove",v=>{v.timeStamp===G.#c&&ut(v)},{signal:m}),e.toggleDrawing(),t._editorUndoBar?.hide(),G.#n){e.drawLayer.updateProperties(this._currentDrawId,G.#n.startNew(o,a,f,p,d));return}t.updateUIForDefaultProperties(this),G.#n=this.createDrawerInstance(o,a,f,p,d),G.#r=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(G.#r.toSVGProperties(),G.#n.defaultSVGProperties),!0,!1)}static _drawMove(e){if(G.#c=-1,!G.#n)return;const{offsetX:t,offsetY:i,pointerId:s}=e;if(G.#s===s){if(G.#a?.size>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,G.#n.add(t,i)),G.#c=e.timeStamp,ut(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,G.#n=null,G.#r=null,G.#l=null,G.#c=NaN),G.#i&&(G.#i.abort(),G.#i=null,G.#s=NaN,G.#a=null)}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e&&t.drawLayer.updateProperties(this._currentDrawId,G.#n.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const i=G.#n,s=this._currentDrawId,r=i.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(s,i.setLastElement(r))},undo:()=>{t.drawLayer.updateProperties(s,i.removeLastElement())},mustExec:!1,type:Q.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(Q.DRAW_STEP),!G.#n.isEmpty()){const{pageDimensions:[i,s],scale:r}=t,o=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:G.#n.getOutlines(i*r,s*r,r,this._INNER_MARGIN),drawingOptions:G.#r,mustBeCommitted:!e});return this._cleanup(!0),o}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,i,s,r,o){se("Not implemented")}static async deserialize(e,t,i){const{rawDims:{pageWidth:s,pageHeight:r,pageX:o,pageY:a}}=t.viewport,l=this.deserializeDraw(o,a,s,r,this._INNER_MARGIN,e),u=await super.deserialize(e,t,i);return u.createDrawingOptions(e),u.#u({drawOutlines:l}),u.#f(),u.onScaleChanging(),u.rotate(),u}serializeDraw(e){const[t,i]=this.pageTranslation,[s,r]=this.pageDimensions;return this.#e.serialize([t,i,s,r],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class I_{#e=new Float64Array(6);#t;#n;#i;#r;#s;#l="";#a=0;#c=new xo;#u;#h;constructor(e,t,i,s,r,o){this.#u=i,this.#h=s,this.#i=r,this.#r=o,[e,t]=this.#d(e,t);const a=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t],this.#n=[{line:a,points:this.#s}],this.#e.set(a,0)}updateProperty(e,t){e==="stroke-width"&&(this.#r=t)}#d(e,t){return F._normalizePoint(e,t,this.#u,this.#h,this.#i)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#s.length<=10}add(e,t){[e,t]=this.#d(e,t);const[i,s,r,o]=this.#e.subarray(2,6),a=e-r,l=t-o;return Math.hypot(this.#u*a,this.#h*l)<=2?null:(this.#s.push(e,t),isNaN(i)?(this.#e.set([r,o,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([i,s,r,o,e,t],0),this.#t.push(...F.createBezierPoints(i,s,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const i=this.add(e,t);return i||(this.#s.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,i,s,r){this.#u=i,this.#h=s,this.#i=r,[e,t]=this.#d(e,t);const o=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t];const a=this.#n.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#n.push({line:o,points:this.#s}),this.#e.set(o,0),this.#a=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(e){return this.#n?(this.#n.push(e),this.#t=e.line,this.#s=e.points,this.#a=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(e)}removeLastElement(){if(!this.#n)return this.#c.removeLastElement();this.#n.pop(),this.#l="";for(let e=0,t=this.#n.length;e<t;e++){const{line:i,points:s}=this.#n[e];this.#t=i,this.#s=s,this.#a=0,this.toSVGPath()}return{path:{d:this.#l}}}toSVGPath(){const e=F.svgRound(this.#t[4]),t=F.svgRound(this.#t[5]);if(this.#s.length===2)return this.#l=`${this.#l} M ${e} ${t} Z`,this.#l;if(this.#s.length<=6){const s=this.#l.lastIndexOf("M");this.#l=`${this.#l.slice(0,s)} M ${e} ${t}`,this.#a=6}if(this.#s.length===4){const s=F.svgRound(this.#t[10]),r=F.svgRound(this.#t[11]);return this.#l=`${this.#l} L ${s} ${r}`,this.#a=12,this.#l}const i=[];this.#a===0&&(i.push(`M ${e} ${t}`),this.#a=6);for(let s=this.#a,r=this.#t.length;s<r;s+=6){const[o,a,l,u,d,f]=this.#t.slice(s,s+6).map(F.svgRound);i.push(`C${o} ${a} ${l} ${u} ${d} ${f}`)}return this.#l+=i.join(" "),this.#a=this.#t.length,this.#l}getOutlines(e,t,i,s){const r=this.#n.at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),this.#c.build(this.#n,e,t,i,this.#i,this.#r,s),this.#e=null,this.#t=null,this.#n=null,this.#l=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class xo extends F{#e;#t=0;#n;#i;#r;#s;#l;#a;#c;build(e,t,i,s,r,o,a){this.#r=t,this.#s=i,this.#l=s,this.#a=r,this.#c=o,this.#n=a??0,this.#i=e,this.#d()}setLastElement(e){return this.#i.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#i.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#i){if(e.push(`M${F.svgRound(t[4])} ${F.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12){e.push(`L${F.svgRound(t[10])} ${F.svgRound(t[11])}`);continue}for(let i=6,s=t.length;i<s;i+=6){const[r,o,a,l,u,d]=t.subarray(i,i+6).map(F.svgRound);e.push(`C${r} ${o} ${a} ${l} ${u} ${d}`)}}return e.join("")}serialize([e,t,i,s],r){const o=[],a=[],[l,u,d,f]=this.#h();let p,g,m,v,S,y,_,A,E;switch(this.#a){case 0:E=F._rescale,p=e,g=t+s,m=i,v=-s,S=e+l*i,y=t+(1-u-f)*s,_=e+(l+d)*i,A=t+(1-u)*s;break;case 90:E=F._rescaleAndSwap,p=e,g=t,m=i,v=s,S=e+u*i,y=t+l*s,_=e+(u+f)*i,A=t+(l+d)*s;break;case 180:E=F._rescale,p=e+i,g=t,m=-i,v=s,S=e+(1-l-d)*i,y=t+u*s,_=e+(1-l)*i,A=t+(u+f)*s;break;case 270:E=F._rescaleAndSwap,p=e+i,g=t+s,m=-i,v=-s,S=e+(1-u-f)*i,y=t+(1-l-d)*s,_=e+(1-u)*i,A=t+(1-l)*s;break}for(const{line:w,points:C}of this.#i)o.push(E(w,p,g,m,v,r?new Array(w.length):null)),a.push(E(C,p,g,m,v,r?new Array(C.length):null));return{lines:o,points:a,rect:[S,y,_,A]}}static deserialize(e,t,i,s,r,{paths:{lines:o,points:a},rotation:l,thickness:u}){const d=[];let f,p,g,m,v;switch(l){case 0:v=F._rescale,f=-e/i,p=t/s+1,g=1/i,m=-1/s;break;case 90:v=F._rescaleAndSwap,f=-t/s,p=-e/i,g=1/s,m=1/i;break;case 180:v=F._rescale,f=e/i+1,p=-t/s,g=-1/i,m=1/s;break;case 270:v=F._rescaleAndSwap,f=t/s+1,p=e/i+1,g=-1/s,m=-1/i;break}if(!o){o=[];for(const y of a){const _=y.length;if(_===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1]]));continue}if(_===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1],NaN,NaN,NaN,NaN,y[2],y[3]]));continue}const A=new Float32Array(3*(_-2));o.push(A);let[E,w,C,T]=y.subarray(0,4);A.set([NaN,NaN,NaN,NaN,E,w],0);for(let I=4;I<_;I+=2){const P=y[I],R=y[I+1];A.set(F.createBezierPoints(E,w,C,T,P,R),(I-2)*3),[E,w,C,T]=[C,T,P,R]}}}for(let y=0,_=o.length;y<_;y++)d.push({line:v(o[y].map(A=>A??NaN),f,p,g,m),points:v(a[y].map(A=>A??NaN),f,p,g,m)});const S=new xo;return S.build(d,i,s,1,l,u,r),S}#u(e=this.#c){const t=this.#n+e/2*this.#l;return this.#a%180===0?[t/this.#r,t/this.#s]:[t/this.#s,t/this.#r]}#h(){const[e,t,i,s]=this.#e,[r,o]=this.#u(0);return[e+r,t+o,i-2*r,s-2*o]}#d(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:s}of this.#i){if(s.length<=12){for(let a=4,l=s.length;a<l;a+=6){const[u,d]=s.subarray(a,a+2);e[0]=Math.min(e[0],u),e[1]=Math.min(e[1],d),e[2]=Math.max(e[2],u),e[3]=Math.max(e[3],d)}continue}let r=s[4],o=s[5];for(let a=6,l=s.length;a<l;a+=6){const[u,d,f,p,g,m]=s.subarray(a,a+6);H.bezierBoundingBox(r,o,u,d,f,p,g,m,e),r=g,o=m}}const[t,i]=this.#u();e[0]=Math.min(1,Math.max(0,e[0]-t)),e[1]=Math.min(1,Math.max(0,e[1]-i)),e[2]=Math.min(1,Math.max(0,e[2]+t)),e[3]=Math.min(1,Math.max(0,e[3]+i)),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){const[t,i]=this.#u();this.#c=e;const[s,r]=this.#u(),[o,a]=[s-t,r-i],l=this.#e;return l[0]-=o,l[1]-=a,l[2]+=2*o,l[3]+=2*a,l}updateParentDimensions([e,t],i){const[s,r]=this.#u();this.#r=e,this.#s=t,this.#l=i;const[o,a]=this.#u(),l=o-s,u=a-r,d=this.#e;return d[0]-=l,d[1]-=u,d[2]+=2*l,d[3]+=2*u,d}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(F.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${F.svgRound(e)} ${F.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let i=0,s=0,r=0,o=0,a=0,l=0;switch(this.#t){case 90:s=t/e,r=-e/t,a=e;break;case 180:i=-1,o=-1,a=e,l=t;break;case 270:s=-t/e,r=e/t,l=t;break;default:return""}return`matrix(${i} ${s} ${r} ${o} ${F.svgRound(a)} ${F.svgRound(l)})`}getPathResizingSVGProperties([e,t,i,s]){const[r,o]=this.#u(),[a,l,u,d]=this.#e;if(Math.abs(u-r)<=F.PRECISION||Math.abs(d-o)<=F.PRECISION){const v=e+i/2-(a+u/2),S=t+s/2-(l+d/2);return{path:{"transform-origin":`${F.svgRound(e)} ${F.svgRound(t)}`,transform:`${this.rotationTransform} translate(${v} ${S})`}}}const f=(i-2*r)/(u-2*r),p=(s-2*o)/(d-2*o),g=u/i,m=d/s;return{path:{"transform-origin":`${F.svgRound(a)} ${F.svgRound(l)}`,transform:`${this.rotationTransform} scale(${g} ${m}) translate(${F.svgRound(r)} ${F.svgRound(o)}) scale(${f} ${p}) translate(${F.svgRound(-r)} ${F.svgRound(-o)})`}}}getPathResizedSVGProperties([e,t,i,s]){const[r,o]=this.#u(),a=this.#e,[l,u,d,f]=a;if(a[0]=e,a[1]=t,a[2]=i,a[3]=s,Math.abs(d-r)<=F.PRECISION||Math.abs(f-o)<=F.PRECISION){const S=e+i/2-(l+d/2),y=t+s/2-(u+f/2);for(const{line:_,points:A}of this.#i)F._translate(_,S,y,_),F._translate(A,S,y,A);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${F.svgRound(e)} ${F.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(i-2*r)/(d-2*r),g=(s-2*o)/(f-2*o),m=-p*(l+r)+e+r,v=-g*(u+o)+t+o;if(p!==1||g!==1||m!==0||v!==0)for(const{line:S,points:y}of this.#i)F._rescale(S,m,v,p,g,S),F._rescale(y,m,v,p,g,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${F.svgRound(e)} ${F.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],i){const[s,r]=i,o=this.#e,a=e-o[0],l=t-o[1];if(this.#r===s&&this.#s===r)for(const{line:u,points:d}of this.#i)F._translate(u,a,l,u),F._translate(d,a,l,d);else{const u=this.#r/s,d=this.#s/r;this.#r=s,this.#s=r;for(const{line:f,points:p}of this.#i)F._rescale(f,a,l,u,d,f),F._rescale(p,a,l,u,d,p);o[2]*=u,o[3]*=d}return o[0]=e,o[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${F.svgRound(e)} ${F.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${F.svgRound(e[0])} ${F.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class Pu extends x_{#e;constructor(e){super(),this.#e=e,super.updateProperties({fill:"none",stroke:B._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this.#e.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Pu(this.#e);return e.updateAll(this),e}}class Ru extends G{static _type="ink";static _editorType=$.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0}static initialize(e,t){B.initialize(e,t),this._defaultDrawingOptions=new Pu(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return Y(this,"typesMap",new Map([[Q.INK_THICKNESS,"stroke-width"],[Q.INK_COLOR,"stroke"],[Q.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,i,s,r){return new I_(e,t,i,s,r,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,i,s,r,o){return xo.deserialize(e,t,i,s,r,o)}static async deserialize(e,t,i){let s=null;if(e instanceof Iu){const{data:{inkLists:o,rect:a,rotation:l,id:u,color:d,opacity:f,borderStyle:{rawWidth:p},popupRef:g},parent:{page:{pageNumber:m}}}=e;s=e={annotationType:$.INK,color:Array.from(d),thickness:p,opacity:f,paths:{points:o},boxes:null,pageIndex:m-1,rect:a.slice(0),rotation:l,id:u,deleted:!1,popupRef:g}}const r=await super.deserialize(e,t,i);return r.annotationElementId=e.id||null,r._initialData=s,r}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:i}=this;t.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:i}){this._drawingOptions=Ru.getDefaultDrawingOptions({stroke:H.makeHexColor(...e),"stroke-width":t,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:i,rect:s}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":a}}=this,l={annotationType:$.INK,color:B._colorManager.convert(r),opacity:o,thickness:a,paths:{lines:t,points:i},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?l:this.annotationElementId&&!this.#e(l)?null:(l.id=this.annotationElementId,l)}#e(e){const{color:t,thickness:i,opacity:s,pageIndex:r}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((o,a)=>o!==t[a])||e.thickness!==i||e.opacity!==s||e.pageIndex!==r}renderAnnotationElement(e){const{points:t,rect:i}=this.serializeDraw(!1);return e.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:t}),null}}class Mu extends B{#e=null;#t=null;#n=null;#i=null;#r=null;#s="";#l=null;#a=null;#c=!1;#u=!1;static _type="stamp";static _editorType=$.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#i=e.bitmapUrl,this.#r=e.bitmapFile}static initialize(e,t){B.initialize(e,t)}static get supportedTypes(){return Y(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(t=>`image/${t}`))}static get supportedTypesStr(){return Y(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,t){t.pasteEditor($.STAMP,{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#h(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#c=e.isSvg),e.file&&(this.#s=e.file.name),this.#o()}#d(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#l){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:r,height:o}=e||this.copyCanvas(null,null,!0).imageData,a=await i.guess({name:"altText",request:{data:s,width:r,height:o,channels:s.length/(r*o)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const l=a.output;return await this.setGuessedAltText(l),t&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#f(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(i=>this.#h(i,!0)).finally(()=>this.#d());return}if(this.#i){const i=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(i).then(s=>this.#h(s)).finally(()=>this.#d());return}if(this.#r){const i=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(i).then(s=>this.#h(s)).finally(()=>this.#d());return}const e=document.createElement("input");e.type="file",e.accept=Mu.supportedTypesStr;const t=this._uiManager._signal;this.#n=new Promise(i=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#h(s)}i()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:t})}).finally(()=>this.#d()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#l?.remove(),this.#l=null,this.#a&&(clearTimeout(this.#a),this.#a=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#f();return}super.rebuild(),this.div!==null&&(this.#t&&this.#l===null&&this.#f(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#n||this.#e||this.#i||this.#r||this.#t)}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;if(this.width&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#e?this.#o():this.#f(),this.width&&!this.annotationElementId){const[i,s]=this.parentDimensions;this.setAt(e*i,t*s,this.width*i,this.height*s)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#a!==null&&clearTimeout(this.#a);const e=200;this.#a=setTimeout(()=>{this.#a=null,this.#m()},e)}#o(){const{div:e}=this;let{width:t,height:i}=this.#e;const[s,r]=this.pageDimensions,o=.75;if(this.width)t=this.width*s,i=this.height*r;else if(t>o*s||i>o*r){const d=Math.min(o*s/t,o*r/i);t*=d,i*=d}const[a,l]=this.parentDimensions;this.setDims(t*a/s,i*l/r),this._uiManager.enableWaiting(!1);const u=this.#l=document.createElement("canvas");u.setAttribute("role","img"),this.addContainer(u),this.width=t/s,this.height=i/r,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#m(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&u.setAttribute("aria-label",this.#s)}copyCanvas(e,t,i=!1){e||(e=224);const{width:s,height:r}=this.#e,o=new ol;let a=this.#e,l=s,u=r,d=null;if(t){if(s>t||r>t){const C=Math.min(t/s,t/r);l=Math.floor(s*C),u=Math.floor(r*C)}d=document.createElement("canvas");const p=d.width=Math.ceil(l*o.sx),g=d.height=Math.ceil(u*o.sy);this.#c||(a=this.#p(p,g));const m=d.getContext("2d");m.filter=this._uiManager.hcmFilter;let v="white",S="#cfcfd8";this._uiManager.hcmFilter!=="none"?S="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(v="#8f8f9d",S="#42414d");const y=15,_=y*o.sx,A=y*o.sy,E=new OffscreenCanvas(_*2,A*2),w=E.getContext("2d");w.fillStyle=v,w.fillRect(0,0,_*2,A*2),w.fillStyle=S,w.fillRect(0,0,_,A),w.fillRect(_,A,_,A),m.fillStyle=m.createPattern(E,"repeat"),m.fillRect(0,0,p,g),m.drawImage(a,0,0,a.width,a.height,0,0,p,g)}let f=null;if(i){let p,g;if(o.symmetric&&a.width<e&&a.height<e)p=a.width,g=a.height;else if(a=this.#e,s>e||r>e){const S=Math.min(e/s,e/r);p=Math.floor(s*S),g=Math.floor(r*S),this.#c||(a=this.#p(p,g))}const v=new OffscreenCanvas(p,g).getContext("2d",{willReadFrequently:!0});v.drawImage(a,0,0,a.width,a.height,0,0,p,g),f={width:p,height:g,data:v.getImageData(0,0,p,g).data}}return{canvas:d,width:l,height:u,imageData:f}}#p(e,t){const{width:i,height:s}=this.#e;let r=i,o=s,a=this.#e;for(;r>2*e||o>2*t;){const l=r,u=o;r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2)),o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const d=new OffscreenCanvas(r,o);d.getContext("2d").drawImage(a,0,0,l,u,0,0,r,o),a=d.transferToImageBitmap()}return a}#m(){const[e,t]=this.parentDimensions,{width:i,height:s}=this,r=new ol,o=Math.ceil(i*e*r.sx),a=Math.ceil(s*t*r.sy),l=this.#l;if(!l||l.width===o&&l.height===a)return;l.width=o,l.height=a;const u=this.#c?this.#e:this.#p(o,a),d=l.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(u,0,0,u.width,u.height,0,0,o,a)}getImageForAltText(){return this.#l}#g(e){if(e){if(this.#c){const s=this._uiManager.imageManager.getSvgUrl(this.#t);if(s)return s}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#c){const[t,i]=this.pageDimensions,s=Math.round(this.width*t*Mi.PDF_TO_CSS_UNITS),r=Math.round(this.height*i*Mi.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(s,r);return o.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,s,r),o.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,i){let s=null;if(e instanceof Cg){const{data:{rect:m,rotation:v,id:S,structParent:y,popupRef:_},container:A,parent:{page:{pageNumber:E}}}=e,w=A.querySelector("canvas"),C=i.imageManager.getFromCanvas(A.id,w);w.remove();const T=(await t._structTree.getAriaAttributes(`${mu}${S}`))?.get("aria-label")||"";s=e={annotationType:$.STAMP,bitmapId:C.id,bitmap:C.bitmap,pageIndex:E-1,rect:m.slice(0),rotation:v,id:S,deleted:!1,accessibilityData:{decorative:!1,altText:T},isSvg:!1,structParent:y,popupRef:_}}const r=await super.deserialize(e,t,i),{rect:o,bitmap:a,bitmapUrl:l,bitmapId:u,isSvg:d,accessibilityData:f}=e;u&&i.imageManager.isValidId(u)?(r.#t=u,a&&(r.#e=a)):r.#i=l,r.#c=d;const[p,g]=r.pageDimensions;return r.width=(o[2]-o[0])/p,r.height=(o[3]-o[1])/g,r.annotationElementId=e.id||null,f&&(r.altTextData=f),r._initialData=s,r.#u=!!s,r}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:$.STAMP,bitmapId:this.#t,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(e)return i.bitmapUrl=this.#g(!0),i.accessibilityData=this.serializeAltText(!0),i;const{decorative:s,altText:r}=this.serializeAltText(!1);if(!s&&r&&(i.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){const a=this.#y(i);if(a.isSame)return null;a.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,t===null)return i;t.stamps||=new Map;const o=this.#c?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:o,serialized:i}),i.bitmap=this.#g(!1);else if(this.#c){const a=t.stamps.get(this.#t);o>a.area&&(a.area=o,a.serialized.bitmap.close(),a.serialized.bitmap=this.#g(!1))}return i}#y(e){const{pageIndex:t,accessibilityData:{altText:i}}=this._initialData,s=e.pageIndex===t,r=(e.accessibilityData?.alt||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&s&&r,isSameAltText:r}}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}class $t{#e;#t=!1;#n=null;#i=null;#r=null;#s=new Map;#l=!1;#a=!1;#c=!1;#u=null;#h=null;#d=null;#f=null;#o;static _initialized=!1;static#p=new Map([xe,Ru,Mu,ye].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:i,structTreeLayer:s,accessibilityManager:r,annotationLayer:o,drawLayer:a,textLayer:l,viewport:u,l10n:d}){const f=[...$t.#p.values()];if(!$t._initialized){$t._initialized=!0;for(const p of f)p.initialize(d,e)}e.registerEditorTypes(f),this.#o=e,this.pageIndex=t,this.div=i,this.#e=r,this.#n=o,this.viewport=u,this.#d=l,this.drawLayer=a,this._structTree=s,this.#o.addLayer(this)}get isEmpty(){return this.#s.size===0}get isInvisible(){return this.isEmpty&&this.#o.getMode()===$.NONE}updateToolbar(e){this.#o.updateToolbar(e)}updateMode(e=this.#o.getMode()){switch(this.#v(),e){case $.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case $.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case $.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const i of $t.#p.values())t.toggle(`${i._type}Editing`,e===i._editorType);this.div.hidden=!1}hasTextLayer(e){return e===this.#d?.div}setEditingState(e){this.#o.setEditingState(e)}addCommands(e){this.#o.addCommands(e)}cleanUndoStack(e){this.#o.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#n?.div.classList.toggle("disabled",!e)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const i of this.#s.values())i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#o.removeChangedExistingAnnotation(i),e.add(i.annotationElementId));if(!this.#n){this.#c=!1;return}const t=this.#n.getEditableAnnotations();for(const i of t){if(i.hide(),this.#o.isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const s=await this.deserialize(i);s&&(this.addOrRebuild(s),s.enableEditing())}this.#c=!1}disable(){this.#a=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const s of this.#s.values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){e.set(s.annotationElementId,s);continue}else t.set(s.annotationElementId,s);this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()}if(this.#n){const s=this.#n.getEditableAnnotations();for(const r of s){const{id:o}=r.data;if(this.#o.isDeletedAnnotationElement(o))continue;let a=t.get(o);if(a){a.resetAnnotationElement(r),a.show(!1),r.show();continue}a=e.get(o),a&&(this.#o.addChangedExistingAnnotation(a),a.renderAnnotationElement(r)&&a.show(!1)),r.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const s of $t.#p.values())i.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#a=!1}getEditableAnnotation(e){return this.#n?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#o.getActive()!==e&&this.#o.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#f){this.#f=new AbortController;const e=this.#o.combinedSignal(this.#f);this.#d.div.addEventListener("pointerdown",this.#m.bind(this),{signal:e}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#d.div.classList.remove("highlighting"))}#m(e){this.#o.unselectAll();const{target:t}=e;if(t===this.#d.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#d.div.contains(t)){const{isMac:i}=Ke.platform;if(e.button!==0||e.ctrlKey&&i)return;this.#o.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),ye.startHighlighting(this,this.#o.direction==="ltr",{target:this.#d.div,x:e.x,y:e.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#o._signal}),e.preventDefault()}}enableClick(){if(this.#i)return;this.#i=new AbortController;const e=this.#o.combinedSignal(this.#i);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#i?.abort(),this.#i=null}attach(e){this.#s.set(e.id,e);const{annotationElementId:t}=e;t&&this.#o.isDeletedAnnotationElement(t)&&this.#o.removeDeletedAnnotationElement(e)}detach(e){this.#s.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#a&&e.annotationElementId&&this.#o.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#o.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#o.addDeletedAnnotationElement(e.annotationElementId),B.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#o.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#c),this.#o.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#r&&(e._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#o._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),i=()=>{e.remove()};this.addCommands({cmd:t,undo:i,mustExec:!1})}getNextId(){return this.#o.getId()}get#g(){return $t.#p.get(this.#o.getMode())}combinedSignal(e){return this.#o.combinedSignal(e)}#y(e){const t=this.#g;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#g?.canCreateNewEmptyEditor()}pasteEditor(e,t){this.#o.updateToolbar(e),this.#o.updateMode(e);const{offsetX:i,offsetY:s}=this.#A(),r=this.getNextId(),o=this.#y({parent:this,id:r,x:i,y:s,uiManager:this.#o,isCentered:!0,...t});o&&this.add(o)}async deserialize(e){return await $t.#p.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#o)||null}createAndAddNewEditor(e,t,i={}){const s=this.getNextId(),r=this.#y({parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:this.#o,isCentered:t,...i});return r&&this.add(r),r}#A(){const{x:e,y:t,width:i,height:s}=this.div.getBoundingClientRect(),r=Math.max(0,e),o=Math.max(0,t),a=Math.min(window.innerWidth,e+i),l=Math.min(window.innerHeight,t+s),u=(r+a)/2-e,d=(o+l)/2-t,[f,p]=this.viewport.rotation%180===0?[u,d]:[d,u];return{offsetX:f,offsetY:p}}addNewEditor(){this.createAndAddNewEditor(this.#A(),!0)}setSelected(e){this.#o.setSelected(e)}toggleSelected(e){this.#o.toggleSelected(e)}unselect(e){this.#o.unselect(e)}pointerup(e){const{isMac:t}=Ke.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&this.#l&&(this.#l=!1,!(this.#g?.isDrawer&&this.#g.supportMultipleDrawings))){if(!this.#t){this.#t=!0;return}if(this.#o.getMode()===$.STAMP){this.#o.unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){if(this.#o.getMode()===$.HIGHLIGHT&&this.enableTextSelection(),this.#l){this.#l=!1;return}const{isMac:t}=Ke.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#l=!0,this.#g?.isDrawer){this.startDrawingSession(e);return}const i=this.#o.getActive();this.#t=!i||i.isEmpty()}startDrawingSession(e){if(this.div.focus(),this.#u){this.#g.startDrawing(this,this.#o,!1,e);return}this.#o.setCurrentDrawingSession(this),this.#u=new AbortController;const t=this.#o.combinedSignal(this.#u);this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(this.#h=null,this.commitOrRemove())},{signal:t}),this.#g.startDrawing(this,this.#o,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#h=t);return}this.#h&&setTimeout(()=>{this.#h?.focus(),this.#h=null},0)}endDrawingSession(e=!1){return this.#u?(this.#o.setCurrentDrawingSession(null),this.#u.abort(),this.#u=null,this.#h=null,this.#g.endDrawing(e)):null}findNewParent(e,t,i){const s=this.#o.findParent(t,i);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return this.#u?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#u&&this.#g.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#o.getActive()?.parent===this&&(this.#o.commitOrRemove(),this.#o.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const e of this.#s.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#s.clear(),this.#o.removeLayer(this)}#v(){for(const e of this.#s.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,qn(this.div,e);for(const t of this.#o.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#o.commitOrRemove(),this.#v();const t=this.viewport.rotation,i=e.rotation;if(this.viewport=e,qn(this.div,{rotation:i}),t!==i)for(const s of this.#s.values())s.rotate(i)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#o.viewParameters.realScale}}class qe{#e=null;#t=0;#n=new Map;#i=new Map;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#n.size>0)for(const t of this.#n.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return Y(this,"_svgFactory",new xu)}static#r(e,[t,i,s,r]){const{style:o}=e;o.top=`${100*i}%`,o.left=`${100*t}%`,o.width=`${100*s}%`,o.height=`${100*r}%`}#s(){const e=qe._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#l(e,t){const i=qe._svgFactory.createElement("clipPath");e.append(i);const s=`clip_${t}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");const r=qe._svgFactory.createElement("use");return i.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),s}#a(e,t){for(const[i,s]of Object.entries(t))s===null?e.removeAttribute(i):e.setAttribute(i,s)}draw(e,t=!1,i=!1){const s=this.#t++,r=this.#s(),o=qe._svgFactory.createElement("defs");r.append(o);const a=qe._svgFactory.createElement("path");o.append(a);const l=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#i.set(s,a);const u=i?this.#l(o,l):null,d=qe._svgFactory.createElement("use");return r.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(r,e),this.#n.set(s,r),{id:s,clipPathId:`url(#${u})`}}drawOutline(e,t){const i=this.#t++,s=this.#s(),r=qe._svgFactory.createElement("defs");s.append(r);const o=qe._svgFactory.createElement("path");r.append(o);const a=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const f=qe._svgFactory.createElement("mask");r.append(f),l=`mask_p${this.pageIndex}_${i}`,f.setAttribute("id",l),f.setAttribute("maskUnits","objectBoundingBox");const p=qe._svgFactory.createElement("rect");f.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const g=qe._svgFactory.createElement("use");f.append(g),g.setAttribute("href",`#${a}`),g.setAttribute("stroke","none"),g.setAttribute("fill","black"),g.setAttribute("fill-rule","nonzero"),g.classList.add("mask")}const u=qe._svgFactory.createElement("use");s.append(u),u.setAttribute("href",`#${a}`),l&&u.setAttribute("mask",`url(#${l})`);const d=u.cloneNode();return s.append(d),u.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(s,e),this.#n.set(i,s),i}finalizeDraw(e,t){this.#i.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:i,bbox:s,rootClass:r,path:o}=t,a=typeof e=="number"?this.#n.get(e):e;if(a){if(i&&this.#a(a,i),s&&qe.#r(a,s),r){const{classList:l}=a;for(const[u,d]of Object.entries(r))l.toggle(u,d)}if(o){const u=a.firstChild.firstChild;this.#a(u,o)}}}updateParent(e,t){if(t===this)return;const i=this.#n.get(e);i&&(t.#e.append(i),this.#n.delete(e),t.#n.set(e,i))}remove(e){this.#i.delete(e),this.#e!==null&&(this.#n.get(e).remove(),this.#n.delete(e))}destroy(){this.#e=null;for(const e of this.#n.values())e.remove();this.#n.clear(),this.#i.clear()}}globalThis.pdfjsTestingUtils={HighlightOutliner:cl};q.AbortException;q.AnnotationEditorLayer;q.AnnotationEditorParamsType;q.AnnotationEditorType;q.AnnotationEditorUIManager;q.AnnotationLayer;q.AnnotationMode;q.ColorPicker;q.DOMSVGFactory;q.DrawLayer;q.FeatureTest;var P_=q.GlobalWorkerOptions;q.ImageKind;q.InvalidPDFException;q.MissingPDFException;q.OPS;q.OutputScale;q.PDFDataRangeTransport;q.PDFDateString;q.PDFWorker;q.PasswordResponses;q.PermissionFlag;q.PixelsPerInch;q.RenderingCancelledException;q.TextLayer;q.TouchManager;q.UnexpectedResponseException;q.Util;q.VerbosityLevel;q.XfaLayer;q.build;q.createValidAbsoluteUrl;q.fetchData;var R_=q.getDocument;q.getFilenameFromUrl;q.getPdfFilenameFromUrl;q.getXfaPageViewport;q.isDataScheme;q.isPdfFile;q.noContextMenu;q.normalizeUnicode;q.setLayerDimensions;q.shadow;q.stopEvent;q.version;P_.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.0.379/build/pdf.worker.min.mjs";const M_=({onStart:n,isLoading:e})=>{const[t,i]=Ee.useState(""),[s,r]=Ee.useState(""),[o,a]=Ee.useState(!1),[l,u]=Ee.useState(5),[d,f]=Ee.useState(il.Intermediate),[p,g]=Ee.useState({tf:!0,mc:!0,basic:!0}),m=async y=>{try{const _=await y.arrayBuffer(),A=await R_({data:_}).promise;let E="";for(let w=1;w<=A.numPages;w++){const I=(await(await A.getPage(w)).getTextContent()).items.map(P=>P.str).join(" ");E+=I+`
`}return E}catch(_){throw console.error("Errore PDF",_),new Error("Impossibile leggere il PDF.")}},v=Ee.useCallback(async y=>{const _=y.target.files?.[0];if(!_)return;const A=_.type==="application/pdf"||_.name.toLowerCase().endsWith(".pdf"),E=_.name.toLowerCase().endsWith(".md")||_.type==="text/markdown";if(!A&&!E){alert("Formato non supportato. Carica solo PDF o MD.");return}r(_.name),a(!0),i("");try{if(A){const w=await m(_);i(w)}else{const w=new FileReader;w.onload=C=>{const T=C.target?.result;i(T),a(!1)},w.readAsText(_);return}}catch(w){console.error("Errore lettura file:",w),alert("Impossibile leggere il file."),r("")}finally{A&&a(!1)}},[]),S=y=>{if(y.preventDefault(),!t.trim()){alert("Per favore carica un documento valido (PDF o MD).");return}if(!p.tf&&!p.mc&&!p.basic){alert("Seleziona almeno un tipo di carta.");return}n({cardCount:l,difficulty:d,includeTrueFalse:p.tf,includeMultipleChoice:p.mc,includeBasic:p.basic},{text:t,fileName:s})};return x.jsxs("div",{className:"w-full max-w-3xl mx-auto backdrop-blur-xl bg-slate-900/80 border border-slate-700/50 rounded-3xl shadow-2xl overflow-hidden animate-slide-up relative",children:[x.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"}),x.jsxs("div",{className:"p-8 md:p-10 space-y-8",children:[x.jsxs("div",{className:"text-center space-y-2",children:[x.jsx("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-cyan-400",children:"Setup Sessione"}),x.jsx("p",{className:"text-slate-400",children:"Carica i tuoi appunti e personalizza l'esperienza"})]}),x.jsxs("form",{onSubmit:S,className:"space-y-8",children:[x.jsxs("div",{className:"space-y-3",children:[x.jsx("label",{className:"block text-sm font-bold text-slate-300 uppercase tracking-wider",children:"1. Documento (PDF / MD)"}),x.jsx("div",{className:"group relative",children:x.jsxs("label",{className:`flex flex-col items-center justify-center w-full h-40 border-2 border-dashed rounded-2xl cursor-pointer transition-all duration-300 ${o?"border-slate-600 bg-slate-800/50 cursor-wait":s?"border-emerald-500/50 bg-emerald-950/20":"border-slate-600 bg-slate-800/30 hover:bg-slate-800 hover:border-indigo-500 hover:shadow-lg hover:shadow-indigo-500/20"}`,children:[x.jsx("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:o?x.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-500 mb-3"}):s?x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"w-12 h-12 mb-3 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400",children:x.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),x.jsx("p",{className:"mb-1 text-sm text-emerald-400 font-semibold",children:s}),x.jsx("p",{className:"text-xs text-slate-500",children:"Pronto per l'analisi"})]}):x.jsxs(x.Fragment,{children:[x.jsx("div",{className:"w-12 h-12 mb-3 rounded-full bg-slate-700/50 flex items-center justify-center text-slate-400 group-hover:text-indigo-400 group-hover:bg-indigo-500/10 transition-colors",children:x.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),x.jsx("p",{className:"mb-2 text-sm text-slate-400",children:x.jsx("span",{className:"font-semibold text-indigo-400",children:"Clicca per caricare"})}),x.jsx("p",{className:"text-xs text-slate-500",children:"PDF o Markdown"})]})}),x.jsx("input",{type:"file",className:"hidden",accept:".pdf,.md",onChange:v,disabled:o})]})})]}),x.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[x.jsxs("div",{className:"space-y-4",children:[x.jsx("label",{className:"block text-sm font-bold text-slate-300 uppercase tracking-wider",children:"2. Livello"}),x.jsx("div",{className:"flex bg-slate-800 p-1 rounded-xl",children:Object.values(il).map(y=>x.jsx("button",{type:"button",onClick:()=>f(y),className:`flex-1 py-2.5 text-sm rounded-lg transition-all font-medium ${d===y?"bg-gradient-to-br from-indigo-600 to-purple-600 text-white shadow-lg":"text-slate-400 hover:text-white hover:bg-slate-700/50"}`,children:y},y))})]}),x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"flex justify-between items-center",children:[x.jsx("label",{className:"block text-sm font-bold text-slate-300 uppercase tracking-wider",children:"3. Quantit"}),x.jsxs("span",{className:"px-3 py-1 bg-indigo-500/20 text-indigo-300 rounded-lg text-sm font-bold",children:[l," Card"]})]}),x.jsx("input",{type:"range",min:"3",max:"20",value:l,onChange:y=>u(parseInt(y.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]})]}),x.jsxs("div",{className:"space-y-3",children:[x.jsx("label",{className:"block text-sm font-bold text-slate-300 uppercase tracking-wider mb-2",children:"4. Tipologie"}),x.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{id:"tf",label:"Vero/Falso",val:p.tf},{id:"mc",label:"Multipla",val:p.mc},{id:"basic",label:"Aperta",val:p.basic}].map(y=>x.jsxs("label",{className:`flex items-center justify-center p-4 rounded-xl cursor-pointer border transition-all ${y.val?"bg-indigo-600/20 border-indigo-500/50 text-white shadow-lg shadow-indigo-900/20":"bg-slate-800 border-transparent text-slate-500 hover:border-slate-600"}`,children:[x.jsx("input",{type:"checkbox",checked:y.val,onChange:()=>g(_=>({..._,[y.id]:!_[y.id]})),className:"hidden"}),x.jsx("span",{className:"font-semibold",children:y.label})]},y.id))})]}),x.jsxs("button",{type:"submit",disabled:e||o||!t,className:"w-full py-5 relative group overflow-hidden rounded-xl font-bold text-lg text-white shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed",children:[x.jsx("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 transition-all duration-300 group-hover:scale-105"}),x.jsx("div",{className:"absolute inset-0 w-full h-full bg-white/20 opacity-0 group-hover:opacity-100 transition-opacity"}),x.jsx("span",{className:"relative flex items-center justify-center",children:e?x.jsxs(x.Fragment,{children:[x.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[x.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),x.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Elaborazione con IA..."]}):"GENERA FLASHCARD"})]})]})]})]})},k_=({card:n,onAnswer:e,currentIndex:t,totalCards:i})=>{const[s,r]=Ee.useState(!1),[o,a]=Ee.useState(null),[l,u]=Ee.useState(!1),d=S=>{l||(a(S),u(!0),setTimeout(()=>{r(!0)},800))},f=()=>{r(!0)},p=S=>{u(!0),e(S)},g=()=>{if(n.type===ot.MultipleChoice||n.type===ot.TrueFalse){const S=o===n.correctAnswer;e(S)}},m=S=>l?S===n.correctAnswer?"bg-emerald-900/50 border-emerald-500 text-emerald-200 font-bold shadow-[0_0_15px_rgba(16,185,129,0.4)]":S===o&&S!==n.correctAnswer?"bg-red-900/50 border-red-500 text-red-200":"bg-slate-800/50 border-slate-800 text-slate-600 opacity-50":"bg-slate-800 hover:bg-slate-700 border-slate-700 text-slate-200 hover:border-indigo-500",v=t/i*100;return x.jsxs("div",{className:"w-full max-w-4xl mx-auto my-6 px-4 animate-slide-up",children:[x.jsxs("div",{className:"flex flex-col mb-8",children:[x.jsxs("div",{className:"flex justify-between items-end mb-2",children:[x.jsxs("span",{className:"text-2xl font-bold text-white",children:["Domanda ",t+1," ",x.jsxs("span",{className:"text-slate-500 text-lg",children:["/ ",i]})]}),x.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800 border border-slate-700 text-xs font-medium uppercase tracking-wider text-indigo-400",children:n.type==="basic"?"Aperta":n.type==="true_false"?"Vero/Falso":"Multipla"})]}),x.jsx("div",{className:"w-full bg-slate-800 rounded-full h-2 overflow-hidden",children:x.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-500 to-purple-500 shadow-[0_0_10px_rgba(168,85,247,0.5)] transition-all duration-700 ease-out",style:{width:`${v}%`}})})]}),x.jsx("div",{className:"perspective-1000 w-full",children:x.jsxs("div",{className:`relative w-full transition-transform duration-700 transform-style-3d card-grid ${s?"rotate-y-180":""}`,children:[x.jsxs("div",{className:"card-face backface-hidden bg-slate-900 rounded-3xl p-8 md:p-12 border border-slate-700 shadow-2xl flex flex-col justify-between min-h-[450px]",children:[x.jsx("div",{className:"flex-grow flex items-center justify-center py-6",children:x.jsx("h2",{className:"text-2xl md:text-4xl font-bold text-white leading-tight text-center",children:n.question})}),x.jsxs("div",{className:"mt-8 space-y-4 w-full",children:[n.type===ot.MultipleChoice&&n.options&&x.jsx("div",{className:"grid grid-cols-1 gap-3",children:n.options.map((S,y)=>x.jsx("button",{onClick:()=>d(S),disabled:l,className:`p-5 w-full rounded-2xl border-2 text-left transition-all duration-200 text-lg ${m(S)}`,children:S},y))}),n.type===ot.TrueFalse&&x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsx("button",{onClick:()=>d("Vero"),disabled:l,className:`py-6 rounded-2xl border-2 font-bold text-xl transition-all ${m("Vero")}`,children:"Vero"}),x.jsx("button",{onClick:()=>d("Falso"),disabled:l,className:`py-6 rounded-2xl border-2 font-bold text-xl transition-all ${m("Falso")}`,children:"Falso"})]}),n.type===ot.Basic&&x.jsx("div",{className:"flex justify-center pb-4",children:x.jsxs("button",{onClick:f,className:"group relative px-8 py-4 bg-indigo-600 rounded-full font-bold text-white shadow-lg overflow-hidden transition-all hover:scale-105 active:scale-95",children:[x.jsx("div",{className:"absolute inset-0 bg-white/20 group-hover:translate-x-full transition-transform duration-500 -skew-x-12"}),"Rivela Risposta"]})}),n.type!==ot.Basic&&l&&!s&&x.jsx("p",{className:"text-center text-slate-500 text-sm animate-pulse",children:"Girando la carta..."})]})]}),x.jsxs("div",{className:"card-face backface-hidden rotate-y-180 bg-slate-900 rounded-3xl p-8 md:p-12 border border-indigo-500/30 shadow-[0_0_40px_rgba(79,70,229,0.15)] flex flex-col justify-between min-h-[450px]",children:[x.jsxs("div",{className:"space-y-6",children:[x.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[x.jsx("div",{className:`w-3 h-3 rounded-full ${o===n.correctAnswer||n.type===ot.Basic?"bg-emerald-500":"bg-red-500"}`}),x.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Soluzione"})]}),x.jsx("h3",{className:`text-2xl md:text-3xl font-bold leading-snug ${n.type===ot.Basic?"text-indigo-400":o===n.correctAnswer?"text-emerald-400":"text-red-400"}`,children:n.correctAnswer}),x.jsxs("div",{className:"bg-slate-800/50 p-6 rounded-2xl border border-slate-700/50 backdrop-blur-sm",children:[x.jsxs("h4",{className:"font-semibold text-indigo-300 mb-2 flex items-center",children:[x.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Spiegazione"]}),x.jsx("p",{className:"text-slate-300 leading-relaxed text-lg",children:n.userExplanation||"Nessuna spiegazione dettagliata disponibile."})]})]}),x.jsx("div",{className:"mt-8 pt-6 border-t border-slate-800",children:n.type===ot.Basic?x.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[x.jsx("button",{onClick:()=>p(!1),className:"py-4 rounded-xl border border-red-900/50 bg-red-950/30 text-red-400 font-bold hover:bg-red-900/50 hover:border-red-500 transition-all",children:"Non lo sapevo"}),x.jsx("button",{onClick:()=>p(!0),className:"py-4 rounded-xl border border-emerald-900/50 bg-emerald-950/30 text-emerald-400 font-bold hover:bg-emerald-900/50 hover:border-emerald-500 transition-all",children:"Lo sapevo"})]}):x.jsx("button",{onClick:g,className:"w-full py-4 bg-white text-slate-900 rounded-xl font-extrabold text-lg hover:bg-indigo-50 hover:scale-[1.02] transition-all shadow-[0_0_20px_rgba(255,255,255,0.3)]",children:"Prossima Domanda"})})]})]})})]})},b_=({state:n,onRestart:e})=>{const[t,i]=Ee.useState(0),[s,r]=Ee.useState(!1),o=n.answers.length,a=n.answers.filter(y=>y).length,l=o>0?a/o*100:0,d=(y=>y>=98?{grade:"10",message:"Leggendario!",color:"from-fuchsia-400 to-purple-600",glow:"shadow-fuchsia-500/50",stroke:"#d946ef"}:y>=95?{grade:"9 ",message:"Eccellente",color:"from-violet-400 to-indigo-600",glow:"shadow-violet-500/50",stroke:"#8b5cf6"}:y>=90?{grade:"9",message:"Ottimo",color:"from-indigo-400 to-blue-600",glow:"shadow-indigo-500/50",stroke:"#6366f1"}:y>=85?{grade:"8 ",message:"Molto Buono",color:"from-cyan-400 to-blue-500",glow:"shadow-cyan-500/50",stroke:"#06b6d4"}:y>=80?{grade:"8",message:"Buono",color:"from-teal-400 to-emerald-600",glow:"shadow-teal-500/50",stroke:"#14b8a6"}:y>=75?{grade:"7 ",message:"Discreto",color:"from-emerald-400 to-green-600",glow:"shadow-emerald-500/50",stroke:"#10b981"}:y>=70?{grade:"7",message:"Pi che sufficiente",color:"from-green-400 to-emerald-600",glow:"shadow-green-500/50",stroke:"#22c55e"}:y>=65?{grade:"6 ",message:"Sufficiente +",color:"from-lime-400 to-green-600",glow:"shadow-lime-500/50",stroke:"#84cc16"}:y>=60?{grade:"6",message:"Sufficiente",color:"from-yellow-400 to-orange-500",glow:"shadow-yellow-500/50",stroke:"#eab308"}:y>=55?{grade:"5 ",message:"Quasi sufficiente",color:"from-orange-400 to-red-500",glow:"shadow-orange-500/50",stroke:"#f97316"}:y>=45?{grade:"5",message:"Insufficiente",color:"from-orange-500 to-red-600",glow:"shadow-orange-500/50",stroke:"#f97316"}:y>=35?{grade:"4 ",message:"Gravemente insufficiente",color:"from-red-500 to-rose-700",glow:"shadow-red-500/50",stroke:"#ef4444"}:y>=25?{grade:"4",message:"Gravemente insufficiente",color:"from-red-600 to-rose-800",glow:"shadow-red-600/50",stroke:"#dc2626"}:{grade:"2",message:"Disastroso",color:"from-red-700 to-rose-950",glow:"shadow-red-900/50",stroke:"#991b1b"})(l);Ee.useEffect(()=>{setTimeout(()=>{let y=0;const _=1500,A=20,E=_/A,w=l/E,C=setInterval(()=>{y+=w,y>=l?(i(l),clearInterval(C),r(!0)):i(y)},A);return()=>clearInterval(C)},300)},[l]);const f=280,p=12,g=f/2,m=(f-p)/2-10,v=2*Math.PI*m,S=v-t/100*v;return x.jsxs("div",{className:"w-full flex flex-col items-center justify-center animate-fade-in py-8",children:[x.jsxs("div",{className:"relative w-[320px] h-[320px] flex items-center justify-center mb-8",children:[x.jsx("div",{className:`absolute inset-0 rounded-full bg-gradient-to-tr ${d.color} opacity-20 blur-3xl animate-pulse`}),x.jsx("div",{className:"absolute inset-0 border-[2px] border-slate-700/30 rounded-full border-dashed animate-[spin_10s_linear_infinite]"}),x.jsx("div",{className:"absolute inset-4 border-[1px] border-slate-600/20 rounded-full animate-[spin_15s_linear_infinite_reverse]"}),x.jsxs("svg",{width:f,height:f,className:"transform -rotate-90 relative z-10 drop-shadow-2xl",children:[x.jsx("circle",{cx:g,cy:g,r:m,stroke:"#1e293b",strokeWidth:p,fill:"transparent",strokeLinecap:"round"}),x.jsx("circle",{cx:g,cy:g,r:m,stroke:d.stroke,strokeWidth:p,fill:"transparent",strokeDasharray:v,strokeDashoffset:S,strokeLinecap:"round",className:"transition-all duration-100 ease-linear",style:{filter:`drop-shadow(0 0 6px ${d.stroke})`}})]}),x.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20",children:[x.jsx("span",{className:"text-slate-400 text-xs font-bold uppercase tracking-[0.2em] mb-2",children:"Voto"}),x.jsx("div",{className:`text-7xl font-black text-transparent bg-clip-text bg-gradient-to-b ${d.color} drop-shadow-sm`,children:s?d.grade:Math.round(t/10*10)/10}),x.jsxs("div",{className:`mt-4 px-4 py-1 rounded-full bg-slate-800/80 backdrop-blur border border-slate-700 text-sm font-medium ${s?"opacity-100 translate-y-0":"opacity-0 translate-y-4"} transition-all duration-500`,children:[Math.round(t),"% Accuratezza"]})]})]}),x.jsxs("div",{className:`text-center space-y-2 mb-10 transition-all duration-700 ${s?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[x.jsx("h2",{className:`text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r ${d.color}`,children:d.message}),x.jsx("p",{className:"text-slate-400 text-lg",children:"Hai completato la sessione."})]}),x.jsxs("div",{className:`grid grid-cols-2 gap-4 w-full max-w-lg mb-12 transition-all duration-1000 delay-200 ${s?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[x.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-2xl border border-emerald-500/20 flex flex-col items-center shadow-lg relative overflow-hidden group",children:[x.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-emerald-500"}),x.jsx("span",{className:"text-3xl font-bold text-white mb-1 group-hover:scale-110 transition-transform",children:a}),x.jsx("span",{className:"text-xs text-emerald-400 uppercase font-bold tracking-wider",children:"Corrette"})]}),x.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-2xl border border-red-500/20 flex flex-col items-center shadow-lg relative overflow-hidden group",children:[x.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-red-500"}),x.jsx("span",{className:"text-3xl font-bold text-white mb-1 group-hover:scale-110 transition-transform",children:o-a}),x.jsx("span",{className:"text-xs text-red-400 uppercase font-bold tracking-wider",children:"Errate"})]})]}),x.jsxs("button",{onClick:e,className:"group relative px-10 py-4 bg-slate-900 rounded-xl font-bold text-lg text-white overflow-hidden border border-indigo-500/50 shadow-[0_0_20px_rgba(99,102,241,0.3)] transition-all hover:shadow-[0_0_30px_rgba(99,102,241,0.6)] hover:-translate-y-1 active:scale-95",children:[x.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-600 opacity-0 group-hover:opacity-20 transition-opacity duration-300"}),x.jsxs("span",{className:"relative flex items-center space-x-2",children:[x.jsx("svg",{className:"w-5 h-5 transition-transform group-hover:rotate-180",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),x.jsx("span",{children:"Nuova Sessione"})]})]})]})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let N_,L_;function D_(){return{geminiUrl:N_,vertexUrl:L_}}function F_(n,e,t,i){var s,r;if(!n?.baseUrl){const o=D_();return e?(s=o.vertexUrl)!==null&&s!==void 0?s:t:(r=o.geminiUrl)!==null&&r!==void 0?r:i}return n.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nn{}function N(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(i,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){const r=e[s];return r!=null?String(r):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function h(n,e,t){for(let r=0;r<e.length-1;r++){const o=e[r];if(o.endsWith("[]")){const a=o.slice(0,-2);if(!(a in n))if(Array.isArray(t))n[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(n[a])){const l=n[a];if(Array.isArray(t))for(let u=0;u<l.length;u++){const d=l[u];h(d,e.slice(r+1),t[u])}else for(const u of l)h(u,e.slice(r+1),t)}return}else if(o.endsWith("[0]")){const a=o.slice(0,-3);a in n||(n[a]=[{}]);const l=n[a];h(l[0],e.slice(r+1),t);return}(!n[o]||typeof n[o]!="object")&&(n[o]={}),n=n[o]}const i=e[e.length-1],s=n[i];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else i==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[i]=t}function c(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let i=0;i<e.length;i++){if(typeof n!="object"||n===null)return t;const s=e[i];if(s.endsWith("[]")){const r=s.slice(0,-2);if(r in n){const o=n[r];return Array.isArray(o)?o.map(a=>c(a,e.slice(i+1),t)):t}else return t}else n=n[s]}return n}catch(i){if(i instanceof TypeError)return t;throw i}}function U_(n,e){for(const[t,i]of Object.entries(e)){const s=t.split("."),r=i.split("."),o=new Set;let a=-1;for(let l=0;l<s.length;l++)if(s[l]==="*"){a=l;break}if(a!==-1&&r.length>a)for(let l=a;l<r.length;l++){const u=r[l];u!=="*"&&!u.endsWith("[]")&&!u.endsWith("[0]")&&o.add(u)}hl(n,s,r,0,o)}}function hl(n,e,t,i,s){if(i>=e.length||typeof n!="object"||n===null)return;const r=e[i];if(r.endsWith("[]")){const o=r.slice(0,-2),a=n;if(o in a&&Array.isArray(a[o]))for(const l of a[o])hl(l,e,t,i+1,s)}else if(r==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){const o=n,a=Object.keys(o).filter(u=>!u.startsWith("_")&&!s.has(u)),l={};for(const u of a)l[u]=o[u];for(const[u,d]of Object.entries(l)){const f=[];for(const p of t.slice(i))p==="*"?f.push(u):f.push(p);h(o,f,d)}for(const u of a)delete o[u]}}else{const o=n;r in o&&hl(o[r],e,t,i+1,s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ku(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function H_(n){const e={},t=c(n,["operationName"]);t!=null&&h(e,["operationName"],t);const i=c(n,["resourceName"]);return i!=null&&h(e,["_url","resourceName"],i),e}function V_(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["metadata"]);i!=null&&h(e,["metadata"],i);const s=c(n,["done"]);s!=null&&h(e,["done"],s);const r=c(n,["error"]);r!=null&&h(e,["error"],r);const o=c(n,["response","generateVideoResponse"]);return o!=null&&h(e,["response"],G_(o)),e}function O_(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["metadata"]);i!=null&&h(e,["metadata"],i);const s=c(n,["done"]);s!=null&&h(e,["done"],s);const r=c(n,["error"]);r!=null&&h(e,["error"],r);const o=c(n,["response"]);return o!=null&&h(e,["response"],B_(o)),e}function G_(n){const e={},t=c(n,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>z_(o))),h(e,["generatedVideos"],r)}const i=c(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);const s=c(n,["raiMediaFilteredReasons"]);return s!=null&&h(e,["raiMediaFilteredReasons"],s),e}function B_(n){const e={},t=c(n,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>q_(o))),h(e,["generatedVideos"],r)}const i=c(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);const s=c(n,["raiMediaFilteredReasons"]);return s!=null&&h(e,["raiMediaFilteredReasons"],s),e}function z_(n){const e={},t=c(n,["video"]);return t!=null&&h(e,["video"],X_(t)),e}function q_(n){const e={},t=c(n,["_self"]);return t!=null&&h(e,["video"],Q_(t)),e}function $_(n){const e={},t=c(n,["operationName"]);return t!=null&&h(e,["_url","operationName"],t),e}function W_(n){const e={},t=c(n,["operationName"]);return t!=null&&h(e,["_url","operationName"],t),e}function Y_(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["metadata"]);i!=null&&h(e,["metadata"],i);const s=c(n,["done"]);s!=null&&h(e,["done"],s);const r=c(n,["error"]);r!=null&&h(e,["error"],r);const o=c(n,["response"]);return o!=null&&h(e,["response"],K_(o)),e}function K_(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["parent"]);i!=null&&h(e,["parent"],i);const s=c(n,["documentName"]);return s!=null&&h(e,["documentName"],s),e}function xg(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["metadata"]);i!=null&&h(e,["metadata"],i);const s=c(n,["done"]);s!=null&&h(e,["done"],s);const r=c(n,["error"]);r!=null&&h(e,["error"],r);const o=c(n,["response"]);return o!=null&&h(e,["response"],J_(o)),e}function J_(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["parent"]);i!=null&&h(e,["parent"],i);const s=c(n,["documentName"]);return s!=null&&h(e,["documentName"],s),e}function X_(n){const e={},t=c(n,["uri"]);t!=null&&h(e,["uri"],t);const i=c(n,["encodedVideo"]);i!=null&&h(e,["videoBytes"],ku(i));const s=c(n,["encoding"]);return s!=null&&h(e,["mimeType"],s),e}function Q_(n){const e={},t=c(n,["gcsUri"]);t!=null&&h(e,["uri"],t);const i=c(n,["bytesBase64Encoded"]);i!=null&&h(e,["videoBytes"],ku(i));const s=c(n,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var pd;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(pd||(pd={}));var gd;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(gd||(gd={}));var md;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(md||(md={}));var Ne;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(Ne||(Ne={}));var yd;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(yd||(yd={}));var vd;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(vd||(vd={}));var _d;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(_d||(_d={}));var Ad;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(Ad||(Ad={}));var Sd;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Sd||(Sd={}));var Ed;(function(n){n.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",n.LOW="LOW",n.HIGH="HIGH"})(Ed||(Ed={}));var wd;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(wd||(wd={}));var Cd;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(Cd||(Cd={}));var Td;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(Td||(Td={}));var xd;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE"})(xd||(xd={}));var Id;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(Id||(Id={}));var Pd;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Pd||(Pd={}));var Rd;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Rd||(Rd={}));var Md;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(Md||(Md={}));var kd;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(kd||(kd={}));var Xr;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(Xr||(Xr={}));var bd;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(bd||(bd={}));var Nd;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Nd||(Nd={}));var Ld;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Ld||(Ld={}));var fl;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(fl||(fl={}));var Dd;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Dd||(Dd={}));var Fd;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Fd||(Fd={}));var Ud;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(Ud||(Ud={}));var Hd;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(Hd||(Hd={}));var Vd;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Vd||(Vd={}));var Od;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Od||(Od={}));var Gd;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(Gd||(Gd={}));var Bd;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(Bd||(Bd={}));var zd;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(zd||(zd={}));var qd;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(qd||(qd={}));var $d;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})($d||($d={}));var Wd;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Wd||(Wd={}));var Yd;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Yd||(Yd={}));var Kd;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Kd||(Kd={}));var Jd;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(Jd||(Jd={}));var Xd;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(Xd||(Xd={}));var Qd;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(Qd||(Qd={}));var Zd;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(Zd||(Zd={}));var jd;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(jd||(jd={}));var eh;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(eh||(eh={}));var th;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(th||(th={}));var nh;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(nh||(nh={}));var ih;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(ih||(ih={}));var sh;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(sh||(sh={}));var rh;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(rh||(rh={}));var oh;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(oh||(oh={}));var ah;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(ah||(ah={}));var lh;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(lh||(lh={}));var uh;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(uh||(uh={}));var ch;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(ch||(ch={}));var hi;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(hi||(hi={}));class pl{constructor(e){const t={};for(const i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Ji{get text(){var e,t,i,s,r,o,a,l;if(((s=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",d=!1;const f=[];for(const p of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(const[g,m]of Object.entries(p))g!=="text"&&g!=="thought"&&g!=="thoughtSignature"&&(m!==null||m!==void 0)&&f.push(g);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;d=!0,u+=p.text}}return f.length>0&&console.warn(`there are non-text parts ${f} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?u:void 0}get data(){var e,t,i,s,r,o,a,l;if(((s=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const d=[];for(const f of(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&l!==void 0?l:[]){for(const[p,g]of Object.entries(f))p!=="inlineData"&&(g!==null||g!==void 0)&&d.push(p);f.inlineData&&typeof f.inlineData.data=="string"&&(u+=atob(f.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var e,t,i,s,r,o,a,l;if(((s=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if(u?.length!==0)return u}get executableCode(){var e,t,i,s,r,o,a,l,u;if(((s=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const d=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(f=>f.executableCode).map(f=>f.executableCode).filter(f=>f!==void 0);if(d?.length!==0)return(u=d?.[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var e,t,i,s,r,o,a,l,u;if(((s=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const d=(l=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||l===void 0?void 0:l.filter(f=>f.codeExecutionResult).map(f=>f.codeExecutionResult).filter(f=>f!==void 0);if(d?.length!==0)return(u=d?.[0])===null||u===void 0?void 0:u.output}}class dh{}class hh{}class Z_{}class j_{}class eA{}class tA{}class fh{}class ph{}class gh{}class nA{}class Qr{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const i=new Qr;let s;const r=e;return t?s=O_(r):s=V_(r),Object.assign(i,s),i}}class mh{}class yh{}class vh{}class iA{}class sA{}class rA{}class bu{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const i=new bu,r=Y_(e);return Object.assign(i,r),i}}class oA{}class aA{}class lA{}class _h{}class uA{get text(){var e,t,i;let s="",r=!1;const o=[];for(const a of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[l,u]of Object.entries(a))l!=="text"&&l!=="thought"&&u!==null&&o.push(l);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;r=!0,s+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?s:void 0}get data(){var e,t,i;let s="";const r=[];for(const o of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[a,l]of Object.entries(o))a!=="inlineData"&&l!==null&&r.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(s+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}}class cA{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Nu{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const i=new Nu,r=xg(e);return Object.assign(i,r),i}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function te(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Ig(n,e){const t=te(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function Pg(n){return Array.isArray(n)?n.map(e=>Zr(e)):[Zr(n)]}function Zr(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function Rg(n){const e=Zr(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Mg(n){const e=Zr(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Ah(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function kg(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>Ah(e)):[Ah(n)]}function gl(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Sh(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Eh(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function Be(n){if(n==null)throw new Error("ContentUnion is required");return gl(n)?n:{role:"user",parts:kg(n)}}function Lu(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const i=Be(t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){const t=Be(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Be(t)):[Be(e)]}function St(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(Sh(n)||Eh(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Be(n)]}const e=[],t=[],i=gl(n[0]);for(const s of n){const r=gl(s);if(r!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(s);else{if(Sh(s)||Eh(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(s)}}return i||e.push({role:"user",parts:kg(t)}),e}function dA(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(i=>i!=="null");if(t.length===1)e.type=Object.values(Ne).includes(t[0].toUpperCase())?t[0].toUpperCase():Ne.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const i of t)e.anyOf.push({type:Object.values(Ne).includes(i.toUpperCase())?i.toUpperCase():Ne.TYPE_UNSPECIFIED})}}function Ai(n){const e={},t=["items"],i=["anyOf"],s=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=n.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,n=r[1]):r[1].type==="null"&&(e.nullable=!0,n=r[0])),n.type instanceof Array&&dA(n.type,e);for(const[o,a]of Object.entries(n))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(Ne).includes(a.toUpperCase())?a.toUpperCase():Ne.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=Ai(a);else if(i.includes(o)){const l=[];for(const u of a){if(u.type=="null"){e.nullable=!0;continue}l.push(Ai(u))}e[o]=l}else if(s.includes(o)){const l={};for(const[u,d]of Object.entries(a))l[u]=Ai(d);e[o]=l}else{if(o==="additionalProperties")continue;e[o]=a}return e}function Du(n){return Ai(n)}function Fu(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Uu(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Li(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Ai(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Ai(e.response));return n}function Di(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function hA(n,e,t,i=1){const s=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:s?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function sn(n,e){if(typeof e!="string")throw new Error("name must be a string");return hA(n,e,"cachedContents")}function bg(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function Mn(n){return ku(n)}function fA(n){return n!=null&&typeof n=="object"&&"name"in n}function pA(n){return n!=null&&typeof n=="object"&&"video"in n}function gA(n){return n!=null&&typeof n=="object"&&"uri"in n}function Ng(n){var e;let t;if(fA(n)&&(t=n.name),!(gA(n)&&(t=n.uri,t===void 0))&&!(pA(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const s=t.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${t}`);t=s[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function Lg(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function Dg(n){for(const e of["models","tunedModels","publisherModels"])if(mA(n,e))return n[e];return[]}function mA(n,e){return n!==null&&typeof n=="object"&&e in n}function yA(n,e={}){const t=n,i={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(i.responseJsonSchema=t.outputSchema),e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function vA(n,e={}){const t=[],i=new Set;for(const s of n){const r=s.name;if(i.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);i.add(r);const o=yA(s,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function Fg(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const i=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,s=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(s>0||i!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function _A(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Ug(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const s=t.inlinedResponses;if(!Array.isArray(s)||s.length===0)return n;let r=!1;for(const o of s){if(typeof o!="object"||o===null)continue;const l=o.response;if(typeof l!="object"||l===null)continue;if(l.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function Fi(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function Hg(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function AA(n){const e={},t=c(n,["responsesFile"]);t!=null&&h(e,["fileName"],t);const i=c(n,["inlinedResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>eS(o))),h(e,["inlinedResponses"],r)}const s=c(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["inlinedEmbedContentResponses"],r)}return e}function SA(n){const e={},t=c(n,["predictionsFormat"]);t!=null&&h(e,["format"],t);const i=c(n,["gcsDestination","outputUriPrefix"]);i!=null&&h(e,["gcsUri"],i);const s=c(n,["bigqueryDestination","outputUri"]);return s!=null&&h(e,["bigqueryUri"],s),e}function EA(n){const e={},t=c(n,["format"]);t!=null&&h(e,["predictionsFormat"],t);const i=c(n,["gcsUri"]);i!=null&&h(e,["gcsDestination","outputUriPrefix"],i);const s=c(n,["bigqueryUri"]);if(s!=null&&h(e,["bigqueryDestination","outputUri"],s),c(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(c(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(c(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Er(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["metadata","displayName"]);i!=null&&h(e,["displayName"],i);const s=c(n,["metadata","state"]);s!=null&&h(e,["state"],Hg(s));const r=c(n,["metadata","createTime"]);r!=null&&h(e,["createTime"],r);const o=c(n,["metadata","endTime"]);o!=null&&h(e,["endTime"],o);const a=c(n,["metadata","updateTime"]);a!=null&&h(e,["updateTime"],a);const l=c(n,["metadata","model"]);l!=null&&h(e,["model"],l);const u=c(n,["metadata","output"]);return u!=null&&h(e,["dest"],AA(Ug(u))),e}function ml(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["displayName"]);i!=null&&h(e,["displayName"],i);const s=c(n,["state"]);s!=null&&h(e,["state"],Hg(s));const r=c(n,["error"]);r!=null&&h(e,["error"],r);const o=c(n,["createTime"]);o!=null&&h(e,["createTime"],o);const a=c(n,["startTime"]);a!=null&&h(e,["startTime"],a);const l=c(n,["endTime"]);l!=null&&h(e,["endTime"],l);const u=c(n,["updateTime"]);u!=null&&h(e,["updateTime"],u);const d=c(n,["model"]);d!=null&&h(e,["model"],d);const f=c(n,["inputConfig"]);f!=null&&h(e,["src"],wA(f));const p=c(n,["outputConfig"]);p!=null&&h(e,["dest"],SA(Ug(p)));const g=c(n,["completionStats"]);return g!=null&&h(e,["completionStats"],g),e}function wA(n){const e={},t=c(n,["instancesFormat"]);t!=null&&h(e,["format"],t);const i=c(n,["gcsSource","uris"]);i!=null&&h(e,["gcsUri"],i);const s=c(n,["bigquerySource","inputUri"]);return s!=null&&h(e,["bigqueryUri"],s),e}function CA(n,e){const t={};if(c(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(c(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(c(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const i=c(e,["fileName"]);i!=null&&h(t,["fileName"],i);const s=c(e,["inlinedRequests"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>jA(n,o))),h(t,["requests","requests"],r)}return t}function TA(n){const e={},t=c(n,["format"]);t!=null&&h(e,["instancesFormat"],t);const i=c(n,["gcsUri"]);i!=null&&h(e,["gcsSource","uris"],i);const s=c(n,["bigqueryUri"]);if(s!=null&&h(e,["bigquerySource","inputUri"],s),c(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(c(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function xA(n){const e={},t=c(n,["data"]);if(t!=null&&h(e,["data"],t),c(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function IA(n,e){const t={},i=c(e,["name"]);return i!=null&&h(t,["_url","name"],Fi(n,i)),t}function PA(n,e){const t={},i=c(e,["name"]);return i!=null&&h(t,["_url","name"],Fi(n,i)),t}function RA(n){const e={},t=c(n,["content"]);t!=null&&h(e,["content"],t);const i=c(n,["citationMetadata"]);i!=null&&h(e,["citationMetadata"],MA(i));const s=c(n,["tokenCount"]);s!=null&&h(e,["tokenCount"],s);const r=c(n,["finishReason"]);r!=null&&h(e,["finishReason"],r);const o=c(n,["avgLogprobs"]);o!=null&&h(e,["avgLogprobs"],o);const a=c(n,["groundingMetadata"]);a!=null&&h(e,["groundingMetadata"],a);const l=c(n,["index"]);l!=null&&h(e,["index"],l);const u=c(n,["logprobsResult"]);u!=null&&h(e,["logprobsResult"],u);const d=c(n,["safetyRatings"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(g=>g)),h(e,["safetyRatings"],p)}const f=c(n,["urlContextMetadata"]);return f!=null&&h(e,["urlContextMetadata"],f),e}function MA(n){const e={},t=c(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(s=>s)),h(e,["citations"],i)}return e}function Vg(n){const e={},t=c(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>aS(r))),h(e,["parts"],s)}const i=c(n,["role"]);return i!=null&&h(e,["role"],i),e}function kA(n,e){const t={},i=c(n,["displayName"]);if(e!==void 0&&i!=null&&h(e,["batch","displayName"],i),c(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function bA(n,e){const t={},i=c(n,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);const s=c(n,["dest"]);return e!==void 0&&s!=null&&h(e,["outputConfig"],EA(_A(s))),t}function wh(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["src"]);s!=null&&h(t,["batch","inputConfig"],CA(n,Fg(n,s)));const r=c(e,["config"]);return r!=null&&kA(r,t),t}function NA(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["model"],te(n,i));const s=c(e,["src"]);s!=null&&h(t,["inputConfig"],TA(Fg(n,s)));const r=c(e,["config"]);return r!=null&&bA(r,t),t}function LA(n,e){const t={},i=c(n,["displayName"]);return e!==void 0&&i!=null&&h(e,["batch","displayName"],i),t}function DA(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["src"]);s!=null&&h(t,["batch","inputConfig"],BA(n,s));const r=c(e,["config"]);return r!=null&&LA(r,t),t}function FA(n,e){const t={},i=c(e,["name"]);return i!=null&&h(t,["_url","name"],Fi(n,i)),t}function UA(n,e){const t={},i=c(e,["name"]);return i!=null&&h(t,["_url","name"],Fi(n,i)),t}function HA(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["name"]);i!=null&&h(e,["name"],i);const s=c(n,["done"]);s!=null&&h(e,["done"],s);const r=c(n,["error"]);return r!=null&&h(e,["error"],r),e}function VA(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["name"]);i!=null&&h(e,["name"],i);const s=c(n,["done"]);s!=null&&h(e,["done"],s);const r=c(n,["error"]);return r!=null&&h(e,["error"],r),e}function OA(n,e){const t={},i=c(e,["contents"]);if(i!=null){let r=Lu(n,i);Array.isArray(r)&&(r=r.map(o=>o)),h(t,["requests[]","request","content"],r)}const s=c(e,["config"]);return s!=null&&(h(t,["_self"],GA(s,t)),U_(t,{"requests[].*":"requests[].request.*"})),t}function GA(n,e){const t={},i=c(n,["taskType"]);e!==void 0&&i!=null&&h(e,["requests[]","taskType"],i);const s=c(n,["title"]);e!==void 0&&s!=null&&h(e,["requests[]","title"],s);const r=c(n,["outputDimensionality"]);if(e!==void 0&&r!=null&&h(e,["requests[]","outputDimensionality"],r),c(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(c(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function BA(n,e){const t={},i=c(e,["fileName"]);i!=null&&h(t,["file_name"],i);const s=c(e,["inlinedRequests"]);return s!=null&&h(t,["requests"],OA(n,s)),t}function zA(n){const e={};if(c(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=c(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function qA(n){const e={},t=c(n,["id"]);t!=null&&h(e,["id"],t);const i=c(n,["args"]);i!=null&&h(e,["args"],i);const s=c(n,["name"]);if(s!=null&&h(e,["name"],s),c(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(c(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function $A(n){const e={},t=c(n,["mode"]);t!=null&&h(e,["mode"],t);const i=c(n,["allowedFunctionNames"]);if(i!=null&&h(e,["allowedFunctionNames"],i),c(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function WA(n,e,t){const i={},s=c(e,["systemInstruction"]);t!==void 0&&s!=null&&h(t,["systemInstruction"],Vg(Be(s)));const r=c(e,["temperature"]);r!=null&&h(i,["temperature"],r);const o=c(e,["topP"]);o!=null&&h(i,["topP"],o);const a=c(e,["topK"]);a!=null&&h(i,["topK"],a);const l=c(e,["candidateCount"]);l!=null&&h(i,["candidateCount"],l);const u=c(e,["maxOutputTokens"]);u!=null&&h(i,["maxOutputTokens"],u);const d=c(e,["stopSequences"]);d!=null&&h(i,["stopSequences"],d);const f=c(e,["responseLogprobs"]);f!=null&&h(i,["responseLogprobs"],f);const p=c(e,["logprobs"]);p!=null&&h(i,["logprobs"],p);const g=c(e,["presencePenalty"]);g!=null&&h(i,["presencePenalty"],g);const m=c(e,["frequencyPenalty"]);m!=null&&h(i,["frequencyPenalty"],m);const v=c(e,["seed"]);v!=null&&h(i,["seed"],v);const S=c(e,["responseMimeType"]);S!=null&&h(i,["responseMimeType"],S);const y=c(e,["responseSchema"]);y!=null&&h(i,["responseSchema"],Du(y));const _=c(e,["responseJsonSchema"]);if(_!=null&&h(i,["responseJsonSchema"],_),c(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(c(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const A=c(e,["safetySettings"]);if(t!==void 0&&A!=null){let V=A;Array.isArray(V)&&(V=V.map(J=>lS(J))),h(t,["safetySettings"],V)}const E=c(e,["tools"]);if(t!==void 0&&E!=null){let V=Di(E);Array.isArray(V)&&(V=V.map(J=>cS(Li(J)))),h(t,["tools"],V)}const w=c(e,["toolConfig"]);if(t!==void 0&&w!=null&&h(t,["toolConfig"],uS(w)),c(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const C=c(e,["cachedContent"]);t!==void 0&&C!=null&&h(t,["cachedContent"],sn(n,C));const T=c(e,["responseModalities"]);T!=null&&h(i,["responseModalities"],T);const I=c(e,["mediaResolution"]);I!=null&&h(i,["mediaResolution"],I);const P=c(e,["speechConfig"]);if(P!=null&&h(i,["speechConfig"],Fu(P)),c(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const R=c(e,["thinkingConfig"]);R!=null&&h(i,["thinkingConfig"],R);const L=c(e,["imageConfig"]);return L!=null&&h(i,["imageConfig"],ZA(L)),i}function YA(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["candidates"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(u=>RA(u))),h(e,["candidates"],l)}const s=c(n,["modelVersion"]);s!=null&&h(e,["modelVersion"],s);const r=c(n,["promptFeedback"]);r!=null&&h(e,["promptFeedback"],r);const o=c(n,["responseId"]);o!=null&&h(e,["responseId"],o);const a=c(n,["usageMetadata"]);return a!=null&&h(e,["usageMetadata"],a),e}function KA(n,e){const t={},i=c(e,["name"]);return i!=null&&h(t,["_url","name"],Fi(n,i)),t}function JA(n,e){const t={},i=c(e,["name"]);return i!=null&&h(t,["_url","name"],Fi(n,i)),t}function XA(n){const e={};if(c(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=c(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function QA(n){const e={};if(c(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(c(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=c(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function ZA(n){const e={},t=c(n,["aspectRatio"]);t!=null&&h(e,["aspectRatio"],t);const i=c(n,["imageSize"]);if(i!=null&&h(e,["imageSize"],i),c(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(c(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function jA(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["request","model"],te(n,i));const s=c(e,["contents"]);if(s!=null){let a=St(s);Array.isArray(a)&&(a=a.map(l=>Vg(l))),h(t,["request","contents"],a)}const r=c(e,["metadata"]);r!=null&&h(t,["metadata"],r);const o=c(e,["config"]);return o!=null&&h(t,["request","generationConfig"],WA(n,o,c(t,["request"],{}))),t}function eS(n){const e={},t=c(n,["response"]);t!=null&&h(e,["response"],YA(t));const i=c(n,["error"]);return i!=null&&h(e,["error"],i),e}function tS(n,e){const t={},i=c(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const s=c(n,["pageToken"]);if(e!==void 0&&s!=null&&h(e,["_query","pageToken"],s),c(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function nS(n,e){const t={},i=c(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const s=c(n,["pageToken"]);e!==void 0&&s!=null&&h(e,["_query","pageToken"],s);const r=c(n,["filter"]);return e!==void 0&&r!=null&&h(e,["_query","filter"],r),t}function iS(n){const e={},t=c(n,["config"]);return t!=null&&tS(t,e),e}function sS(n){const e={},t=c(n,["config"]);return t!=null&&nS(t,e),e}function rS(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);const s=c(n,["operations"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>Er(o))),h(e,["batchJobs"],r)}return e}function oS(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);const s=c(n,["batchPredictionJobs"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>ml(o))),h(e,["batchJobs"],r)}return e}function aS(n){const e={},t=c(n,["mediaResolution"]);t!=null&&h(e,["mediaResolution"],t);const i=c(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);const s=c(n,["executableCode"]);s!=null&&h(e,["executableCode"],s);const r=c(n,["fileData"]);r!=null&&h(e,["fileData"],zA(r));const o=c(n,["functionCall"]);o!=null&&h(e,["functionCall"],qA(o));const a=c(n,["functionResponse"]);a!=null&&h(e,["functionResponse"],a);const l=c(n,["inlineData"]);l!=null&&h(e,["inlineData"],xA(l));const u=c(n,["text"]);u!=null&&h(e,["text"],u);const d=c(n,["thought"]);d!=null&&h(e,["thought"],d);const f=c(n,["thoughtSignature"]);f!=null&&h(e,["thoughtSignature"],f);const p=c(n,["videoMetadata"]);return p!=null&&h(e,["videoMetadata"],p),e}function lS(n){const e={},t=c(n,["category"]);if(t!=null&&h(e,["category"],t),c(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=c(n,["threshold"]);return i!=null&&h(e,["threshold"],i),e}function uS(n){const e={},t=c(n,["functionCallingConfig"]);t!=null&&h(e,["functionCallingConfig"],$A(t));const i=c(n,["retrievalConfig"]);return i!=null&&h(e,["retrievalConfig"],i),e}function cS(n){const e={},t=c(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(f=>f)),h(e,["functionDeclarations"],d)}if(c(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=c(n,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const s=c(n,["computerUse"]);s!=null&&h(e,["computerUse"],s);const r=c(n,["fileSearch"]);r!=null&&h(e,["fileSearch"],r);const o=c(n,["codeExecution"]);if(o!=null&&h(e,["codeExecution"],o),c(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=c(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],XA(a));const l=c(n,["googleSearch"]);l!=null&&h(e,["googleSearch"],QA(l));const u=c(n,["urlContext"]);return u!=null&&h(e,["urlContext"],u),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var en;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(en||(en={}));class Jn{constructor(e,t,i,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,s)}init(e,t,i){var s,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!i||Object.keys(i).length===0?o={config:{}}:typeof i=="object"?o=Object.assign({},i):o=i,o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(r=(s=o.config)===null||s===void 0?void 0:s.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class dS extends nn{constructor(e){super(),this.apiClient=e,this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)},this.list=async(t={})=>new Jn(en.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(t),t)}createInlinedGenerateContentRequest(e){const t=wh(this.apiClient,e),i=t._url,s=N("{model}:batchGenerateContent",i),a=t.batch.inputConfig.requests,l=a.requests,u=[];for(const d of l){const f=Object.assign({},d);if(f.systemInstruction){const p=f.systemInstruction;delete f.systemInstruction;const g=f.request;g.systemInstruction=p,f.request=g}u.push(f)}return a.requests=u,delete t.config,delete t._url,delete t._query,{path:s,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const i=t?Object.assign({},t):{},s=Date.now().toString();if(i.displayName||(i.displayName=`genaiBatchJob_${s}`),i.dest===void 0){const r=this.getGcsUri(e),o=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?i.dest=`${r.slice(0,-6)}/dest`:i.dest=`${r}_dest_${s}`;else if(o)i.dest=`${o}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return i}async createInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=NA(this.apiClient,e);return a=N("batchPredictionJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>ml(d))}else{const u=wh(this.apiClient,e);return a=N("{model}:batchGenerateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>Er(d))}}async createEmbeddingsInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=DA(this.apiClient,e);return r=N("{model}:asyncBatchEmbedContent",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>Er(l))}}async get(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=JA(this.apiClient,e);return a=N("batchPredictionJobs/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>ml(d))}else{const u=KA(this.apiClient,e);return a=N("batches/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>Er(d))}}async cancel(e){var t,i,s,r;let o="",a={};if(this.apiClient.isVertexAI()){const l=PA(this.apiClient,e);o=N("batchPredictionJobs/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const l=IA(this.apiClient,e);o=N("batches/{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=sS(e);return a=N("batchPredictionJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=oS(d),p=new _h;return Object.assign(p,f),p})}else{const u=iS(e);return a=N("batches",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=rS(d),p=new _h;return Object.assign(p,f),p})}}async delete(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=UA(this.apiClient,e);return a=N("batchPredictionJobs/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>VA(d))}else{const u=FA(this.apiClient,e);return a=N("batches/{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>HA(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function hS(n){const e={},t=c(n,["data"]);if(t!=null&&h(e,["data"],t),c(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function Ch(n){const e={},t=c(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>DS(r))),h(e,["parts"],s)}const i=c(n,["role"]);return i!=null&&h(e,["role"],i),e}function fS(n,e){const t={},i=c(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);const s=c(n,["expireTime"]);e!==void 0&&s!=null&&h(e,["expireTime"],s);const r=c(n,["displayName"]);e!==void 0&&r!=null&&h(e,["displayName"],r);const o=c(n,["contents"]);if(e!==void 0&&o!=null){let d=St(o);Array.isArray(d)&&(d=d.map(f=>Ch(f))),h(e,["contents"],d)}const a=c(n,["systemInstruction"]);e!==void 0&&a!=null&&h(e,["systemInstruction"],Ch(Be(a)));const l=c(n,["tools"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(f=>US(f))),h(e,["tools"],d)}const u=c(n,["toolConfig"]);if(e!==void 0&&u!=null&&h(e,["toolConfig"],FS(u)),c(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function pS(n,e){const t={},i=c(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);const s=c(n,["expireTime"]);e!==void 0&&s!=null&&h(e,["expireTime"],s);const r=c(n,["displayName"]);e!==void 0&&r!=null&&h(e,["displayName"],r);const o=c(n,["contents"]);if(e!==void 0&&o!=null){let f=St(o);Array.isArray(f)&&(f=f.map(p=>p)),h(e,["contents"],f)}const a=c(n,["systemInstruction"]);e!==void 0&&a!=null&&h(e,["systemInstruction"],Be(a));const l=c(n,["tools"]);if(e!==void 0&&l!=null){let f=l;Array.isArray(f)&&(f=f.map(p=>HS(p))),h(e,["tools"],f)}const u=c(n,["toolConfig"]);e!==void 0&&u!=null&&h(e,["toolConfig"],u);const d=c(n,["kmsKeyName"]);return e!==void 0&&d!=null&&h(e,["encryption_spec","kmsKeyName"],d),t}function gS(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["model"],Ig(n,i));const s=c(e,["config"]);return s!=null&&fS(s,t),t}function mS(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["model"],Ig(n,i));const s=c(e,["config"]);return s!=null&&pS(s,t),t}function yS(n,e){const t={},i=c(e,["name"]);return i!=null&&h(t,["_url","name"],sn(n,i)),t}function vS(n,e){const t={},i=c(e,["name"]);return i!=null&&h(t,["_url","name"],sn(n,i)),t}function _S(n){const e={},t=c(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function AS(n){const e={},t=c(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function SS(n){const e={};if(c(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=c(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function ES(n){const e={},t=c(n,["id"]);t!=null&&h(e,["id"],t);const i=c(n,["args"]);i!=null&&h(e,["args"],i);const s=c(n,["name"]);if(s!=null&&h(e,["name"],s),c(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(c(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function wS(n){const e={},t=c(n,["mode"]);t!=null&&h(e,["mode"],t);const i=c(n,["allowedFunctionNames"]);if(i!=null&&h(e,["allowedFunctionNames"],i),c(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function CS(n){const e={};if(c(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=c(n,["description"]);t!=null&&h(e,["description"],t);const i=c(n,["name"]);i!=null&&h(e,["name"],i);const s=c(n,["parameters"]);s!=null&&h(e,["parameters"],s);const r=c(n,["parametersJsonSchema"]);r!=null&&h(e,["parametersJsonSchema"],r);const o=c(n,["response"]);o!=null&&h(e,["response"],o);const a=c(n,["responseJsonSchema"]);return a!=null&&h(e,["responseJsonSchema"],a),e}function TS(n,e){const t={},i=c(e,["name"]);return i!=null&&h(t,["_url","name"],sn(n,i)),t}function xS(n,e){const t={},i=c(e,["name"]);return i!=null&&h(t,["_url","name"],sn(n,i)),t}function IS(n){const e={};if(c(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=c(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function PS(n){const e={};if(c(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(c(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=c(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function RS(n,e){const t={},i=c(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const s=c(n,["pageToken"]);return e!==void 0&&s!=null&&h(e,["_query","pageToken"],s),t}function MS(n,e){const t={},i=c(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const s=c(n,["pageToken"]);return e!==void 0&&s!=null&&h(e,["_query","pageToken"],s),t}function kS(n){const e={},t=c(n,["config"]);return t!=null&&RS(t,e),e}function bS(n){const e={},t=c(n,["config"]);return t!=null&&MS(t,e),e}function NS(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);const s=c(n,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["cachedContents"],r)}return e}function LS(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);const s=c(n,["cachedContents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["cachedContents"],r)}return e}function DS(n){const e={},t=c(n,["mediaResolution"]);t!=null&&h(e,["mediaResolution"],t);const i=c(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);const s=c(n,["executableCode"]);s!=null&&h(e,["executableCode"],s);const r=c(n,["fileData"]);r!=null&&h(e,["fileData"],SS(r));const o=c(n,["functionCall"]);o!=null&&h(e,["functionCall"],ES(o));const a=c(n,["functionResponse"]);a!=null&&h(e,["functionResponse"],a);const l=c(n,["inlineData"]);l!=null&&h(e,["inlineData"],hS(l));const u=c(n,["text"]);u!=null&&h(e,["text"],u);const d=c(n,["thought"]);d!=null&&h(e,["thought"],d);const f=c(n,["thoughtSignature"]);f!=null&&h(e,["thoughtSignature"],f);const p=c(n,["videoMetadata"]);return p!=null&&h(e,["videoMetadata"],p),e}function FS(n){const e={},t=c(n,["functionCallingConfig"]);t!=null&&h(e,["functionCallingConfig"],wS(t));const i=c(n,["retrievalConfig"]);return i!=null&&h(e,["retrievalConfig"],i),e}function US(n){const e={},t=c(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(f=>f)),h(e,["functionDeclarations"],d)}if(c(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=c(n,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const s=c(n,["computerUse"]);s!=null&&h(e,["computerUse"],s);const r=c(n,["fileSearch"]);r!=null&&h(e,["fileSearch"],r);const o=c(n,["codeExecution"]);if(o!=null&&h(e,["codeExecution"],o),c(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=c(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],IS(a));const l=c(n,["googleSearch"]);l!=null&&h(e,["googleSearch"],PS(l));const u=c(n,["urlContext"]);return u!=null&&h(e,["urlContext"],u),e}function HS(n){const e={},t=c(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>CS(p))),h(e,["functionDeclarations"],f)}const i=c(n,["retrieval"]);i!=null&&h(e,["retrieval"],i);const s=c(n,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const r=c(n,["computerUse"]);if(r!=null&&h(e,["computerUse"],r),c(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=c(n,["codeExecution"]);o!=null&&h(e,["codeExecution"],o);const a=c(n,["enterpriseWebSearch"]);a!=null&&h(e,["enterpriseWebSearch"],a);const l=c(n,["googleMaps"]);l!=null&&h(e,["googleMaps"],l);const u=c(n,["googleSearch"]);u!=null&&h(e,["googleSearch"],u);const d=c(n,["urlContext"]);return d!=null&&h(e,["urlContext"],d),e}function VS(n,e){const t={},i=c(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);const s=c(n,["expireTime"]);return e!==void 0&&s!=null&&h(e,["expireTime"],s),t}function OS(n,e){const t={},i=c(n,["ttl"]);e!==void 0&&i!=null&&h(e,["ttl"],i);const s=c(n,["expireTime"]);return e!==void 0&&s!=null&&h(e,["expireTime"],s),t}function GS(n,e){const t={},i=c(e,["name"]);i!=null&&h(t,["_url","name"],sn(n,i));const s=c(e,["config"]);return s!=null&&VS(s,t),t}function BS(n,e){const t={},i=c(e,["name"]);i!=null&&h(t,["_url","name"],sn(n,i));const s=c(e,["config"]);return s!=null&&OS(s,t),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class zS extends nn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Jn(en.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=mS(this.apiClient,e);return a=N("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{const u=gS(this.apiClient,e);return a=N("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async get(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=xS(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{const u=TS(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async delete(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=vS(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=AS(d),p=new yh;return Object.assign(p,f),p})}else{const u=yS(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=_S(d),p=new yh;return Object.assign(p,f),p})}}async update(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=BS(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>d)}else{const u=GS(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>d)}}async listInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=bS(e);return a=N("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=LS(d),p=new vh;return Object.assign(p,f),p})}else{const u=kS(e);return a=N("cachedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=NS(d),p=new vh;return Object.assign(p,f),p})}}}function Th(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ae(n){return this instanceof ae?(this.v=n,this):new ae(n)}function Si(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),s,r=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(g){return function(m){return Promise.resolve(m).then(g,f)}}function a(g,m){i[g]&&(s[g]=function(v){return new Promise(function(S,y){r.push([g,v,S,y])>1||l(g,v)})},m&&(s[g]=m(s[g])))}function l(g,m){try{u(i[g](m))}catch(v){p(r[0][3],v)}}function u(g){g.value instanceof ae?Promise.resolve(g.value.v).then(d,f):p(r[0][2],g)}function d(g){l("next",g)}function f(g){l("throw",g)}function p(g,m){g(m),r.shift(),r.length&&l(r[0][0],r[0][1])}}function ps(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Th=="function"?Th(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=n[r]&&function(o){return new Promise(function(a,l){o=n[r](o),s(a,l,o.done,o.value)})}}function s(r,o,a,l){Promise.resolve(l).then(function(u){r({value:u,done:a})},o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qS(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:Og(t)}function Og(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function $S(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function xh(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let i=0;for(;i<t;)if(n[i].role==="user")e.push(n[i]),i++;else{const s=[];let r=!0;for(;i<t&&n[i].role==="model";)s.push(n[i]),r&&!Og(n[i])&&(r=!1),i++;r?e.push(...s):e.pop()}return e}class WS{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new YS(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class YS{constructor(e,t,i,s={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=s,this.history=r,this.sendPromise=Promise.resolve(),$S(r)}async sendMessage(e){var t;await this.sendPromise;const i=Be(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,o,a;const l=await s,u=(o=(r=l.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content,d=l.automaticFunctionCallingHistory,f=this.getHistory(!0).length;let p=[];d!=null&&(p=(a=d.slice(f))!==null&&a!==void 0?a:[]);const g=u?[u]:[];this.recordHistory(i,g,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;const i=Be(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const r=await s;return this.processStreamResponse(r,i)}getHistory(e=!1){const t=e?xh(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var i,s;return Si(this,arguments,function*(){var o,a,l,u;const d=[];try{for(var f=!0,p=ps(e),g;g=yield ae(p.next()),o=g.done,!o;f=!0){u=g.value,f=!1;const m=u;if(qS(m)){const v=(s=(i=m.candidates)===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.content;v!==void 0&&d.push(v)}yield yield ae(m)}}catch(m){a={error:m}}finally{try{!f&&!o&&(l=p.return)&&(yield ae(l.call(p)))}finally{if(a)throw a.error}}this.recordHistory(t,d)})}recordHistory(e,t,i){let s=[];t.length>0&&t.every(r=>r.role!==void 0)?s=t:s.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...xh(i)):this.history.push(e),this.history.push(...s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Io extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Io.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function KS(n){const e={},t=c(n,["file"]);return t!=null&&h(e,["file"],t),e}function JS(n){const e={},t=c(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function XS(n){const e={},t=c(n,["name"]);return t!=null&&h(e,["_url","file"],Ng(t)),e}function QS(n){const e={},t=c(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function ZS(n){const e={},t=c(n,["name"]);return t!=null&&h(e,["_url","file"],Ng(t)),e}function jS(n,e){const t={},i=c(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const s=c(n,["pageToken"]);return e!==void 0&&s!=null&&h(e,["_query","pageToken"],s),t}function eE(n){const e={},t=c(n,["config"]);return t!=null&&jS(t,e),e}function tE(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);const s=c(n,["files"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["files"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nE extends nn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Jn(en.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=eE(e);return r=N("files",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{const u=tE(l),d=new oA;return Object.assign(d,u),d})}}async createInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=KS(e);return r=N("upload/v1beta/files",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>{const u=JS(l),d=new aA;return Object.assign(d,u),d})}}async get(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=ZS(e);return r=N("files/{file}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=XS(e);return r=N("files/{file}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{const u=QS(l),d=new lA;return Object.assign(d,u),d})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wr(n){const e={},t=c(n,["data"]);if(t!=null&&h(e,["data"],t),c(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function iE(n){const e={},t=c(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>_E(r))),h(e,["parts"],s)}const i=c(n,["role"]);return i!=null&&h(e,["role"],i),e}function sE(n){const e={};if(c(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=c(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function rE(n){const e={},t=c(n,["id"]);t!=null&&h(e,["id"],t);const i=c(n,["args"]);i!=null&&h(e,["args"],i);const s=c(n,["name"]);if(s!=null&&h(e,["name"],s),c(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(c(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function oE(n){const e={};if(c(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=c(n,["description"]);t!=null&&h(e,["description"],t);const i=c(n,["name"]);i!=null&&h(e,["name"],i);const s=c(n,["parameters"]);s!=null&&h(e,["parameters"],s);const r=c(n,["parametersJsonSchema"]);r!=null&&h(e,["parametersJsonSchema"],r);const o=c(n,["response"]);o!=null&&h(e,["response"],o);const a=c(n,["responseJsonSchema"]);return a!=null&&h(e,["responseJsonSchema"],a),e}function aE(n){const e={},t=c(n,["modelSelectionConfig"]);t!=null&&h(e,["modelConfig"],t);const i=c(n,["responseJsonSchema"]);i!=null&&h(e,["responseJsonSchema"],i);const s=c(n,["audioTimestamp"]);s!=null&&h(e,["audioTimestamp"],s);const r=c(n,["candidateCount"]);r!=null&&h(e,["candidateCount"],r);const o=c(n,["enableAffectiveDialog"]);o!=null&&h(e,["enableAffectiveDialog"],o);const a=c(n,["frequencyPenalty"]);a!=null&&h(e,["frequencyPenalty"],a);const l=c(n,["logprobs"]);l!=null&&h(e,["logprobs"],l);const u=c(n,["maxOutputTokens"]);u!=null&&h(e,["maxOutputTokens"],u);const d=c(n,["mediaResolution"]);d!=null&&h(e,["mediaResolution"],d);const f=c(n,["presencePenalty"]);f!=null&&h(e,["presencePenalty"],f);const p=c(n,["responseLogprobs"]);p!=null&&h(e,["responseLogprobs"],p);const g=c(n,["responseMimeType"]);g!=null&&h(e,["responseMimeType"],g);const m=c(n,["responseModalities"]);m!=null&&h(e,["responseModalities"],m);const v=c(n,["responseSchema"]);v!=null&&h(e,["responseSchema"],v);const S=c(n,["routingConfig"]);S!=null&&h(e,["routingConfig"],S);const y=c(n,["seed"]);y!=null&&h(e,["seed"],y);const _=c(n,["speechConfig"]);_!=null&&h(e,["speechConfig"],Gg(_));const A=c(n,["stopSequences"]);A!=null&&h(e,["stopSequences"],A);const E=c(n,["temperature"]);E!=null&&h(e,["temperature"],E);const w=c(n,["thinkingConfig"]);w!=null&&h(e,["thinkingConfig"],w);const C=c(n,["topK"]);C!=null&&h(e,["topK"],C);const T=c(n,["topP"]);if(T!=null&&h(e,["topP"],T),c(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function lE(n){const e={};if(c(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=c(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function uE(n){const e={};if(c(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(c(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=c(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function cE(n,e){const t={},i=c(n,["generationConfig"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig"],i);const s=c(n,["responseModalities"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig","responseModalities"],s);const r=c(n,["temperature"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","temperature"],r);const o=c(n,["topP"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","topP"],o);const a=c(n,["topK"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topK"],a);const l=c(n,["maxOutputTokens"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","maxOutputTokens"],l);const u=c(n,["mediaResolution"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","mediaResolution"],u);const d=c(n,["seed"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","seed"],d);const f=c(n,["speechConfig"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","speechConfig"],Uu(f));const p=c(n,["thinkingConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","thinkingConfig"],p);const g=c(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],g);const m=c(n,["systemInstruction"]);e!==void 0&&m!=null&&h(e,["setup","systemInstruction"],iE(Be(m)));const v=c(n,["tools"]);if(e!==void 0&&v!=null){let C=Di(v);Array.isArray(C)&&(C=C.map(T=>SE(Li(T)))),h(e,["setup","tools"],C)}const S=c(n,["sessionResumption"]);e!==void 0&&S!=null&&h(e,["setup","sessionResumption"],AE(S));const y=c(n,["inputAudioTranscription"]);e!==void 0&&y!=null&&h(e,["setup","inputAudioTranscription"],y);const _=c(n,["outputAudioTranscription"]);e!==void 0&&_!=null&&h(e,["setup","outputAudioTranscription"],_);const A=c(n,["realtimeInputConfig"]);e!==void 0&&A!=null&&h(e,["setup","realtimeInputConfig"],A);const E=c(n,["contextWindowCompression"]);e!==void 0&&E!=null&&h(e,["setup","contextWindowCompression"],E);const w=c(n,["proactivity"]);return e!==void 0&&w!=null&&h(e,["setup","proactivity"],w),t}function dE(n,e){const t={},i=c(n,["generationConfig"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig"],aE(i));const s=c(n,["responseModalities"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig","responseModalities"],s);const r=c(n,["temperature"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","temperature"],r);const o=c(n,["topP"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","topP"],o);const a=c(n,["topK"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topK"],a);const l=c(n,["maxOutputTokens"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","maxOutputTokens"],l);const u=c(n,["mediaResolution"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","mediaResolution"],u);const d=c(n,["seed"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","seed"],d);const f=c(n,["speechConfig"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","speechConfig"],Gg(Uu(f)));const p=c(n,["thinkingConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","thinkingConfig"],p);const g=c(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],g);const m=c(n,["systemInstruction"]);e!==void 0&&m!=null&&h(e,["setup","systemInstruction"],Be(m));const v=c(n,["tools"]);if(e!==void 0&&v!=null){let C=Di(v);Array.isArray(C)&&(C=C.map(T=>EE(Li(T)))),h(e,["setup","tools"],C)}const S=c(n,["sessionResumption"]);e!==void 0&&S!=null&&h(e,["setup","sessionResumption"],S);const y=c(n,["inputAudioTranscription"]);e!==void 0&&y!=null&&h(e,["setup","inputAudioTranscription"],y);const _=c(n,["outputAudioTranscription"]);e!==void 0&&_!=null&&h(e,["setup","outputAudioTranscription"],_);const A=c(n,["realtimeInputConfig"]);e!==void 0&&A!=null&&h(e,["setup","realtimeInputConfig"],A);const E=c(n,["contextWindowCompression"]);e!==void 0&&E!=null&&h(e,["setup","contextWindowCompression"],E);const w=c(n,["proactivity"]);return e!==void 0&&w!=null&&h(e,["setup","proactivity"],w),t}function hE(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["setup","model"],te(n,i));const s=c(e,["config"]);return s!=null&&h(t,["config"],cE(s,t)),t}function fE(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["setup","model"],te(n,i));const s=c(e,["config"]);return s!=null&&h(t,["config"],dE(s,t)),t}function pE(n){const e={},t=c(n,["musicGenerationConfig"]);return t!=null&&h(e,["musicGenerationConfig"],t),e}function gE(n){const e={},t=c(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(s=>s)),h(e,["weightedPrompts"],i)}return e}function mE(n){const e={},t=c(n,["media"]);if(t!=null){let u=Pg(t);Array.isArray(u)&&(u=u.map(d=>wr(d))),h(e,["mediaChunks"],u)}const i=c(n,["audio"]);i!=null&&h(e,["audio"],wr(Mg(i)));const s=c(n,["audioStreamEnd"]);s!=null&&h(e,["audioStreamEnd"],s);const r=c(n,["video"]);r!=null&&h(e,["video"],wr(Rg(r)));const o=c(n,["text"]);o!=null&&h(e,["text"],o);const a=c(n,["activityStart"]);a!=null&&h(e,["activityStart"],a);const l=c(n,["activityEnd"]);return l!=null&&h(e,["activityEnd"],l),e}function yE(n){const e={},t=c(n,["media"]);if(t!=null){let u=Pg(t);Array.isArray(u)&&(u=u.map(d=>d)),h(e,["mediaChunks"],u)}const i=c(n,["audio"]);i!=null&&h(e,["audio"],Mg(i));const s=c(n,["audioStreamEnd"]);s!=null&&h(e,["audioStreamEnd"],s);const r=c(n,["video"]);r!=null&&h(e,["video"],Rg(r));const o=c(n,["text"]);o!=null&&h(e,["text"],o);const a=c(n,["activityStart"]);a!=null&&h(e,["activityStart"],a);const l=c(n,["activityEnd"]);return l!=null&&h(e,["activityEnd"],l),e}function vE(n){const e={},t=c(n,["setupComplete"]);t!=null&&h(e,["setupComplete"],t);const i=c(n,["serverContent"]);i!=null&&h(e,["serverContent"],i);const s=c(n,["toolCall"]);s!=null&&h(e,["toolCall"],s);const r=c(n,["toolCallCancellation"]);r!=null&&h(e,["toolCallCancellation"],r);const o=c(n,["usageMetadata"]);o!=null&&h(e,["usageMetadata"],wE(o));const a=c(n,["goAway"]);a!=null&&h(e,["goAway"],a);const l=c(n,["sessionResumptionUpdate"]);return l!=null&&h(e,["sessionResumptionUpdate"],l),e}function _E(n){const e={},t=c(n,["mediaResolution"]);t!=null&&h(e,["mediaResolution"],t);const i=c(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);const s=c(n,["executableCode"]);s!=null&&h(e,["executableCode"],s);const r=c(n,["fileData"]);r!=null&&h(e,["fileData"],sE(r));const o=c(n,["functionCall"]);o!=null&&h(e,["functionCall"],rE(o));const a=c(n,["functionResponse"]);a!=null&&h(e,["functionResponse"],a);const l=c(n,["inlineData"]);l!=null&&h(e,["inlineData"],wr(l));const u=c(n,["text"]);u!=null&&h(e,["text"],u);const d=c(n,["thought"]);d!=null&&h(e,["thought"],d);const f=c(n,["thoughtSignature"]);f!=null&&h(e,["thoughtSignature"],f);const p=c(n,["videoMetadata"]);return p!=null&&h(e,["videoMetadata"],p),e}function AE(n){const e={},t=c(n,["handle"]);if(t!=null&&h(e,["handle"],t),c(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Gg(n){const e={},t=c(n,["languageCode"]);t!=null&&h(e,["languageCode"],t);const i=c(n,["voiceConfig"]);if(i!=null&&h(e,["voiceConfig"],i),c(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function SE(n){const e={},t=c(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(f=>f)),h(e,["functionDeclarations"],d)}if(c(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=c(n,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const s=c(n,["computerUse"]);s!=null&&h(e,["computerUse"],s);const r=c(n,["fileSearch"]);r!=null&&h(e,["fileSearch"],r);const o=c(n,["codeExecution"]);if(o!=null&&h(e,["codeExecution"],o),c(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=c(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],lE(a));const l=c(n,["googleSearch"]);l!=null&&h(e,["googleSearch"],uE(l));const u=c(n,["urlContext"]);return u!=null&&h(e,["urlContext"],u),e}function EE(n){const e={},t=c(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>oE(p))),h(e,["functionDeclarations"],f)}const i=c(n,["retrieval"]);i!=null&&h(e,["retrieval"],i);const s=c(n,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const r=c(n,["computerUse"]);if(r!=null&&h(e,["computerUse"],r),c(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=c(n,["codeExecution"]);o!=null&&h(e,["codeExecution"],o);const a=c(n,["enterpriseWebSearch"]);a!=null&&h(e,["enterpriseWebSearch"],a);const l=c(n,["googleMaps"]);l!=null&&h(e,["googleMaps"],l);const u=c(n,["googleSearch"]);u!=null&&h(e,["googleSearch"],u);const d=c(n,["urlContext"]);return d!=null&&h(e,["urlContext"],d),e}function wE(n){const e={},t=c(n,["promptTokenCount"]);t!=null&&h(e,["promptTokenCount"],t);const i=c(n,["cachedContentTokenCount"]);i!=null&&h(e,["cachedContentTokenCount"],i);const s=c(n,["candidatesTokenCount"]);s!=null&&h(e,["responseTokenCount"],s);const r=c(n,["toolUsePromptTokenCount"]);r!=null&&h(e,["toolUsePromptTokenCount"],r);const o=c(n,["thoughtsTokenCount"]);o!=null&&h(e,["thoughtsTokenCount"],o);const a=c(n,["totalTokenCount"]);a!=null&&h(e,["totalTokenCount"],a);const l=c(n,["promptTokensDetails"]);if(l!=null){let g=l;Array.isArray(g)&&(g=g.map(m=>m)),h(e,["promptTokensDetails"],g)}const u=c(n,["cacheTokensDetails"]);if(u!=null){let g=u;Array.isArray(g)&&(g=g.map(m=>m)),h(e,["cacheTokensDetails"],g)}const d=c(n,["candidatesTokensDetails"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(m=>m)),h(e,["responseTokensDetails"],g)}const f=c(n,["toolUsePromptTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(m=>m)),h(e,["toolUsePromptTokensDetails"],g)}const p=c(n,["trafficType"]);return p!=null&&h(e,["trafficType"],p),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function CE(n){const e={},t=c(n,["data"]);if(t!=null&&h(e,["data"],t),c(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function TE(n){const e={},t=c(n,["content"]);t!=null&&h(e,["content"],t);const i=c(n,["citationMetadata"]);i!=null&&h(e,["citationMetadata"],xE(i));const s=c(n,["tokenCount"]);s!=null&&h(e,["tokenCount"],s);const r=c(n,["finishReason"]);r!=null&&h(e,["finishReason"],r);const o=c(n,["avgLogprobs"]);o!=null&&h(e,["avgLogprobs"],o);const a=c(n,["groundingMetadata"]);a!=null&&h(e,["groundingMetadata"],a);const l=c(n,["index"]);l!=null&&h(e,["index"],l);const u=c(n,["logprobsResult"]);u!=null&&h(e,["logprobsResult"],u);const d=c(n,["safetyRatings"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(g=>g)),h(e,["safetyRatings"],p)}const f=c(n,["urlContextMetadata"]);return f!=null&&h(e,["urlContextMetadata"],f),e}function xE(n){const e={},t=c(n,["citationSources"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(s=>s)),h(e,["citations"],i)}return e}function IE(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["contents"]);if(s!=null){let r=St(s);Array.isArray(r)&&(r=r.map(o=>o)),h(t,["contents"],r)}return t}function PE(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["tokensInfo"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>r)),h(e,["tokensInfo"],s)}return e}function RE(n){const e={},t=c(n,["values"]);t!=null&&h(e,["values"],t);const i=c(n,["statistics"]);return i!=null&&h(e,["statistics"],ME(i)),e}function ME(n){const e={},t=c(n,["truncated"]);t!=null&&h(e,["truncated"],t);const i=c(n,["token_count"]);return i!=null&&h(e,["tokenCount"],i),e}function Po(n){const e={},t=c(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>Vw(r))),h(e,["parts"],s)}const i=c(n,["role"]);return i!=null&&h(e,["role"],i),e}function kE(n){const e={},t=c(n,["controlType"]);t!=null&&h(e,["controlType"],t);const i=c(n,["enableControlImageComputation"]);return i!=null&&h(e,["computeControl"],i),e}function bE(n){const e={};if(c(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(c(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(c(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function NE(n,e){const t={},i=c(n,["systemInstruction"]);e!==void 0&&i!=null&&h(e,["systemInstruction"],Be(i));const s=c(n,["tools"]);if(e!==void 0&&s!=null){let o=s;Array.isArray(o)&&(o=o.map(a=>Wg(a))),h(e,["tools"],o)}const r=c(n,["generationConfig"]);return e!==void 0&&r!=null&&h(e,["generationConfig"],Cw(r)),t}function LE(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["contents"]);if(s!=null){let o=St(s);Array.isArray(o)&&(o=o.map(a=>Po(a))),h(t,["contents"],o)}const r=c(e,["config"]);return r!=null&&bE(r),t}function DE(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["contents"]);if(s!=null){let o=St(s);Array.isArray(o)&&(o=o.map(a=>a)),h(t,["contents"],o)}const r=c(e,["config"]);return r!=null&&NE(r,t),t}function FE(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["totalTokens"]);i!=null&&h(e,["totalTokens"],i);const s=c(n,["cachedContentTokenCount"]);return s!=null&&h(e,["cachedContentTokenCount"],s),e}function UE(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["totalTokens"]);return i!=null&&h(e,["totalTokens"],i),e}function HE(n,e){const t={},i=c(e,["model"]);return i!=null&&h(t,["_url","name"],te(n,i)),t}function VE(n,e){const t={},i=c(e,["model"]);return i!=null&&h(t,["_url","name"],te(n,i)),t}function OE(n){const e={},t=c(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function GE(n){const e={},t=c(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}function BE(n,e){const t={},i=c(n,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);const s=c(n,["negativePrompt"]);e!==void 0&&s!=null&&h(e,["parameters","negativePrompt"],s);const r=c(n,["numberOfImages"]);e!==void 0&&r!=null&&h(e,["parameters","sampleCount"],r);const o=c(n,["aspectRatio"]);e!==void 0&&o!=null&&h(e,["parameters","aspectRatio"],o);const a=c(n,["guidanceScale"]);e!==void 0&&a!=null&&h(e,["parameters","guidanceScale"],a);const l=c(n,["seed"]);e!==void 0&&l!=null&&h(e,["parameters","seed"],l);const u=c(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&h(e,["parameters","safetySetting"],u);const d=c(n,["personGeneration"]);e!==void 0&&d!=null&&h(e,["parameters","personGeneration"],d);const f=c(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&h(e,["parameters","includeSafetyAttributes"],f);const p=c(n,["includeRaiReason"]);e!==void 0&&p!=null&&h(e,["parameters","includeRaiReason"],p);const g=c(n,["language"]);e!==void 0&&g!=null&&h(e,["parameters","language"],g);const m=c(n,["outputMimeType"]);e!==void 0&&m!=null&&h(e,["parameters","outputOptions","mimeType"],m);const v=c(n,["outputCompressionQuality"]);e!==void 0&&v!=null&&h(e,["parameters","outputOptions","compressionQuality"],v);const S=c(n,["addWatermark"]);e!==void 0&&S!=null&&h(e,["parameters","addWatermark"],S);const y=c(n,["labels"]);e!==void 0&&y!=null&&h(e,["labels"],y);const _=c(n,["editMode"]);e!==void 0&&_!=null&&h(e,["parameters","editMode"],_);const A=c(n,["baseSteps"]);return e!==void 0&&A!=null&&h(e,["parameters","editConfig","baseSteps"],A),t}function zE(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["prompt"]);s!=null&&h(t,["instances[0]","prompt"],s);const r=c(e,["referenceImages"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>$w(l))),h(t,["instances[0]","referenceImages"],a)}const o=c(e,["config"]);return o!=null&&BE(o,t),t}function qE(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>Ro(r))),h(e,["generatedImages"],s)}return e}function $E(n,e){const t={},i=c(n,["taskType"]);e!==void 0&&i!=null&&h(e,["requests[]","taskType"],i);const s=c(n,["title"]);e!==void 0&&s!=null&&h(e,["requests[]","title"],s);const r=c(n,["outputDimensionality"]);if(e!==void 0&&r!=null&&h(e,["requests[]","outputDimensionality"],r),c(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(c(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function WE(n,e){const t={},i=c(n,["taskType"]);e!==void 0&&i!=null&&h(e,["instances[]","task_type"],i);const s=c(n,["title"]);e!==void 0&&s!=null&&h(e,["instances[]","title"],s);const r=c(n,["outputDimensionality"]);e!==void 0&&r!=null&&h(e,["parameters","outputDimensionality"],r);const o=c(n,["mimeType"]);e!==void 0&&o!=null&&h(e,["instances[]","mimeType"],o);const a=c(n,["autoTruncate"]);return e!==void 0&&a!=null&&h(e,["parameters","autoTruncate"],a),t}function YE(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["contents"]);if(s!=null){let a=Lu(n,s);Array.isArray(a)&&(a=a.map(l=>l)),h(t,["requests[]","content"],a)}const r=c(e,["config"]);r!=null&&$E(r,t);const o=c(e,["model"]);return o!==void 0&&h(t,["requests[]","model"],te(n,o)),t}function KE(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["contents"]);if(s!=null){let o=Lu(n,s);Array.isArray(o)&&(o=o.map(a=>a)),h(t,["instances[]","content"],o)}const r=c(e,["config"]);return r!=null&&WE(r,t),t}function JE(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["embeddings"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["embeddings"],r)}const s=c(n,["metadata"]);return s!=null&&h(e,["metadata"],s),e}function XE(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["predictions[]","embeddings"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>RE(o))),h(e,["embeddings"],r)}const s=c(n,["metadata"]);return s!=null&&h(e,["metadata"],s),e}function QE(n){const e={},t=c(n,["endpoint"]);t!=null&&h(e,["name"],t);const i=c(n,["deployedModelId"]);return i!=null&&h(e,["deployedModelId"],i),e}function ZE(n){const e={};if(c(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=c(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function jE(n){const e={},t=c(n,["id"]);t!=null&&h(e,["id"],t);const i=c(n,["args"]);i!=null&&h(e,["args"],i);const s=c(n,["name"]);if(s!=null&&h(e,["name"],s),c(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(c(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function ew(n){const e={},t=c(n,["mode"]);t!=null&&h(e,["mode"],t);const i=c(n,["allowedFunctionNames"]);if(i!=null&&h(e,["allowedFunctionNames"],i),c(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function tw(n){const e={};if(c(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=c(n,["description"]);t!=null&&h(e,["description"],t);const i=c(n,["name"]);i!=null&&h(e,["name"],i);const s=c(n,["parameters"]);s!=null&&h(e,["parameters"],s);const r=c(n,["parametersJsonSchema"]);r!=null&&h(e,["parametersJsonSchema"],r);const o=c(n,["response"]);o!=null&&h(e,["response"],o);const a=c(n,["responseJsonSchema"]);return a!=null&&h(e,["responseJsonSchema"],a),e}function nw(n,e,t){const i={},s=c(e,["systemInstruction"]);t!==void 0&&s!=null&&h(t,["systemInstruction"],Po(Be(s)));const r=c(e,["temperature"]);r!=null&&h(i,["temperature"],r);const o=c(e,["topP"]);o!=null&&h(i,["topP"],o);const a=c(e,["topK"]);a!=null&&h(i,["topK"],a);const l=c(e,["candidateCount"]);l!=null&&h(i,["candidateCount"],l);const u=c(e,["maxOutputTokens"]);u!=null&&h(i,["maxOutputTokens"],u);const d=c(e,["stopSequences"]);d!=null&&h(i,["stopSequences"],d);const f=c(e,["responseLogprobs"]);f!=null&&h(i,["responseLogprobs"],f);const p=c(e,["logprobs"]);p!=null&&h(i,["logprobs"],p);const g=c(e,["presencePenalty"]);g!=null&&h(i,["presencePenalty"],g);const m=c(e,["frequencyPenalty"]);m!=null&&h(i,["frequencyPenalty"],m);const v=c(e,["seed"]);v!=null&&h(i,["seed"],v);const S=c(e,["responseMimeType"]);S!=null&&h(i,["responseMimeType"],S);const y=c(e,["responseSchema"]);y!=null&&h(i,["responseSchema"],Du(y));const _=c(e,["responseJsonSchema"]);if(_!=null&&h(i,["responseJsonSchema"],_),c(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(c(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const A=c(e,["safetySettings"]);if(t!==void 0&&A!=null){let V=A;Array.isArray(V)&&(V=V.map(J=>Ww(J))),h(t,["safetySettings"],V)}const E=c(e,["tools"]);if(t!==void 0&&E!=null){let V=Di(E);Array.isArray(V)&&(V=V.map(J=>jw(Li(J)))),h(t,["tools"],V)}const w=c(e,["toolConfig"]);if(t!==void 0&&w!=null&&h(t,["toolConfig"],Zw(w)),c(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const C=c(e,["cachedContent"]);t!==void 0&&C!=null&&h(t,["cachedContent"],sn(n,C));const T=c(e,["responseModalities"]);T!=null&&h(i,["responseModalities"],T);const I=c(e,["mediaResolution"]);I!=null&&h(i,["mediaResolution"],I);const P=c(e,["speechConfig"]);if(P!=null&&h(i,["speechConfig"],Fu(P)),c(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const R=c(e,["thinkingConfig"]);R!=null&&h(i,["thinkingConfig"],R);const L=c(e,["imageConfig"]);return L!=null&&h(i,["imageConfig"],Rw(L)),i}function iw(n,e,t){const i={},s=c(e,["systemInstruction"]);t!==void 0&&s!=null&&h(t,["systemInstruction"],Be(s));const r=c(e,["temperature"]);r!=null&&h(i,["temperature"],r);const o=c(e,["topP"]);o!=null&&h(i,["topP"],o);const a=c(e,["topK"]);a!=null&&h(i,["topK"],a);const l=c(e,["candidateCount"]);l!=null&&h(i,["candidateCount"],l);const u=c(e,["maxOutputTokens"]);u!=null&&h(i,["maxOutputTokens"],u);const d=c(e,["stopSequences"]);d!=null&&h(i,["stopSequences"],d);const f=c(e,["responseLogprobs"]);f!=null&&h(i,["responseLogprobs"],f);const p=c(e,["logprobs"]);p!=null&&h(i,["logprobs"],p);const g=c(e,["presencePenalty"]);g!=null&&h(i,["presencePenalty"],g);const m=c(e,["frequencyPenalty"]);m!=null&&h(i,["frequencyPenalty"],m);const v=c(e,["seed"]);v!=null&&h(i,["seed"],v);const S=c(e,["responseMimeType"]);S!=null&&h(i,["responseMimeType"],S);const y=c(e,["responseSchema"]);y!=null&&h(i,["responseSchema"],Du(y));const _=c(e,["responseJsonSchema"]);_!=null&&h(i,["responseJsonSchema"],_);const A=c(e,["routingConfig"]);A!=null&&h(i,["routingConfig"],A);const E=c(e,["modelSelectionConfig"]);E!=null&&h(i,["modelConfig"],E);const w=c(e,["safetySettings"]);if(t!==void 0&&w!=null){let k=w;Array.isArray(k)&&(k=k.map(U=>U)),h(t,["safetySettings"],k)}const C=c(e,["tools"]);if(t!==void 0&&C!=null){let k=Di(C);Array.isArray(k)&&(k=k.map(U=>Wg(Li(U)))),h(t,["tools"],k)}const T=c(e,["toolConfig"]);t!==void 0&&T!=null&&h(t,["toolConfig"],T);const I=c(e,["labels"]);t!==void 0&&I!=null&&h(t,["labels"],I);const P=c(e,["cachedContent"]);t!==void 0&&P!=null&&h(t,["cachedContent"],sn(n,P));const R=c(e,["responseModalities"]);R!=null&&h(i,["responseModalities"],R);const L=c(e,["mediaResolution"]);L!=null&&h(i,["mediaResolution"],L);const V=c(e,["speechConfig"]);V!=null&&h(i,["speechConfig"],$g(Fu(V)));const J=c(e,["audioTimestamp"]);J!=null&&h(i,["audioTimestamp"],J);const ee=c(e,["thinkingConfig"]);ee!=null&&h(i,["thinkingConfig"],ee);const Ae=c(e,["imageConfig"]);return Ae!=null&&h(i,["imageConfig"],Mw(Ae)),i}function Ih(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["contents"]);if(s!=null){let o=St(s);Array.isArray(o)&&(o=o.map(a=>Po(a))),h(t,["contents"],o)}const r=c(e,["config"]);return r!=null&&h(t,["generationConfig"],nw(n,r,t)),t}function Ph(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["contents"]);if(s!=null){let o=St(s);Array.isArray(o)&&(o=o.map(a=>a)),h(t,["contents"],o)}const r=c(e,["config"]);return r!=null&&h(t,["generationConfig"],iw(n,r,t)),t}function Rh(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["candidates"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(u=>TE(u))),h(e,["candidates"],l)}const s=c(n,["modelVersion"]);s!=null&&h(e,["modelVersion"],s);const r=c(n,["promptFeedback"]);r!=null&&h(e,["promptFeedback"],r);const o=c(n,["responseId"]);o!=null&&h(e,["responseId"],o);const a=c(n,["usageMetadata"]);return a!=null&&h(e,["usageMetadata"],a),e}function Mh(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["candidates"]);if(i!=null){let u=i;Array.isArray(u)&&(u=u.map(d=>d)),h(e,["candidates"],u)}const s=c(n,["createTime"]);s!=null&&h(e,["createTime"],s);const r=c(n,["modelVersion"]);r!=null&&h(e,["modelVersion"],r);const o=c(n,["promptFeedback"]);o!=null&&h(e,["promptFeedback"],o);const a=c(n,["responseId"]);a!=null&&h(e,["responseId"],a);const l=c(n,["usageMetadata"]);return l!=null&&h(e,["usageMetadata"],l),e}function sw(n,e){const t={};if(c(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(c(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=c(n,["numberOfImages"]);e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i);const s=c(n,["aspectRatio"]);e!==void 0&&s!=null&&h(e,["parameters","aspectRatio"],s);const r=c(n,["guidanceScale"]);if(e!==void 0&&r!=null&&h(e,["parameters","guidanceScale"],r),c(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=c(n,["safetyFilterLevel"]);e!==void 0&&o!=null&&h(e,["parameters","safetySetting"],o);const a=c(n,["personGeneration"]);e!==void 0&&a!=null&&h(e,["parameters","personGeneration"],a);const l=c(n,["includeSafetyAttributes"]);e!==void 0&&l!=null&&h(e,["parameters","includeSafetyAttributes"],l);const u=c(n,["includeRaiReason"]);e!==void 0&&u!=null&&h(e,["parameters","includeRaiReason"],u);const d=c(n,["language"]);e!==void 0&&d!=null&&h(e,["parameters","language"],d);const f=c(n,["outputMimeType"]);e!==void 0&&f!=null&&h(e,["parameters","outputOptions","mimeType"],f);const p=c(n,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&h(e,["parameters","outputOptions","compressionQuality"],p),c(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(c(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const g=c(n,["imageSize"]);if(e!==void 0&&g!=null&&h(e,["parameters","sampleImageSize"],g),c(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function rw(n,e){const t={},i=c(n,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);const s=c(n,["negativePrompt"]);e!==void 0&&s!=null&&h(e,["parameters","negativePrompt"],s);const r=c(n,["numberOfImages"]);e!==void 0&&r!=null&&h(e,["parameters","sampleCount"],r);const o=c(n,["aspectRatio"]);e!==void 0&&o!=null&&h(e,["parameters","aspectRatio"],o);const a=c(n,["guidanceScale"]);e!==void 0&&a!=null&&h(e,["parameters","guidanceScale"],a);const l=c(n,["seed"]);e!==void 0&&l!=null&&h(e,["parameters","seed"],l);const u=c(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&h(e,["parameters","safetySetting"],u);const d=c(n,["personGeneration"]);e!==void 0&&d!=null&&h(e,["parameters","personGeneration"],d);const f=c(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&h(e,["parameters","includeSafetyAttributes"],f);const p=c(n,["includeRaiReason"]);e!==void 0&&p!=null&&h(e,["parameters","includeRaiReason"],p);const g=c(n,["language"]);e!==void 0&&g!=null&&h(e,["parameters","language"],g);const m=c(n,["outputMimeType"]);e!==void 0&&m!=null&&h(e,["parameters","outputOptions","mimeType"],m);const v=c(n,["outputCompressionQuality"]);e!==void 0&&v!=null&&h(e,["parameters","outputOptions","compressionQuality"],v);const S=c(n,["addWatermark"]);e!==void 0&&S!=null&&h(e,["parameters","addWatermark"],S);const y=c(n,["labels"]);e!==void 0&&y!=null&&h(e,["labels"],y);const _=c(n,["imageSize"]);e!==void 0&&_!=null&&h(e,["parameters","sampleImageSize"],_);const A=c(n,["enhancePrompt"]);return e!==void 0&&A!=null&&h(e,["parameters","enhancePrompt"],A),t}function ow(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["prompt"]);s!=null&&h(t,["instances[0]","prompt"],s);const r=c(e,["config"]);return r!=null&&sw(r,t),t}function aw(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["prompt"]);s!=null&&h(t,["instances[0]","prompt"],s);const r=c(e,["config"]);return r!=null&&rw(r,t),t}function lw(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["predictions"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>Aw(o))),h(e,["generatedImages"],r)}const s=c(n,["positivePromptSafetyAttributes"]);return s!=null&&h(e,["positivePromptSafetyAttributes"],zg(s)),e}function uw(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["predictions"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>Ro(o))),h(e,["generatedImages"],r)}const s=c(n,["positivePromptSafetyAttributes"]);return s!=null&&h(e,["positivePromptSafetyAttributes"],qg(s)),e}function cw(n,e){const t={},i=c(n,["numberOfVideos"]);if(e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i),c(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(c(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const s=c(n,["durationSeconds"]);if(e!==void 0&&s!=null&&h(e,["parameters","durationSeconds"],s),c(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=c(n,["aspectRatio"]);e!==void 0&&r!=null&&h(e,["parameters","aspectRatio"],r);const o=c(n,["resolution"]);e!==void 0&&o!=null&&h(e,["parameters","resolution"],o);const a=c(n,["personGeneration"]);if(e!==void 0&&a!=null&&h(e,["parameters","personGeneration"],a),c(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const l=c(n,["negativePrompt"]);e!==void 0&&l!=null&&h(e,["parameters","negativePrompt"],l);const u=c(n,["enhancePrompt"]);if(e!==void 0&&u!=null&&h(e,["parameters","enhancePrompt"],u),c(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const d=c(n,["lastFrame"]);e!==void 0&&d!=null&&h(e,["instances[0]","lastFrame"],Mo(d));const f=c(n,["referenceImages"]);if(e!==void 0&&f!=null){let p=f;Array.isArray(p)&&(p=p.map(g=>hC(g))),h(e,["instances[0]","referenceImages"],p)}if(c(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(c(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function dw(n,e){const t={},i=c(n,["numberOfVideos"]);e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i);const s=c(n,["outputGcsUri"]);e!==void 0&&s!=null&&h(e,["parameters","storageUri"],s);const r=c(n,["fps"]);e!==void 0&&r!=null&&h(e,["parameters","fps"],r);const o=c(n,["durationSeconds"]);e!==void 0&&o!=null&&h(e,["parameters","durationSeconds"],o);const a=c(n,["seed"]);e!==void 0&&a!=null&&h(e,["parameters","seed"],a);const l=c(n,["aspectRatio"]);e!==void 0&&l!=null&&h(e,["parameters","aspectRatio"],l);const u=c(n,["resolution"]);e!==void 0&&u!=null&&h(e,["parameters","resolution"],u);const d=c(n,["personGeneration"]);e!==void 0&&d!=null&&h(e,["parameters","personGeneration"],d);const f=c(n,["pubsubTopic"]);e!==void 0&&f!=null&&h(e,["parameters","pubsubTopic"],f);const p=c(n,["negativePrompt"]);e!==void 0&&p!=null&&h(e,["parameters","negativePrompt"],p);const g=c(n,["enhancePrompt"]);e!==void 0&&g!=null&&h(e,["parameters","enhancePrompt"],g);const m=c(n,["generateAudio"]);e!==void 0&&m!=null&&h(e,["parameters","generateAudio"],m);const v=c(n,["lastFrame"]);e!==void 0&&v!=null&&h(e,["instances[0]","lastFrame"],Nt(v));const S=c(n,["referenceImages"]);if(e!==void 0&&S!=null){let A=S;Array.isArray(A)&&(A=A.map(E=>fC(E))),h(e,["instances[0]","referenceImages"],A)}const y=c(n,["mask"]);e!==void 0&&y!=null&&h(e,["instances[0]","mask"],dC(y));const _=c(n,["compressionQuality"]);return e!==void 0&&_!=null&&h(e,["parameters","compressionQuality"],_),t}function hw(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["metadata"]);i!=null&&h(e,["metadata"],i);const s=c(n,["done"]);s!=null&&h(e,["done"],s);const r=c(n,["error"]);r!=null&&h(e,["error"],r);const o=c(n,["response","generateVideoResponse"]);return o!=null&&h(e,["response"],mw(o)),e}function fw(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["metadata"]);i!=null&&h(e,["metadata"],i);const s=c(n,["done"]);s!=null&&h(e,["done"],s);const r=c(n,["error"]);r!=null&&h(e,["error"],r);const o=c(n,["response"]);return o!=null&&h(e,["response"],yw(o)),e}function pw(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["prompt"]);s!=null&&h(t,["instances[0]","prompt"],s);const r=c(e,["image"]);r!=null&&h(t,["instances[0]","image"],Mo(r));const o=c(e,["video"]);o!=null&&h(t,["instances[0]","video"],Yg(o));const a=c(e,["source"]);a!=null&&vw(a,t);const l=c(e,["config"]);return l!=null&&cw(l,t),t}function gw(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["prompt"]);s!=null&&h(t,["instances[0]","prompt"],s);const r=c(e,["image"]);r!=null&&h(t,["instances[0]","image"],Nt(r));const o=c(e,["video"]);o!=null&&h(t,["instances[0]","video"],Kg(o));const a=c(e,["source"]);a!=null&&_w(a,t);const l=c(e,["config"]);return l!=null&&dw(l,t),t}function mw(n){const e={},t=c(n,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>Ew(o))),h(e,["generatedVideos"],r)}const i=c(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);const s=c(n,["raiMediaFilteredReasons"]);return s!=null&&h(e,["raiMediaFilteredReasons"],s),e}function yw(n){const e={},t=c(n,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>ww(o))),h(e,["generatedVideos"],r)}const i=c(n,["raiMediaFilteredCount"]);i!=null&&h(e,["raiMediaFilteredCount"],i);const s=c(n,["raiMediaFilteredReasons"]);return s!=null&&h(e,["raiMediaFilteredReasons"],s),e}function vw(n,e){const t={},i=c(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);const s=c(n,["image"]);e!==void 0&&s!=null&&h(e,["instances[0]","image"],Mo(s));const r=c(n,["video"]);return e!==void 0&&r!=null&&h(e,["instances[0]","video"],Yg(r)),t}function _w(n,e){const t={},i=c(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);const s=c(n,["image"]);e!==void 0&&s!=null&&h(e,["instances[0]","image"],Nt(s));const r=c(n,["video"]);return e!==void 0&&r!=null&&h(e,["instances[0]","video"],Kg(r)),t}function Aw(n){const e={},t=c(n,["_self"]);t!=null&&h(e,["image"],kw(t));const i=c(n,["raiFilteredReason"]);i!=null&&h(e,["raiFilteredReason"],i);const s=c(n,["_self"]);return s!=null&&h(e,["safetyAttributes"],zg(s)),e}function Ro(n){const e={},t=c(n,["_self"]);t!=null&&h(e,["image"],Bg(t));const i=c(n,["raiFilteredReason"]);i!=null&&h(e,["raiFilteredReason"],i);const s=c(n,["_self"]);s!=null&&h(e,["safetyAttributes"],qg(s));const r=c(n,["prompt"]);return r!=null&&h(e,["enhancedPrompt"],r),e}function Sw(n){const e={},t=c(n,["_self"]);t!=null&&h(e,["mask"],Bg(t));const i=c(n,["labels"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>r)),h(e,["labels"],s)}return e}function Ew(n){const e={},t=c(n,["video"]);return t!=null&&h(e,["video"],uC(t)),e}function ww(n){const e={},t=c(n,["_self"]);return t!=null&&h(e,["video"],cC(t)),e}function Cw(n){const e={},t=c(n,["modelSelectionConfig"]);t!=null&&h(e,["modelConfig"],t);const i=c(n,["responseJsonSchema"]);i!=null&&h(e,["responseJsonSchema"],i);const s=c(n,["audioTimestamp"]);s!=null&&h(e,["audioTimestamp"],s);const r=c(n,["candidateCount"]);r!=null&&h(e,["candidateCount"],r);const o=c(n,["enableAffectiveDialog"]);o!=null&&h(e,["enableAffectiveDialog"],o);const a=c(n,["frequencyPenalty"]);a!=null&&h(e,["frequencyPenalty"],a);const l=c(n,["logprobs"]);l!=null&&h(e,["logprobs"],l);const u=c(n,["maxOutputTokens"]);u!=null&&h(e,["maxOutputTokens"],u);const d=c(n,["mediaResolution"]);d!=null&&h(e,["mediaResolution"],d);const f=c(n,["presencePenalty"]);f!=null&&h(e,["presencePenalty"],f);const p=c(n,["responseLogprobs"]);p!=null&&h(e,["responseLogprobs"],p);const g=c(n,["responseMimeType"]);g!=null&&h(e,["responseMimeType"],g);const m=c(n,["responseModalities"]);m!=null&&h(e,["responseModalities"],m);const v=c(n,["responseSchema"]);v!=null&&h(e,["responseSchema"],v);const S=c(n,["routingConfig"]);S!=null&&h(e,["routingConfig"],S);const y=c(n,["seed"]);y!=null&&h(e,["seed"],y);const _=c(n,["speechConfig"]);_!=null&&h(e,["speechConfig"],$g(_));const A=c(n,["stopSequences"]);A!=null&&h(e,["stopSequences"],A);const E=c(n,["temperature"]);E!=null&&h(e,["temperature"],E);const w=c(n,["thinkingConfig"]);w!=null&&h(e,["thinkingConfig"],w);const C=c(n,["topK"]);C!=null&&h(e,["topK"],C);const T=c(n,["topP"]);if(T!=null&&h(e,["topP"],T),c(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Tw(n,e){const t={},i=c(e,["model"]);return i!=null&&h(t,["_url","name"],te(n,i)),t}function xw(n,e){const t={},i=c(e,["model"]);return i!=null&&h(t,["_url","name"],te(n,i)),t}function Iw(n){const e={};if(c(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=c(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function Pw(n){const e={};if(c(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(c(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=c(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function Rw(n){const e={},t=c(n,["aspectRatio"]);t!=null&&h(e,["aspectRatio"],t);const i=c(n,["imageSize"]);if(i!=null&&h(e,["imageSize"],i),c(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(c(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Mw(n){const e={},t=c(n,["aspectRatio"]);t!=null&&h(e,["aspectRatio"],t);const i=c(n,["imageSize"]);i!=null&&h(e,["imageSize"],i);const s=c(n,["outputMimeType"]);s!=null&&h(e,["imageOutputOptions","mimeType"],s);const r=c(n,["outputCompressionQuality"]);return r!=null&&h(e,["imageOutputOptions","compressionQuality"],r),e}function kw(n){const e={},t=c(n,["bytesBase64Encoded"]);t!=null&&h(e,["imageBytes"],Mn(t));const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function Bg(n){const e={},t=c(n,["gcsUri"]);t!=null&&h(e,["gcsUri"],t);const i=c(n,["bytesBase64Encoded"]);i!=null&&h(e,["imageBytes"],Mn(i));const s=c(n,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function Mo(n){const e={};if(c(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=c(n,["imageBytes"]);t!=null&&h(e,["bytesBase64Encoded"],Mn(t));const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function Nt(n){const e={},t=c(n,["gcsUri"]);t!=null&&h(e,["gcsUri"],t);const i=c(n,["imageBytes"]);i!=null&&h(e,["bytesBase64Encoded"],Mn(i));const s=c(n,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function bw(n,e,t){const i={},s=c(e,["pageSize"]);t!==void 0&&s!=null&&h(t,["_query","pageSize"],s);const r=c(e,["pageToken"]);t!==void 0&&r!=null&&h(t,["_query","pageToken"],r);const o=c(e,["filter"]);t!==void 0&&o!=null&&h(t,["_query","filter"],o);const a=c(e,["queryBase"]);return t!==void 0&&a!=null&&h(t,["_url","models_url"],Lg(n,a)),i}function Nw(n,e,t){const i={},s=c(e,["pageSize"]);t!==void 0&&s!=null&&h(t,["_query","pageSize"],s);const r=c(e,["pageToken"]);t!==void 0&&r!=null&&h(t,["_query","pageToken"],r);const o=c(e,["filter"]);t!==void 0&&o!=null&&h(t,["_query","filter"],o);const a=c(e,["queryBase"]);return t!==void 0&&a!=null&&h(t,["_url","models_url"],Lg(n,a)),i}function Lw(n,e){const t={},i=c(e,["config"]);return i!=null&&bw(n,i,t),t}function Dw(n,e){const t={},i=c(e,["config"]);return i!=null&&Nw(n,i,t),t}function Fw(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);const s=c(n,["_self"]);if(s!=null){let r=Dg(s);Array.isArray(r)&&(r=r.map(o=>yl(o))),h(e,["models"],r)}return e}function Uw(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);const s=c(n,["_self"]);if(s!=null){let r=Dg(s);Array.isArray(r)&&(r=r.map(o=>vl(o))),h(e,["models"],r)}return e}function Hw(n){const e={},t=c(n,["maskMode"]);t!=null&&h(e,["maskMode"],t);const i=c(n,["segmentationClasses"]);i!=null&&h(e,["maskClasses"],i);const s=c(n,["maskDilation"]);return s!=null&&h(e,["dilation"],s),e}function yl(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["displayName"]);i!=null&&h(e,["displayName"],i);const s=c(n,["description"]);s!=null&&h(e,["description"],s);const r=c(n,["version"]);r!=null&&h(e,["version"],r);const o=c(n,["_self"]);o!=null&&h(e,["tunedModelInfo"],eC(o));const a=c(n,["inputTokenLimit"]);a!=null&&h(e,["inputTokenLimit"],a);const l=c(n,["outputTokenLimit"]);l!=null&&h(e,["outputTokenLimit"],l);const u=c(n,["supportedGenerationMethods"]);u!=null&&h(e,["supportedActions"],u);const d=c(n,["temperature"]);d!=null&&h(e,["temperature"],d);const f=c(n,["maxTemperature"]);f!=null&&h(e,["maxTemperature"],f);const p=c(n,["topP"]);p!=null&&h(e,["topP"],p);const g=c(n,["topK"]);g!=null&&h(e,["topK"],g);const m=c(n,["thinking"]);return m!=null&&h(e,["thinking"],m),e}function vl(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["displayName"]);i!=null&&h(e,["displayName"],i);const s=c(n,["description"]);s!=null&&h(e,["description"],s);const r=c(n,["versionId"]);r!=null&&h(e,["version"],r);const o=c(n,["deployedModels"]);if(o!=null){let f=o;Array.isArray(f)&&(f=f.map(p=>QE(p))),h(e,["endpoints"],f)}const a=c(n,["labels"]);a!=null&&h(e,["labels"],a);const l=c(n,["_self"]);l!=null&&h(e,["tunedModelInfo"],tC(l));const u=c(n,["defaultCheckpointId"]);u!=null&&h(e,["defaultCheckpointId"],u);const d=c(n,["checkpoints"]);if(d!=null){let f=d;Array.isArray(f)&&(f=f.map(p=>p)),h(e,["checkpoints"],f)}return e}function Vw(n){const e={},t=c(n,["mediaResolution"]);t!=null&&h(e,["mediaResolution"],t);const i=c(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);const s=c(n,["executableCode"]);s!=null&&h(e,["executableCode"],s);const r=c(n,["fileData"]);r!=null&&h(e,["fileData"],ZE(r));const o=c(n,["functionCall"]);o!=null&&h(e,["functionCall"],jE(o));const a=c(n,["functionResponse"]);a!=null&&h(e,["functionResponse"],a);const l=c(n,["inlineData"]);l!=null&&h(e,["inlineData"],CE(l));const u=c(n,["text"]);u!=null&&h(e,["text"],u);const d=c(n,["thought"]);d!=null&&h(e,["thought"],d);const f=c(n,["thoughtSignature"]);f!=null&&h(e,["thoughtSignature"],f);const p=c(n,["videoMetadata"]);return p!=null&&h(e,["videoMetadata"],p),e}function Ow(n){const e={},t=c(n,["productImage"]);return t!=null&&h(e,["image"],Nt(t)),e}function Gw(n,e){const t={},i=c(n,["numberOfImages"]);e!==void 0&&i!=null&&h(e,["parameters","sampleCount"],i);const s=c(n,["baseSteps"]);e!==void 0&&s!=null&&h(e,["parameters","baseSteps"],s);const r=c(n,["outputGcsUri"]);e!==void 0&&r!=null&&h(e,["parameters","storageUri"],r);const o=c(n,["seed"]);e!==void 0&&o!=null&&h(e,["parameters","seed"],o);const a=c(n,["safetyFilterLevel"]);e!==void 0&&a!=null&&h(e,["parameters","safetySetting"],a);const l=c(n,["personGeneration"]);e!==void 0&&l!=null&&h(e,["parameters","personGeneration"],l);const u=c(n,["addWatermark"]);e!==void 0&&u!=null&&h(e,["parameters","addWatermark"],u);const d=c(n,["outputMimeType"]);e!==void 0&&d!=null&&h(e,["parameters","outputOptions","mimeType"],d);const f=c(n,["outputCompressionQuality"]);e!==void 0&&f!=null&&h(e,["parameters","outputOptions","compressionQuality"],f);const p=c(n,["enhancePrompt"]);e!==void 0&&p!=null&&h(e,["parameters","enhancePrompt"],p);const g=c(n,["labels"]);return e!==void 0&&g!=null&&h(e,["labels"],g),t}function Bw(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["source"]);s!=null&&qw(s,t);const r=c(e,["config"]);return r!=null&&Gw(r,t),t}function zw(n){const e={},t=c(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(s=>Ro(s))),h(e,["generatedImages"],i)}return e}function qw(n,e){const t={},i=c(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);const s=c(n,["personImage"]);e!==void 0&&s!=null&&h(e,["instances[0]","personImage","image"],Nt(s));const r=c(n,["productImages"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>Ow(a))),h(e,["instances[0]","productImages"],o)}return t}function $w(n){const e={},t=c(n,["referenceImage"]);t!=null&&h(e,["referenceImage"],Nt(t));const i=c(n,["referenceId"]);i!=null&&h(e,["referenceId"],i);const s=c(n,["referenceType"]);s!=null&&h(e,["referenceType"],s);const r=c(n,["maskImageConfig"]);r!=null&&h(e,["maskImageConfig"],Hw(r));const o=c(n,["controlImageConfig"]);o!=null&&h(e,["controlImageConfig"],kE(o));const a=c(n,["styleImageConfig"]);a!=null&&h(e,["styleImageConfig"],a);const l=c(n,["subjectImageConfig"]);return l!=null&&h(e,["subjectImageConfig"],l),e}function zg(n){const e={},t=c(n,["safetyAttributes","categories"]);t!=null&&h(e,["categories"],t);const i=c(n,["safetyAttributes","scores"]);i!=null&&h(e,["scores"],i);const s=c(n,["contentType"]);return s!=null&&h(e,["contentType"],s),e}function qg(n){const e={},t=c(n,["safetyAttributes","categories"]);t!=null&&h(e,["categories"],t);const i=c(n,["safetyAttributes","scores"]);i!=null&&h(e,["scores"],i);const s=c(n,["contentType"]);return s!=null&&h(e,["contentType"],s),e}function Ww(n){const e={},t=c(n,["category"]);if(t!=null&&h(e,["category"],t),c(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=c(n,["threshold"]);return i!=null&&h(e,["threshold"],i),e}function Yw(n){const e={},t=c(n,["image"]);return t!=null&&h(e,["image"],Nt(t)),e}function Kw(n,e){const t={},i=c(n,["mode"]);e!==void 0&&i!=null&&h(e,["parameters","mode"],i);const s=c(n,["maxPredictions"]);e!==void 0&&s!=null&&h(e,["parameters","maxPredictions"],s);const r=c(n,["confidenceThreshold"]);e!==void 0&&r!=null&&h(e,["parameters","confidenceThreshold"],r);const o=c(n,["maskDilation"]);e!==void 0&&o!=null&&h(e,["parameters","maskDilation"],o);const a=c(n,["binaryColorThreshold"]);e!==void 0&&a!=null&&h(e,["parameters","binaryColorThreshold"],a);const l=c(n,["labels"]);return e!==void 0&&l!=null&&h(e,["labels"],l),t}function Jw(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["source"]);s!=null&&Qw(s,t);const r=c(e,["config"]);return r!=null&&Kw(r,t),t}function Xw(n){const e={},t=c(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(s=>Sw(s))),h(e,["generatedMasks"],i)}return e}function Qw(n,e){const t={},i=c(n,["prompt"]);e!==void 0&&i!=null&&h(e,["instances[0]","prompt"],i);const s=c(n,["image"]);e!==void 0&&s!=null&&h(e,["instances[0]","image"],Nt(s));const r=c(n,["scribbleImage"]);return e!==void 0&&r!=null&&h(e,["instances[0]","scribble"],Yw(r)),t}function $g(n){const e={},t=c(n,["languageCode"]);t!=null&&h(e,["languageCode"],t);const i=c(n,["voiceConfig"]);if(i!=null&&h(e,["voiceConfig"],i),c(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function Zw(n){const e={},t=c(n,["functionCallingConfig"]);t!=null&&h(e,["functionCallingConfig"],ew(t));const i=c(n,["retrievalConfig"]);return i!=null&&h(e,["retrievalConfig"],i),e}function jw(n){const e={},t=c(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(f=>f)),h(e,["functionDeclarations"],d)}if(c(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=c(n,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const s=c(n,["computerUse"]);s!=null&&h(e,["computerUse"],s);const r=c(n,["fileSearch"]);r!=null&&h(e,["fileSearch"],r);const o=c(n,["codeExecution"]);if(o!=null&&h(e,["codeExecution"],o),c(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=c(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],Iw(a));const l=c(n,["googleSearch"]);l!=null&&h(e,["googleSearch"],Pw(l));const u=c(n,["urlContext"]);return u!=null&&h(e,["urlContext"],u),e}function Wg(n){const e={},t=c(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>tw(p))),h(e,["functionDeclarations"],f)}const i=c(n,["retrieval"]);i!=null&&h(e,["retrieval"],i);const s=c(n,["googleSearchRetrieval"]);s!=null&&h(e,["googleSearchRetrieval"],s);const r=c(n,["computerUse"]);if(r!=null&&h(e,["computerUse"],r),c(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=c(n,["codeExecution"]);o!=null&&h(e,["codeExecution"],o);const a=c(n,["enterpriseWebSearch"]);a!=null&&h(e,["enterpriseWebSearch"],a);const l=c(n,["googleMaps"]);l!=null&&h(e,["googleMaps"],l);const u=c(n,["googleSearch"]);u!=null&&h(e,["googleSearch"],u);const d=c(n,["urlContext"]);return d!=null&&h(e,["urlContext"],d),e}function eC(n){const e={},t=c(n,["baseModel"]);t!=null&&h(e,["baseModel"],t);const i=c(n,["createTime"]);i!=null&&h(e,["createTime"],i);const s=c(n,["updateTime"]);return s!=null&&h(e,["updateTime"],s),e}function tC(n){const e={},t=c(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&h(e,["baseModel"],t);const i=c(n,["createTime"]);i!=null&&h(e,["createTime"],i);const s=c(n,["updateTime"]);return s!=null&&h(e,["updateTime"],s),e}function nC(n,e){const t={},i=c(n,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);const s=c(n,["description"]);e!==void 0&&s!=null&&h(e,["description"],s);const r=c(n,["defaultCheckpointId"]);return e!==void 0&&r!=null&&h(e,["defaultCheckpointId"],r),t}function iC(n,e){const t={},i=c(n,["displayName"]);e!==void 0&&i!=null&&h(e,["displayName"],i);const s=c(n,["description"]);e!==void 0&&s!=null&&h(e,["description"],s);const r=c(n,["defaultCheckpointId"]);return e!==void 0&&r!=null&&h(e,["defaultCheckpointId"],r),t}function sC(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","name"],te(n,i));const s=c(e,["config"]);return s!=null&&nC(s,t),t}function rC(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["config"]);return s!=null&&iC(s,t),t}function oC(n,e){const t={},i=c(n,["outputGcsUri"]);e!==void 0&&i!=null&&h(e,["parameters","storageUri"],i);const s=c(n,["safetyFilterLevel"]);e!==void 0&&s!=null&&h(e,["parameters","safetySetting"],s);const r=c(n,["personGeneration"]);e!==void 0&&r!=null&&h(e,["parameters","personGeneration"],r);const o=c(n,["includeRaiReason"]);e!==void 0&&o!=null&&h(e,["parameters","includeRaiReason"],o);const a=c(n,["outputMimeType"]);e!==void 0&&a!=null&&h(e,["parameters","outputOptions","mimeType"],a);const l=c(n,["outputCompressionQuality"]);e!==void 0&&l!=null&&h(e,["parameters","outputOptions","compressionQuality"],l);const u=c(n,["enhanceInputImage"]);e!==void 0&&u!=null&&h(e,["parameters","upscaleConfig","enhanceInputImage"],u);const d=c(n,["imagePreservationFactor"]);e!==void 0&&d!=null&&h(e,["parameters","upscaleConfig","imagePreservationFactor"],d);const f=c(n,["labels"]);e!==void 0&&f!=null&&h(e,["labels"],f);const p=c(n,["numberOfImages"]);e!==void 0&&p!=null&&h(e,["parameters","sampleCount"],p);const g=c(n,["mode"]);return e!==void 0&&g!=null&&h(e,["parameters","mode"],g),t}function aC(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["_url","model"],te(n,i));const s=c(e,["image"]);s!=null&&h(t,["instances[0]","image"],Nt(s));const r=c(e,["upscaleFactor"]);r!=null&&h(t,["parameters","upscaleConfig","upscaleFactor"],r);const o=c(e,["config"]);return o!=null&&oC(o,t),t}function lC(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["predictions"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>Ro(r))),h(e,["generatedImages"],s)}return e}function uC(n){const e={},t=c(n,["uri"]);t!=null&&h(e,["uri"],t);const i=c(n,["encodedVideo"]);i!=null&&h(e,["videoBytes"],Mn(i));const s=c(n,["encoding"]);return s!=null&&h(e,["mimeType"],s),e}function cC(n){const e={},t=c(n,["gcsUri"]);t!=null&&h(e,["uri"],t);const i=c(n,["bytesBase64Encoded"]);i!=null&&h(e,["videoBytes"],Mn(i));const s=c(n,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}function dC(n){const e={},t=c(n,["image"]);t!=null&&h(e,["_self"],Nt(t));const i=c(n,["maskMode"]);return i!=null&&h(e,["maskMode"],i),e}function hC(n){const e={},t=c(n,["image"]);t!=null&&h(e,["image"],Mo(t));const i=c(n,["referenceType"]);return i!=null&&h(e,["referenceType"],i),e}function fC(n){const e={},t=c(n,["image"]);t!=null&&h(e,["image"],Nt(t));const i=c(n,["referenceType"]);return i!=null&&h(e,["referenceType"],i),e}function Yg(n){const e={},t=c(n,["uri"]);t!=null&&h(e,["uri"],t);const i=c(n,["videoBytes"]);i!=null&&h(e,["encodedVideo"],Mn(i));const s=c(n,["mimeType"]);return s!=null&&h(e,["encoding"],s),e}function Kg(n){const e={},t=c(n,["uri"]);t!=null&&h(e,["gcsUri"],t);const i=c(n,["videoBytes"]);i!=null&&h(e,["bytesBase64Encoded"],Mn(i));const s=c(n,["mimeType"]);return s!=null&&h(e,["mimeType"],s),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pC="Content-Type",gC="X-Server-Timeout",mC="User-Agent",_l="x-goog-api-client",yC="1.30.0",vC=`google-genai-sdk/${yC}`,_C="v1beta1",AC="v1beta",kh=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class SC{constructor(e){var t,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:_C,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:AC,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,i){const s=[this.getRequestUrlInternal(t)];return i&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,i);if(e.queryParams)for(const[o,a]of Object.entries(e.queryParams))s.searchParams.append(o,String(a));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.unaryApiCall(s,r,e.httpMethod)}patchHttpOptions(e,t){const i=JSON.parse(JSON.stringify(e));for(const[s,r]of Object.entries(t))typeof r=="object"?i[s]=Object.assign(Object.assign({},i[s]),r):r!==void 0&&(i[s]=r);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,i);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,s.toString(),e.abortSignal),this.streamApiCall(s,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,i,s){if(t&&t.timeout||s){const r=new AbortController,o=r.signal;if(t.timeout&&t?.timeout>0){const a=setTimeout(()=>r.abort(),t.timeout);a&&typeof a.unref=="function"&&a.unref()}s&&s.addEventListener("abort",()=>{r.abort()}),e.signal=o}return t&&t.extraBody!==null&&EC(e,t.extraBody),e.headers=await this.getHeadersInternal(t,i),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async s=>(await bh(s),new pl(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async s=>(await bh(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){var t;return Si(this,arguments,function*(){const s=(t=e?.body)===null||t===void 0?void 0:t.getReader(),r=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let o="";for(;;){const{done:a,value:l}=yield ae(s.read());if(a){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const u=r.decode(l,{stream:!0});try{const f=JSON.parse(u);if("error"in f){const p=JSON.parse(JSON.stringify(f.error)),g=p.status,m=p.code,v=`got status: ${g}. ${JSON.stringify(f)}`;if(m>=400&&m<600)throw new Io({message:v,status:m})}}catch(f){if(f.name==="ApiError")throw f}o+=u;let d=o.match(kh);for(;d;){const f=d[1];try{const p=new Response(f,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield ae(new pl(p)),o=o.slice(d[0].length),d=o.match(kh)}catch(p){throw new Error(`exception parsing stream chunk ${f}. ${p}`)}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){const e={},t=vC+" "+this.clientOptions.userAgentExtra;return e[mC]=t,e[_l]=t,e[pC]="application/json",e}async getHeadersInternal(e,t){const i=new Headers;if(e&&e.headers){for(const[s,r]of Object.entries(e.headers))i.append(s,r);e.timeout&&e.timeout>0&&i.append(gC,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(i,t),i}getFileName(e){var t;let i="";return typeof e=="string"&&(i=e.replace(/[/\\]+$/,""),i=(t=i.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),i}async uploadFile(e,t){var i;const s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const r=this.clientOptions.uploader,o=await r.stat(e);s.sizeBytes=String(o.size);const a=(i=t?.mimeType)!==null&&i!==void 0?i:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=a;const l={file:s},u=this.getFileName(e),d=N("upload/v1beta/files",l._url),f=await this.fetchUploadUrl(d,s.sizeBytes,s.mimeType,u,l,t?.httpOptions);return r.upload(e,f,this)}async uploadFileToFileSearchStore(e,t,i){var s;const r=this.clientOptions.uploader,o=await r.stat(t),a=String(o.size),l=(s=i?.mimeType)!==null&&s!==void 0?s:o.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const u=`upload/v1beta/${e}:uploadToFileSearchStore`,d=this.getFileName(t),f={};i?.customMetadata&&(f.customMetadata=i.customMetadata),i?.chunkingConfig&&(f.chunkingConfig=i.chunkingConfig);const p=await this.fetchUploadUrl(u,a,l,d,f,i?.httpOptions);return r.uploadToFileSearchStore(t,p,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,i,s,r,o){var a;let l={};o?l=o:l={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${i}`},s?{"X-Goog-Upload-File-Name":s}:{})};const u=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:l});if(!u||!u?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const d=(a=u?.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}}async function bh(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};const s=JSON.stringify(i);throw t>=400&&t<600?new Io({message:s,status:t}):new Error(s)}}function EC(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const r=JSON.parse(n.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(r,o){const a=Object.assign({},r);for(const l in o)if(Object.prototype.hasOwnProperty.call(o,l)){const u=o[l],d=a[l];u&&typeof u=="object"&&!Array.isArray(u)&&d&&typeof d=="object"&&!Array.isArray(d)?a[l]=i(d,u):(d&&u&&typeof d!=typeof u&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${l}". Original type: ${typeof d}, New type: ${typeof u}. Overwriting.`),a[l]=u)}return a}const s=i(t,e);n.body=JSON.stringify(s)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const wC="mcp_used/unknown";let CC=!1;function Jg(n){for(const e of n)if(TC(e)||typeof e=="object"&&"inputSchema"in e)return!0;return CC}function Xg(n){var e;const t=(e=n[_l])!==null&&e!==void 0?e:"";n[_l]=(t+` ${wC}`).trimStart()}function TC(n){return n!==null&&typeof n=="object"&&n instanceof Hu}function xC(n,e=100){return Si(this,arguments,function*(){let i,s=0;for(;s<e;){const r=yield ae(n.listTools({cursor:i}));for(const o of r.tools)yield yield ae(o),s++;if(!r.nextCursor)break;i=r.nextCursor}})}class Hu{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new Hu(e,t)}async initialize(){var e,t,i,s;if(this.mcpTools.length>0)return;const r={},o=[];for(const d of this.mcpClients)try{for(var a=!0,l=(t=void 0,ps(xC(d))),u;u=await l.next(),e=u.done,!e;a=!0){s=u.value,a=!1;const f=s;o.push(f);const p=f.name;if(r[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);r[p]=d}}catch(f){t={error:f}}finally{try{!a&&!e&&(i=l.return)&&await i.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),vA(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const i of e)if(i.name in this.functionNameToMcpClient){const s=this.functionNameToMcpClient[i.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const o=await s.callTool({name:i.name,arguments:i.args},void 0,r);t.push({functionResponse:{name:i.name,response:o.isError?{error:o}:o}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function IC(n,e,t){const i=new cA;let s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),Object.assign(i,s),e(i)}class PC{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const s=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=kC(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),l=`${s}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${a}`;let u=()=>{};const d=new Promise(A=>{u=A}),f=e.callbacks,p=function(){u({})},g=this.apiClient,m={onopen:p,onmessage:A=>{IC(g,f.onmessage,A)},onerror:(t=f?.onerror)!==null&&t!==void 0?t:function(A){},onclose:(i=f?.onclose)!==null&&i!==void 0?i:function(A){}},v=this.webSocketFactory.create(l,MC(o),m);v.connect(),await d;const _={setup:{model:te(this.apiClient,e.model)}};return v.send(JSON.stringify(_)),new RC(v,this.apiClient)}}class RC{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=gE(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=pE(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(hi.PLAY)}pause(){this.sendPlaybackControl(hi.PAUSE)}stop(){this.sendPlaybackControl(hi.STOP)}resetContext(){this.sendPlaybackControl(hi.RESET_CONTEXT)}close(){this.conn.close()}}function MC(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function kC(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bC="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function NC(n,e,t){const i=new uA;let s;t.data instanceof Blob?s=await t.data.text():t.data instanceof ArrayBuffer?s=new TextDecoder().decode(t.data):s=t.data;const r=JSON.parse(s);if(n.isVertexAI()){const o=vE(r);Object.assign(i,o)}else Object.assign(i,r);e(i)}class LC{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i,this.music=new PC(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,i,s,r,o,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const l=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion();let d;const f=this.apiClient.getHeaders();e.config&&e.config.tools&&Jg(e.config.tools)&&Xg(f);const p=HC(f);if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,d);else{const P=this.apiClient.getApiKey();let R="BidiGenerateContent",L="key";P?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),u!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),R="BidiGenerateContentConstrained",L="access_token"),d=`${l}/ws/google.ai.generativelanguage.${u}.GenerativeService.${R}?${L}=${P}`}let g=()=>{};const m=new Promise(P=>{g=P}),v=e.callbacks,S=function(){var P;(P=v?.onopen)===null||P===void 0||P.call(v),g({})},y=this.apiClient,_={onopen:S,onmessage:P=>{NC(y,v.onmessage,P)},onerror:(t=v?.onerror)!==null&&t!==void 0?t:function(P){},onclose:(i=v?.onclose)!==null&&i!==void 0?i:function(P){}},A=this.webSocketFactory.create(d,UC(p),_);A.connect(),await m;let E=te(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&E.startsWith("publishers/")){const P=this.apiClient.getProject(),R=this.apiClient.getLocation();E=`projects/${P}/locations/${R}/`+E}let w={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Xr.AUDIO]}:e.config.responseModalities=[Xr.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const C=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],T=[];for(const P of C)if(this.isCallableTool(P)){const R=P;T.push(await R.tool())}else T.push(P);T.length>0&&(e.config.tools=T);const I={model:E,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?w=fE(this.apiClient,I):w=hE(this.apiClient,I),delete w.config,A.send(JSON.stringify(w)),new FC(A,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const DC={turnComplete:!0};class FC{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=St(t.turns),e.isVertexAI()||(i=i.map(s=>Po(s)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(const r of i){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(bC)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},DC),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:yE(e)}:t={realtimeInput:mE(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function UC(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function HC(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Nh=10;function Lh(n){var e,t,i;if(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(const o of(t=n?.tools)!==null&&t!==void 0?t:[])if(Ei(o)){s=!0;break}if(!s)return!0;const r=(i=n?.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function Ei(n){return"callTool"in n&&typeof n.callTool=="function"}function VC(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>Ei(s)))!==null&&i!==void 0?i:!1}function Dh(n){var e;const t=[];return!((e=n?.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((i,s)=>{if(Ei(i))return;const r=i;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(s)}),t}function Fh(n){var e;return!(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class OC extends nn{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var i,s,r,o,a;const l=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!VC(t)||Lh(t.config))return await this.generateContentInternal(l);const u=Dh(t);if(u.length>0){const v=u.map(S=>`tools[${S}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${v}.`)}let d,f;const p=St(l.contents),g=(r=(s=(i=l.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&r!==void 0?r:Nh;let m=0;for(;m<g&&(d=await this.generateContentInternal(l),!(!d.functionCalls||d.functionCalls.length===0));){const v=d.candidates[0].content,S=[];for(const y of(a=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(Ei(y)){const A=await y.callTool(d.functionCalls);S.push(...A)}m++,f={role:"user",parts:S},l.contents=St(l.contents),l.contents.push(v),l.contents.push(f),Fh(l.config)&&(p.push(v),p.push(f))}return Fh(l.config)&&(d.automaticFunctionCallingHistory=p),d},this.generateContentStream=async t=>{var i,s,r,o,a;if(this.maybeMoveToResponseJsonSchem(t),Lh(t.config)){const f=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(f)}const l=Dh(t);if(l.length>0){const f=l.map(p=>`tools[${p}]`).join(", ");throw new Error(`Incompatible tools found at ${f}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const u=(r=(s=(i=t?.config)===null||i===void 0?void 0:i.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,d=(a=(o=t?.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(u&&!d)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var s;let r;const o=[];if(i?.generatedImages)for(const l of i.generatedImages)l&&l?.safetyAttributes&&((s=l?.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?r=l?.safetyAttributes:o.push(l);let a;return r?a={generatedImages:o,positivePromptSafetyAttributes:r,sdkHttpResponse:i.sdkHttpResponse}:a={generatedImages:o,sdkHttpResponse:i.sdkHttpResponse},a}),this.list=async t=>{var i;const o={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((i=o.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new Jn(en.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async t=>{const i={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(i.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async t=>{let i={numberOfImages:1,mode:"upscale"};t.config&&(i=Object.assign(Object.assign({},i),t.config));const s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:i};return await this.upscaleImageInternal(s)},this.generateVideos=async t=>{var i,s,r,o,a,l;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((i=t.video)===null||i===void 0)&&i.uri&&(!((s=t.video)===null||s===void 0)&&s.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((o=(r=t.source)===null||r===void 0?void 0:r.video)===null||o===void 0)&&o.uri&&(!((l=(a=t.source)===null||a===void 0?void 0:a.video)===null||l===void 0)&&l.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,i,s;const r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;const o=await Promise.all(r.map(async l=>Ei(l)?await l.tool():l)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&Jg(e.config.tools)){const l=(s=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&s!==void 0?s:{};let u=Object.assign({},l);Object.keys(u).length===0&&(u=this.apiClient.getDefaultHeaders()),Xg(u),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:u})}return a}async initAfcToolsMap(e){var t,i,s;const r=new Map;for(const o of(i=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&i!==void 0?i:[])if(Ei(o)){const a=o,l=await a.tool();for(const u of(s=l.functionDeclarations)!==null&&s!==void 0?s:[]){if(!u.name)throw new Error("Function declaration name is required.");if(r.has(u.name))throw new Error(`Duplicate tool declaration name: ${u.name}`);r.set(u.name,a)}}return r}async processAfcStream(e){var t,i,s;const r=(s=(i=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&s!==void 0?s:Nh;let o=!1,a=0;const l=await this.initAfcToolsMap(e);return function(u,d,f){var p,g;return Si(this,arguments,function*(){for(var m,v,S,y;a<r;){o&&(a++,o=!1);const w=yield ae(u.processParamsMaybeAddMcpUsage(f)),C=yield ae(u.generateContentStreamInternal(w)),T=[],I=[];try{for(var _=!0,A=(v=void 0,ps(C)),E;E=yield ae(A.next()),m=E.done,!m;_=!0){y=E.value,_=!1;const P=y;if(yield yield ae(P),P.candidates&&(!((p=P.candidates[0])===null||p===void 0)&&p.content)){I.push(P.candidates[0].content);for(const R of(g=P.candidates[0].content.parts)!==null&&g!==void 0?g:[])if(a<r&&R.functionCall){if(!R.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(R.functionCall.name)){const L=yield ae(d.get(R.functionCall.name).callTool([R.functionCall]));T.push(...L)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${R.functionCall.name}`)}}}}catch(P){v={error:P}}finally{try{!_&&!m&&(S=A.return)&&(yield ae(S.call(A)))}finally{if(v)throw v.error}}if(T.length>0){o=!0;const P=new Ji;P.candidates=[{content:{role:"user",parts:T}}],yield yield ae(P);const R=[];R.push(...I),R.push({role:"user",parts:T});const L=St(f.contents).concat(R);f.contents=L}else break}})}(this,l,e)}async generateContentInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Ph(this.apiClient,e);return a=N("{model}:generateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=Mh(d),p=new Ji;return Object.assign(p,f),p})}else{const u=Ih(this.apiClient,e);return a=N("{model}:generateContent",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=Rh(d),p=new Ji;return Object.assign(p,f),p})}}async generateContentStreamInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Ph(this.apiClient,e);return a=N("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),o.then(function(f){return Si(this,arguments,function*(){var p,g,m,v;try{for(var S=!0,y=ps(f),_;_=yield ae(y.next()),p=_.done,!p;S=!0){v=_.value,S=!1;const A=v,E=Mh(yield ae(A.json()));E.sdkHttpResponse={headers:A.headers};const w=new Ji;Object.assign(w,E),yield yield ae(w)}}catch(A){g={error:A}}finally{try{!S&&!p&&(m=y.return)&&(yield ae(m.call(y)))}finally{if(g)throw g.error}}})})}else{const u=Ih(this.apiClient,e);return a=N("{model}:streamGenerateContent?alt=sse",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.requestStream({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(f){return Si(this,arguments,function*(){var p,g,m,v;try{for(var S=!0,y=ps(f),_;_=yield ae(y.next()),p=_.done,!p;S=!0){v=_.value,S=!1;const A=v,E=Rh(yield ae(A.json()));E.sdkHttpResponse={headers:A.headers};const w=new Ji;Object.assign(w,E),yield yield ae(w)}}catch(A){g={error:A}}finally{try{!S&&!p&&(m=y.return)&&(yield ae(m.call(y)))}finally{if(g)throw g.error}}})})}}async embedContent(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=KE(this.apiClient,e);return a=N("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=XE(d),p=new dh;return Object.assign(p,f),p})}else{const u=YE(this.apiClient,e);return a=N("{model}:batchEmbedContents",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=JE(d),p=new dh;return Object.assign(p,f),p})}}async generateImagesInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=aw(this.apiClient,e);return a=N("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=uw(d),p=new hh;return Object.assign(p,f),p})}else{const u=ow(this.apiClient,e);return a=N("{model}:predict",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=lw(d),p=new hh;return Object.assign(p,f),p})}}async editImageInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI()){const a=zE(this.apiClient,e);return r=N("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{const u=qE(l),d=new Z_;return Object.assign(d,u),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI()){const a=aC(this.apiClient,e);return r=N("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{const u=lC(l),d=new j_;return Object.assign(d,u),d})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI()){const a=Bw(this.apiClient,e);return r=N("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>{const u=zw(l),d=new eA;return Object.assign(d,u),d})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI()){const a=Jw(this.apiClient,e);return r=N("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>{const u=Xw(l),d=new tA;return Object.assign(d,u),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=xw(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>vl(d))}else{const u=Tw(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>yl(d))}}async listInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=Dw(this.apiClient,e);return a=N("{models_url}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=Uw(d),p=new fh;return Object.assign(p,f),p})}else{const u=Lw(this.apiClient,e);return a=N("{models_url}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=Fw(d),p=new fh;return Object.assign(p,f),p})}}async update(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=rC(this.apiClient,e);return a=N("{model}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>vl(d))}else{const u=sC(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>yl(d))}}async delete(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=VE(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=GE(d),p=new ph;return Object.assign(p,f),p})}else{const u=HE(this.apiClient,e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=OE(d),p=new ph;return Object.assign(p,f),p})}}async countTokens(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=DE(this.apiClient,e);return a=N("{model}:countTokens",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=UE(d),p=new gh;return Object.assign(p,f),p})}else{const u=LE(this.apiClient,e);return a=N("{model}:countTokens",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=FE(d),p=new gh;return Object.assign(p,f),p})}}async computeTokens(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI()){const a=IE(this.apiClient,e);return r=N("{model}:computeTokens",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>{const u=PE(l),d=new nA;return Object.assign(d,u),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=gw(this.apiClient,e);return a=N("{model}:predictLongRunning",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>{const f=fw(d),p=new Qr;return Object.assign(p,f),p})}else{const u=pw(this.apiClient,e);return a=N("{model}:predictLongRunning",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o.then(d=>{const f=hw(d),p=new Qr;return Object.assign(p,f),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class GC extends nn{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let r;i&&"httpOptions"in i&&(r=i.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let r;i&&"httpOptions"in i&&(r=i.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=W_(e);return a=N("{operationName}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o}else{const u=$_(e);return a=N("{operationName}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),o}}async fetchPredictVideosOperationInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI()){const a=H_(e);return r=N("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function BC(n){const e={},t=c(n,["data"]);if(t!=null&&h(e,["data"],t),c(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function zC(n){const e={},t=c(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(r=>ZC(r))),h(e,["parts"],s)}const i=c(n,["role"]);return i!=null&&h(e,["role"],i),e}function qC(n,e,t){const i={},s=c(e,["expireTime"]);t!==void 0&&s!=null&&h(t,["expireTime"],s);const r=c(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&h(t,["newSessionExpireTime"],r);const o=c(e,["uses"]);t!==void 0&&o!=null&&h(t,["uses"],o);const a=c(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&h(t,["bidiGenerateContentSetup"],QC(n,a));const l=c(e,["lockAdditionalFields"]);return t!==void 0&&l!=null&&h(t,["fieldMask"],l),i}function $C(n,e){const t={},i=c(e,["config"]);return i!=null&&h(t,["config"],qC(n,i,t)),t}function WC(n){const e={};if(c(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=c(n,["fileUri"]);t!=null&&h(e,["fileUri"],t);const i=c(n,["mimeType"]);return i!=null&&h(e,["mimeType"],i),e}function YC(n){const e={},t=c(n,["id"]);t!=null&&h(e,["id"],t);const i=c(n,["args"]);i!=null&&h(e,["args"],i);const s=c(n,["name"]);if(s!=null&&h(e,["name"],s),c(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(c(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function KC(n){const e={};if(c(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=c(n,["enableWidget"]);return t!=null&&h(e,["enableWidget"],t),e}function JC(n){const e={};if(c(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(c(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=c(n,["timeRangeFilter"]);return t!=null&&h(e,["timeRangeFilter"],t),e}function XC(n,e){const t={},i=c(n,["generationConfig"]);e!==void 0&&i!=null&&h(e,["setup","generationConfig"],i);const s=c(n,["responseModalities"]);e!==void 0&&s!=null&&h(e,["setup","generationConfig","responseModalities"],s);const r=c(n,["temperature"]);e!==void 0&&r!=null&&h(e,["setup","generationConfig","temperature"],r);const o=c(n,["topP"]);e!==void 0&&o!=null&&h(e,["setup","generationConfig","topP"],o);const a=c(n,["topK"]);e!==void 0&&a!=null&&h(e,["setup","generationConfig","topK"],a);const l=c(n,["maxOutputTokens"]);e!==void 0&&l!=null&&h(e,["setup","generationConfig","maxOutputTokens"],l);const u=c(n,["mediaResolution"]);e!==void 0&&u!=null&&h(e,["setup","generationConfig","mediaResolution"],u);const d=c(n,["seed"]);e!==void 0&&d!=null&&h(e,["setup","generationConfig","seed"],d);const f=c(n,["speechConfig"]);e!==void 0&&f!=null&&h(e,["setup","generationConfig","speechConfig"],Uu(f));const p=c(n,["thinkingConfig"]);e!==void 0&&p!=null&&h(e,["setup","generationConfig","thinkingConfig"],p);const g=c(n,["enableAffectiveDialog"]);e!==void 0&&g!=null&&h(e,["setup","generationConfig","enableAffectiveDialog"],g);const m=c(n,["systemInstruction"]);e!==void 0&&m!=null&&h(e,["setup","systemInstruction"],zC(Be(m)));const v=c(n,["tools"]);if(e!==void 0&&v!=null){let C=Di(v);Array.isArray(C)&&(C=C.map(T=>eT(Li(T)))),h(e,["setup","tools"],C)}const S=c(n,["sessionResumption"]);e!==void 0&&S!=null&&h(e,["setup","sessionResumption"],jC(S));const y=c(n,["inputAudioTranscription"]);e!==void 0&&y!=null&&h(e,["setup","inputAudioTranscription"],y);const _=c(n,["outputAudioTranscription"]);e!==void 0&&_!=null&&h(e,["setup","outputAudioTranscription"],_);const A=c(n,["realtimeInputConfig"]);e!==void 0&&A!=null&&h(e,["setup","realtimeInputConfig"],A);const E=c(n,["contextWindowCompression"]);e!==void 0&&E!=null&&h(e,["setup","contextWindowCompression"],E);const w=c(n,["proactivity"]);return e!==void 0&&w!=null&&h(e,["setup","proactivity"],w),t}function QC(n,e){const t={},i=c(e,["model"]);i!=null&&h(t,["setup","model"],te(n,i));const s=c(e,["config"]);return s!=null&&h(t,["config"],XC(s,t)),t}function ZC(n){const e={},t=c(n,["mediaResolution"]);t!=null&&h(e,["mediaResolution"],t);const i=c(n,["codeExecutionResult"]);i!=null&&h(e,["codeExecutionResult"],i);const s=c(n,["executableCode"]);s!=null&&h(e,["executableCode"],s);const r=c(n,["fileData"]);r!=null&&h(e,["fileData"],WC(r));const o=c(n,["functionCall"]);o!=null&&h(e,["functionCall"],YC(o));const a=c(n,["functionResponse"]);a!=null&&h(e,["functionResponse"],a);const l=c(n,["inlineData"]);l!=null&&h(e,["inlineData"],BC(l));const u=c(n,["text"]);u!=null&&h(e,["text"],u);const d=c(n,["thought"]);d!=null&&h(e,["thought"],d);const f=c(n,["thoughtSignature"]);f!=null&&h(e,["thoughtSignature"],f);const p=c(n,["videoMetadata"]);return p!=null&&h(e,["videoMetadata"],p),e}function jC(n){const e={},t=c(n,["handle"]);if(t!=null&&h(e,["handle"],t),c(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function eT(n){const e={},t=c(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(f=>f)),h(e,["functionDeclarations"],d)}if(c(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=c(n,["googleSearchRetrieval"]);i!=null&&h(e,["googleSearchRetrieval"],i);const s=c(n,["computerUse"]);s!=null&&h(e,["computerUse"],s);const r=c(n,["fileSearch"]);r!=null&&h(e,["fileSearch"],r);const o=c(n,["codeExecution"]);if(o!=null&&h(e,["codeExecution"],o),c(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=c(n,["googleMaps"]);a!=null&&h(e,["googleMaps"],KC(a));const l=c(n,["googleSearch"]);l!=null&&h(e,["googleSearch"],JC(l));const u=c(n,["urlContext"]);return u!=null&&h(e,["urlContext"],u),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tT(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const i=n[t];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){const s=Object.keys(i).map(r=>`${t}.${r}`);e.push(...s)}else e.push(t)}return e.join(",")}function nT(n,e){let t=null;const i=n.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){const r=i.setup;typeof r=="object"&&r!==null?(n.bidiGenerateContentSetup=r,t=r):delete n.bidiGenerateContentSetup}else i!==void 0&&delete n.bidiGenerateContentSetup;const s=n.fieldMask;if(t){const r=tT(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)r?n.fieldMask=r:delete n.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){const o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let a=[];s.length>0&&(a=s.map(u=>o.includes(u)?`generationConfig.${u}`:u));const l=[];r&&l.push(r),a.length>0&&l.push(...a),l.length>0?n.fieldMask=l.join(","):delete n.fieldMask}else delete n.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?n.fieldMask=s.join(","):delete n.fieldMask;return n}class iT extends nn{constructor(e){super(),this.apiClient=e}async create(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const a=$C(this.apiClient,e);r=N("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;const l=nT(a,e.config);return s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),s.then(u=>u)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sT(n,e){const t={},i=c(n,["displayName"]);return e!==void 0&&i!=null&&h(e,["displayName"],i),t}function rT(n){const e={},t=c(n,["config"]);return t!=null&&sT(t,e),e}function oT(n,e){const t={},i=c(n,["force"]);return e!==void 0&&i!=null&&h(e,["_query","force"],i),t}function aT(n){const e={},t=c(n,["name"]);t!=null&&h(e,["_url","name"],t);const i=c(n,["config"]);return i!=null&&oT(i,e),e}function lT(n){const e={},t=c(n,["name"]);return t!=null&&h(e,["_url","name"],t),e}function uT(n,e){const t={},i=c(n,["customMetadata"]);if(e!==void 0&&i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["customMetadata"],r)}const s=c(n,["chunkingConfig"]);return e!==void 0&&s!=null&&h(e,["chunkingConfig"],s),t}function cT(n){const e={},t=c(n,["name"]);t!=null&&h(e,["name"],t);const i=c(n,["metadata"]);i!=null&&h(e,["metadata"],i);const s=c(n,["done"]);s!=null&&h(e,["done"],s);const r=c(n,["error"]);r!=null&&h(e,["error"],r);const o=c(n,["response"]);return o!=null&&h(e,["response"],hT(o)),e}function dT(n){const e={},t=c(n,["fileSearchStoreName"]);t!=null&&h(e,["_url","file_search_store_name"],t);const i=c(n,["fileName"]);i!=null&&h(e,["fileName"],i);const s=c(n,["config"]);return s!=null&&uT(s,e),e}function hT(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["parent"]);i!=null&&h(e,["parent"],i);const s=c(n,["documentName"]);return s!=null&&h(e,["documentName"],s),e}function fT(n,e){const t={},i=c(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const s=c(n,["pageToken"]);return e!==void 0&&s!=null&&h(e,["_query","pageToken"],s),t}function pT(n){const e={},t=c(n,["config"]);return t!=null&&fT(t,e),e}function gT(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);const s=c(n,["fileSearchStores"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["fileSearchStores"],r)}return e}function mT(n,e){const t={},i=c(n,["mimeType"]);e!==void 0&&i!=null&&h(e,["mimeType"],i);const s=c(n,["displayName"]);e!==void 0&&s!=null&&h(e,["displayName"],s);const r=c(n,["customMetadata"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(l=>l)),h(e,["customMetadata"],a)}const o=c(n,["chunkingConfig"]);return e!==void 0&&o!=null&&h(e,["chunkingConfig"],o),t}function yT(n){const e={},t=c(n,["fileSearchStoreName"]);t!=null&&h(e,["_url","file_search_store_name"],t);const i=c(n,["config"]);return i!=null&&mT(i,e),e}function vT(n){const e={},t=c(n,["sdkHttpResponse"]);return t!=null&&h(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _T(n,e){const t={},i=c(n,["force"]);return e!==void 0&&i!=null&&h(e,["_query","force"],i),t}function AT(n){const e={},t=c(n,["name"]);t!=null&&h(e,["_url","name"],t);const i=c(n,["config"]);return i!=null&&_T(i,e),e}function ST(n){const e={},t=c(n,["name"]);return t!=null&&h(e,["_url","name"],t),e}function ET(n,e){const t={},i=c(n,["pageSize"]);e!==void 0&&i!=null&&h(e,["_query","pageSize"],i);const s=c(n,["pageToken"]);return e!==void 0&&s!=null&&h(e,["_query","pageToken"],s),t}function wT(n){const e={},t=c(n,["parent"]);t!=null&&h(e,["_url","parent"],t);const i=c(n,["config"]);return i!=null&&ET(i,e),e}function CT(n){const e={},t=c(n,["sdkHttpResponse"]);t!=null&&h(e,["sdkHttpResponse"],t);const i=c(n,["nextPageToken"]);i!=null&&h(e,["nextPageToken"],i);const s=c(n,["documents"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),h(e,["documents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class TT extends nn{constructor(e){super(),this.apiClient=e,this.list=async t=>new Jn(en.PAGED_ITEM_DOCUMENTS,i=>this.listInternal({parent:t.parent,config:i.config}),await this.listInternal(t),t)}async get(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=ST(e);return r=N("{name}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,i;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=AT(e);s=N("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=wT(e);return r=N("{parent}/documents",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>{const u=CT(l),d=new iA;return Object.assign(d,u),d})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class xT extends nn{constructor(e,t=new TT(e)){super(),this.apiClient=e,this.documents=t,this.list=async(i={})=>new Jn(en.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(i),i)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=rT(e);return r=N("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async get(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=lT(e);return r=N("{name}",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>l)}}async delete(e){var t,i;let s="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=aT(e);s=N("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:s,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}}async listInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=pT(e);return r=N("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>{const u=gT(l),d=new sA;return Object.assign(d,u),d})}}async uploadToFileSearchStoreInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=yT(e);return r=N("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>{const u=vT(l),d=new rA;return Object.assign(d,u),d})}}async importFile(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=dT(e);return r=N("{file_search_store_name}:importFile",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json()),s.then(l=>{const u=cT(l),d=new bu;return Object.assign(d,u),d})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function IT(n,e){const t={},i=c(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function PT(n,e){const t={},i=c(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function RT(n,e,t){const i={};if(c(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=c(n,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&h(e,["displayName"],s),c(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=c(n,["epochCount"]);e!==void 0&&r!=null&&h(e,["tuningTask","hyperparameters","epochCount"],r);const o=c(n,["learningRateMultiplier"]);if(o!=null&&h(i,["tuningTask","hyperparameters","learningRateMultiplier"],o),c(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(c(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(c(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const a=c(n,["batchSize"]);e!==void 0&&a!=null&&h(e,["tuningTask","hyperparameters","batchSize"],a);const l=c(n,["learningRate"]);if(e!==void 0&&l!=null&&h(e,["tuningTask","hyperparameters","learningRate"],l),c(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(c(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return i}function MT(n,e,t){const i={};let s=c(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const g=c(n,["validationDataset"]);e!==void 0&&g!=null&&h(e,["supervisedTuningSpec"],Uh(g))}else if(s==="PREFERENCE_TUNING"){const g=c(n,["validationDataset"]);e!==void 0&&g!=null&&h(e,["preferenceOptimizationSpec"],Uh(g))}const r=c(n,["tunedModelDisplayName"]);e!==void 0&&r!=null&&h(e,["tunedModelDisplayName"],r);const o=c(n,["description"]);e!==void 0&&o!=null&&h(e,["description"],o);let a=c(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const g=c(n,["epochCount"]);e!==void 0&&g!=null&&h(e,["supervisedTuningSpec","hyperParameters","epochCount"],g)}else if(a==="PREFERENCE_TUNING"){const g=c(n,["epochCount"]);e!==void 0&&g!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],g)}let l=c(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const g=c(n,["learningRateMultiplier"]);e!==void 0&&g!=null&&h(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],g)}else if(l==="PREFERENCE_TUNING"){const g=c(n,["learningRateMultiplier"]);e!==void 0&&g!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],g)}let u=c(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const g=c(n,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&h(e,["supervisedTuningSpec","exportLastCheckpointOnly"],g)}else if(u==="PREFERENCE_TUNING"){const g=c(n,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&h(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],g)}let d=c(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const g=c(n,["adapterSize"]);e!==void 0&&g!=null&&h(e,["supervisedTuningSpec","hyperParameters","adapterSize"],g)}else if(d==="PREFERENCE_TUNING"){const g=c(n,["adapterSize"]);e!==void 0&&g!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],g)}if(c(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(c(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const f=c(n,["labels"]);e!==void 0&&f!=null&&h(e,["labels"],f);const p=c(n,["beta"]);return e!==void 0&&p!=null&&h(e,["preferenceOptimizationSpec","hyperParameters","beta"],p),i}function kT(n,e){const t={},i=c(n,["baseModel"]);i!=null&&h(t,["baseModel"],i);const s=c(n,["preTunedModel"]);s!=null&&h(t,["preTunedModel"],s);const r=c(n,["trainingDataset"]);r!=null&&BT(r);const o=c(n,["config"]);return o!=null&&RT(o,t),t}function bT(n,e){const t={},i=c(n,["baseModel"]);i!=null&&h(t,["baseModel"],i);const s=c(n,["preTunedModel"]);s!=null&&h(t,["preTunedModel"],s);const r=c(n,["trainingDataset"]);r!=null&&zT(r,t,e);const o=c(n,["config"]);return o!=null&&MT(o,t,e),t}function NT(n,e){const t={},i=c(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function LT(n,e){const t={},i=c(n,["name"]);return i!=null&&h(t,["_url","name"],i),t}function DT(n,e,t){const i={},s=c(n,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const r=c(n,["pageToken"]);e!==void 0&&r!=null&&h(e,["_query","pageToken"],r);const o=c(n,["filter"]);return e!==void 0&&o!=null&&h(e,["_query","filter"],o),i}function FT(n,e,t){const i={},s=c(n,["pageSize"]);e!==void 0&&s!=null&&h(e,["_query","pageSize"],s);const r=c(n,["pageToken"]);e!==void 0&&r!=null&&h(e,["_query","pageToken"],r);const o=c(n,["filter"]);return e!==void 0&&o!=null&&h(e,["_query","filter"],o),i}function UT(n,e){const t={},i=c(n,["config"]);return i!=null&&DT(i,t),t}function HT(n,e){const t={},i=c(n,["config"]);return i!=null&&FT(i,t),t}function VT(n,e){const t={},i=c(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);const s=c(n,["nextPageToken"]);s!=null&&h(t,["nextPageToken"],s);const r=c(n,["tunedModels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>Qg(a))),h(t,["tuningJobs"],o)}return t}function OT(n,e){const t={},i=c(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);const s=c(n,["nextPageToken"]);s!=null&&h(t,["nextPageToken"],s);const r=c(n,["tuningJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>Al(a))),h(t,["tuningJobs"],o)}return t}function GT(n,e){const t={},i=c(n,["name"]);i!=null&&h(t,["model"],i);const s=c(n,["name"]);return s!=null&&h(t,["endpoint"],s),t}function BT(n,e){const t={};if(c(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(c(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const i=c(n,["examples"]);if(i!=null){let s=i;Array.isArray(s)&&(s=s.map(r=>r)),h(t,["examples","examples"],s)}return t}function zT(n,e,t){const i={};let s=c(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const o=c(n,["gcsUri"]);e!==void 0&&o!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(s==="PREFERENCE_TUNING"){const o=c(n,["gcsUri"]);e!==void 0&&o!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let r=c(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const o=c(n,["vertexDatasetResource"]);e!==void 0&&o!=null&&h(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(r==="PREFERENCE_TUNING"){const o=c(n,["vertexDatasetResource"]);e!==void 0&&o!=null&&h(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(c(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return i}function Qg(n,e){const t={},i=c(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);const s=c(n,["name"]);s!=null&&h(t,["name"],s);const r=c(n,["state"]);r!=null&&h(t,["state"],bg(r));const o=c(n,["createTime"]);o!=null&&h(t,["createTime"],o);const a=c(n,["tuningTask","startTime"]);a!=null&&h(t,["startTime"],a);const l=c(n,["tuningTask","completeTime"]);l!=null&&h(t,["endTime"],l);const u=c(n,["updateTime"]);u!=null&&h(t,["updateTime"],u);const d=c(n,["description"]);d!=null&&h(t,["description"],d);const f=c(n,["baseModel"]);f!=null&&h(t,["baseModel"],f);const p=c(n,["_self"]);return p!=null&&h(t,["tunedModel"],GT(p)),t}function Al(n,e){const t={},i=c(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);const s=c(n,["name"]);s!=null&&h(t,["name"],s);const r=c(n,["state"]);r!=null&&h(t,["state"],bg(r));const o=c(n,["createTime"]);o!=null&&h(t,["createTime"],o);const a=c(n,["startTime"]);a!=null&&h(t,["startTime"],a);const l=c(n,["endTime"]);l!=null&&h(t,["endTime"],l);const u=c(n,["updateTime"]);u!=null&&h(t,["updateTime"],u);const d=c(n,["error"]);d!=null&&h(t,["error"],d);const f=c(n,["description"]);f!=null&&h(t,["description"],f);const p=c(n,["baseModel"]);p!=null&&h(t,["baseModel"],p);const g=c(n,["tunedModel"]);g!=null&&h(t,["tunedModel"],g);const m=c(n,["preTunedModel"]);m!=null&&h(t,["preTunedModel"],m);const v=c(n,["supervisedTuningSpec"]);v!=null&&h(t,["supervisedTuningSpec"],v);const S=c(n,["preferenceOptimizationSpec"]);S!=null&&h(t,["preferenceOptimizationSpec"],S);const y=c(n,["tuningDataStats"]);y!=null&&h(t,["tuningDataStats"],y);const _=c(n,["encryptionSpec"]);_!=null&&h(t,["encryptionSpec"],_);const A=c(n,["partnerModelTuningSpec"]);A!=null&&h(t,["partnerModelTuningSpec"],A);const E=c(n,["customBaseModel"]);E!=null&&h(t,["customBaseModel"],E);const w=c(n,["experiment"]);w!=null&&h(t,["experiment"],w);const C=c(n,["labels"]);C!=null&&h(t,["labels"],C);const T=c(n,["outputUri"]);T!=null&&h(t,["outputUri"],T);const I=c(n,["pipelineJob"]);I!=null&&h(t,["pipelineJob"],I);const P=c(n,["serviceAccount"]);P!=null&&h(t,["serviceAccount"],P);const R=c(n,["tunedModelDisplayName"]);R!=null&&h(t,["tunedModelDisplayName"],R);const L=c(n,["veoTuningSpec"]);return L!=null&&h(t,["veoTuningSpec"],L),t}function qT(n,e){const t={},i=c(n,["sdkHttpResponse"]);i!=null&&h(t,["sdkHttpResponse"],i);const s=c(n,["name"]);s!=null&&h(t,["name"],s);const r=c(n,["metadata"]);r!=null&&h(t,["metadata"],r);const o=c(n,["done"]);o!=null&&h(t,["done"],o);const a=c(n,["error"]);return a!=null&&h(t,["error"],a),t}function Uh(n,e){const t={},i=c(n,["gcsUri"]);i!=null&&h(t,["validationDatasetUri"],i);const s=c(n,["vertexDatasetResource"]);return s!=null&&h(t,["validationDatasetUri"],s),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $T extends nn{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Jn(en.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.tune=async t=>{var i;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const s={tunedModelName:t.baseModel};!((i=t.config)===null||i===void 0)&&i.preTunedModelCheckpointId&&(s.checkpointId=t.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},t),{preTunedModel:s});return r.baseModel=void 0,await this.tuneInternal(r)}else{const s=Object.assign({},t);return await this.tuneInternal(s)}else{const s=Object.assign({},t),r=await this.tuneMldevInternal(s);let o="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?o=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(o=r.name.split("/operations/")[0]),{name:o,state:fl.JOB_STATE_QUEUED}}}}async getInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=LT(e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>Al(d))}else{const u=NT(e);return a=N("{name}",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>Qg(d))}}async listInternal(e){var t,i,s,r;let o,a="",l={};if(this.apiClient.isVertexAI()){const u=HT(e);return a=N("tuningJobs",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=OT(d),p=new mh;return Object.assign(p,f),p})}else{const u=UT(e);return a=N("tunedModels",u._url),l=u._query,delete u._url,delete u._query,o=this.apiClient.request({path:a,queryParams:l,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json().then(f=>{const p=f;return p.sdkHttpResponse={headers:d.headers},p})),o.then(d=>{const f=VT(d),p=new mh;return Object.assign(p,f),p})}}async cancel(e){var t,i,s,r;let o="",a={};if(this.apiClient.isVertexAI()){const l=PT(e);o=N("{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const l=IT(e);o=N("{name}:cancel",l._url),a=l._query,delete l._url,delete l._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async tuneInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI()){const a=bT(e,e);return r=N("tuningJobs",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>Al(l))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,i;let s,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=kT(e);return r=N("tunedModels",a._url),o=a._query,delete a._url,delete a._query,s=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(l=>l.json().then(u=>{const d=u;return d.sdkHttpResponse={headers:l.headers},d})),s.then(l=>qT(l))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class WT{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const YT=1024*1024*8,KT=3,JT=1e3,XT=2,jr="x-goog-upload-status";async function QT(n,e,t){var i;const s=await Zg(n,e,t),r=await s?.json();if(((i=s?.headers)===null||i===void 0?void 0:i[jr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function ZT(n,e,t){var i;const s=await Zg(n,e,t),r=await s?.json();if(((i=s?.headers)===null||i===void 0?void 0:i[jr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const o=xg(r),a=new Nu;return Object.assign(a,o),a}async function Zg(n,e,t){var i,s;let r=0,o=0,a=new pl(new Response),l="upload";for(r=n.size;o<r;){const u=Math.min(YT,r-o),d=n.slice(o,o+u);o+u>=r&&(l+=", finalize");let f=0,p=JT;for(;f<KT&&(a=await t.request({path:"",body:d,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(o),"Content-Length":String(u)}}}),!(!((i=a?.headers)===null||i===void 0)&&i[jr]));)f++,await ex(p),p=p*XT;if(o+=u,((s=a?.headers)===null||s===void 0?void 0:s[jr])!=="active")break;if(r<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function jT(n){return{size:n.size,type:n.type}}function ex(n){return new Promise(e=>setTimeout(e,n))}class tx{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await QT(e,t,i)}async uploadToFileSearchStore(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await ZT(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await jT(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nx{create(e,t,i){return new ix(e,t,i)}}class ix{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Hh="x-goog-api-key";class sx{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(Hh)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Hh,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const rx="gl-node/";class ox{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const i=F_(e.httpOptions,e.vertexai,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion;const s=new sx(this.apiKey);this.apiClient=new SC({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:rx+"web",uploader:new tx,downloader:new WT}),this.models=new OC(this.apiClient),this.live=new LC(this.apiClient,s,new nx),this.batches=new dS(this.apiClient),this.chats=new WS(this.models,this.apiClient),this.caches=new zS(this.apiClient),this.files=new nE(this.apiClient),this.operations=new GC(this.apiClient),this.authTokens=new iT(this.apiClient),this.tunings=new $T(this.apiClient),this.fileSearchStores=new xT(this.apiClient)}}const ax=new ox({apiKey:"AIzaSyB002CdDAWdnwD6l_lYXHfNWKm8Kzgnn5A"}),lx=async(n,e)=>{const t=[];if(e.includeTrueFalse&&t.push("true_false (Vero o Falso)"),e.includeMultipleChoice&&t.push("multiple_choice (Risposta Multipla a 4 opzioni)"),e.includeBasic&&t.push("basic (Domanda aperta classica)"),t.length===0)throw new Error("Devi selezionare almeno un tipo di flash card.");const i=`
    Sei un professore esperto. Analizza il seguente testo e crea esattamente ${e.cardCount} flash card didattiche.
    
    Livello di difficolt: ${e.difficulty}.
    Tipi di domande permessi: ${t.join(", ")}.
    Lingua: Italiano.

    Regole:
    1. Per 'multiple_choice', fornisci 4 opzioni nell'array 'options'.
    2. Per 'true_false', la risposta deve essere "Vero" o "Falso".
    3. Per 'basic', la domanda deve richiedere una risposta breve ma precisa.
    4. Il campo 'correctAnswer' deve corrispondere esattamente a una delle opzioni (per MC), a "Vero"/"Falso" (per TF), o alla risposta corretta (per Basic).
    
    Testo da analizzare:
    "${n.substring(0,3e4)}" 
  `,s={type:Ne.ARRAY,items:{type:Ne.OBJECT,properties:{id:{type:Ne.INTEGER},type:{type:Ne.STRING,enum:[ot.TrueFalse,ot.MultipleChoice,ot.Basic]},question:{type:Ne.STRING},options:{type:Ne.ARRAY,items:{type:Ne.STRING}},correctAnswer:{type:Ne.STRING},userExplanation:{type:Ne.STRING,description:"Breve spiegazione del perch la risposta  corretta"}},required:["id","type","question","correctAnswer"]}};try{const o=(await ax.models.generateContent({model:"gemini-2.5-flash",contents:i,config:{responseMimeType:"application/json",responseSchema:s,temperature:.7}})).text;if(!o)throw new Error("Nessuna risposta dal modello.");return JSON.parse(o).map((l,u)=>({...l,id:u+1}))}catch(r){throw console.error("Errore durante la generazione delle flashcard:",r),new Error("Impossibile generare le flashcard. Riprova o controlla il testo.")}};function ux(){const[n,e]=Ee.useState(!1),[t,i]=Ee.useState(null),[s,r]=Ee.useState([]),[o,a]=Ee.useState({score:0,answers:[],currentCardIndex:0,isFinished:!1}),l=async(f,p)=>{e(!0),i(null);try{const g=await lx(p.text,f);r(g),a({score:0,answers:[],currentCardIndex:0,isFinished:!1})}catch(g){i(g.message||"Qualcosa  andato storto.")}finally{e(!1)}},u=f=>{const p=[...o.answers,f],g=o.currentCardIndex+1>=s.length;a(m=>({...m,score:f?m.score+1:m.score,answers:p,currentCardIndex:g?m.currentCardIndex:m.currentCardIndex+1,isFinished:g}))},d=()=>{r([]),a({score:0,answers:[],currentCardIndex:0,isFinished:!1}),i(null)};return x.jsxs("div",{className:"min-h-screen text-slate-200 overflow-x-hidden relative font-sans",children:[x.jsxs("div",{className:"fixed inset-0 z-[-1] bg-slate-950",children:[x.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[60%] h-[60%] bg-indigo-900/30 rounded-full mix-blend-screen filter blur-[100px] animate-blob"}),x.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-purple-900/20 rounded-full mix-blend-screen filter blur-[100px] animate-blob animation-delay-2000"}),x.jsx("div",{className:"absolute top-[40%] left-[40%] w-[40%] h-[40%] bg-pink-900/20 rounded-full mix-blend-screen filter blur-[100px] animate-blob animation-delay-4000"}),x.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"})]}),x.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8 md:py-12 flex flex-col min-h-screen",children:[x.jsxs("header",{className:`text-center transition-all duration-500 ${s.length>0?"mb-4":"mb-12 mt-10"}`,children:[x.jsxs("div",{className:"inline-flex items-center justify-center space-x-3 mb-2",children:[x.jsx("div",{className:"p-2 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg shadow-indigo-500/30",children:x.jsx("span",{className:"text-2xl md:text-3xl text-white",children:""})}),x.jsx("h1",{className:"text-3xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-purple-300 to-pink-300 tracking-tight",children:"FlashMind AI"})]}),!s.length&&!n&&x.jsx("p",{className:"text-lg text-slate-400 max-w-xl mx-auto mt-4 animate-fade-in",children:"Carica PDF o MD. L'intelligenza artificiale creer il tuo percorso di studio personalizzato."})]}),x.jsxs("main",{className:"flex-grow flex flex-col items-center justify-center w-full",children:[t&&x.jsxs("div",{className:"w-full max-w-lg bg-red-950/50 border border-red-500/50 text-red-200 p-6 rounded-2xl shadow-xl mb-8 animate-slide-up backdrop-blur-sm",children:[x.jsxs("div",{className:"flex items-center mb-2",children:[x.jsx("svg",{className:"w-6 h-6 mr-2 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),x.jsx("h3",{className:"font-bold text-lg",children:"Si  verificato un errore"})]}),x.jsx("p",{className:"opacity-90",children:t}),x.jsx("button",{onClick:()=>i(null),className:"mt-4 px-4 py-2 bg-red-500/20 hover:bg-red-500/40 text-red-300 rounded-lg text-sm font-semibold transition-colors",children:"Riprova"})]}),s.length===0?x.jsx(M_,{onStart:l,isLoading:n}):o.isFinished?x.jsx(b_,{state:o,onRestart:d}):x.jsx(k_,{card:s[o.currentCardIndex],currentIndex:o.currentCardIndex,totalCards:s.length,onAnswer:u},s[o.currentCardIndex].id)]}),x.jsx("footer",{className:"mt-12 text-center text-slate-600 text-sm py-6",children:x.jsx("p",{className:"hover:text-slate-400 transition-colors cursor-default",children:"Powered by Google Gemini 2.5 Flash"})})]})]})}const jg=document.getElementById("root");if(!jg)throw new Error("Could not find root element to mount to");const cx=ca.createRoot(jg);cx.render(x.jsx(ym.StrictMode,{children:x.jsx(ux,{})}));
